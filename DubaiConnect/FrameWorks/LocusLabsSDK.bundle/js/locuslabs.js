function refine_interval(t,e,n){e&n?t[0]=(t[0]+t[1])/2:t[1]=(t[0]+t[1])/2}function calculateAdjacent(t,e){t=t.toLowerCase();var n=t.charAt(t.length-1),i=t.length%2?"odd":"even",s=t.substring(0,t.length-1);return-1!=BORDERS[e][i].indexOf(n)&&(s=calculateAdjacent(s,e)),s+BASE32[NEIGHBORS[e][i].indexOf(n)]}function decodeGeoHash(t){var e=1,n=[],s=[];for(n[0]=-90,n[1]=90,s[0]=-180,s[1]=180,lat_err=90,lon_err=180,i=0;i<t.length;i++)for(c=t[i],cd=BASE32.indexOf(c),j=0;j<5;j++)mask=BITS[j],e?(lon_err/=2,refine_interval(s,cd,mask)):(lat_err/=2,refine_interval(n,cd,mask)),e=!e;return n[2]=(n[0]+n[1])/2,s[2]=(s[0]+s[1])/2,{latitude:n,longitude:s}}function encodeGeoHash(t,e){var n,i=1,s=[],o=[],a=0,r=0,l=12,u="";for(s[0]=-90,s[1]=90,o[0]=-180,o[1]=180;u.length<l;)i?(n=(o[0]+o[1])/2,e>n?(r|=BITS[a],o[0]=n):o[1]=n):(n=(s[0]+s[1])/2,t>n?(r|=BITS[a],s[0]=n):s[1]=n),i=!i,4>a?a++:(u+=BASE32[r],a=0,r=0);return u}function BeaconReading(t,e,n){function i(t,e){return r.getTime()<e-1e3*t}var s=t,o=locuslabs.maps.PositionManager.idForBeaconInfo(t),a=e,r=n;return function(){return{beaconInfo:s,beaconId:o,rssi:a,time:r,isTooOld:i}}()}function PositionSensorReading(t,e,n,i){return function(){return{latLng:t,errorRadius:e,floorId:n,time:i}}()}function BeaconStrengthGauge(t,e){function n(t){var e,n=t.rssi;e=t.timestamp?new Date(t.timestamp):new Date,n>a&&r>n&&p.push(new BeaconReading(d,n,e))}function i(t){if(p.length&&p[p.length-1].isTooOld(u,t))return void(p=[]);for(var e=0;e<p.length;e++)if(!p[e].isTooOld(u,t))return void(p=p.slice(e))}function s(t){if(f!=t){if(i(t),p.length<h)return l;for(var e=0,n=0;e<p.length;e++)n+=p[e].rssi;f=t,g=n/p.length+(m?c:0)}return g}function o(t){m=t}e=e||{};const a=e.minBeaconReading||-100,r=e.maxBeaconReading||-5,l=locuslabs.maps.PositionManager.BEACON_IS_OFF;var u=e.beaconReadingLifespan||5,c=e.bonusForBeingNearest||3,h=e.minimumReadingCount||1,d=t,p=[],f=null,g=l,m=!1,v=locuslabs.maps.PositionManager.idForBeaconInfo(d);return function(){return{addBeaconReading:n,effectiveStrength:s,beaconInfo:d,floorId:d.floorId,beaconReadings:p,markNearest:o,beaconId:v,setBeaconReadingLifespan:function(t){u=t},setBonusForBeingNearest:function(t){c=t},setMinimumReadingCount:function(t){h=t},getBeaconReadingLifespan:function(){return u},getBonusForBeingNearest:function(){return c},getMinimumReadingCount:function(){return h}}}()}function runAllTests(){console.log("window: "+(new locuslabs.MemoryFootprint).process(window)[0]),console.log("map:    "+(new locuslabs.MemoryFootprint).process(map)[0]),(new locuslabs.FindDetachedNodes).output(window),(new locuslabs.FindUnexpectedGlobals).output(),(new locuslabs.CountDomElements).output(document)}var _locuslabs_uglified=!0,locuslabs={_loaded:function(){$.each(locuslabs.maps.event._pendingEvents,function(t,e){locuslabs.maps.event.trigger(e.instance,e.event.type)}),locuslabs.maps._loaded=!0,locuslabs.maps.event.trigger(locuslabs,"locuslabs-loaded")},_loadFiles:function(t,e){if(e.length<=0)return void(t&&t());$.each(e.shift(),function(t,e){var n=document.createElement("script");n.type="text/javascript",n.src=e+"?_="+(new Date).getTime(),$("head").append(n)}),locuslabs._loadFiles(t,e)},configDefaults:{apiBase:"https://api.locuslabs.com",fontsBase:"https://assets.locuslabs.com/fonts/",assetsBase:"https://assets.locuslabs.com/accounts/",assetsFormatVersion:"v2",isPreparingAssets:!1,cache:!0,panZoomMethod:"jqueryPanZoomCss",sdk:"js",sdkVersion:"locuslabs-ios-sdk-1.0.1",walkingSpeed:84},config:{},_getAccountId:function(){return"undefined"==typeof Storage?null:locuslabs.config.accountId?localStorage.getItem("locuslabs."+locuslabs.config.accountId+".id"):null},_setAccountId:function(t){"undefined"!=typeof Storage&&locuslabs.config.accountId&&localStorage.setItem("locuslabs."+locuslabs.config.accountId+".id",t)},_loadAccountId:function(){var t=$.Deferred();if("undefined"==typeof Storage)return locuslabs.error("Local storage not supported!"),t.reject(),t.promise();var e=locuslabs._getAccountId();return e?(locuslabs.log.debug("Found accountId in localStorage:",e),t.resolve(e)):$.ajax(locuslabs.config.apiBase+"/accounts?shortId="+locuslabs.config.accountId).then(function(e){if(!e)return void t.reject("missing data");if(!e.accounts)return void t.reject("missing accounts array");if(!e.accounts.length)return void t.reject("accounts array empty");var n=e.accounts[0];locuslabs.log.debug("Loaded accountId:",n),localStorage.setItem("locuslabs."+locuslabs.config.accountId+".id",n),t.resolve(n)}).fail(function(e){t.reject(e)}),t.promise()},login:function(t,e){var n=JSON.stringify({installs:[locuslabs._getInstallId()]}),i=locuslabs.config.apiBase+"/people/"+t.get("id")+"/links/installs";return locuslabs.log.debug("Login:",i),$.ajax({method:"post",url:i,data:n}).then(function(){locuslabs.log.debug("Login successful for:",t.get("id")),e&&e(t)})},logout:function(t,e){var n=locuslabs.config.apiBase+"/people/"+t.get("id")+"/links/installs/"+locuslabs._getInstallId();return locuslabs.log.debug("Logout:",n),$.ajax({method:"delete",url:n}).then(function(){locuslabs.log.debug("Logout successful for:",t.get("id")),e&&e(t)})},_getInstallId:function(){return"undefined"==typeof Storage?null:localStorage.getItem("locuslabs."+locuslabs._getAccountId()+".install.id")},_setInstallId:function(t){"undefined"!=typeof Storage&&localStorage.setItem("locuslabs."+locuslabs._getAccountId()+".install.id",t)},_loadInstallId:function(){var t=$.Deferred();if("undefined"==typeof Storage)return locuslabs.error("Local storage not supported!"),t.reject(),t.promise();var e=locuslabs._getInstallId();return e?(locuslabs.log.debug("Found installId in localStorage:",e),t.resolve(e)):locuslabs._loadAccountId().then(function(e){locuslabs.log.debug("Got accountId:",e);var n=JSON.stringify({installs:{sdk:locuslabs.config.sdk,links:{account:e}}});$.ajax({method:"post",url:locuslabs.config.apiBase+"/installs",data:n,contentType:"application/vnd.api+json"}).done(function(e,n,i){if(!e)return void t.reject("no data returned");if(!e.installs)return void t.reject("missing installs object");var s=e.installs;locuslabs.log.debug("Created install:",s.id),locuslabs._setInstallId(s.id),t.resolve(s.id)}).fail(function(e){t.reject(e)})}),t.promise()},_setupInstall:function(){locuslabs._loadInstallId().then(function(){locuslabs.log.info("Setup Install complete.")}).fail(function(t){locuslabs.log.info("Failed to register install.",t),setTimeout(locuslabs._setupInstall,3e4)})},finishSetup:function(t){var e={};locuslabs.config.eventsSendNow&&(e.sendNow=!0),locuslabs.events=locuslabs.config.events||new locuslabs.Events(e),locuslabs.session=new locuslabs.Session,locuslabs._setupInstall(),t&&t(),locuslabs._loaded()},setup:function(t,e){t=t||{},$.each(locuslabs.configDefaults,function(t,e){locuslabs.config[t]=e}),$.each(t,function(t,e){locuslabs.config[t]=e}),"undefined"==typeof _locuslabs_uglified?$.ajax({cache:!1,url:"config.json"}).success(function(t){$.each(t,function(t,e){locuslabs.config[t]=e})}).complete(function(){$.ajax({cache:!1,url:"js/files.js"}).success(function(){locuslabs._loadFiles(function(){locuslabs.finishSetup(e)},_locuslabs_filesToLoad)})}):(locuslabs.logAppender.setThreshold(log4javascript.Level.ERROR),locuslabs.finishSetup(e)),locuslabs._handleBrowserDifferences()},_handleBrowserDifferences:function(){"WebkitAppearance"in document.documentElement.style&&(locuslabs.maps.isWebkit=!0)},setupAndroid:function(t){locuslabs._loadFiles(t,_locuslabs_androidFilesToLoad)},setupIOS:function(t){t()},_elementDiv:function(){var t=$("body").find("#__locuslabs_map_elements");return 0===t.length&&(t=$("body").append('<div id="__locuslabs_map_elements"></div>')),t},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})},maps:{MapsEventListener:function(){},_loaded:!1,event:{_pendingEvents:[],addDomListener:function(t,e,n,i,s){i&&console.error("locuslabs.maps.event.addDomListener: capture not supported.");var o=s?"one":"on",a=locuslabs.uuid();$(t)[o](e+".locuslabs."+a,function(n){locuslabs.maps._loaded?locuslabs.maps.event.trigger(t,e):locuslabs.maps.event._pendingEvents.push({event:n,instance:t})}),$(t)[o]("locuslabs-"+e+".locuslabs."+a,function(t){var e=Array.prototype.slice.call(arguments),i=e.slice(1);n.apply(this,i)});var r=new locuslabs.maps.MapsEventListener;return r.instance=t,r.eventName=e,r.uuid=a,r},addDomListenerOnce:function(t,e,n,i){i&&console.error("locuslabs.maps.event.addDomListener: capture not supported."),locuslabs.maps.event.addDomListener(t,e,n,i,!0)},addListener:function(t,e,n){locuslabs.maps.event.addDomListener(t,e,n)},addListenerOnce:function(t,e,n){locuslabs.maps.event.addDomListenerOnce(t,e,n)},clearInstanceListeners:function(t){$(t).off(".locuslabs")},clearListeners:function(t,e){$(t).off("locuslabs-"+e),$(t).off(e+".locuslabs")},removeListener:function(t){$(t.instance).off("."+t.uuid)},trigger:function(t,e){var n=Array.prototype.slice.call(arguments),i=n.slice(2);$(t).trigger("locuslabs-"+e+".locuslabs",i)}}}};!function(t,e){function n(e,n){var s,o,a,r=e.nodeName.toLowerCase();return"area"===r?(s=e.parentNode,o=s.name,e.href&&o&&"map"===s.nodeName.toLowerCase()?(a=t("img[usemap=#"+o+"]")[0],!!a&&i(a)):!1):(/input|select|textarea|button|object/.test(r)?!e.disabled:"a"===r?e.href||n:n)&&i(e)}function i(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}var s=0,o=/^ui-id-\d+$/;t.ui=t.ui||{},t.extend(t.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({focus:function(e){return function(n,i){return"number"==typeof n?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),i&&i.call(e)},n)}):e.apply(this,arguments)}}(t.fn.focus),scrollParent:function(){var e;return e=t.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.css(this,"position"))&&/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(n){if(n!==e)return this.css("zIndex",n);if(this.length)for(var i,s,o=t(this[0]);o.length&&o[0]!==document;){if(i=o.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(o.css("zIndex"),10),!isNaN(s)&&0!==s))return s;o=o.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++s)})},removeUniqueId:function(){return this.each(function(){o.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(n){return!!t.data(n,e)}}):function(e,n,i){return!!t.data(e,i[3])},focusable:function(e){return n(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var i=t.attr(e,"tabindex"),s=isNaN(i);return(s||i>=0)&&n(e,!s)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(n,i){function s(e,n,i,s){return t.each(o,function(){n-=parseFloat(t.css(e,"padding"+this))||0,i&&(n-=parseFloat(t.css(e,"border"+this+"Width"))||0),s&&(n-=parseFloat(t.css(e,"margin"+this))||0)}),n}var o="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),r={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(n){return n===e?r["inner"+i].call(this):this.each(function(){t(this).css(a,s(this,n)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?r["outer"+i].call(this,e):this.each(function(){t(this).css(a,s(this,e,!0,n)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(n){return arguments.length?e.call(this,t.camelCase(n)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.support.selectstart="onselectstart"in document.createElement("div"),t.fn.extend({disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.extend(t.ui,{plugin:{add:function(e,n,i){var s,o=t.ui[e].prototype;for(s in i)o.plugins[s]=o.plugins[s]||[],o.plugins[s].push([n,i[s]])},call:function(t,e,n){var i,s=t.plugins[e];if(s&&t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType)for(i=0;s.length>i;i++)t.options[s[i][0]]&&s[i][1].apply(t.element,n)}},hasScroll:function(e,n){if("hidden"===t(e).css("overflow"))return!1;var i=n&&"left"===n?"scrollLeft":"scrollTop",s=!1;return e[i]>0?!0:(e[i]=1,s=e[i]>0,e[i]=0,s)}})}(jQuery),function(t,e){var n=0,i=Array.prototype.slice,s=t.cleanData;t.cleanData=function(e){for(var n,i=0;null!=(n=e[i]);i++)try{t(n).triggerHandler("remove")}catch(o){}s(e)},t.widget=function(n,i,s){var o,a,r,l,u={},c=n.split(".")[0];n=n.split(".")[1],o=c+"-"+n,s||(s=i,i=t.Widget),t.expr[":"][o.toLowerCase()]=function(e){return!!t.data(e,o)},t[c]=t[c]||{},a=t[c][n],r=t[c][n]=function(t,n){return this._createWidget?(arguments.length&&this._createWidget(t,n),e):new r(t,n)},t.extend(r,a,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),l=new i,l.options=t.widget.extend({},l.options),t.each(s,function(n,s){return t.isFunction(s)?(u[n]=function(){var t=function(){return i.prototype[n].apply(this,arguments)},e=function(t){return i.prototype[n].apply(this,t)};return function(){var n,i=this._super,o=this._superApply;return this._super=t,this._superApply=e,n=s.apply(this,arguments),this._super=i,this._superApply=o,n}}(),e):(u[n]=s,e)}),r.prototype=t.widget.extend(l,{widgetEventPrefix:a?l.widgetEventPrefix||n:n},u,{constructor:r,namespace:c,widgetName:n,widgetFullName:o}),a?(t.each(a._childConstructors,function(e,n){var i=n.prototype;t.widget(i.namespace+"."+i.widgetName,r,n._proto)}),delete a._childConstructors):i._childConstructors.push(r),t.widget.bridge(n,r)},t.widget.extend=function(n){for(var s,o,a=i.call(arguments,1),r=0,l=a.length;l>r;r++)for(s in a[r])o=a[r][s],a[r].hasOwnProperty(s)&&o!==e&&(n[s]=t.isPlainObject(o)?t.isPlainObject(n[s])?t.widget.extend({},n[s],o):t.widget.extend({},o):o);return n},t.widget.bridge=function(n,s){var o=s.prototype.widgetFullName||n;t.fn[n]=function(a){var r="string"==typeof a,l=i.call(arguments,1),u=this;return a=!r&&l.length?t.widget.extend.apply(null,[a].concat(l)):a,r?this.each(function(){var i,s=t.data(this,o);return s?t.isFunction(s[a])&&"_"!==a.charAt(0)?(i=s[a].apply(s,l),i!==s&&i!==e?(u=i&&i.jquery?u.pushStack(i.get()):i,!1):e):t.error("no such method '"+a+"' for "+n+" widget instance"):t.error("cannot call methods on "+n+" prior to initialization; attempted to call method '"+a+"'")}):this.each(function(){var e=t.data(this,o);e?e.option(a||{})._init():t.data(this,o,new s(a,this))}),u}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(n,i){var s,o,a,r=n;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof n)if(r={},s=n.split("."),n=s.shift(),s.length){for(o=r[n]=t.widget.extend({},this.options[n]),a=0;s.length-1>a;a++)o[s[a]]=o[s[a]]||{},o=o[s[a]];if(n=s.pop(),1===arguments.length)return o[n]===e?null:o[n];o[n]=i}else{if(1===arguments.length)return this.options[n]===e?null:this.options[n];r[n]=i}return this._setOptions(r),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(n,i,s){var o,a=this;"boolean"!=typeof n&&(s=i,i=n,n=!1),s?(i=o=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,o=this.widget()),t.each(s,function(s,r){function l(){return n||a.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof r?a[r]:r).apply(a,arguments):e}"string"!=typeof r&&(l.guid=r.guid=r.guid||l.guid||t.guid++);var u=s.match(/^(\w+)\s*(.*)$/),c=u[1]+a.eventNamespace,h=u[2];h?o.delegate(h,c,l):i.bind(c,l)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function n(){return("string"==typeof t?i[t]:t).apply(i,arguments)}var i=this;return setTimeout(n,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,n,i){var s,o,a=this.options[e];if(i=i||{},n=t.Event(n),n.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),n.target=this.element[0],o=n.originalEvent)for(s in o)s in n||(n[s]=o[s]);return this.element.trigger(n,i),!(t.isFunction(a)&&a.apply(this.element[0],[n].concat(i))===!1||n.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,n){t.Widget.prototype["_"+e]=function(i,s,o){"string"==typeof s&&(s={effect:s});var a,r=s?s===!0||"number"==typeof s?n:s.effect||n:e;s=s||{},"number"==typeof s&&(s={duration:s}),a=!t.isEmptyObject(s),s.complete=o,s.delay&&i.delay(s.delay),a&&t.effects&&t.effects.effect[r]?i[e](s):r!==e&&i[r]?i[r](s.duration,s.easing,o):i.queue(function(n){t(this)[e](),o&&o.call(i[0]),n()})}})}(jQuery),function(t){var e=!1;t(document).mouseup(function(){e=!1}),t.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(n){return!0===t.data(n.target,e.widgetName+".preventClickEvent")?(t.removeData(n.target,e.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(n){if(!e){this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var i=this,s=1===n.which,o="string"==typeof this.options.cancel&&n.target.nodeName?t(n.target).closest(this.options.cancel).length:!1;return s&&!o&&this._mouseCapture(n)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=this._mouseStart(n)!==!1,!this._mouseStarted)?(n.preventDefault(),!0):(!0===t.data(n.target,this.widgetName+".preventClickEvent")&&t.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),e=!0,!0)):!0}},_mouseMove:function(e){return t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button?this._mouseUp(e):this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(t,e){function n(t,e,n){return[parseFloat(t[0])*(p.test(t[0])?e/100:1),parseFloat(t[1])*(p.test(t[1])?n/100:1)]}function i(e,n){return parseInt(t.css(e,n),10)||0}function s(e){var n=e[0];return 9===n.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(n)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}t.ui=t.ui||{};var o,a=Math.max,r=Math.abs,l=Math.round,u=/left|center|right/,c=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,p=/%$/,f=t.fn.position;t.position={scrollbarWidth:function(){if(o!==e)return o;var n,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=s.children()[0];return t("body").append(s),n=a.offsetWidth,s.css("overflow","scroll"),i=a.offsetWidth,n===i&&(i=s[0].clientWidth),s.remove(),o=n-i},getScrollInfo:function(e){var n=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),i=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),s="scroll"===n||"auto"===n&&e.width<e.element[0].scrollWidth,o="scroll"===i||"auto"===i&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:s?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var n=t(e||window),i=t.isWindow(n[0]),s=!!n[0]&&9===n[0].nodeType;return{element:n,isWindow:i,isDocument:s,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:i?n.width():n.outerWidth(),height:i?n.height():n.outerHeight()}}},t.fn.position=function(e){if(!e||!e.of)return f.apply(this,arguments);e=t.extend({},e);var o,p,g,m,v,b,y=t(e.of),_=t.position.getWithinInfo(e.within),w=t.position.getScrollInfo(_),M=(e.collision||"flip").split(" "),x={};return b=s(y),y[0].preventDefault&&(e.at="left top"),p=b.width,g=b.height,m=b.offset,v=t.extend({},m),t.each(["my","at"],function(){var t,n,i=(e[this]||"").split(" ");1===i.length&&(i=u.test(i[0])?i.concat(["center"]):c.test(i[0])?["center"].concat(i):["center","center"]),i[0]=u.test(i[0])?i[0]:"center",i[1]=c.test(i[1])?i[1]:"center",t=h.exec(i[0]),n=h.exec(i[1]),x[this]=[t?t[0]:0,n?n[0]:0],e[this]=[d.exec(i[0])[0],d.exec(i[1])[0]]}),1===M.length&&(M[1]=M[0]),"right"===e.at[0]?v.left+=p:"center"===e.at[0]&&(v.left+=p/2),"bottom"===e.at[1]?v.top+=g:"center"===e.at[1]&&(v.top+=g/2),o=n(x.at,p,g),v.left+=o[0],v.top+=o[1],this.each(function(){var s,u,c=t(this),h=c.outerWidth(),d=c.outerHeight(),f=i(this,"marginLeft"),b=i(this,"marginTop"),C=h+f+i(this,"marginRight")+w.width,I=d+b+i(this,"marginBottom")+w.height,S=t.extend({},v),E=n(x.my,c.outerWidth(),c.outerHeight());"right"===e.my[0]?S.left-=h:"center"===e.my[0]&&(S.left-=h/2),"bottom"===e.my[1]?S.top-=d:"center"===e.my[1]&&(S.top-=d/2),S.left+=E[0],S.top+=E[1],t.support.offsetFractions||(S.left=l(S.left),S.top=l(S.top)),s={marginLeft:f,marginTop:b},t.each(["left","top"],function(n,i){t.ui.position[M[n]]&&t.ui.position[M[n]][i](S,{targetWidth:p,targetHeight:g,elemWidth:h,elemHeight:d,collisionPosition:s,collisionWidth:C,collisionHeight:I,offset:[o[0]+E[0],o[1]+E[1]],my:e.my,at:e.at,within:_,elem:c})}),e.using&&(u=function(t){var n=m.left-S.left,i=n+p-h,s=m.top-S.top,o=s+g-d,l={target:{element:y,left:m.left,top:m.top,width:p,height:g},element:{element:c,left:S.left,top:S.top,width:h,height:d},horizontal:0>i?"left":n>0?"right":"center",vertical:0>o?"top":s>0?"bottom":"middle"};h>p&&p>r(n+i)&&(l.horizontal="center"),d>g&&g>r(s+o)&&(l.vertical="middle"),l.important=a(r(n),r(i))>a(r(s),r(o))?"horizontal":"vertical",e.using.call(this,t,l)}),c.offset(t.extend(S,{using:u}))})},t.ui.position={fit:{left:function(t,e){var n,i=e.within,s=i.isWindow?i.scrollLeft:i.offset.left,o=i.width,r=t.left-e.collisionPosition.marginLeft,l=s-r,u=r+e.collisionWidth-o-s;e.collisionWidth>o?l>0&&0>=u?(n=t.left+l+e.collisionWidth-o-s,t.left+=l-n):t.left=u>0&&0>=l?s:l>u?s+o-e.collisionWidth:s:l>0?t.left+=l:u>0?t.left-=u:t.left=a(t.left-r,t.left)},top:function(t,e){var n,i=e.within,s=i.isWindow?i.scrollTop:i.offset.top,o=e.within.height,r=t.top-e.collisionPosition.marginTop,l=s-r,u=r+e.collisionHeight-o-s;e.collisionHeight>o?l>0&&0>=u?(n=t.top+l+e.collisionHeight-o-s,t.top+=l-n):t.top=u>0&&0>=l?s:l>u?s+o-e.collisionHeight:s:l>0?t.top+=l:u>0?t.top-=u:t.top=a(t.top-r,t.top)}},flip:{left:function(t,e){var n,i,s=e.within,o=s.offset.left+s.scrollLeft,a=s.width,l=s.isWindow?s.scrollLeft:s.offset.left,u=t.left-e.collisionPosition.marginLeft,c=u-l,h=u+e.collisionWidth-a-l,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(n=t.left+d+p+f+e.collisionWidth-a-o,(0>n||r(c)>n)&&(t.left+=d+p+f)):h>0&&(i=t.left-e.collisionPosition.marginLeft+d+p+f-l,(i>0||h>r(i))&&(t.left+=d+p+f))},top:function(t,e){var n,i,s=e.within,o=s.offset.top+s.scrollTop,a=s.height,l=s.isWindow?s.scrollTop:s.offset.top,u=t.top-e.collisionPosition.marginTop,c=u-l,h=u+e.collisionHeight-a-l,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(i=t.top+p+f+g+e.collisionHeight-a-o,t.top+p+f+g>c&&(0>i||r(c)>i)&&(t.top+=p+f+g)):h>0&&(n=t.top-e.collisionPosition.marginTop+p+f+g-l,t.top+p+f+g>h&&(n>0||h>r(n))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var e,n,i,s,o,a=document.getElementsByTagName("body")[0],r=document.createElement("div");e=document.createElement(a?"div":"body"),i={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},a&&t.extend(i,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in i)e.style[o]=i[o];e.appendChild(r),n=a||document.documentElement,n.insertBefore(e,n.firstChild),r.style.cssText="position: absolute; left: 10.7432222px;",s=t(r).offset().left,t.support.offsetFractions=s>10&&11>s,e.innerHTML="",n.removeChild(e)}()}(jQuery),function(t){t.widget("ui.draggable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(e){var n=this.options;return this.helper||n.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(t(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){t("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(e){var n=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,n){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!n){var i=this._uiHash();if(this._trigger("drag",e,i)===!1)return this._mouseUp({}),!1;this.position=i.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var n=this,i=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(i=t.ui.ddmanager.drop(this,e)),this.dropped&&(i=this.dropped,this.dropped=!1),"original"!==this.options.helper||t.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!i||"valid"===this.options.revert&&i||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){
n._trigger("stop",e)!==!1&&n._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1):!1},_mouseUp:function(e){return t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(e){var n=this.options,i=t.isFunction(n.helper)?t(n.helper.apply(this.element[0],[e])):"clone"===n.helper?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo("parent"===n.appendTo?this.element[0].parentNode:n.appendTo),i[0]===this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,n,i,s=this.options;return s.containment?"window"===s.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===s.containment?void(this.containment=[0,0,t(document).width()-this.helperProportions.width-this.margins.left,(t(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):s.containment.constructor===Array?void(this.containment=s.containment):("parent"===s.containment&&(s.containment=this.helper[0].parentNode),n=t(s.containment),i=n[0],void(i&&(e="hidden"!==n.css("overflow"),this.containment=[(parseInt(n.css("borderLeftWidth"),10)||0)+(parseInt(n.css("paddingLeft"),10)||0),(parseInt(n.css("borderTopWidth"),10)||0)+(parseInt(n.css("paddingTop"),10)||0),(e?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(n.css("borderRightWidth"),10)||0)-(parseInt(n.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(n.css("borderBottomWidth"),10)||0)-(parseInt(n.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n))):void(this.containment=null)},_convertPositionTo:function(e,n){n||(n=this.position);var i="absolute"===e?1:-1,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:s.scrollTop(),left:s.scrollLeft()}),{top:n.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*i,left:n.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*i}},_generatePosition:function(e){var n,i,s,o,a=this.options,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=e.pageX,u=e.pageY;return this.offset.scroll||(this.offset.scroll={top:r.scrollTop(),left:r.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(i=this.relative_container.offset(),n=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):n=this.containment,e.pageX-this.offset.click.left<n[0]&&(l=n[0]+this.offset.click.left),e.pageY-this.offset.click.top<n[1]&&(u=n[1]+this.offset.click.top),e.pageX-this.offset.click.left>n[2]&&(l=n[2]+this.offset.click.left),e.pageY-this.offset.click.top>n[3]&&(u=n[3]+this.offset.click.top)),a.grid&&(s=a.grid[1]?this.originalPageY+Math.round((u-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,u=n?s-this.offset.click.top>=n[1]||s-this.offset.click.top>n[3]?s:s-this.offset.click.top>=n[1]?s-a.grid[1]:s+a.grid[1]:s,o=a.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,l=n?o-this.offset.click.left>=n[0]||o-this.offset.click.left>n[2]?o:o-this.offset.click.left>=n[0]?o-a.grid[0]:o+a.grid[0]:o)),{top:u-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,n,i){return i=i||this._uiHash(),t.ui.plugin.call(this,e,[n,i]),"drag"===e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,n,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,n){var i=t(this).data("ui-draggable"),s=i.options,o=t.extend({},n,{item:i.element});i.sortables=[],t(s.connectToSortable).each(function(){var n=t.data(this,"ui-sortable");n&&!n.options.disabled&&(i.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",e,o))})},stop:function(e,n){var i=t(this).data("ui-draggable"),s=t.extend({},n,{item:i.element});t.each(i.sortables,function(){this.instance.isOver?(this.instance.isOver=0,i.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"===i.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,s))})},drag:function(e,n){var i=t(this).data("ui-draggable"),s=this;t.each(i.sortables,function(){var o=!1,a=this;this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,t.each(i.sortables,function(){return this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this!==a&&this.instance._intersectsWith(this.instance.containerCache)&&t.contains(a.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(s).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i._trigger("toSortable",e),i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i._trigger("fromSortable",e),i.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(){var e=t("body"),n=t(this).data("ui-draggable").options;e.css("cursor")&&(n._cursor=e.css("cursor")),e.css("cursor",n.cursor)},stop:function(){var e=t(this).data("ui-draggable").options;e._cursor&&t("body").css("cursor",e._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,n){var i=t(n.helper),s=t(this).data("ui-draggable").options;i.css("opacity")&&(s._opacity=i.css("opacity")),i.css("opacity",s.opacity)},stop:function(e,n){var i=t(this).data("ui-draggable").options;i._opacity&&t(n.helper).css("opacity",i._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(){var e=t(this).data("ui-draggable");e.scrollParent[0]!==document&&"HTML"!==e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var n=t(this).data("ui-draggable"),i=n.options,s=!1;n.scrollParent[0]!==document&&"HTML"!==n.scrollParent[0].tagName?(i.axis&&"x"===i.axis||(n.overflowOffset.top+n.scrollParent[0].offsetHeight-e.pageY<i.scrollSensitivity?n.scrollParent[0].scrollTop=s=n.scrollParent[0].scrollTop+i.scrollSpeed:e.pageY-n.overflowOffset.top<i.scrollSensitivity&&(n.scrollParent[0].scrollTop=s=n.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&"y"===i.axis||(n.overflowOffset.left+n.scrollParent[0].offsetWidth-e.pageX<i.scrollSensitivity?n.scrollParent[0].scrollLeft=s=n.scrollParent[0].scrollLeft+i.scrollSpeed:e.pageX-n.overflowOffset.left<i.scrollSensitivity&&(n.scrollParent[0].scrollLeft=s=n.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&"x"===i.axis||(e.pageY-t(document).scrollTop()<i.scrollSensitivity?s=t(document).scrollTop(t(document).scrollTop()-i.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<i.scrollSensitivity&&(s=t(document).scrollTop(t(document).scrollTop()+i.scrollSpeed))),i.axis&&"y"===i.axis||(e.pageX-t(document).scrollLeft()<i.scrollSensitivity?s=t(document).scrollLeft(t(document).scrollLeft()-i.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<i.scrollSensitivity&&(s=t(document).scrollLeft(t(document).scrollLeft()+i.scrollSpeed)))),s!==!1&&t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(n,e)}}),t.ui.plugin.add("draggable","snap",{start:function(){var e=t(this).data("ui-draggable"),n=e.options;e.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var n=t(this),i=n.offset();this!==e.element[0]&&e.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:i.top,left:i.left})})},drag:function(e,n){var i,s,o,a,r,l,u,c,h,d,p=t(this).data("ui-draggable"),f=p.options,g=f.snapTolerance,m=n.offset.left,v=m+p.helperProportions.width,b=n.offset.top,y=b+p.helperProportions.height;for(h=p.snapElements.length-1;h>=0;h--)r=p.snapElements[h].left,l=r+p.snapElements[h].width,u=p.snapElements[h].top,c=u+p.snapElements[h].height,r-g>v||m>l+g||u-g>y||b>c+g||!t.contains(p.snapElements[h].item.ownerDocument,p.snapElements[h].item)?(p.snapElements[h].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,e,t.extend(p._uiHash(),{snapItem:p.snapElements[h].item})),p.snapElements[h].snapping=!1):("inner"!==f.snapMode&&(i=g>=Math.abs(u-y),s=g>=Math.abs(c-b),o=g>=Math.abs(r-v),a=g>=Math.abs(l-m),i&&(n.position.top=p._convertPositionTo("relative",{top:u-p.helperProportions.height,left:0}).top-p.margins.top),s&&(n.position.top=p._convertPositionTo("relative",{top:c,left:0}).top-p.margins.top),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:r-p.helperProportions.width}).left-p.margins.left),a&&(n.position.left=p._convertPositionTo("relative",{top:0,left:l}).left-p.margins.left)),d=i||s||o||a,"outer"!==f.snapMode&&(i=g>=Math.abs(u-b),s=g>=Math.abs(c-y),o=g>=Math.abs(r-m),a=g>=Math.abs(l-v),i&&(n.position.top=p._convertPositionTo("relative",{top:u,left:0}).top-p.margins.top),s&&(n.position.top=p._convertPositionTo("relative",{top:c-p.helperProportions.height,left:0}).top-p.margins.top),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:r}).left-p.margins.left),a&&(n.position.left=p._convertPositionTo("relative",{top:0,left:l-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[h].snapping&&(i||s||o||a||d)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,e,t.extend(p._uiHash(),{snapItem:p.snapElements[h].item})),p.snapElements[h].snapping=i||s||o||a||d)}}),t.ui.plugin.add("draggable","stack",{start:function(){var e,n=this.data("ui-draggable").options,i=t.makeArray(t(n.stack)).sort(function(e,n){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(n).css("zIndex"),10)||0)});i.length&&(e=parseInt(t(i[0]).css("zIndex"),10)||0,t(i).each(function(n){t(this).css("zIndex",e+n)}),this.css("zIndex",e+i.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,n){var i=t(n.helper),s=t(this).data("ui-draggable").options;i.css("zIndex")&&(s._zIndex=i.css("zIndex")),i.css("zIndex",s.zIndex)},stop:function(e,n){var i=t(this).data("ui-draggable").options;i._zIndex&&t(n.helper).css("zIndex",i._zIndex)}})}(jQuery),function(t){function e(t,e,n){return t>e&&e+n>t}t.widget("ui.droppable",{version:"1.10.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,n=this.options,i=n.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(i)?i:function(t){return t.is(i)},this.proportions=function(){return arguments.length?void(e=arguments[0]):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},t.ui.ddmanager.droppables[n.scope]=t.ui.ddmanager.droppables[n.scope]||[],t.ui.ddmanager.droppables[n.scope].push(this),n.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var e=0,n=t.ui.ddmanager.droppables[this.options.scope];n.length>e;e++)n[e]===this&&n.splice(e,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,n){"accept"===e&&(this.accept=t.isFunction(n)?n:function(t){return t.is(n)}),t.Widget.prototype._setOption.apply(this,arguments)},_activate:function(e){var n=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",e,this.ui(n))},_deactivate:function(e){var n=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",e,this.ui(n))},_over:function(e){var n=t.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(n)))},_out:function(e){var n=t.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(n)))},_drop:function(e,n){var i=n||t.ui.ddmanager.current,s=!1;return i&&(i.currentItem||i.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var e=t.data(this,"ui-droppable");return e.options.greedy&&!e.options.disabled&&e.options.scope===i.options.scope&&e.accept.call(e.element[0],i.currentItem||i.element)&&t.ui.intersect(i,t.extend(e,{offset:e.element.offset()}),e.options.tolerance)?(s=!0,!1):void 0}),s?!1:this.accept.call(this.element[0],i.currentItem||i.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(i)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.ui.intersect=function(t,n,i){if(!n.offset)return!1;var s,o,a=(t.positionAbs||t.position.absolute).left,r=(t.positionAbs||t.position.absolute).top,l=a+t.helperProportions.width,u=r+t.helperProportions.height,c=n.offset.left,h=n.offset.top,d=c+n.proportions().width,p=h+n.proportions().height;switch(i){case"fit":return a>=c&&d>=l&&r>=h&&p>=u;case"intersect":return a+t.helperProportions.width/2>c&&d>l-t.helperProportions.width/2&&r+t.helperProportions.height/2>h&&p>u-t.helperProportions.height/2;case"pointer":return s=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,o=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,e(o,h,n.proportions().height)&&e(s,c,n.proportions().width);case"touch":return(r>=h&&p>=r||u>=h&&p>=u||h>r&&u>p)&&(a>=c&&d>=a||l>=c&&d>=l||c>a&&l>d);default:return!1}},t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,n){var i,s,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=n?n.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(i=0;o.length>i;i++)if(!(o[i].options.disabled||e&&!o[i].accept.call(o[i].element[0],e.currentItem||e.element))){for(s=0;r.length>s;s++)if(r[s]===o[i].element[0]){o[i].proportions().height=0;continue t}o[i].visible="none"!==o[i].element.css("display"),o[i].visible&&("mousedown"===a&&o[i]._activate.call(o[i],n),o[i].offset=o[i].element.offset(),o[i].proportions({width:o[i].element[0].offsetWidth,height:o[i].element[0].offsetHeight}))}},drop:function(e,n){var i=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance)&&(i=this._drop.call(this,n)||i),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,n)))}),i},dragStart:function(e,n){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,n)})},drag:function(e,n){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,n),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var i,s,o,a=t.ui.intersect(e,this,this.options.tolerance),r=!a&&this.isover?"isout":a&&!this.isover?"isover":null;r&&(this.options.greedy&&(s=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return t.data(this,"ui-droppable").options.scope===s}),o.length&&(i=t.data(o[0],"ui-droppable"),i.greedyChild="isover"===r)),i&&"isover"===r&&(i.isover=!1,i.isout=!0,i._out.call(i,n)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,n),i&&"isout"===r&&(i.isout=!1,i.isover=!0,i._over.call(i,n)))}})},dragStop:function(e,n){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,n)}}}(jQuery),function(t){function e(t){return parseInt(t,10)||0}function n(t){return!isNaN(parseInt(t,10))}t.widget("ui.resizable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var e,n,i,s,o,a=this,r=this.options;if(this.element.addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),e=this.handles.split(","),this.handles={},n=0;e.length>n;n++)i=t.trim(e[n]),o="ui-resizable-"+i,s=t("<div class='ui-resizable-handle "+o+"'></div>"),s.css({zIndex:r.zIndex}),"se"===i&&s.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[i]=".ui-resizable-"+i,this.element.append(s);this._renderAxis=function(e){var n,i,s,o;e=e||this.element;for(n in this.handles)this.handles[n].constructor===String&&(this.handles[n]=t(this.handles[n],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(i=t(this.handles[n],this.element),o=/sw|ne|nw|se|n|s/.test(n)?i.outerHeight():i.outerWidth(),s=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),e.css(s,o),this._proportionallyResize()),t(this.handles[n]).length},this._renderAxis(this.element),this._handles=t(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){a.resizing||(this.className&&(s=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=s&&s[1]?s[1]:"se")}),r.autoHide&&(this._handles.hide(),t(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(t(this).removeClass("ui-resizable-autohide"),a._handles.show())}).mouseleave(function(){r.disabled||a.resizing||(t(this).addClass("ui-resizable-autohide"),a._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,n=function(e){t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(n(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_mouseCapture:function(e){var n,i,s=!1;for(n in this.handles)i=t(this.handles[n])[0],(i===e.target||t.contains(i,e.target))&&(s=!0);return!this.options.disabled&&s},_mouseStart:function(n){var i,s,o,a=this.options,r=this.element.position(),l=this.element;return this.resizing=!0,/absolute/.test(l.css("position"))?l.css({position:"absolute",top:l.css("top"),left:l.css("left")}):l.is(".ui-draggable")&&l.css({position:"absolute",top:r.top,left:r.left}),this._renderProxy(),i=e(this.helper.css("left")),s=e(this.helper.css("top")),a.containment&&(i+=t(a.containment).scrollLeft()||0,s+=t(a.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:l.width(),height:l.height()},this.originalSize=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalPosition={left:i,top:s},this.sizeDiff={width:l.outerWidth()-l.width(),height:l.outerHeight()-l.height()},this.originalMousePosition={left:n.pageX,top:n.pageY},this.aspectRatio="number"==typeof a.aspectRatio?a.aspectRatio:this.originalSize.width/this.originalSize.height||1,o=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===o?this.axis+"-resize":o),l.addClass("ui-resizable-resizing"),this._propagate("start",n),!0},_mouseDrag:function(e){var n,i=this.helper,s={},o=this.originalMousePosition,a=this.axis,r=this.position.top,l=this.position.left,u=this.size.width,c=this.size.height,h=e.pageX-o.left||0,d=e.pageY-o.top||0,p=this._change[a];return p?(n=p.apply(this,[e,h,d]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(n=this._updateRatio(n,e)),n=this._respectSize(n,e),this._updateCache(n),this._propagate("resize",e),this.position.top!==r&&(s.top=this.position.top+"px"),this.position.left!==l&&(s.left=this.position.left+"px"),this.size.width!==u&&(s.width=this.size.width+"px"),this.size.height!==c&&(s.height=this.size.height+"px"),i.css(s),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||this._trigger("resize",e,this.ui()),!1):!1},_mouseStop:function(e){this.resizing=!1;var n,i,s,o,a,r,l,u=this.options,c=this;return this._helper&&(n=this._proportionallyResizeElements,i=n.length&&/textarea/i.test(n[0].nodeName),s=i&&t.ui.hasScroll(n[0],"left")?0:c.sizeDiff.height,o=i?0:c.sizeDiff.width,a={width:c.helper.width()-o,height:c.helper.height()-s},r=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,l=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null,u.animate||this.element.css(t.extend(a,{top:l,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!u.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(t){var e,i,s,o,a,r=this.options;a={minWidth:n(r.minWidth)?r.minWidth:0,maxWidth:n(r.maxWidth)?r.maxWidth:1/0,minHeight:n(r.minHeight)?r.minHeight:0,maxHeight:n(r.maxHeight)?r.maxHeight:1/0},(this._aspectRatio||t)&&(e=a.minHeight*this.aspectRatio,s=a.minWidth/this.aspectRatio,i=a.maxHeight*this.aspectRatio,o=a.maxWidth/this.aspectRatio,e>a.minWidth&&(a.minWidth=e),s>a.minHeight&&(a.minHeight=s),a.maxWidth>i&&(a.maxWidth=i),a.maxHeight>o&&(a.maxHeight=o)),this._vBoundaries=a},_updateCache:function(t){this.offset=this.helper.offset(),n(t.left)&&(this.position.left=t.left),n(t.top)&&(this.position.top=t.top),n(t.height)&&(this.size.height=t.height),n(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,s=this.axis;return n(t.height)?t.width=t.height*this.aspectRatio:n(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,s=n(t.width)&&e.maxWidth&&e.maxWidth<t.width,o=n(t.height)&&e.maxHeight&&e.maxHeight<t.height,a=n(t.width)&&e.minWidth&&e.minWidth>t.width,r=n(t.height)&&e.minHeight&&e.minHeight>t.height,l=this.originalPosition.left+this.originalSize.width,u=this.position.top+this.size.height,c=/sw|nw|w/.test(i),h=/nw|ne|n/.test(i);return a&&(t.width=e.minWidth),r&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),o&&(t.height=e.maxHeight),a&&c&&(t.left=l-e.minWidth),s&&c&&(t.left=l-e.maxWidth),r&&h&&(t.top=u-e.minHeight),o&&h&&(t.top=u-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var t,e,n,i,s,o=this.helper||this.element;for(t=0;this._proportionallyResizeElements.length>t;t++){if(s=this._proportionallyResizeElements[t],!this.borderDif)for(this.borderDif=[],n=[s.css("borderTopWidth"),s.css("borderRightWidth"),s.css("borderBottomWidth"),s.css("borderLeftWidth")],i=[s.css("paddingTop"),s.css("paddingRight"),s.css("paddingBottom"),s.css("paddingLeft")],e=0;n.length>e;e++)this.borderDif[e]=(parseInt(n[e],10)||0)+(parseInt(i[e],10)||0);s.css({height:o.height()-this.borderDif[0]-this.borderDif[2]||0,width:o.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var e=this.element,n=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var n=this.originalSize,i=this.originalPosition;return{left:i.left+e,width:n.width-e}},n:function(t,e,n){var i=this.originalSize,s=this.originalPosition;return{top:s.top+n,height:i.height-n}},s:function(t,e,n){return{height:this.originalSize.height+n}},se:function(e,n,i){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,n,i]))},sw:function(e,n,i){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,n,i]))},ne:function(e,n,i){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,n,i]))},nw:function(e,n,i){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,n,i]))}},_propagate:function(e,n){t.ui.plugin.call(this,e,[n,this.ui()]),"resize"!==e&&this._trigger(e,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var n=t(this).data("ui-resizable"),i=n.options,s=n._proportionallyResizeElements,o=s.length&&/textarea/i.test(s[0].nodeName),a=o&&t.ui.hasScroll(s[0],"left")?0:n.sizeDiff.height,r=o?0:n.sizeDiff.width,l={width:n.size.width-r,height:n.size.height-a},u=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,c=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;
n.element.animate(t.extend(l,c&&u?{top:c,left:u}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var i={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};s&&s.length&&t(s[0]).css({width:i.width,height:i.height}),n._updateCache(i),n._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var n,i,s,o,a,r,l,u=t(this).data("ui-resizable"),c=u.options,h=u.element,d=c.containment,p=d instanceof t?d.get(0):/parent/.test(d)?h.parent().get(0):d;p&&(u.containerElement=t(p),/document/.test(d)||d===document?(u.containerOffset={left:0,top:0},u.containerPosition={left:0,top:0},u.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(n=t(p),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=e(n.css("padding"+s))}),u.containerOffset=n.offset(),u.containerPosition=n.position(),u.containerSize={height:n.innerHeight()-i[3],width:n.innerWidth()-i[1]},s=u.containerOffset,o=u.containerSize.height,a=u.containerSize.width,r=t.ui.hasScroll(p,"left")?p.scrollWidth:a,l=t.ui.hasScroll(p)?p.scrollHeight:o,u.parentData={element:p,left:s.left,top:s.top,width:r,height:l}))},resize:function(e){var n,i,s,o,a=t(this).data("ui-resizable"),r=a.options,l=a.containerOffset,u=a.position,c=a._aspectRatio||e.shiftKey,h={top:0,left:0},d=a.containerElement;d[0]!==document&&/static/.test(d.css("position"))&&(h=l),u.left<(a._helper?l.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-l.left:a.position.left-h.left),c&&(a.size.height=a.size.width/a.aspectRatio),a.position.left=r.helper?l.left:0),u.top<(a._helper?l.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-l.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio),a.position.top=a._helper?l.top:0),a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top,n=Math.abs((a._helper?a.offset.left-h.left:a.offset.left-h.left)+a.sizeDiff.width),i=Math.abs((a._helper?a.offset.top-h.top:a.offset.top-l.top)+a.sizeDiff.height),s=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),s&&o&&(n-=Math.abs(a.parentData.left)),n+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-n,c&&(a.size.height=a.size.width/a.aspectRatio)),i+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-i,c&&(a.size.width=a.size.height*a.aspectRatio))},stop:function(){var e=t(this).data("ui-resizable"),n=e.options,i=e.containerOffset,s=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),l=a.outerWidth()-e.sizeDiff.width,u=a.outerHeight()-e.sizeDiff.height;e._helper&&!n.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-s.left-i.left,width:l,height:u}),e._helper&&!n.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-s.left-i.left,width:l,height:u})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).data("ui-resizable"),n=e.options,i=function(e){t(e).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)})})};"object"!=typeof n.alsoResize||n.alsoResize.parentNode?i(n.alsoResize):n.alsoResize.length?(n.alsoResize=n.alsoResize[0],i(n.alsoResize)):t.each(n.alsoResize,function(t){i(t)})},resize:function(e,n){var i=t(this).data("ui-resizable"),s=i.options,o=i.originalSize,a=i.originalPosition,r={height:i.size.height-o.height||0,width:i.size.width-o.width||0,top:i.position.top-a.top||0,left:i.position.left-a.left||0},l=function(e,i){t(e).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),o={},a=i&&i.length?i:e.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(a,function(t,e){var n=(s[e]||0)+(r[e]||0);n&&n>=0&&(o[e]=n||null)}),e.css(o)})};"object"!=typeof s.alsoResize||s.alsoResize.nodeType?l(s.alsoResize):t.each(s.alsoResize,function(t,e){l(t,e)})},stop:function(){t(this).removeData("resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).data("ui-resizable"),n=e.options,i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof n.ghost?n.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).data("ui-resizable");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).data("ui-resizable");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e=t(this).data("ui-resizable"),n=e.options,i=e.size,s=e.originalSize,o=e.originalPosition,a=e.axis,r="number"==typeof n.grid?[n.grid,n.grid]:n.grid,l=r[0]||1,u=r[1]||1,c=Math.round((i.width-s.width)/l)*l,h=Math.round((i.height-s.height)/u)*u,d=s.width+c,p=s.height+h,f=n.maxWidth&&d>n.maxWidth,g=n.maxHeight&&p>n.maxHeight,m=n.minWidth&&n.minWidth>d,v=n.minHeight&&n.minHeight>p;n.grid=r,m&&(d+=l),v&&(p+=u),f&&(d-=l),g&&(p-=u),/^(se|s|e)$/.test(a)?(e.size.width=d,e.size.height=p):/^(ne)$/.test(a)?(e.size.width=d,e.size.height=p,e.position.top=o.top-h):/^(sw)$/.test(a)?(e.size.width=d,e.size.height=p,e.position.left=o.left-c):(p-u>0?(e.size.height=p,e.position.top=o.top-h):(e.size.height=u,e.position.top=o.top+s.height-u),d-l>0?(e.size.width=d,e.position.left=o.left-c):(e.size.width=l,e.position.left=o.left+s.width-l))}})}(jQuery),function(t){t.widget("ui.selectable",t.ui.mouse,{version:"1.10.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e,n=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e=t(n.options.filter,n.element[0]),e.addClass("ui-selectee"),e.each(function(){var e=t(this),n=e.offset();t.data(this,"selectable-item",{element:this,$element:e,left:n.left,top:n.top,right:n.left+e.outerWidth(),bottom:n.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=e.addClass("ui-selectee"),this._mouseInit(),this.helper=t("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(e){var n=this,i=this.options;this.opos=[e.pageX,e.pageY],this.options.disabled||(this.selectees=t(i.filter,this.element[0]),this._trigger("start",e),t(i.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),i.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var i=t.data(this,"selectable-item");i.startselected=!0,e.metaKey||e.ctrlKey||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,n._trigger("unselecting",e,{unselecting:i.element}))}),t(e.target).parents().addBack().each(function(){var i,s=t.data(this,"selectable-item");return s?(i=!e.metaKey&&!e.ctrlKey||!s.$element.hasClass("ui-selected"),s.$element.removeClass(i?"ui-unselecting":"ui-selected").addClass(i?"ui-selecting":"ui-unselecting"),s.unselecting=!i,s.selecting=i,s.selected=i,i?n._trigger("selecting",e,{selecting:s.element}):n._trigger("unselecting",e,{unselecting:s.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var n,i=this,s=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,l=e.pageY;return o>r&&(n=r,r=o,o=n),a>l&&(n=l,l=a,a=n),this.helper.css({left:o,top:a,width:r-o,height:l-a}),this.selectees.each(function(){var n=t.data(this,"selectable-item"),u=!1;n&&n.element!==i.element[0]&&("touch"===s.tolerance?u=!(n.left>r||o>n.right||n.top>l||a>n.bottom):"fit"===s.tolerance&&(u=n.left>o&&r>n.right&&n.top>a&&l>n.bottom),u?(n.selected&&(n.$element.removeClass("ui-selected"),n.selected=!1),n.unselecting&&(n.$element.removeClass("ui-unselecting"),n.unselecting=!1),n.selecting||(n.$element.addClass("ui-selecting"),n.selecting=!0,i._trigger("selecting",e,{selecting:n.element}))):(n.selecting&&((e.metaKey||e.ctrlKey)&&n.startselected?(n.$element.removeClass("ui-selecting"),n.selecting=!1,n.$element.addClass("ui-selected"),n.selected=!0):(n.$element.removeClass("ui-selecting"),n.selecting=!1,n.startselected&&(n.$element.addClass("ui-unselecting"),n.unselecting=!0),i._trigger("unselecting",e,{unselecting:n.element}))),n.selected&&(e.metaKey||e.ctrlKey||n.startselected||(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",e,{unselecting:n.element})))))}),!1}},_mouseStop:function(e){var n=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var i=t.data(this,"selectable-item");i.$element.removeClass("ui-unselecting"),i.unselecting=!1,i.startselected=!1,n._trigger("unselected",e,{unselected:i.element})}),t(".ui-selecting",this.element[0]).each(function(){var i=t.data(this,"selectable-item");i.$element.removeClass("ui-selecting").addClass("ui-selected"),i.selecting=!1,i.selected=!0,i.startselected=!0,n._trigger("selected",e,{selected:i.element})}),this._trigger("stop",e),this.helper.remove(),!1}})}(jQuery),function(t){function e(t,e,n){return t>e&&e+n>t}function n(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))}t.widget("ui.sortable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===t.axis||n(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,n){"disabled"===e?(this.options[e]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):t.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,n){var i=null,s=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(i=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(i=t(e.target)),i&&(!this.options.handle||n||(t(this.options.handle,i).find("*").addBack().each(function(){this===e.target&&(s=!0)}),s))?(this.currentItem=i,this._removeCurrentsFromItems(),!0):!1)},_mouseStart:function(e,n,i){var s,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!i)for(s=this.containers.length-1;s>=0;s--)this.containers[s]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var n,i,s,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-t(document).scrollTop()<a.scrollSensitivity?r=t(document).scrollTop(t(document).scrollTop()-a.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<a.scrollSensitivity&&(r=t(document).scrollTop(t(document).scrollTop()+a.scrollSpeed)),e.pageX-t(document).scrollLeft()<a.scrollSensitivity?r=t(document).scrollLeft(t(document).scrollLeft()-a.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<a.scrollSensitivity&&(r=t(document).scrollLeft(t(document).scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),n=this.items.length-1;n>=0;n--)if(i=this.items[n],s=i.item[0],o=this._intersectsWithPointer(i),o&&i.instance===this.currentContainer&&s!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==s&&!t.contains(this.placeholder[0],s)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],s):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(i))break;this._rearrange(e,i),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,n){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var i=this,s=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=s.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=s.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){i._clear(e)})}else this._clear(e,n);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var n=this._getItemsAsjQuery(e&&e.connected),i=[];return e=e||{},t(n).each(function(){var n=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);n&&i.push((e.key||n[1]+"[]")+"="+(e.key&&e.expression?n[1]:n[2]))}),!i.length&&e.key&&i.push(e.key+"="),i.join("&")},toArray:function(e){var n=this._getItemsAsjQuery(e&&e.connected),i=[];return e=e||{},n.each(function(){i.push(t(e.item||this).attr(e.attribute||"id")||"")}),i},_intersectsWith:function(t){var e=this.positionAbs.left,n=e+this.helperProportions.width,i=this.positionAbs.top,s=i+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,l=r+t.height,u=this.offset.click.top,c=this.offset.click.left,h="x"===this.options.axis||i+u>r&&l>i+u,d="y"===this.options.axis||e+c>o&&a>e+c,p=h&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>n-this.helperProportions.width/2&&i+this.helperProportions.height/2>r&&l>s-this.helperProportions.height/2},_intersectsWithPointer:function(t){var n="x"===this.options.axis||e(this.positionAbs.top+this.offset.click.top,t.top,t.height),i="y"===this.options.axis||e(this.positionAbs.left+this.offset.click.left,t.left,t.width),s=n&&i,o=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return s?this.floating?a&&"right"===a||"down"===o?2:1:o&&("down"===o?2:1):!1},_intersectsWithSides:function(t){var n=e(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=e(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"===o&&i||"left"===o&&!i:s&&("down"===s&&n||"up"===s&&!n)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function n(){r.push(this)}var i,s,o,a,r=[],l=[],u=this._connectWith();if(u&&e)for(i=u.length-1;i>=0;i--)for(o=t(u[i]),s=o.length-1;s>=0;s--)a=t.data(o[s],this.widgetFullName),a&&a!==this&&!a.options.disabled&&l.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=l.length-1;i>=0;i--)l[i][0].each(n);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var n=0;e.length>n;n++)if(e[n]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var n,i,s,o,a,r,l,u,c=this.items,h=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(n=d.length-1;n>=0;n--)for(s=t(d[n]),i=s.length-1;i>=0;i--)o=t.data(s[i],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(h.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(n=h.length-1;n>=0;n--)for(a=h[n][1],r=h[n][0],i=0,u=r.length;u>i;i++)l=t(r[i]),l.data(this.widgetName+"-item",a),c.push({item:l,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var n,i,s,o;for(n=this.items.length-1;n>=0;n--)i=this.items[n],i.instance!==this.currentContainer&&this.currentContainer&&i.item[0]!==this.currentItem[0]||(s=this.options.toleranceElement?t(this.options.toleranceElement,i.item):i.item,e||(i.width=s.outerWidth(),i.height=s.outerHeight()),o=s.offset(),i.left=o.left,i.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)o=this.containers[n].element.offset(),this.containers[n].containerCache.left=o.left,this.containers[n].containerCache.top=o.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var n,i=e.options;i.placeholder&&i.placeholder.constructor!==String||(n=i.placeholder,i.placeholder={element:function(){var i=e.currentItem[0].nodeName.toLowerCase(),s=t("<"+i+">",e.document[0]).addClass(n||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===i?e.currentItem.children().each(function(){t("<td>&#160;</td>",e.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(s)}):"img"===i&&s.attr("src",e.currentItem.attr("src")),n||s.css("visibility","hidden"),s},update:function(t,s){(!n||i.forcePlaceholderSize)&&(s.height()||s.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),s.width()||s.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(i.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),i.placeholder.update(e,e.placeholder)},_contactContainers:function(i){var s,o,a,r,l,u,c,h,d,p,f=null,g=null;for(s=this.containers.length-1;s>=0;s--)if(!t.contains(this.currentItem[0],this.containers[s].element[0]))if(this._intersectsWith(this.containers[s].containerCache)){if(f&&t.contains(this.containers[s].element[0],f.element[0]))continue;f=this.containers[s],g=s}else this.containers[s].containerCache.over&&(this.containers[s]._trigger("out",i,this._uiHash(this)),this.containers[s].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[g].containerCache.over||(this.containers[g]._trigger("over",i,this._uiHash(this)),this.containers[g].containerCache.over=1);else{for(a=1e4,r=null,p=f.floating||n(this.currentItem),l=p?"left":"top",u=p?"width":"height",c=this.positionAbs[l]+this.offset.click[l],o=this.items.length-1;o>=0;o--)t.contains(this.containers[g].element[0],this.items[o].item[0])&&this.items[o].item[0]!==this.currentItem[0]&&(!p||e(this.positionAbs.top+this.offset.click.top,this.items[o].top,this.items[o].height))&&(h=this.items[o].item.offset()[l],d=!1,Math.abs(h-c)>Math.abs(h+this.items[o][u]-c)&&(d=!0,h+=this.items[o][u]),a>Math.abs(h-c)&&(a=Math.abs(h-c),r=this.items[o],this.direction=d?"up":"down"));if(!r&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[g])return;r?this._rearrange(i,r,null,!0):this._rearrange(i,null,this.containers[g].element,!0),this._trigger("change",i,this._uiHash()),this.containers[g]._trigger("change",i,this._uiHash(this)),this.currentContainer=this.containers[g],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[g]._trigger("over",i,this._uiHash(this)),this.containers[g].containerCache.over=1}},_createHelper:function(e){var n=this.options,i=t.isFunction(n.helper)?t(n.helper.apply(this.element[0],[e,this.currentItem])):"clone"===n.helper?this.currentItem.clone():this.currentItem;return i.parents("body").length||t("parent"!==n.appendTo?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(i[0]),i[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!i[0].style.width||n.forceHelperSize)&&i.width(this.currentItem.width()),(!i[0].style.height||n.forceHelperSize)&&i.height(this.currentItem.height()),i},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,n,i,s=this.options;"parent"===s.containment&&(s.containment=this.helper[0].parentNode),("document"===s.containment||"window"===s.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"===s.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===s.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(s.containment)||(e=t(s.containment)[0],n=t(s.containment).offset(),i="hidden"!==t(e).css("overflow"),this.containment=[n.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,n.left+(i?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(i?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,n){n||(n=this.position);var i="absolute"===e?1:-1,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:s.scrollTop())*i,left:n.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*i}},_generatePosition:function(e){var n,i,s=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),s.grid&&(n=this.originalPageY+Math.round((a-this.originalPageY)/s.grid[1])*s.grid[1],a=this.containment?n-this.offset.click.top>=this.containment[1]&&n-this.offset.click.top<=this.containment[3]?n:n-this.offset.click.top>=this.containment[1]?n-s.grid[1]:n+s.grid[1]:n,i=this.originalPageX+Math.round((o-this.originalPageX)/s.grid[0])*s.grid[0],o=this.containment?i-this.offset.click.left>=this.containment[0]&&i-this.offset.click.left<=this.containment[2]?i:i-this.offset.click.left>=this.containment[0]?i-s.grid[0]:i+s.grid[0]:i)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:r.scrollLeft())}},_rearrange:function(t,e,n,i){n?n[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var s=this.counter;this._delay(function(){s===this.counter&&this.refreshPositions(!i)})},_clear:function(t,e){function n(t,e,n){return function(i){n._trigger(t,i,e._uiHash(e))}}this.reverting=!1;var i,s=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)("auto"===this._storedCSS[i]||"static"===this._storedCSS[i])&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&s.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||s.push(function(t){this._trigger("update",t,this._uiHash());
}),this!==this.currentContainer&&(e||(s.push(function(t){this._trigger("remove",t,this._uiHash())}),s.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),s.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)e||s.push(n("deactivate",this,this.containers[i])),this.containers[i].containerCache.over&&(s.push(n("out",this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!e){for(this._trigger("beforeStop",t,this._uiHash()),i=0;s.length>i;i++)s[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!e){for(i=0;s.length>i;i++)s[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var n=e||this;return{helper:n.helper,placeholder:n.placeholder||t([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:e?e.element:null}}})}(jQuery),function(t){var e=0,n={},i={};n.height=n.paddingTop=n.paddingBottom=n.borderTopWidth=n.borderBottomWidth="hide",i.height=i.paddingTop=i.paddingBottom=i.borderTopWidth=i.borderBottomWidth="show",t.widget("ui.accordion",{version:"1.10.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),e.collapsible||e.active!==!1&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t(),content:this.active.length?this.active.next():t()}},_createIcons:function(){var e=this.options.icons;e&&(t("<span>").addClass("ui-accordion-header-icon ui-icon "+e.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(e.header).addClass(e.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?void this._activate(e):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||this.options.active!==!1||this._activate(0),"icons"===t&&(this._destroyIcons(),e&&this._createIcons()),void("disabled"===t&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!e)))},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var n=t.ui.keyCode,i=this.headers.length,s=this.headers.index(e.target),o=!1;switch(e.keyCode){case n.RIGHT:case n.DOWN:o=this.headers[(s+1)%i];break;case n.LEFT:case n.UP:o=this.headers[(s-1+i)%i];break;case n.SPACE:case n.ENTER:this._eventHandler(e);break;case n.HOME:o=this.headers[0];break;case n.END:o=this.headers[i-1]}o&&(t(e.target).attr("tabIndex",-1),t(o).attr("tabIndex",0),o.focus(),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().focus()},refresh:function(){var e=this.options;this._processPanels(),e.active===!1&&e.collapsible===!0||!this.headers.length?(e.active=!1,this.active=t()):e.active===!1?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var n,i=this.options,s=i.heightStyle,o=this.element.parent(),a=this.accordionId="ui-accordion-"+(this.element.attr("id")||++e);this.active=this._findActive(i.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(e){var n=t(this),i=n.attr("id"),s=n.next(),o=s.attr("id");i||(i=a+"-header-"+e,n.attr("id",i)),o||(o=a+"-panel-"+e,s.attr("id",o)),n.attr("aria-controls",o),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(n=o.height(),this.element.siblings(":visible").each(function(){var e=t(this),i=e.css("position");"absolute"!==i&&"fixed"!==i&&(n-=e.outerHeight(!0))}),this.headers.each(function(){n-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,n-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===s&&(n=0,this.headers.next().each(function(){n=Math.max(n,t(this).css("height","").height())}).height(n))},_activate:function(e){var n=this._findActive(e)[0];n!==this.active[0]&&(n=n||this.active[0],this._eventHandler({target:n,currentTarget:n,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var n={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){n[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,n),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var n=this.options,i=this.active,s=t(e.currentTarget),o=s[0]===i[0],a=o&&n.collapsible,r=a?t():s.next(),l=i.next(),u={oldHeader:i,oldPanel:l,newHeader:a?t():s,newPanel:r};e.preventDefault(),o&&!n.collapsible||this._trigger("beforeActivate",e,u)===!1||(n.active=a?!1:this.headers.index(s),this.active=o?t():s,this._toggle(u),i.removeClass("ui-accordion-header-active ui-state-active"),n.icons&&i.children(".ui-accordion-header-icon").removeClass(n.icons.activeHeader).addClass(n.icons.header),o||(s.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),n.icons&&s.children(".ui-accordion-header-icon").removeClass(n.icons.header).addClass(n.icons.activeHeader),s.next().addClass("ui-accordion-content-active")))},_toggle:function(e){var n=e.newPanel,i=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=n,this.prevHide=i,this.options.animate?this._animate(n,i,e):(i.hide(),n.show(),this._toggleComplete(e)),i.attr({"aria-hidden":"true"}),i.prev().attr("aria-selected","false"),n.length&&i.length?i.prev().attr({tabIndex:-1,"aria-expanded":"false"}):n.length&&this.headers.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),n.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(t,e,s){var o,a,r,l=this,u=0,c=t.length&&(!e.length||t.index()<e.index()),h=this.options.animate||{},d=c&&h.down||h,p=function(){l._toggleComplete(s)};return"number"==typeof d&&(r=d),"string"==typeof d&&(a=d),a=a||d.easing||h.easing,r=r||d.duration||h.duration,e.length?t.length?(o=t.show().outerHeight(),e.animate(n,{duration:r,easing:a,step:function(t,e){e.now=Math.round(t)}}),void t.hide().animate(i,{duration:r,easing:a,complete:p,step:function(t,n){n.now=Math.round(t),"height"!==n.prop?u+=n.now:"content"!==l.options.heightStyle&&(n.now=Math.round(o-e.outerHeight()-u),u=0)}})):e.animate(n,r,a,p):t.animate(i,r,a,p)},_toggleComplete:function(t){var e=t.oldPanel;e.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}})}(jQuery),function(t){t.widget("ui.autocomplete",{version:"1.10.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,n,i,s=this.element[0].nodeName.toLowerCase(),o="textarea"===s,a="input"===s;this.isMultiLine=o?!0:a?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(s){if(this.element.prop("readOnly"))return e=!0,i=!0,void(n=!0);e=!1,i=!1,n=!1;var o=t.ui.keyCode;switch(s.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",s);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",s);break;case o.UP:e=!0,this._keyEvent("previous",s);break;case o.DOWN:e=!0,this._keyEvent("next",s);break;case o.ENTER:case o.NUMPAD_ENTER:this.menu.active&&(e=!0,s.preventDefault(),this.menu.select(s));break;case o.TAB:this.menu.active&&this.menu.select(s);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(s),s.preventDefault());break;default:n=!0,this._searchTimeout(s)}},keypress:function(i){if(e)return e=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&i.preventDefault());if(!n){var s=t.ui.keyCode;switch(i.keyCode){case s.PAGE_UP:this._move("previousPage",i);break;case s.PAGE_DOWN:this._move("nextPage",i);break;case s.UP:this._keyEvent("previous",i);break;case s.DOWN:this._keyEvent("next",i)}}},input:function(t){return i?(i=!1,void t.preventDefault()):void this._searchTimeout(t)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(t),void this._change(t))}}),this._initSource(),this.menu=t("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var n=this.menu.element[0];t(e.target).closest(".ui-menu-item").length||this._delay(function(){var e=this;this.document.one("mousedown",function(i){i.target===e.element[0]||i.target===n||t.contains(n,i.target)||e.close()})})},menufocus:function(e,n){if(this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)});var i=n.item.data("ui-autocomplete-item");!1!==this._trigger("focus",e,{item:i})?e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(i.value):this.liveRegion.text(i.value)},menuselect:function(t,e){var n=e.item.data("ui-autocomplete-item"),i=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=i,this._delay(function(){this.previous=i,this.selectedItem=n})),!1!==this._trigger("select",t,{item:n})&&this._value(n.value),this.term=this._value(),this.close(t),this.selectedItem=n}}),this.liveRegion=t("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e||(e=this.element.closest(".ui-front")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,n,i=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(n,i){i(t.ui.autocomplete.filter(e,n.term))}):"string"==typeof this.options.source?(n=this.options.source,this.source=function(e,s){i.xhr&&i.xhr.abort(),i.xhr=t.ajax({url:n,data:e,dataType:"json",success:function(t){s(t)},error:function(){s([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):void 0},_search:function(t){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({label:e.label||e.value,value:e.value||e.label},e)})},_suggest:function(e){var n=this.menu.element.empty();this._renderMenu(n,e),this.isNewMenu=!0,this.menu.refresh(),n.show(),this._resizeMenu(),n.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,n){var i=this;t.each(n,function(t,n){i._renderItemData(e,n)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,n){return t("<li>").append(t("<a>").text(n.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this._value(this.term),void this.menu.blur()):void this.menu[t](e):void this.search(null,e)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,n){var i=RegExp(t.ui.autocomplete.escapeRegex(n),"i");return t.grep(e,function(t){return i.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var e;this._superApply(arguments),this.options.disabled||this.cancelSearch||(e=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.text(e))}})}(jQuery),function(t){var e,n="ui-button ui-widget ui-state-default ui-corner-all",i="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",s=function(){var e=t(this);setTimeout(function(){e.find(":ui-button").button("refresh")},1)},o=function(e){var n=e.name,i=e.form,s=t([]);return n&&(n=n.replace(/'/g,"\\'"),s=i?t(i).find("[name='"+n+"']"):t("[name='"+n+"']",e.ownerDocument).filter(function(){return!this.form})),s};t.widget("ui.button",{version:"1.10.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,s),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var i=this,a=this.options,r="checkbox"===this.type||"radio"===this.type,l=r?"":"ui-state-active";null===a.label&&(a.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(n).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){a.disabled||this===e&&t(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){a.disabled||t(this).removeClass(l)}).bind("click"+this.eventNamespace,function(t){a.disabled&&(t.preventDefault(),t.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),r&&this.element.bind("change"+this.eventNamespace,function(){i.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return a.disabled?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(a.disabled)return!1;t(this).addClass("ui-state-active"),i.buttonElement.attr("aria-pressed","true");var e=i.element[0];o(e).not(e).map(function(){return t(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return a.disabled?!1:(t(this).addClass("ui-state-active"),e=this,void i.document.one("mouseup",function(){e=null}))}).bind("mouseup"+this.eventNamespace,function(){return a.disabled?!1:void t(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(e){return a.disabled?!1:void((e.keyCode===t.ui.keyCode.SPACE||e.keyCode===t.ui.keyCode.ENTER)&&t(this).addClass("ui-state-active"))}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){t(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(e){e.keyCode===t.ui.keyCode.SPACE&&t(this).click()})),this._setOption("disabled",a.disabled),this._resetButton()},_determineButtonType:function(){var t,e,n;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(t=this.element.parents().last(),e="label[for='"+this.element.attr("id")+"']",this.buttonElement=t.find(e),this.buttonElement.length||(t=t.length?t.siblings():this.element.siblings(),this.buttonElement=t.filter(e),this.buttonElement.length||(this.buttonElement=t.find(e))),this.element.addClass("ui-helper-hidden-accessible"),n=this.element.is(":checked"),n&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",n)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(n+" ui-state-active "+i).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(t,e){return this._super(t,e),"disabled"===t?(this.element.prop("disabled",!!e),void(e&&this.buttonElement.removeClass("ui-state-focus"))):void this._resetButton()},refresh:function(){var e=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOption("disabled",e),"radio"===this.type?o(this.element[0]).each(function(){t(this).is(":checked")?t(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):t(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return void(this.options.label&&this.element.val(this.options.label));var e=this.buttonElement.removeClass(i),n=t("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(e.empty()).text(),s=this.options.icons,o=s.primary&&s.secondary,a=[];s.primary||s.secondary?(this.options.text&&a.push("ui-button-text-icon"+(o?"s":s.primary?"-primary":"-secondary")),s.primary&&e.prepend("<span class='ui-button-icon-primary ui-icon "+s.primary+"'></span>"),s.secondary&&e.append("<span class='ui-button-icon-secondary ui-icon "+s.secondary+"'></span>"),this.options.text||(a.push(o?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||e.attr("title",t.trim(n)))):a.push("ui-button-text-only"),e.addClass(a.join(" "))}}),t.widget("ui.buttonset",{version:"1.10.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(t,e){"disabled"===t&&this.buttons.button("option",t,e),this._super(t,e)},refresh:function(){var e="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(e?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(e?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(t,e){function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.dpDiv=i(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function i(e){var n="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(n,"mouseout",function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).delegate(n,"mouseover",function(){t.datepicker._isDisabledDatepicker(o.inline?e.parent()[0]:o.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))})}function s(e,n){t.extend(e,n);for(var i in n)null==n[i]&&(e[i]=n[i]);return e}t.extend(t.ui,{datepicker:{version:"1.10.4"}});var o,a="datepicker";t.extend(n.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return s(this._defaults,t||{}),this},_attachDatepicker:function(e,n){var i,s,o;i=e.nodeName.toLowerCase(),s="div"===i||"span"===i,e.id||(this.uuid+=1,e.id="dp"+this.uuid),o=this._newInst(t(e),s),o.settings=t.extend({},n||{}),"input"===i?this._connectDatepicker(e,o):s&&this._inlineDatepicker(e,o)},_newInst:function(e,n){var s=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:n,dpDiv:n?i(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,n){var i=t(e);n.append=t([]),n.trigger=t([]),i.hasClass(this.markerClassName)||(this._attachments(i,n),i.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(n),t.data(e,a,n),n.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,n){var i,s,o,a=this._get(n,"appendText"),r=this._get(n,"isRTL");n.append&&n.append.remove(),a&&(n.append=t("<span class='"+this._appendClass+"'>"+a+"</span>"),e[r?"before":"after"](n.append)),e.unbind("focus",this._showDatepicker),n.trigger&&n.trigger.remove(),i=this._get(n,"showOn"),("focus"===i||"both"===i)&&e.focus(this._showDatepicker),("button"===i||"both"===i)&&(s=this._get(n,"buttonText"),o=this._get(n,"buttonImage"),n.trigger=t(this._get(n,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:s,title:s}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:s,title:s}):s)),e[r?"before":"after"](n.trigger),n.trigger.click(function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,n,i,s,o=new Date(2009,11,20),a=this._get(t,"dateFormat");a.match(/[DM]/)&&(e=function(t){for(n=0,i=0,s=0;t.length>s;s++)t[s].length>n&&(n=t[s].length,i=s);return i},o.setMonth(e(this._get(t,a.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,a.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length)}},_inlineDatepicker:function(e,n){var i=t(e);i.hasClass(this.markerClassName)||(i.addClass(this.markerClassName).append(n.dpDiv),t.data(e,a,n),this._setDate(n,this._getDefaultDate(n),!0),this._updateDatepicker(n),this._updateAlternate(n),n.settings.disabled&&this._disableDatepicker(e),n.dpDiv.css("display","block"))},_dialogDatepicker:function(e,n,i,o,r){var l,u,c,h,d,p=this._dialogInst;return p||(this.uuid+=1,l="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+l+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),t("body").append(this._dialogInput),p=this._dialogInst=this._newInst(this._dialogInput,!1),p.settings={},t.data(this._dialogInput[0],a,p)),s(p.settings,o||{}),n=n&&n.constructor===Date?this._formatDate(p,n):n,this._dialogInput.val(n),this._pos=r?r.length?r:[r.pageX,r.pageY]:null,this._pos||(u=document.documentElement.clientWidth,c=document.documentElement.clientHeight,h=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[u/2-100+h,c/2-150+d]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),p.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],a,p),this},_destroyDatepicker:function(e){var n,i=t(e),s=t.data(e,a);i.hasClass(this.markerClassName)&&(n=e.nodeName.toLowerCase(),t.removeData(e,a),"input"===n?(s.append.remove(),s.trigger.remove(),i.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===n||"span"===n)&&i.removeClass(this.markerClassName).empty())},_enableDatepicker:function(e){var n,i,s=t(e),o=t.data(e,a);s.hasClass(this.markerClassName)&&(n=e.nodeName.toLowerCase(),"input"===n?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===n||"span"===n)&&(i=s.children("."+this._inlineClass),i.children().removeClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var n,i,s=t(e),o=t.data(e,a);
s.hasClass(this.markerClassName)&&(n=e.nodeName.toLowerCase(),"input"===n?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===n||"span"===n)&&(i=s.children("."+this._inlineClass),i.children().addClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,a)}catch(n){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(n,i,o){var a,r,l,u,c=this._getInst(n);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):c?"all"===i?t.extend({},c.settings):this._get(c,i):null:(a=i||{},"string"==typeof i&&(a={},a[i]=o),c&&(this._curInst===c&&this._hideDatepicker(),r=this._getDateDatepicker(n,!0),l=this._getMinMaxDate(c,"min"),u=this._getMinMaxDate(c,"max"),s(c.settings,a),null!==l&&a.dateFormat!==e&&a.minDate===e&&(c.settings.minDate=this._formatDate(c,l)),null!==u&&a.dateFormat!==e&&a.maxDate===e&&(c.settings.maxDate=this._formatDate(c,u)),"disabled"in a&&(a.disabled?this._disableDatepicker(n):this._enableDatepicker(n)),this._attachments(t(n),c),this._autoSize(c),this._setDate(c,r),this._updateAlternate(c),this._updateDatepicker(c)),e)},_changeDatepicker:function(t,e,n){this._optionDatepicker(t,e,n)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var n=this._getInst(t);n&&(this._setDate(n,e),this._updateDatepicker(n),this._updateAlternate(n))},_getDateDatepicker:function(t,e){var n=this._getInst(t);return n&&!n.inline&&this._setDateFromField(n,e),n?this._getDate(n):null},_doKeyDown:function(e){var n,i,s,o=t.datepicker._getInst(e.target),a=!0,r=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),a=!1;break;case 13:return s=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv),s[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,s[0]),n=t.datepicker._get(o,"onSelect"),n?(i=t.datepicker._formatDate(o),n.apply(o.input?o.input[0]:null,[i,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),a=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),a=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?1:-1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),a=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?-1:1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),a=e.ctrlKey||e.metaKey;break;default:a=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):a=!1;a&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(n){var i,s,o=t.datepicker._getInst(n.target);return t.datepicker._get(o,"constrainInput")?(i=t.datepicker._possibleChars(t.datepicker._get(o,"dateFormat")),s=String.fromCharCode(null==n.charCode?n.keyCode:n.charCode),n.ctrlKey||n.metaKey||" ">s||!i||i.indexOf(s)>-1):e},_doKeyUp:function(e){var n,i=t.datepicker._getInst(e.target);if(i.input.val()!==i.lastVal)try{n=t.datepicker.parseDate(t.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,t.datepicker._getFormatConfig(i)),n&&(t.datepicker._setDateFromField(i),t.datepicker._updateAlternate(i),t.datepicker._updateDatepicker(i))}catch(s){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var n,i,o,a,r,l,u;n=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==n&&(t.datepicker._curInst.dpDiv.stop(!0,!0),n&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),i=t.datepicker._get(n,"beforeShow"),o=i?i.apply(e,[e,n]):{},o!==!1&&(s(n.settings,o),n.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(n),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),a=!1,t(e).parents().each(function(){return a|="fixed"===t(this).css("position"),!a}),r={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,n.dpDiv.empty(),n.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(n),r=t.datepicker._checkOffset(n,r,a),n.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":a?"fixed":"absolute",display:"none",left:r.left+"px",top:r.top+"px"}),n.inline||(l=t.datepicker._get(n,"showAnim"),u=t.datepicker._get(n,"duration"),n.dpDiv.zIndex(t(e).zIndex()+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[l]?n.dpDiv.show(l,t.datepicker._get(n,"showOptions"),u):n.dpDiv[l||"show"](l?u:null),t.datepicker._shouldFocusInput(n)&&n.input.focus(),t.datepicker._curInst=n))}},_updateDatepicker:function(e){this.maxRows=4,o=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var n,i=this._getNumberOfMonths(e),s=i[1],a=17;e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),s>1&&e.dpDiv.addClass("ui-datepicker-multi-"+s).css("width",a*s+"em"),e.dpDiv[(1!==i[0]||1!==i[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.focus(),e.yearshtml&&(n=e.yearshtml,setTimeout(function(){n===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),n=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,n,i){var s=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),a=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,l=document.documentElement.clientWidth+(i?0:t(document).scrollLeft()),u=document.documentElement.clientHeight+(i?0:t(document).scrollTop());return n.left-=this._get(e,"isRTL")?s-a:0,n.left-=i&&n.left===e.input.offset().left?t(document).scrollLeft():0,n.top-=i&&n.top===e.input.offset().top+r?t(document).scrollTop():0,n.left-=Math.min(n.left,n.left+s>l&&l>s?Math.abs(n.left+s-l):0),n.top-=Math.min(n.top,n.top+o>u&&u>o?Math.abs(o+r):0),n},_findPos:function(e){for(var n,i=this._getInst(e),s=this._get(i,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[s?"previousSibling":"nextSibling"];return n=t(e).offset(),[n.left,n.top]},_hideDatepicker:function(e){var n,i,s,o,r=this._curInst;!r||e&&r!==t.data(e,a)||this._datepickerShowing&&(n=this._get(r,"showAnim"),i=this._get(r,"duration"),s=function(){t.datepicker._tidyDialog(r)},t.effects&&(t.effects.effect[n]||t.effects[n])?r.dpDiv.hide(n,t.datepicker._get(r,"showOptions"),i,s):r.dpDiv["slideDown"===n?"slideUp":"fadeIn"===n?"fadeOut":"hide"](n?i:null,s),n||s(),this._datepickerShowing=!1,o=this._get(r,"onClose"),o&&o.apply(r.input?r.input[0]:null,[r.input?r.input.val():"",r]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var n=t(e.target),i=t.datepicker._getInst(n[0]);(n[0].id!==t.datepicker._mainDivId&&0===n.parents("#"+t.datepicker._mainDivId).length&&!n.hasClass(t.datepicker.markerClassName)&&!n.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||n.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==i)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,n,i){var s=t(e),o=this._getInst(s[0]);this._isDisabledDatepicker(s[0])||(this._adjustInstDate(o,n+("M"===i?this._get(o,"showCurrentAtPos"):0),i),this._updateDatepicker(o))},_gotoToday:function(e){var n,i=t(e),s=this._getInst(i[0]);this._get(s,"gotoCurrent")&&s.currentDay?(s.selectedDay=s.currentDay,s.drawMonth=s.selectedMonth=s.currentMonth,s.drawYear=s.selectedYear=s.currentYear):(n=new Date,s.selectedDay=n.getDate(),s.drawMonth=s.selectedMonth=n.getMonth(),s.drawYear=s.selectedYear=n.getFullYear()),this._notifyChange(s),this._adjustDate(i)},_selectMonthYear:function(e,n,i){var s=t(e),o=this._getInst(s[0]);o["selected"+("M"===i?"Month":"Year")]=o["draw"+("M"===i?"Month":"Year")]=parseInt(n.options[n.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(s)},_selectDay:function(e,n,i,s){var o,a=t(e);t(s).hasClass(this._unselectableClass)||this._isDisabledDatepicker(a[0])||(o=this._getInst(a[0]),o.selectedDay=o.currentDay=t("a",s).html(),o.selectedMonth=o.currentMonth=n,o.selectedYear=o.currentYear=i,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(e){var n=t(e);this._selectDate(n,"")},_selectDate:function(e,n){var i,s=t(e),o=this._getInst(s[0]);n=null!=n?n:this._formatDate(o),o.input&&o.input.val(n),this._updateAlternate(o),i=this._get(o,"onSelect"),i?i.apply(o.input?o.input[0]:null,[n,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var n,i,s,o=this._get(e,"altField");o&&(n=this._get(e,"altFormat")||this._get(e,"dateFormat"),i=this._getDate(e),s=this.formatDate(n,i,this._getFormatConfig(e)),t(o).each(function(){t(this).val(s)}))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,n=new Date(t.getTime());return n.setDate(n.getDate()+4-(n.getDay()||7)),e=n.getTime(),n.setMonth(0),n.setDate(1),Math.floor(Math.round((e-n)/864e5)/7)+1},parseDate:function(n,i,s){if(null==n||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var o,a,r,l,u=0,c=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,h="string"!=typeof c?c:(new Date).getFullYear()%100+parseInt(c,10),d=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,p=(s?s.dayNames:null)||this._defaults.dayNames,f=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,g=(s?s.monthNames:null)||this._defaults.monthNames,m=-1,v=-1,b=-1,y=-1,_=!1,w=function(t){var e=n.length>o+1&&n.charAt(o+1)===t;return e&&o++,e},M=function(t){var e=w(t),n="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,s=RegExp("^\\d{1,"+n+"}"),o=i.substring(u).match(s);if(!o)throw"Missing number at position "+u;return u+=o[0].length,parseInt(o[0],10)},x=function(n,s,o){var a=-1,r=t.map(w(n)?o:s,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(r,function(t,n){var s=n[1];return i.substr(u,s.length).toLowerCase()===s.toLowerCase()?(a=n[0],u+=s.length,!1):e}),-1!==a)return a+1;throw"Unknown name at position "+u},C=function(){if(i.charAt(u)!==n.charAt(o))throw"Unexpected literal at position "+u;u++};for(o=0;n.length>o;o++)if(_)"'"!==n.charAt(o)||w("'")?C():_=!1;else switch(n.charAt(o)){case"d":b=M("d");break;case"D":x("D",d,p);break;case"o":y=M("o");break;case"m":v=M("m");break;case"M":v=x("M",f,g);break;case"y":m=M("y");break;case"@":l=new Date(M("@")),m=l.getFullYear(),v=l.getMonth()+1,b=l.getDate();break;case"!":l=new Date((M("!")-this._ticksTo1970)/1e4),m=l.getFullYear(),v=l.getMonth()+1,b=l.getDate();break;case"'":w("'")?C():_=!0;break;default:C()}if(i.length>u&&(r=i.substr(u),!/^\s+/.test(r)))throw"Extra/unparsed characters found in date: "+r;if(-1===m?m=(new Date).getFullYear():100>m&&(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(h>=m?0:-100)),y>-1)for(v=1,b=y;a=this._getDaysInMonth(m,v-1),!(a>=b);)v++,b-=a;if(l=this._daylightSavingAdjust(new Date(m,v-1,b)),l.getFullYear()!==m||l.getMonth()+1!==v||l.getDate()!==b)throw"Invalid date";return l},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864e9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,n){if(!e)return"";var i,s=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,o=(n?n.dayNames:null)||this._defaults.dayNames,a=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,r=(n?n.monthNames:null)||this._defaults.monthNames,l=function(e){var n=t.length>i+1&&t.charAt(i+1)===e;return n&&i++,n},u=function(t,e,n){var i=""+e;if(l(t))for(;n>i.length;)i="0"+i;return i},c=function(t,e,n,i){return l(t)?i[e]:n[e]},h="",d=!1;if(e)for(i=0;t.length>i;i++)if(d)"'"!==t.charAt(i)||l("'")?h+=t.charAt(i):d=!1;else switch(t.charAt(i)){case"d":h+=u("d",e.getDate(),2);break;case"D":h+=c("D",e.getDay(),s,o);break;case"o":h+=u("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":h+=u("m",e.getMonth()+1,2);break;case"M":h+=c("M",e.getMonth(),a,r);break;case"y":h+=l("y")?e.getFullYear():(10>e.getYear()%100?"0":"")+e.getYear()%100;break;case"@":h+=e.getTime();break;case"!":h+=1e4*e.getTime()+this._ticksTo1970;break;case"'":l("'")?h+="'":d=!0;break;default:h+=t.charAt(i)}return h},_possibleChars:function(t){var e,n="",i=!1,s=function(n){var i=t.length>e+1&&t.charAt(e+1)===n;return i&&e++,i};for(e=0;t.length>e;e++)if(i)"'"!==t.charAt(e)||s("'")?n+=t.charAt(e):i=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":n+="0123456789";break;case"D":case"M":return null;case"'":s("'")?n+="'":i=!0;break;default:n+=t.charAt(e)}return n},_get:function(t,n){return t.settings[n]!==e?t.settings[n]:this._defaults[n]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var n=this._get(t,"dateFormat"),i=t.lastVal=t.input?t.input.val():null,s=this._getDefaultDate(t),o=s,a=this._getFormatConfig(t);try{o=this.parseDate(n,i,a)||s}catch(r){i=e?"":i}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=i?o.getDate():0,t.currentMonth=i?o.getMonth():0,t.currentYear=i?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,n,i){var s=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},o=function(n){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),n,t.datepicker._getFormatConfig(e))}catch(i){}for(var s=(n.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,o=s.getFullYear(),a=s.getMonth(),r=s.getDate(),l=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,u=l.exec(n);u;){switch(u[2]||"d"){case"d":case"D":r+=parseInt(u[1],10);break;case"w":case"W":r+=7*parseInt(u[1],10);break;case"m":case"M":a+=parseInt(u[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a));break;case"y":case"Y":o+=parseInt(u[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a))}u=l.exec(n)}return new Date(o,a,r)},a=null==n||""===n?i:"string"==typeof n?o(n):"number"==typeof n?isNaN(n)?i:s(n):new Date(n.getTime());return a=a&&"Invalid Date"==""+a?i:a,a&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,n){var i=!e,s=t.selectedMonth,o=t.selectedYear,a=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=a.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=a.getMonth(),t.drawYear=t.selectedYear=t.currentYear=a.getFullYear(),s===t.selectedMonth&&o===t.selectedYear||n||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(i?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var n=this._get(e,"stepMonths"),i="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(i,-n,"M")},next:function(){t.datepicker._adjustDate(i,+n,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(i)},selectDay:function(){return t.datepicker._selectDay(i,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(i,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(i,this,"Y"),!1}};t(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,n,i,s,o,a,r,l,u,c,h,d,p,f,g,m,v,b,y,_,w,M,x,C,I,S,E,L,k,D,P,T,N,A,O,V,R,F,j,z=new Date,B=this._daylightSavingAdjust(new Date(z.getFullYear(),z.getMonth(),z.getDate())),W=this._get(t,"isRTL"),H=this._get(t,"showButtonPanel"),U=this._get(t,"hideIfNoPrevNext"),$=this._get(t,"navigationAsDateFormat"),G=this._getNumberOfMonths(t),q=this._get(t,"showCurrentAtPos"),Y=this._get(t,"stepMonths"),K=1!==G[0]||1!==G[1],X=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),Z=this._getMinMaxDate(t,"min"),Q=this._getMinMaxDate(t,"max"),J=t.drawMonth-q,tt=t.drawYear;if(0>J&&(J+=12,tt--),Q)for(e=this._daylightSavingAdjust(new Date(Q.getFullYear(),Q.getMonth()-G[0]*G[1]+1,Q.getDate())),e=Z&&Z>e?Z:e;this._daylightSavingAdjust(new Date(tt,J,1))>e;)J--,0>J&&(J=11,tt--);for(t.drawMonth=J,t.drawYear=tt,n=this._get(t,"prevText"),n=$?this.formatDate(n,this._daylightSavingAdjust(new Date(tt,J-Y,1)),this._getFormatConfig(t)):n,i=this._canAdjustMonth(t,-1,tt,J)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(W?"e":"w")+"'>"+n+"</span></a>":U?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(W?"e":"w")+"'>"+n+"</span></a>",s=this._get(t,"nextText"),s=$?this.formatDate(s,this._daylightSavingAdjust(new Date(tt,J+Y,1)),this._getFormatConfig(t)):s,o=this._canAdjustMonth(t,1,tt,J)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+s+"'><span class='ui-icon ui-icon-circle-triangle-"+(W?"w":"e")+"'>"+s+"</span></a>":U?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+s+"'><span class='ui-icon ui-icon-circle-triangle-"+(W?"w":"e")+"'>"+s+"</span></a>",a=this._get(t,"currentText"),r=this._get(t,"gotoCurrent")&&t.currentDay?X:B,a=$?this.formatDate(a,r,this._getFormatConfig(t)):a,l=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",u=H?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(W?l:"")+(this._isInRange(t,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+a+"</button>":"")+(W?"":l)+"</div>":"",c=parseInt(this._get(t,"firstDay"),10),c=isNaN(c)?0:c,h=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),v=this._get(t,"showOtherMonths"),b=this._get(t,"selectOtherMonths"),y=this._getDefaultDate(t),_="",M=0;G[0]>M;M++){for(x="",this.maxRows=4,C=0;G[1]>C;C++){if(I=this._daylightSavingAdjust(new Date(tt,J,t.selectedDay)),S=" ui-corner-all",E="",K){if(E+="<div class='ui-datepicker-group",G[1]>1)switch(C){case 0:E+=" ui-datepicker-group-first",S=" ui-corner-"+(W?"right":"left");break;case G[1]-1:E+=" ui-datepicker-group-last",S=" ui-corner-"+(W?"left":"right");break;default:E+=" ui-datepicker-group-middle",S=""}E+="'>"}for(E+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+S+"'>"+(/all|left/.test(S)&&0===M?W?o:i:"")+(/all|right/.test(S)&&0===M?W?i:o:"")+this._generateMonthYearHeader(t,J,tt,Z,Q,M>0||C>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead><tr>",L=h?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;7>w;w++)k=(w+c)%7,L+="<th"+((w+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+d[k]+"'>"+p[k]+"</span></th>";for(E+=L+"</tr></thead><tbody>",D=this._getDaysInMonth(tt,J),tt===t.selectedYear&&J===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,D)),P=(this._getFirstDayOfMonth(tt,J)-c+7)%7,T=Math.ceil((P+D)/7),N=K&&this.maxRows>T?this.maxRows:T,this.maxRows=N,A=this._daylightSavingAdjust(new Date(tt,J,1-P)),O=0;N>O;O++){for(E+="<tr>",V=h?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(A)+"</td>":"",w=0;7>w;w++)R=m?m.apply(t.input?t.input[0]:null,[A]):[!0,""],F=A.getMonth()!==J,j=F&&!b||!R[0]||Z&&Z>A||Q&&A>Q,V+="<td class='"+((w+c+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(A.getTime()===I.getTime()&&J===t.selectedMonth&&t._keyEvent||y.getTime()===A.getTime()&&y.getTime()===I.getTime()?" "+this._dayOverClass:"")+(j?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!v?"":" "+R[1]+(A.getTime()===X.getTime()?" "+this._currentClass:"")+(A.getTime()===B.getTime()?" ui-datepicker-today":""))+"'"+(F&&!v||!R[2]?"":" title='"+R[2].replace(/'/g,"&#39;")+"'")+(j?"":" data-handler='selectDay' data-event='click' data-month='"+A.getMonth()+"' data-year='"+A.getFullYear()+"'")+">"+(F&&!v?"&#xa0;":j?"<span class='ui-state-default'>"+A.getDate()+"</span>":"<a class='ui-state-default"+(A.getTime()===B.getTime()?" ui-state-highlight":"")+(A.getTime()===X.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+A.getDate()+"</a>")+"</td>",A.setDate(A.getDate()+1),A=this._daylightSavingAdjust(A);E+=V+"</tr>"}J++,J>11&&(J=0,tt++),E+="</tbody></table>"+(K?"</div>"+(G[0]>0&&C===G[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=E}_+=x}return _+=u,t._keyEvent=!1,_},_generateMonthYearHeader:function(t,e,n,i,s,o,a,r){var l,u,c,h,d,p,f,g,m=this._get(t,"changeMonth"),v=this._get(t,"changeYear"),b=this._get(t,"showMonthAfterYear"),y="<div class='ui-datepicker-title'>",_="";if(o||!m)_+="<span class='ui-datepicker-month'>"+a[e]+"</span>";else{for(l=i&&i.getFullYear()===n,u=s&&s.getFullYear()===n,_+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;12>c;c++)(!l||c>=i.getMonth())&&(!u||s.getMonth()>=c)&&(_+="<option value='"+c+"'"+(c===e?" selected='selected'":"")+">"+r[c]+"</option>");_+="</select>"}if(b||(y+=_+(!o&&m&&v?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!v)y+="<span class='ui-datepicker-year'>"+n+"</span>";else{for(h=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?n+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e},f=p(h[0]),g=Math.max(f,p(h[1]||"")),f=i?Math.max(f,i.getFullYear()):f,g=s?Math.min(g,s.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===n?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",y+=t.yearshtml,t.yearshtml=null}return y+=this._get(t,"yearSuffix"),b&&(y+=(!o&&m&&v?"":"&#xa0;")+_),y+="</div>"},_adjustInstDate:function(t,e,n){var i=t.drawYear+("Y"===n?e:0),s=t.drawMonth+("M"===n?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(i,s))+("D"===n?e:0),a=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(i,s,o)));t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),("M"===n||"Y"===n)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var n=this._getMinMaxDate(t,"min"),i=this._getMinMaxDate(t,"max"),s=n&&n>e?n:e;return i&&s>i?i:s},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,n,i){var s=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(n,i+(0>e?e:s[0]*s[1]),1));return 0>e&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var n,i,s=this._getMinMaxDate(t,"min"),o=this._getMinMaxDate(t,"max"),a=null,r=null,l=this._get(t,"yearRange");return l&&(n=l.split(":"),i=(new Date).getFullYear(),a=parseInt(n[0],10),r=parseInt(n[1],10),n[0].match(/[+\-].*/)&&(a+=i),n[1].match(/[+\-].*/)&&(r+=i)),(!s||e.getTime()>=s.getTime())&&(!o||e.getTime()<=o.getTime())&&(!a||e.getFullYear()>=a)&&(!r||r>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,n,i){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var s=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(i,n,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),s,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).mousedown(t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var n=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(n)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(n)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(n))},t.datepicker=new n,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.10.4"}(jQuery),function(t){var e={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},n={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};t.widget("ui.dialog",{version:"1.10.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var n=t(this).css(e).offset().top;0>n&&t(this).css("top",e.top-n)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var n,i=this;if(this._isOpen&&this._trigger("beforeClose",e)!==!1){if(this._isOpen=!1,this._destroyOverlay(),!this.opener.filter(":focusable").focus().length)try{n=this.document[0].activeElement,n&&"body"!==n.nodeName.toLowerCase()&&t(n).blur()}catch(s){}this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,e){var n=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return n&&!e&&this._trigger("focus",t),n},open:function(){var e=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=t(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),void this._trigger("open"))},_focusTabbable:function(){var t=this.element.find("[autofocus]");t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).focus()},_keepFocus:function(e){function n(){var e=this.document[0].activeElement,n=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);n||this._focusTabbable()}e.preventDefault(),n.call(this),this._delay(n)},_createWrapper:function(){this.uiDialog=t("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),void this.close(e);if(e.keyCode===t.ui.keyCode.TAB){var n=this.uiDialog.find(":tabbable"),i=n.filter(":first"),s=n.filter(":last");e.target!==s[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==i[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(s.focus(1),e.preventDefault()):(i.focus(1),
e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(e),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title||t.html("&#160;"),t.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var e=this,n=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(n)||t.isArray(n)&&!n.length?void this.uiDialog.removeClass("ui-dialog-buttons"):(t.each(n,function(n,i){var s,o;i=t.isFunction(i)?{click:i,text:n}:i,i=t.extend({type:"button"},i),s=i.click,i.click=function(){s.apply(e.element[0],arguments)},o={icons:i.icons,text:i.showText},delete i.icons,delete i.showText,t("<button></button>",i).button(o).appendTo(e.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var n=this,i=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(i,s){t(this).addClass("ui-dialog-dragging"),n._blockFrames(),n._trigger("dragStart",i,e(s))},drag:function(t,i){n._trigger("drag",t,e(i))},stop:function(s,o){i.position=[o.position.left-n.document.scrollLeft(),o.position.top-n.document.scrollTop()],t(this).removeClass("ui-dialog-dragging"),n._unblockFrames(),n._trigger("dragStop",s,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var n=this,i=this.options,s=i.resizable,o=this.uiDialog.css("position"),a="string"==typeof s?s:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:i.maxWidth,maxHeight:i.maxHeight,minWidth:i.minWidth,minHeight:this._minHeight(),handles:a,start:function(i,s){t(this).addClass("ui-dialog-resizing"),n._blockFrames(),n._trigger("resizeStart",i,e(s))},resize:function(t,i){n._trigger("resize",t,e(i))},stop:function(s,o){i.height=t(this).height(),i.width=t(this).width(),t(this).removeClass("ui-dialog-resizing"),n._unblockFrames(),n._trigger("resizeStop",s,e(o))}}).css("position",o)},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(i){var s=this,o=!1,a={};t.each(i,function(t,i){s._setOption(t,i),t in e&&(o=!0),t in n&&(a[t]=i)}),o&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",a)},_setOption:function(t,e){var n,i,s=this.uiDialog;"dialogClass"===t&&s.removeClass(this.options.dialogClass).addClass(e),"disabled"!==t&&(this._super(t,e),"appendTo"===t&&this.uiDialog.appendTo(this._appendTo()),"buttons"===t&&this._createButtons(),"closeText"===t&&this.uiDialogTitlebarClose.button({label:""+e}),"draggable"===t&&(n=s.is(":data(ui-draggable)"),n&&!e&&s.draggable("destroy"),!n&&e&&this._makeDraggable()),"position"===t&&this._position(),"resizable"===t&&(i=s.is(":data(ui-resizable)"),i&&!e&&s.resizable("destroy"),i&&"string"==typeof e&&s.resizable("option","handles",e),i||e===!1||this._makeResizable()),"title"===t&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,n,i=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),i.minWidth>i.width&&(i.width=i.minWidth),t=this.uiDialog.css({height:"auto",width:i.width}).outerHeight(),e=Math.max(0,i.minHeight-t),n="number"==typeof i.maxHeight?Math.max(0,i.maxHeight-t):"none","auto"===i.height?this.element.css({minHeight:e,maxHeight:n,height:"auto"}):this.element.height(Math.max(0,i.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return t(e.target).closest(".ui-dialog").length?!0:!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=this,n=this.widgetFullName;t.ui.dialog.overlayInstances||this._delay(function(){t.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(i){e._allowInteraction(i)||(i.preventDefault(),t(".ui-dialog:visible:last .ui-dialog-content").data(n)._focusTabbable())})}),this.overlay=t("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),t.ui.dialog.overlayInstances++}},_destroyOverlay:function(){this.options.modal&&this.overlay&&(t.ui.dialog.overlayInstances--,t.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),t.ui.dialog.overlayInstances=0,t.uiBackCompat!==!1&&t.widget("ui.dialog",t.ui.dialog,{_position:function(){var e,n=this.options.position,i=[],s=[0,0];n?(("string"==typeof n||"object"==typeof n&&"0"in n)&&(i=n.split?n.split(" "):[n[0],n[1]],1===i.length&&(i[1]=i[0]),t.each(["left","top"],function(t,e){+i[t]===i[t]&&(s[t]=i[t],i[t]=e)}),n={my:i[0]+(0>s[0]?s[0]:"+"+s[0])+" "+i[1]+(0>s[1]?s[1]:"+"+s[1]),at:i.join(" ")}),n=t.extend({},t.ui.dialog.prototype.options.position,n)):n=t.ui.dialog.prototype.options.position,e=this.uiDialog.is(":visible"),e||this.uiDialog.show(),this.uiDialog.position(n),e||this.uiDialog.hide()}})}(jQuery),function(t){t.widget("ui.menu",{version:"1.10.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,t.proxy(function(t){this.options.disabled&&t.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(t){t.preventDefault()},"click .ui-state-disabled > a":function(t){t.preventDefault()},"click .ui-menu-item:has(a)":function(e){var n=t(e.target).closest(".ui-menu-item");!this.mouseHandled&&n.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),n.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&t(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){var n=t(e.currentTarget);n.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(e,n)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var n=this.active||this.element.children(".ui-menu-item").eq(0);e||this.focus(t,n)},blur:function(e){this._delay(function(){t.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){t(e.target).closest(".ui-menu").length||this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var e=t(this);e.data("ui-menu-submenu-carat")&&e.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(e){function n(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var i,s,o,a,r,l=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:l=!1,s=this.previousFilter||"",o=String.fromCharCode(e.keyCode),a=!1,clearTimeout(this.filterTimer),o===s?a=!0:o=s+o,r=RegExp("^"+n(o),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return r.test(t(this).children("a").text())}),i=a&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(o=String.fromCharCode(e.keyCode),r=RegExp("^"+n(o),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return r.test(t(this).children("a").text())})),i.length?(this.focus(e,i),i.length>1?(this.previousFilter=o,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}l&&e.preventDefault()},_activate:function(t){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,n=this.options.icons.submenu,i=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),i.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.prev("a"),s=t("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(s),e.attr("aria-labelledby",i.attr("id"))}),e=i.add(this.element),e.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),e.children(":not(.ui-menu-item)").each(function(){var e=t(this);/[^\-\u2014\u2013\s]/.test(e.text())||e.addClass("ui-widget-content ui-menu-divider")}),e.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){"icons"===t&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(e.submenu),this._super(t,e)},focus:function(t,e){var n,i;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),i=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",i.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),n=e.children(".ui-menu"),n.length&&t&&/^mouse/.test(t.type)&&this._startOpening(n),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var n,i,s,o,a,r;this._hasScroll()&&(n=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,i=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,s=e.offset().top-this.activeMenu.offset().top-n-i,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=e.height(),0>s?this.activeMenu.scrollTop(o+s):s+r>a&&this.activeMenu.scrollTop(o+s-a+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",t,{item:this.active}))},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var n=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(n)},collapseAll:function(e,n){clearTimeout(this.timer),this.timer=this._delay(function(){var i=n?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));i.length||(i=this.element),this._close(i),this.blur(e),this.activeMenu=i},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,n){var i;this.active&&(i="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),i&&i.length&&this.active||(i=this.activeMenu.children(".ui-menu-item")[e]()),this.focus(n,i)},nextPage:function(e){var n,i,s;return this.active?void(this.isLastItem()||(this._hasScroll()?(i=this.active.offset().top,s=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return n=t(this),0>n.offset().top-i-s}),this.focus(e,n)):this.focus(e,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]()))):void this.next(e)},previousPage:function(e){var n,i,s;return this.active?void(this.isFirstItem()||(this._hasScroll()?(i=this.active.offset().top,s=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return n=t(this),n.offset().top-i+s>0}),this.focus(e,n)):this.focus(e,this.activeMenu.children(".ui-menu-item").first()))):void this.next(e)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var n={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,n)}})}(jQuery),function(t,e){t.widget("ui.progressbar",{version:"1.10.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=t("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(t){return t===e?this.options.value:(this.options.value=this._constrainedValue(t),this._refreshValue(),e)},_constrainedValue:function(t){return t===e&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,n=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(n.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}})}(jQuery),function(t){var e=5;t.widget("ui.slider",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,n,i=this.options,s=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",a=[];for(n=i.values&&i.values.length||1,s.length>n&&(s.slice(n).remove(),s=s.slice(0,n)),e=s.length;n>e;e++)a.push(o);this.handles=s.add(t(a.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e)})},_createRange:function(){var e=this.options,n="";e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=t("<div></div>").appendTo(this.element),n="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(n+("min"===e.range||"max"===e.range?" ui-slider-range-"+e.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){var t=this.handles.add(this.range).filter("a");this._off(t),this._on(t,this._handleEvents),this._hoverable(t),this._focusable(t)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(e){var n,i,s,o,a,r,l,u,c=this,h=this.options;return h.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(n),s=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var n=Math.abs(i-c.values(e));(s>n||s===n&&(e===c._lastChangedValue||c.values(e)===h.min))&&(s=n,o=t(this),a=e)}),r=this._start(e,a),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=a,o.addClass("ui-state-active").focus(),l=o.offset(),u=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=u?{left:0,top:0}:{left:e.pageX-l.left-o.width()/2,top:e.pageY-l.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,i),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},n=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,n),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,n,i,s,o;return"horizontal"===this.orientation?(e=this.elementSize.width,n=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,n=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),i=n/e,i>1&&(i=1),0>i&&(i=0),"vertical"===this.orientation&&(i=1-i),s=this._valueMax()-this._valueMin(),o=this._valueMin()+i*s,this._trimAlignValue(o)},_start:function(t,e){var n={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(e),n.values=this.values()),this._trigger("start",t,n)},_slide:function(t,e,n){var i,s,o;this.options.values&&this.options.values.length?(i=this.values(e?0:1),2===this.options.values.length&&this.options.range===!0&&(0===e&&n>i||1===e&&i>n)&&(n=i),n!==this.values(e)&&(s=this.values(),s[e]=n,o=this._trigger("slide",t,{handle:this.handles[e],value:n,values:s}),i=this.values(e?0:1),o!==!1&&this.values(e,n))):n!==this.value()&&(o=this._trigger("slide",t,{handle:this.handles[e],value:n}),o!==!1&&this.value(n))},_stop:function(t,e){var n={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(e),n.values=this.values()),this._trigger("stop",t,n)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(e),n.values=this.values()),this._lastChangedValue=e,this._trigger("change",t,n)}},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),void this._change(null,0)):this._value()},values:function(e,n){var i,s,o;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(n),this._refreshValue(),void this._change(null,e);if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(i=this.options.values,s=arguments[0],o=0;i.length>o;o+=1)i[o]=this._trimAlignValue(s[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,n){var i,s=0;switch("range"===e&&this.options.range===!0&&("min"===n?(this.options.value=this._values(0),this.options.values=null):"max"===n&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(s=this.options.values.length),t.Widget.prototype._setOption.apply(this,arguments),e){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),i=0;s>i;i+=1)this._change(null,i);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,n,i;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this.options.values&&this.options.values.length){for(n=this.options.values.slice(),i=0;n.length>i;i+=1)n[i]=this._trimAlignValue(n[i]);return n}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,n=(t-this._valueMin())%e,i=t-n;return 2*Math.abs(n)>=e&&(i+=n>0?e:-e),parseFloat(i.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var e,n,i,s,o,a=this.options.range,r=this.options,l=this,u=this._animateOff?!1:r.animate,c={};this.options.values&&this.options.values.length?this.handles.each(function(i){n=100*((l.values(i)-l._valueMin())/(l._valueMax()-l._valueMin())),c["horizontal"===l.orientation?"left":"bottom"]=n+"%",t(this).stop(1,1)[u?"animate":"css"](c,r.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===i&&l.range.stop(1,1)[u?"animate":"css"]({left:n+"%"},r.animate),1===i&&l.range[u?"animate":"css"]({width:n-e+"%"},{queue:!1,duration:r.animate})):(0===i&&l.range.stop(1,1)[u?"animate":"css"]({bottom:n+"%"},r.animate),1===i&&l.range[u?"animate":"css"]({height:n-e+"%"},{queue:!1,duration:r.animate}))),e=n}):(i=this.value(),s=this._valueMin(),o=this._valueMax(),n=o!==s?100*((i-s)/(o-s)):0,c["horizontal"===this.orientation?"left":"bottom"]=n+"%",this.handle.stop(1,1)[u?"animate":"css"](c,r.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({width:n+"%"},r.animate),"max"===a&&"horizontal"===this.orientation&&this.range[u?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:r.animate}),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({height:n+"%"},r.animate),"max"===a&&"vertical"===this.orientation&&this.range[u?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(n){var i,s,o,a,r=t(n.target).data("ui-slider-handle-index");switch(n.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(n.preventDefault(),!this._keySliding&&(this._keySliding=!0,t(n.target).addClass("ui-state-active"),i=this._start(n,r),i===!1))return}switch(a=this.options.step,s=o=this.options.values&&this.options.values.length?this.values(r):this.value(),n.keyCode){case t.ui.keyCode.HOME:o=this._valueMin();break;case t.ui.keyCode.END:o=this._valueMax();break;case t.ui.keyCode.PAGE_UP:o=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/e);break;case t.ui.keyCode.PAGE_DOWN:o=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/e);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(s===this._valueMax())return;o=this._trimAlignValue(s+a);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(s===this._valueMin())return;o=this._trimAlignValue(s-a)}this._slide(n,r,o)},click:function(t){t.preventDefault()},keyup:function(e){var n=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,n),this._change(e,n),t(e.target).removeClass("ui-state-active"))}}})}(jQuery),function(t){function e(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.widget("ui.spinner",{version:"1.10.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e={},n=this.element;return t.each(["min","max","step"],function(t,i){var s=n.attr(i);void 0!==s&&s.length&&(e[i]=s)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",t)))},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function n(){var t=this.element[0]===this.document[0].activeElement;t||(this.element.focus(),this.previous=i,this._delay(function(){this.previous=i}))}var i;i=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),e.preventDefault(),n.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,n.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)===!1?!1:void this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var t=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=t.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*t.height())&&t.height()>0&&t.height(t.height()),this.options.disabled&&this.disable()},_keydown:function(e){var n=this.options,i=t.ui.keyCode;switch(e.keyCode){case i.UP:return this._repeat(null,1,e),!0;case i.DOWN:return this._repeat(null,-1,e),!0;case i.PAGE_UP:return this._repeat(null,n.page,e),!0;case i.PAGE_DOWN:return this._repeat(null,-n.page,e),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(t){return this.spinning||this._trigger("start",t)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(t,e,n){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){
this._repeat(40,e,n)},t),this._spin(e*this.options.step,n)},_spin:function(t,e){var n=this.value()||0;this.counter||(this.counter=1),n=this._adjustValue(n+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:n})===!1||(this._value(n),this.counter++)},_increment:function(e){var n=this.options.incremental;return n?t.isFunction(n)?n(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,n=e.indexOf(".");return-1===n?0:e.length-n-1},_adjustValue:function(t){var e,n,i=this.options;return e=null!==i.min?i.min:0,n=t-e,n=Math.round(n/i.step)*i.step,t=e+n,t=parseFloat(t.toFixed(this._precision())),null!==i.max&&t>i.max?i.max:null!==i.min&&i.min>t?i.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){if("culture"===t||"numberFormat"===t){var n=this._parse(this.element.val());return this.options[t]=e,void this.element.val(this._format(n))}("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(e.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(e.down)),this._super(t,e),"disabled"===t&&(e?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:e(function(t){this._super(t),this._value(this.element.val())}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(t,e){var n;""!==t&&(n=this._parse(t),null!==n&&(e||(n=this._adjustValue(n)),t=this._format(n))),this.element.val(t),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:e(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:e(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:e(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:e(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?void e(this._value).call(this,t):this._parse(this.element.val())},widget:function(){return this.uiSpinner}})}(jQuery),function(t,e){function n(){return++s}function i(t){return t=t.cloneNode(!1),t.hash.length>1&&decodeURIComponent(t.href.replace(o,""))===decodeURIComponent(location.href.replace(o,""))}var s=0,o=/#.*$/;t.widget("ui.tabs",{version:"1.10.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var e=this,n=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",n.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),n.active=this._initialActive(),t.isArray(n.disabled)&&(n.disabled=t.unique(n.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(n.active):t(),this._refresh(),this.active.length&&this.load(n.active)},_initialActive:function(){var n=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===n&&(s&&this.tabs.each(function(i,o){return t(o).attr("aria-controls")===s?(n=i,!1):e}),null===n&&(n=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===n||-1===n)&&(n=this.tabs.length?0:!1)),n!==!1&&(n=this.tabs.index(this.tabs.eq(n)),-1===n&&(n=i?!1:0)),!i&&n===!1&&this.anchors.length&&(n=0),n},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(n){var i=t(this.document[0].activeElement).closest("li"),s=this.tabs.index(i),o=!0;if(!this._handlePageNav(n)){switch(n.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:s++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:o=!1,s--;break;case t.ui.keyCode.END:s=this.anchors.length-1;break;case t.ui.keyCode.HOME:s=0;break;case t.ui.keyCode.SPACE:return n.preventDefault(),clearTimeout(this.activating),this._activate(s),e;case t.ui.keyCode.ENTER:return n.preventDefault(),clearTimeout(this.activating),this._activate(s===this.options.active?!1:s),e;default:return}n.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,o),n.ctrlKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.focus())},_handlePageNav:function(n){return n.altKey&&n.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):n.altKey&&n.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):e},_findNextTab:function(e,n){function i(){return e>s&&(e=0),0>e&&(e=s),e}for(var s=this.tabs.length-1;-1!==t.inArray(i(),this.options.disabled);)e=n?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).focus(),t},_setOption:function(t,n){return"active"===t?(this._activate(n),e):"disabled"===t?(this._setupDisabled(n),e):(this._super(t,n),"collapsible"===t&&(this.element.toggleClass("ui-tabs-collapsible",n),n||this.options.active!==!1||this._activate(0)),"event"===t&&this._setupEvents(n),"heightStyle"===t&&this._setupHeightStyle(n),e)},_tabId:function(t){return t.attr("aria-controls")||"ui-tabs-"+n()},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,n=this.tablist.children(":has(a[href])");e.disabled=t.map(n.filter(".ui-state-disabled"),function(t){return n.index(t)}),this._processTabs(),e.active!==!1&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=t(),this.anchors.each(function(n,s){var o,a,r,l=t(s).uniqueId().attr("id"),u=t(s).closest("li"),c=u.attr("aria-controls");i(s)?(o=s.hash,a=e.element.find(e._sanitizeSelector(o))):(r=e._tabId(u),o="#"+r,a=e.element.find(o),a.length||(a=e._createPanel(r),a.insertAfter(e.panels[n-1]||e.tablist)),a.attr("aria-live","polite")),a.length&&(e.panels=e.panels.add(a)),c&&u.data("ui-tabs-aria-controls",c),u.attr({"aria-controls":o.substring(1),"aria-labelledby":l}),a.attr("aria-labelledby",l)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(e){t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1);for(var n,i=0;n=this.tabs[i];i++)e===!0||-1!==t.inArray(i,e)?t(n).addClass("ui-state-disabled").attr("aria-disabled","true"):t(n).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=e},_setupEvents:function(e){var n={click:function(t){t.preventDefault()}};e&&t.each(e.split(" "),function(t,e){n[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,n),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var n,i=this.element.parent();"fill"===e?(n=i.height(),n-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),i=e.css("position");"absolute"!==i&&"fixed"!==i&&(n-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){n-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,n-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(n=0,this.panels.each(function(){n=Math.max(n,t(this).height("").height())}).height(n))},_eventHandler:function(e){var n=this.options,i=this.active,s=t(e.currentTarget),o=s.closest("li"),a=o[0]===i[0],r=a&&n.collapsible,l=r?t():this._getPanelForTab(o),u=i.length?this._getPanelForTab(i):t(),c={oldTab:i,oldPanel:u,newTab:r?t():o,newPanel:l};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||a&&!n.collapsible||this._trigger("beforeActivate",e,c)===!1||(n.active=r?!1:this.tabs.index(o),this.active=a?t():o,this.xhr&&this.xhr.abort(),u.length||l.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(o),e),this._toggle(e,c))},_toggle:function(e,n){function i(){o.running=!1,o._trigger("activate",e,n)}function s(){n.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),a.length&&o.options.show?o._show(a,o.options.show,i):(a.show(),i())}var o=this,a=n.newPanel,r=n.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),s()}):(n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r.hide(),s()),r.attr({"aria-expanded":"false","aria-hidden":"true"}),n.oldTab.attr("aria-selected","false"),a.length&&r.length?n.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),a.attr({"aria-expanded":"true","aria-hidden":"false"}),n.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(e){var n,i=this._findActive(e);i[0]!==this.active[0]&&(i.length||(i=this.active),n=i.find(".ui-tabs-anchor")[0],this._eventHandler({target:n,currentTarget:n,preventDefault:t.noop}))},_findActive:function(e){return e===!1?t():this.tabs.eq(e)},_getIndex:function(t){return"string"==typeof t&&(t=this.anchors.index(this.anchors.filter("[href$='"+t+"']"))),t},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var e=t(this),n=e.data("ui-tabs-aria-controls");n?e.attr("aria-controls",n).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(n){var i=this.options.disabled;i!==!1&&(n===e?i=!1:(n=this._getIndex(n),i=t.isArray(i)?t.map(i,function(t){return t!==n?t:null}):t.map(this.tabs,function(t,e){return e!==n?e:null})),this._setupDisabled(i))},disable:function(n){var i=this.options.disabled;if(i!==!0){if(n===e)i=!0;else{if(n=this._getIndex(n),-1!==t.inArray(n,i))return;i=t.isArray(i)?t.merge([n],i).sort():[n]}this._setupDisabled(i)}},load:function(e,n){e=this._getIndex(e);var s=this,o=this.tabs.eq(e),a=o.find(".ui-tabs-anchor"),r=this._getPanelForTab(o),l={tab:o,panel:r};i(a[0])||(this.xhr=t.ajax(this._ajaxSettings(a,n,l)),this.xhr&&"canceled"!==this.xhr.statusText&&(o.addClass("ui-tabs-loading"),r.attr("aria-busy","true"),this.xhr.success(function(t){setTimeout(function(){r.html(t),s._trigger("load",n,l)},1)}).complete(function(t,e){setTimeout(function(){"abort"===e&&s.panels.stop(!1,!0),o.removeClass("ui-tabs-loading"),r.removeAttr("aria-busy"),t===s.xhr&&delete s.xhr},1)})))},_ajaxSettings:function(e,n,i){var s=this;return{url:e.attr("href"),beforeSend:function(e,o){return s._trigger("beforeLoad",n,t.extend({jqXHR:e,ajaxSettings:o},i))}}},_getPanelForTab:function(e){var n=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+n))}})}(jQuery),function(t){function e(e,n){var i=(e.attr("aria-describedby")||"").split(/\s+/);i.push(n),e.data("ui-tooltip-id",n).attr("aria-describedby",t.trim(i.join(" ")))}function n(e){var n=e.data("ui-tooltip-id"),i=(e.attr("aria-describedby")||"").split(/\s+/),s=t.inArray(n,i);-1!==s&&i.splice(s,1),e.removeData("ui-tooltip-id"),i=t.trim(i.join(" ")),i?e.attr("aria-describedby",i):e.removeAttr("aria-describedby")}var i=0;t.widget("ui.tooltip",{version:"1.10.4",options:{content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(e,n){var i=this;return"disabled"===e?(this[n?"_disable":"_enable"](),void(this.options[e]=n)):(this._super(e,n),void("content"===e&&t.each(this.tooltips,function(t,e){i._updateContent(e)})))},_disable:function(){var e=this;t.each(this.tooltips,function(n,i){var s=t.Event("blur");s.target=s.currentTarget=i[0],e.close(s,!0)}),this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.is("[title]")&&e.data("ui-tooltip-title",e.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))})},open:function(e){var n=this,i=t(e?e.target:this.element).closest(this.options.items);i.length&&!i.data("ui-tooltip-id")&&(i.attr("title")&&i.data("ui-tooltip-title",i.attr("title")),i.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&i.parents().each(function(){var e,i=t(this);i.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,n.close(e,!0)),i.attr("title")&&(i.uniqueId(),n.parents[this.id]={element:this,title:i.attr("title")},i.attr("title",""))}),this._updateContent(i,e))},_updateContent:function(t,e){var n,i=this.options.content,s=this,o=e?e.type:null;return"string"==typeof i?this._open(e,t,i):(n=i.call(t[0],function(n){t.data("ui-tooltip-open")&&s._delay(function(){e&&(e.type=o),this._open(e,t,n)})}),void(n&&this._open(e,t,n)))},_open:function(n,i,s){function o(t){u.of=t,a.is(":hidden")||a.position(u)}var a,r,l,u=t.extend({},this.options.position);if(s){if(a=this._find(i),a.length)return void a.find(".ui-tooltip-content").html(s);i.is("[title]")&&(n&&"mouseover"===n.type?i.attr("title",""):i.removeAttr("title")),a=this._tooltip(i),e(i,a.attr("id")),a.find(".ui-tooltip-content").html(s),this.options.track&&n&&/^mouse/.test(n.type)?(this._on(this.document,{mousemove:o}),o(n)):a.position(t.extend({of:i},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.show&&this.options.show.delay&&(l=this.delayedShow=setInterval(function(){a.is(":visible")&&(o(u.of),clearInterval(l))},t.fx.interval)),this._trigger("open",n,{tooltip:a}),r={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var n=t.Event(e);n.currentTarget=i[0],this.close(n,!0)}},remove:function(){this._removeTooltip(a)}},n&&"mouseover"!==n.type||(r.mouseleave="close"),n&&"focusin"!==n.type||(r.focusout="close"),this._on(!0,i,r)}},close:function(e){var i=this,s=t(e?e.currentTarget:this.element),o=this._find(s);this.closing||(clearInterval(this.delayedShow),s.data("ui-tooltip-title")&&s.attr("title",s.data("ui-tooltip-title")),n(s),o.stop(!0),this._hide(o,this.options.hide,function(){i._removeTooltip(t(this))}),s.removeData("ui-tooltip-open"),this._off(s,"mouseleave focusout keyup"),s[0]!==this.element[0]&&this._off(s,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,n){t(n.element).attr("title",n.title),delete i.parents[e]}),this.closing=!0,this._trigger("close",e,{tooltip:o}),this.closing=!1)},_tooltip:function(e){var n="ui-tooltip-"+i++,s=t("<div>").attr({id:n,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return t("<div>").addClass("ui-tooltip-content").appendTo(s),s.appendTo(this.document[0].body),this.tooltips[n]=e,s},_find:function(e){var n=e.data("ui-tooltip-id");return n?t("#"+n):t()},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_destroy:function(){var e=this;t.each(this.tooltips,function(n,i){var s=t.Event("blur");s.target=s.currentTarget=i[0],e.close(s,!0),t("#"+n).remove(),i.data("ui-tooltip-title")&&(i.attr("title",i.data("ui-tooltip-title")),i.removeData("ui-tooltip-title"))})}})}(jQuery),function(t,e){var n="ui-effects-";t.effects={effect:{}},function(t,e){function n(t,e,n){var i=h[e.type]||{};return null==t?n||!e.def?null:e.def:(t=i.floor?~~t:parseFloat(t),isNaN(t)?e.def:i.mod?(t+i.mod)%i.mod:0>t?0:t>i.max?i.max:t)}function i(n){var i=u(),s=i._rgba=[];return n=n.toLowerCase(),f(l,function(t,o){var a,r=o.re.exec(n),l=r&&o.parse(r),u=o.space||"rgba";return l?(a=i[u](l),i[c[u].cache]=a[c[u].cache],s=i._rgba=a._rgba,!1):e}),s.length?("0,0,0,0"===s.join()&&t.extend(s,o.transparent),i):o[n]}function s(t,e,n){return n=(n+1)%1,1>6*n?t+6*(e-t)*n:1>2*n?e:2>3*n?t+6*(e-t)*(2/3-n):t}var o,a="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],u=t.Color=function(e,n,i,s){return new t.Color.fn.parse(e,n,i,s)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},h={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=u.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),u.fn=t.extend(u.prototype,{parse:function(s,a,r,l){if(s===e)return this._rgba=[null,null,null,null],this;(s.jquery||s.nodeType)&&(s=t(s).css(a),a=e);var h=this,d=t.type(s),p=this._rgba=[];return a!==e&&(s=[s,a,r,l],d="array"),"string"===d?this.parse(i(s)||o._default):"array"===d?(f(c.rgba.props,function(t,e){p[e.idx]=n(s[e.idx],e)}),this):"object"===d?(s instanceof u?f(c,function(t,e){s[e.cache]&&(h[e.cache]=s[e.cache].slice())}):f(c,function(e,i){var o=i.cache;f(i.props,function(t,e){if(!h[o]&&i.to){if("alpha"===t||null==s[t])return;h[o]=i.to(h._rgba)}h[o][e.idx]=n(s[t],e,!0)}),h[o]&&0>t.inArray(null,h[o].slice(0,3))&&(h[o][3]=1,i.from&&(h._rgba=i.from(h[o])))}),this):e},is:function(t){var n=u(t),i=!0,s=this;return f(c,function(t,o){var a,r=n[o.cache];return r&&(a=s[o.cache]||o.to&&o.to(s._rgba)||[],f(o.props,function(t,n){return null!=r[n.idx]?i=r[n.idx]===a[n.idx]:e})),i}),i},_space:function(){var t=[],e=this;return f(c,function(n,i){e[i.cache]&&t.push(n)}),t.pop()},transition:function(t,e){var i=u(t),s=i._space(),o=c[s],a=0===this.alpha()?u("transparent"):this,r=a[o.cache]||o.to(a._rgba),l=r.slice();return i=i[o.cache],f(o.props,function(t,s){var o=s.idx,a=r[o],u=i[o],c=h[s.type]||{};null!==u&&(null===a?l[o]=u:(c.mod&&(u-a>c.mod/2?a+=c.mod:a-u>c.mod/2&&(a-=c.mod)),l[o]=n((u-a)*e+a,s)))}),this[s](l)},blend:function(e){if(1===this._rgba[3])return this;var n=this._rgba.slice(),i=n.pop(),s=u(e)._rgba;return u(t.map(n,function(t,e){return(1-i)*s[e]+i*t}))},toRgbaString:function(){var e="rgba(",n=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===n[3]&&(n.pop(),e="rgb("),e+n.join()+")"},toHslaString:function(){var e="hsla(",n=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===n[3]&&(n.pop(),e="hsl("),e+n.join()+")"},toHexString:function(e){var n=this._rgba.slice(),i=n.pop();return e&&n.push(~~(255*i)),"#"+t.map(n,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),u.fn.parse.prototype=u.fn,c.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,n,i=t[0]/255,s=t[1]/255,o=t[2]/255,a=t[3],r=Math.max(i,s,o),l=Math.min(i,s,o),u=r-l,c=r+l,h=.5*c;return e=l===r?0:i===r?60*(s-o)/u+360:s===r?60*(o-i)/u+120:60*(i-s)/u+240,n=0===u?0:.5>=h?u/c:u/(2-c),[Math.round(e)%360,n,h,null==a?1:a]},c.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,n=t[1],i=t[2],o=t[3],a=.5>=i?i*(1+n):i+n-i*n,r=2*i-a;return[Math.round(255*s(r,a,e+1/3)),Math.round(255*s(r,a,e)),Math.round(255*s(r,a,e-1/3)),o]},f(c,function(i,s){var o=s.props,a=s.cache,l=s.to,c=s.from;u.fn[i]=function(i){if(l&&!this[a]&&(this[a]=l(this._rgba)),i===e)return this[a].slice();var s,r=t.type(i),h="array"===r||"object"===r?i:arguments,d=this[a].slice();return f(o,function(t,e){var i=h["object"===r?t:e.idx];null==i&&(i=d[e.idx]),d[e.idx]=n(i,e)}),c?(s=u(c(d)),s[a]=d,s):u(d)},f(o,function(e,n){u.fn[e]||(u.fn[e]=function(s){var o,a=t.type(s),l="alpha"===e?this._hsla?"hsla":"rgba":i,u=this[l](),c=u[n.idx];return"undefined"===a?c:("function"===a&&(s=s.call(this,c),a=t.type(s)),null==s&&n.empty?this:("string"===a&&(o=r.exec(s),o&&(s=c+parseFloat(o[2])*("+"===o[1]?1:-1))),u[n.idx]=s,this[l](u)))})})}),u.hook=function(e){var n=e.split(" ");f(n,function(e,n){t.cssHooks[n]={set:function(e,s){var o,a,r="";if("transparent"!==s&&("string"!==t.type(s)||(o=i(s)))){if(s=u(o||s),!d.rgba&&1!==s._rgba[3]){for(a="backgroundColor"===n?e.parentNode:e;(""===r||"transparent"===r)&&a&&a.style;)try{r=t.css(a,"backgroundColor"),a=a.parentNode}catch(l){}s=s.blend(r&&"transparent"!==r?r:"_default")}s=s.toRgbaString()}try{e.style[n]=s}catch(l){}}},t.fx.step[n]=function(e){e.colorInit||(e.start=u(e.elem,n),e.end=u(e.end),e.colorInit=!0),t.cssHooks[n].set(e.elem,e.start.transition(e.end,e.pos))}})},u.hook(a),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(n,i){e["border"+i+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function n(e){var n,i,s=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(s&&s.length&&s[0]&&s[s[0]])for(i=s.length;i--;)n=s[i],"string"==typeof s[n]&&(o[t.camelCase(n)]=s[n]);else for(n in s)"string"==typeof s[n]&&(o[n]=s[n]);return o}function i(e,n){var i,s,a={};for(i in n)s=n[i],e[i]!==s&&(o[i]||(t.fx.step[i]||!isNaN(parseFloat(s)))&&(a[i]=s));return a}var s=["add","remove","toggle"],o={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,n){t.fx.step[n]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(jQuery.style(t.elem,n,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(e,o,a,r){var l=t.speed(o,a,r);return this.queue(function(){var o,a=t(this),r=a.attr("class")||"",u=l.children?a.find("*").addBack():a;u=u.map(function(){var e=t(this);return{el:e,start:n(this)}}),o=function(){t.each(s,function(t,n){e[n]&&a[n+"Class"](e[n])})},o(),u=u.map(function(){return this.end=n(this.el[0]),this.diff=i(this.start,this.end),this}),a.attr("class",r),u=u.map(function(){var e=this,n=t.Deferred(),i=t.extend({},l,{queue:!1,complete:function(){n.resolve(e)}});return this.el.animate(this.diff,i),n.promise()}),t.when.apply(t,u.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),l.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(n,i,s,o){return i?t.effects.animateClass.call(this,{add:n},i,s,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(n,i,s,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:n},i,s,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(n){return function(i,s,o,a,r){return"boolean"==typeof s||s===e?o?t.effects.animateClass.call(this,s?{add:i}:{remove:i},o,a,r):n.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},s,o,a)}}(t.fn.toggleClass),switchClass:function(e,n,i,s,o){return t.effects.animateClass.call(this,{add:n,remove:e},i,s,o)}})}(),function(){function i(e,n,i,s){return t.isPlainObject(e)&&(n=e,e=e.effect),e={effect:e},null==n&&(n={}),t.isFunction(n)&&(s=n,i=null,n={}),("number"==typeof n||t.fx.speeds[n])&&(s=i,i=n,n={}),t.isFunction(i)&&(s=i,i=null),n&&t.extend(e,n),i=i||n.duration,e.duration=t.fx.off?0:"number"==typeof i?i:i in t.fx.speeds?t.fx.speeds[i]:t.fx.speeds._default,e.complete=s||n.complete,e}function s(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}t.extend(t.effects,{version:"1.10.4",save:function(t,e){for(var i=0;e.length>i;i++)null!==e[i]&&t.data(n+e[i],t[0].style[e[i]])},restore:function(t,i){var s,o;for(o=0;i.length>o;o++)null!==i[o]&&(s=t.data(n+i[o]),s===e&&(s=""),t.css(i[o],s))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var n,i;switch(t[0]){case"top":n=0;break;case"middle":n=.5;break;case"bottom":n=1;break;default:n=t[0]/e.height}switch(t[1]){case"left":i=0;break;case"center":i=.5;break;case"right":i=1;break;default:i=t[1]/e.width}return{x:i,y:n}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var n={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},i=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),s={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(a){o=document.body}return e.wrap(i),(e[0]===o||t.contains(e[0],o))&&t(o).focus(),i=e.parent(),"static"===e.css("position")?(i.css({position:"relative"}),e.css({position:"relative"})):(t.extend(n,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,i){n[i]=e.css(i),isNaN(parseInt(n[i],10))&&(n[i]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(s),i.css(n).show()},removeWrapper:function(e){var n=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===n||t.contains(e[0],n))&&t(n).focus()),e},setTransition:function(e,n,i,s){return s=s||{},t.each(n,function(t,n){var o=e.cssUnit(n);o[0]>0&&(s[n]=o[0]*i+o[1])}),s}}),t.fn.extend({effect:function(){function e(e){function i(){t.isFunction(o)&&o.call(s[0]),t.isFunction(e)&&e()}var s=t(this),o=n.complete,r=n.mode;(s.is(":hidden")?"hide"===r:"show"===r)?(s[r](),i()):a.call(s[0],n,i)}var n=i.apply(this,arguments),s=n.mode,o=n.queue,a=t.effects.effect[n.effect];return t.fx.off||!a?s?this[s](n.duration,n.complete):this.each(function(){n.complete&&n.complete.call(this)}):o===!1?this.each(e):this.queue(o||"fx",e)},show:function(t){return function(e){if(s(e))return t.apply(this,arguments);var n=i.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(t.fn.show),hide:function(t){return function(e){if(s(e))return t.apply(this,arguments);var n=i.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(e){if(s(e)||"boolean"==typeof e)return t.apply(this,arguments);var n=i.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var n=this.css(e),i=[];return t.each(["em","px","%","pt"],function(t,e){n.indexOf(e)>0&&(i=[parseFloat(n),e])}),i}})}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,n){e[n]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,n=4;((e=Math.pow(2,--n))-1)/11>t;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,n){t.easing["easeIn"+e]=n,t.easing["easeOut"+e]=function(t){return 1-n(1-t);
},t.easing["easeInOut"+e]=function(t){return.5>t?n(2*t)/2:1-n(-2*t+2)/2}})}()}(jQuery),function(t){var e=/up|down|vertical/,n=/up|left|vertical|horizontal/;t.effects.effect.blind=function(i,s){var o,a,r,l=t(this),u=["position","top","bottom","left","right","height","width"],c=t.effects.setMode(l,i.mode||"hide"),h=i.direction||"up",d=e.test(h),p=d?"height":"width",f=d?"top":"left",g=n.test(h),m={},v="show"===c;l.parent().is(".ui-effects-wrapper")?t.effects.save(l.parent(),u):t.effects.save(l,u),l.show(),o=t.effects.createWrapper(l).css({overflow:"hidden"}),a=o[p](),r=parseFloat(o.css(f))||0,m[p]=v?a:0,g||(l.css(d?"bottom":"right",0).css(d?"top":"left","auto").css({position:"absolute"}),m[f]=v?r:a+r),v&&(o.css(p,0),g||o.css(f,r+a)),o.animate(m,{duration:i.duration,easing:i.easing,queue:!1,complete:function(){"hide"===c&&l.hide(),t.effects.restore(l,u),t.effects.removeWrapper(l),s()}})}}(jQuery),function(t){t.effects.effect.bounce=function(e,n){var i,s,o,a=t(this),r=["position","top","bottom","left","right","height","width"],l=t.effects.setMode(a,e.mode||"effect"),u="hide"===l,c="show"===l,h=e.direction||"up",d=e.distance,p=e.times||5,f=2*p+(c||u?1:0),g=e.duration/f,m=e.easing,v="up"===h||"down"===h?"top":"left",b="up"===h||"left"===h,y=a.queue(),_=y.length;for((c||u)&&r.push("opacity"),t.effects.save(a,r),a.show(),t.effects.createWrapper(a),d||(d=a["top"===v?"outerHeight":"outerWidth"]()/3),c&&(o={opacity:1},o[v]=0,a.css("opacity",0).css(v,b?2*-d:2*d).animate(o,g,m)),u&&(d/=Math.pow(2,p-1)),o={},o[v]=0,i=0;p>i;i++)s={},s[v]=(b?"-=":"+=")+d,a.animate(s,g,m).animate(o,g,m),d=u?2*d:d/2;u&&(s={opacity:0},s[v]=(b?"-=":"+=")+d,a.animate(s,g,m)),a.queue(function(){u&&a.hide(),t.effects.restore(a,r),t.effects.removeWrapper(a),n()}),_>1&&y.splice.apply(y,[1,0].concat(y.splice(_,f+1))),a.dequeue()}}(jQuery),function(t){t.effects.effect.clip=function(e,n){var i,s,o,a=t(this),r=["position","top","bottom","left","right","height","width"],l=t.effects.setMode(a,e.mode||"hide"),u="show"===l,c=e.direction||"vertical",h="vertical"===c,d=h?"height":"width",p=h?"top":"left",f={};t.effects.save(a,r),a.show(),i=t.effects.createWrapper(a).css({overflow:"hidden"}),s="IMG"===a[0].tagName?i:a,o=s[d](),u&&(s.css(d,0),s.css(p,o/2)),f[d]=u?o:0,f[p]=u?0:o/2,s.animate(f,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){u||a.hide(),t.effects.restore(a,r),t.effects.removeWrapper(a),n()}})}}(jQuery),function(t){t.effects.effect.drop=function(e,n){var i,s=t(this),o=["position","top","bottom","left","right","opacity","height","width"],a=t.effects.setMode(s,e.mode||"hide"),r="show"===a,l=e.direction||"left",u="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l?"pos":"neg",h={opacity:r?1:0};t.effects.save(s,o),s.show(),t.effects.createWrapper(s),i=e.distance||s["top"===u?"outerHeight":"outerWidth"](!0)/2,r&&s.css("opacity",0).css(u,"pos"===c?-i:i),h[u]=(r?"pos"===c?"+=":"-=":"pos"===c?"-=":"+=")+i,s.animate(h,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===a&&s.hide(),t.effects.restore(s,o),t.effects.removeWrapper(s),n()}})}}(jQuery),function(t){t.effects.effect.explode=function(e,n){function i(){y.push(this),y.length===h*d&&s()}function s(){p.css({visibility:"visible"}),t(y).remove(),g||p.hide(),n()}var o,a,r,l,u,c,h=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=h,p=t(this),f=t.effects.setMode(p,e.mode||"hide"),g="show"===f,m=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/d),b=Math.ceil(p.outerHeight()/h),y=[];for(o=0;h>o;o++)for(l=m.top+o*b,c=o-(h-1)/2,a=0;d>a;a++)r=m.left+a*v,u=a-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-a*v,top:-o*b}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:b,left:r+(g?u*v:0),top:l+(g?c*b:0),opacity:g?0:1}).animate({left:r+(g?0:u*v),top:l+(g?0:c*b),opacity:g?1:0},e.duration||500,e.easing,i)}}(jQuery),function(t){t.effects.effect.fade=function(e,n){var i=t(this),s=t.effects.setMode(i,e.mode||"toggle");i.animate({opacity:s},{queue:!1,duration:e.duration,easing:e.easing,complete:n})}}(jQuery),function(t){t.effects.effect.fold=function(e,n){var i,s,o=t(this),a=["position","top","bottom","left","right","height","width"],r=t.effects.setMode(o,e.mode||"hide"),l="show"===r,u="hide"===r,c=e.size||15,h=/([0-9]+)%/.exec(c),d=!!e.horizFirst,p=l!==d,f=p?["width","height"]:["height","width"],g=e.duration/2,m={},v={};t.effects.save(o,a),o.show(),i=t.effects.createWrapper(o).css({overflow:"hidden"}),s=p?[i.width(),i.height()]:[i.height(),i.width()],h&&(c=parseInt(h[1],10)/100*s[u?0:1]),l&&i.css(d?{height:0,width:c}:{height:c,width:0}),m[f[0]]=l?s[0]:c,v[f[1]]=l?s[1]:0,i.animate(m,g,e.easing).animate(v,g,e.easing,function(){u&&o.hide(),t.effects.restore(o,a),t.effects.removeWrapper(o),n()})}}(jQuery),function(t){t.effects.effect.highlight=function(e,n){var i=t(this),s=["backgroundImage","backgroundColor","opacity"],o=t.effects.setMode(i,e.mode||"show"),a={backgroundColor:i.css("backgroundColor")};"hide"===o&&(a.opacity=0),t.effects.save(i,s),i.show().css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(a,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===o&&i.hide(),t.effects.restore(i,s),n()}})}}(jQuery),function(t){t.effects.effect.pulsate=function(e,n){var i,s=t(this),o=t.effects.setMode(s,e.mode||"show"),a="show"===o,r="hide"===o,l=a||"hide"===o,u=2*(e.times||5)+(l?1:0),c=e.duration/u,h=0,d=s.queue(),p=d.length;for((a||!s.is(":visible"))&&(s.css("opacity",0).show(),h=1),i=1;u>i;i++)s.animate({opacity:h},c,e.easing),h=1-h;s.animate({opacity:h},c,e.easing),s.queue(function(){r&&s.hide(),n()}),p>1&&d.splice.apply(d,[1,0].concat(d.splice(p,u+1))),s.dequeue()}}(jQuery),function(t){t.effects.effect.puff=function(e,n){var i=t(this),s=t.effects.setMode(i,e.mode||"hide"),o="hide"===s,a=parseInt(e.percent,10)||150,r=a/100,l={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};t.extend(e,{effect:"scale",queue:!1,fade:!0,mode:s,complete:n,percent:o?a:100,from:o?l:{height:l.height*r,width:l.width*r,outerHeight:l.outerHeight*r,outerWidth:l.outerWidth*r}}),i.effect(e)},t.effects.effect.scale=function(e,n){var i=t(this),s=t.extend(!0,{},e),o=t.effects.setMode(i,e.mode||"effect"),a=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"hide"===o?0:100),r=e.direction||"both",l=e.origin,u={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()},c={y:"horizontal"!==r?a/100:1,x:"vertical"!==r?a/100:1};s.effect="size",s.queue=!1,s.complete=n,"effect"!==o&&(s.origin=l||["middle","center"],s.restore=!0),s.from=e.from||("show"===o?{height:0,width:0,outerHeight:0,outerWidth:0}:u),s.to={height:u.height*c.y,width:u.width*c.x,outerHeight:u.outerHeight*c.y,outerWidth:u.outerWidth*c.x},s.fade&&("show"===o&&(s.from.opacity=0,s.to.opacity=1),"hide"===o&&(s.from.opacity=1,s.to.opacity=0)),i.effect(s)},t.effects.effect.size=function(e,n){var i,s,o,a=t(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["position","top","bottom","left","right","overflow","opacity"],u=["width","height","overflow"],c=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],d=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=t.effects.setMode(a,e.mode||"effect"),f=e.restore||"effect"!==p,g=e.scale||"both",m=e.origin||["middle","center"],v=a.css("position"),b=f?r:l,y={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&a.show(),i={height:a.height(),width:a.width(),outerHeight:a.outerHeight(),outerWidth:a.outerWidth()},"toggle"===e.mode&&"show"===p?(a.from=e.to||y,a.to=e.from||i):(a.from=e.from||("show"===p?y:i),a.to=e.to||("hide"===p?y:i)),o={from:{y:a.from.height/i.height,x:a.from.width/i.width},to:{y:a.to.height/i.height,x:a.to.width/i.width}},("box"===g||"both"===g)&&(o.from.y!==o.to.y&&(b=b.concat(h),a.from=t.effects.setTransition(a,h,o.from.y,a.from),a.to=t.effects.setTransition(a,h,o.to.y,a.to)),o.from.x!==o.to.x&&(b=b.concat(d),a.from=t.effects.setTransition(a,d,o.from.x,a.from),a.to=t.effects.setTransition(a,d,o.to.x,a.to))),("content"===g||"both"===g)&&o.from.y!==o.to.y&&(b=b.concat(c).concat(u),a.from=t.effects.setTransition(a,c,o.from.y,a.from),a.to=t.effects.setTransition(a,c,o.to.y,a.to)),t.effects.save(a,b),a.show(),t.effects.createWrapper(a),a.css("overflow","hidden").css(a.from),m&&(s=t.effects.getBaseline(m,i),a.from.top=(i.outerHeight-a.outerHeight())*s.y,a.from.left=(i.outerWidth-a.outerWidth())*s.x,a.to.top=(i.outerHeight-a.to.outerHeight)*s.y,a.to.left=(i.outerWidth-a.to.outerWidth)*s.x),a.css(a.from),("content"===g||"both"===g)&&(h=h.concat(["marginTop","marginBottom"]).concat(c),d=d.concat(["marginLeft","marginRight"]),u=r.concat(h).concat(d),a.find("*[width]").each(function(){var n=t(this),i={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()};f&&t.effects.save(n,u),n.from={height:i.height*o.from.y,width:i.width*o.from.x,outerHeight:i.outerHeight*o.from.y,outerWidth:i.outerWidth*o.from.x},n.to={height:i.height*o.to.y,width:i.width*o.to.x,outerHeight:i.height*o.to.y,outerWidth:i.width*o.to.x},o.from.y!==o.to.y&&(n.from=t.effects.setTransition(n,h,o.from.y,n.from),n.to=t.effects.setTransition(n,h,o.to.y,n.to)),o.from.x!==o.to.x&&(n.from=t.effects.setTransition(n,d,o.from.x,n.from),n.to=t.effects.setTransition(n,d,o.to.x,n.to)),n.css(n.from),n.animate(n.to,e.duration,e.easing,function(){f&&t.effects.restore(n,u)})})),a.animate(a.to,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){0===a.to.opacity&&a.css("opacity",a.from.opacity),"hide"===p&&a.hide(),t.effects.restore(a,b),f||("static"===v?a.css({position:"relative",top:a.to.top,left:a.to.left}):t.each(["top","left"],function(t,e){a.css(e,function(e,n){var i=parseInt(n,10),s=t?a.to.left:a.to.top;return"auto"===n?s+"px":i+s+"px"})})),t.effects.removeWrapper(a),n()}})}}(jQuery),function(t){t.effects.effect.shake=function(e,n){var i,s=t(this),o=["position","top","bottom","left","right","height","width"],a=t.effects.setMode(s,e.mode||"effect"),r=e.direction||"left",l=e.distance||20,u=e.times||3,c=2*u+1,h=Math.round(e.duration/c),d="up"===r||"down"===r?"top":"left",p="up"===r||"left"===r,f={},g={},m={},v=s.queue(),b=v.length;for(t.effects.save(s,o),s.show(),t.effects.createWrapper(s),f[d]=(p?"-=":"+=")+l,g[d]=(p?"+=":"-=")+2*l,m[d]=(p?"-=":"+=")+2*l,s.animate(f,h,e.easing),i=1;u>i;i++)s.animate(g,h,e.easing).animate(m,h,e.easing);s.animate(g,h,e.easing).animate(f,h/2,e.easing).queue(function(){"hide"===a&&s.hide(),t.effects.restore(s,o),t.effects.removeWrapper(s),n()}),b>1&&v.splice.apply(v,[1,0].concat(v.splice(b,c+1))),s.dequeue()}}(jQuery),function(t){t.effects.effect.slide=function(e,n){var i,s=t(this),o=["position","top","bottom","left","right","width","height"],a=t.effects.setMode(s,e.mode||"show"),r="show"===a,l=e.direction||"left",u="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l,h={};t.effects.save(s,o),s.show(),i=e.distance||s["top"===u?"outerHeight":"outerWidth"](!0),t.effects.createWrapper(s).css({overflow:"hidden"}),r&&s.css(u,c?isNaN(i)?"-"+i:-i:i),h[u]=(r?c?"+=":"-=":c?"-=":"+=")+i,s.animate(h,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===a&&s.hide(),t.effects.restore(s,o),t.effects.removeWrapper(s),n()}})}}(jQuery),function(t){t.effects.effect.transfer=function(e,n){var i=t(this),s=t(e.to),o="fixed"===s.css("position"),a=t("body"),r=o?a.scrollTop():0,l=o?a.scrollLeft():0,u=s.offset(),c={top:u.top-r,left:u.left-l,height:s.innerHeight(),width:s.innerWidth()},h=i.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(e.className).css({top:h.top-r,left:h.left-l,height:i.innerHeight(),width:i.innerWidth(),position:o?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){d.remove(),n()})}}(jQuery),!function(){function t(t,e){return e>t?-1:t>e?1:t>=e?0:NaN}function e(t){return null!=t&&!isNaN(t)}function n(t){return{left:function(e,n,i,s){for(arguments.length<3&&(i=0),arguments.length<4&&(s=e.length);s>i;){var o=i+s>>>1;t(e[o],n)<0?i=o+1:s=o}return i},right:function(e,n,i,s){for(arguments.length<3&&(i=0),arguments.length<4&&(s=e.length);s>i;){var o=i+s>>>1;t(e[o],n)>0?s=o:i=o+1}return i}}}function i(t){return t.length}function s(t){for(var e=1;t*e%1;)e*=10;return e}function o(t,e){try{for(var n in e)Object.defineProperty(t.prototype,n,{value:e[n],enumerable:!1})}catch(i){t.prototype=e}}function a(){}function r(t){return aa+t in this}function l(t){return t=aa+t,t in this&&delete this[t]}function u(){var t=[];return this.forEach(function(e){t.push(e)}),t}function c(){var t=0;for(var e in this)e.charCodeAt(0)===ra&&++t;return t}function h(){for(var t in this)if(t.charCodeAt(0)===ra)return!1;return!0}function d(){}function p(t,e,n){return function(){var i=n.apply(e,arguments);return i===e?t:i}}function f(t,e){if(e in t)return e;e=e.charAt(0).toUpperCase()+e.substring(1);for(var n=0,i=la.length;i>n;++n){var s=la[n]+e;if(s in t)return s}}function g(){}function m(){}function v(t){function e(){for(var e,i=n,s=-1,o=i.length;++s<o;)(e=i[s].on)&&e.apply(this,arguments);return t}var n=[],i=new a;return e.on=function(e,s){var o,a=i.get(e);return arguments.length<2?a&&a.on:(a&&(a.on=null,n=n.slice(0,o=n.indexOf(a)).concat(n.slice(o+1)),i.remove(e)),s&&n.push(i.set(e,{on:s})),t)},e}function b(){$o.event.preventDefault()}function y(){for(var t,e=$o.event;t=e.sourceEvent;)e=t;return e}function _(t){for(var e=new m,n=0,i=arguments.length;++n<i;)e[arguments[n]]=v(e);return e.of=function(n,i){return function(s){try{var o=s.sourceEvent=$o.event;s.target=t,$o.event=s,e[s.type].apply(n,i)}finally{$o.event=o}}},e}function w(t){return ca(t,ga),t}function M(t){return"function"==typeof t?t:function(){return ha(t,this)}}function x(t){return"function"==typeof t?t:function(){return da(t,this)}}function C(t,e){function n(){this.removeAttribute(t)}function i(){this.removeAttributeNS(t.space,t.local)}function s(){this.setAttribute(t,e)}function o(){this.setAttributeNS(t.space,t.local,e)}function a(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}function r(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}return t=$o.ns.qualify(t),null==e?t.local?i:n:"function"==typeof e?t.local?r:a:t.local?o:s}function I(t){return t.trim().replace(/\s+/g," ")}function S(t){return new RegExp("(?:^|\\s+)"+$o.requote(t)+"(?:\\s+|$)","g")}function E(t){return(t+"").trim().split(/^|\s+/)}function L(t,e){function n(){for(var n=-1;++n<s;)t[n](this,e)}function i(){for(var n=-1,i=e.apply(this,arguments);++n<s;)t[n](this,i)}t=E(t).map(k);var s=t.length;return"function"==typeof e?i:n}function k(t){var e=S(t);return function(n,i){if(s=n.classList)return i?s.add(t):s.remove(t);var s=n.getAttribute("class")||"";i?(e.lastIndex=0,e.test(s)||n.setAttribute("class",I(s+" "+t))):n.setAttribute("class",I(s.replace(e," ")))}}function D(t,e,n){function i(){this.style.removeProperty(t)}function s(){this.style.setProperty(t,e,n)}function o(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}return null==e?i:"function"==typeof e?o:s}function P(t,e){function n(){delete this[t]}function i(){this[t]=e}function s(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}return null==e?n:"function"==typeof e?s:i}function T(t){return"function"==typeof t?t:(t=$o.ns.qualify(t)).local?function(){return this.ownerDocument.createElementNS(t.space,t.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,t)}}function N(t){return{__data__:t}}function A(t){return function(){return fa(this,t)}}function O(e){return arguments.length||(e=t),function(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}}function V(t,e){for(var n=0,i=t.length;i>n;n++)for(var s,o=t[n],a=0,r=o.length;r>a;a++)(s=o[a])&&e(s,a,n);return t}function R(t){return ca(t,va),t}function F(t){var e,n;return function(i,s,o){var a,r=t[o].update,l=r.length;for(o!=n&&(n=o,e=0),s>=e&&(e=s+1);!(a=r[e])&&++e<l;);return a}}function j(){var t=this.__transition__;t&&++t.active}function z(t,e,n){function i(){var e=this[a];e&&(this.removeEventListener(t,e,e.$),delete this[a])}function s(){var s=l(e,qo(arguments));i.call(this),this.addEventListener(t,this[a]=s,s.$=n),s._=e}function o(){var e,n=new RegExp("^__on([^.]+)"+$o.requote(t)+"$");for(var i in this)if(e=i.match(n)){var s=this[i];this.removeEventListener(e[1],s,s.$),delete this[i]}}var a="__on"+t,r=t.indexOf("."),l=B;r>0&&(t=t.substring(0,r));var u=ya.get(t);return u&&(t=u,l=W),r?e?s:i:e?g:o}function B(t,e){return function(n){var i=$o.event;$o.event=n,e[0]=this.__data__;try{t.apply(this,e)}finally{$o.event=i}}}function W(t,e){var n=B(t,e);return function(t){var e=this,i=t.relatedTarget;i&&(i===e||8&i.compareDocumentPosition(e))||n.call(e,t)}}function H(){var t=".dragsuppress-"+ ++wa,e="click"+t,n=$o.select(Xo).on("touchmove"+t,b).on("dragstart"+t,b).on("selectstart"+t,b);if(_a){var i=Ko.style,s=i[_a];i[_a]="none"}return function(o){function a(){n.on(e,null)}n.on(t,null),_a&&(i[_a]=s),o&&(n.on(e,function(){b(),a()},!0),setTimeout(a,0))}}function U(t,e){e.changedTouches&&(e=e.changedTouches[0]);var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();if(0>Ma&&(Xo.scrollX||Xo.scrollY)){n=$o.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var s=n[0][0].getScreenCTM();Ma=!(s.f||s.e),n.remove()}return Ma?(i.x=e.pageX,i.y=e.pageY):(i.x=e.clientX,i.y=e.clientY),i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}function $(){return $o.event.changedTouches[0].identifier}function G(){return $o.event.target}function q(){return Xo}function Y(t){return t>0?1:0>t?-1:0}function K(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}function X(t){return t>1?0:-1>t?xa:Math.acos(t)}function Z(t){return t>1?Ia:-1>t?-Ia:Math.asin(t)}function Q(t){return((t=Math.exp(t))-1/t)/2}function J(t){return((t=Math.exp(t))+1/t)/2}function tt(t){return((t=Math.exp(2*t))-1)/(t+1)}function et(t){return(t=Math.sin(t/2))*t}function nt(){}function it(t,e,n){return this instanceof it?(this.h=+t,this.s=+e,void(this.l=+n)):arguments.length<2?t instanceof it?new it(t.h,t.s,t.l):vt(""+t,bt,it):new it(t,e,n)}function st(t,e,n){function i(t){return t>360?t-=360:0>t&&(t+=360),60>t?o+(a-o)*t/60:180>t?a:240>t?o+(a-o)*(240-t)/60:o}function s(t){return Math.round(255*i(t))}var o,a;return t=isNaN(t)?0:(t%=360)<0?t+360:t,e=isNaN(e)?0:0>e?0:e>1?1:e,n=0>n?0:n>1?1:n,a=.5>=n?n*(1+e):n+e-n*e,o=2*n-a,new pt(s(t+120),s(t),s(t-120))}function ot(t,e,n){return this instanceof ot?(this.h=+t,this.c=+e,void(this.l=+n)):arguments.length<2?t instanceof ot?new ot(t.h,t.c,t.l):t instanceof rt?ut(t.l,t.a,t.b):ut((t=yt((t=$o.rgb(t)).r,t.g,t.b)).l,t.a,t.b):new ot(t,e,n)}function at(t,e,n){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),new rt(n,Math.cos(t*=La)*e,Math.sin(t)*e)}function rt(t,e,n){return this instanceof rt?(this.l=+t,this.a=+e,void(this.b=+n)):arguments.length<2?t instanceof rt?new rt(t.l,t.a,t.b):t instanceof ot?at(t.l,t.c,t.h):yt((t=pt(t)).r,t.g,t.b):new rt(t,e,n)}function lt(t,e,n){var i=(t+16)/116,s=i+e/500,o=i-n/200;return s=ct(s)*ja,i=ct(i)*za,o=ct(o)*Ba,new pt(dt(3.2404542*s-1.5371385*i-.4985314*o),dt(-.969266*s+1.8760108*i+.041556*o),dt(.0556434*s-.2040259*i+1.0572252*o))}function ut(t,e,n){return t>0?new ot(Math.atan2(n,e)*ka,Math.sqrt(e*e+n*n),t):new ot(NaN,NaN,t)}function ct(t){return t>.206893034?t*t*t:(t-4/29)/7.787037}function ht(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29}function dt(t){return Math.round(255*(.00304>=t?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function pt(t,e,n){return this instanceof pt?(this.r=~~t,this.g=~~e,void(this.b=~~n)):arguments.length<2?t instanceof pt?new pt(t.r,t.g,t.b):vt(""+t,pt,st):new pt(t,e,n)}function ft(t){return new pt(t>>16,255&t>>8,255&t)}function gt(t){return ft(t)+""}function mt(t){return 16>t?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function vt(t,e,n){var i,s,o,a=0,r=0,l=0;if(i=/([a-z]+)\((.*)\)/i.exec(t))switch(s=i[2].split(","),i[1]){case"hsl":return n(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100);case"rgb":return e(wt(s[0]),wt(s[1]),wt(s[2]))}return(o=Ua.get(t))?e(o.r,o.g,o.b):(null==t||"#"!==t.charAt(0)||isNaN(o=parseInt(t.substring(1),16))||(4===t.length?(a=(3840&o)>>4,a=a>>4|a,r=240&o,r=r>>4|r,l=15&o,l=l<<4|l):7===t.length&&(a=(16711680&o)>>16,r=(65280&o)>>8,l=255&o)),e(a,r,l))}function bt(t,e,n){var i,s,o=Math.min(t/=255,e/=255,n/=255),a=Math.max(t,e,n),r=a-o,l=(a+o)/2;return r?(s=.5>l?r/(a+o):r/(2-a-o),i=t==a?(e-n)/r+(n>e?6:0):e==a?(n-t)/r+2:(t-e)/r+4,i*=60):(i=NaN,s=l>0&&1>l?0:i),new it(i,s,l)}function yt(t,e,n){t=_t(t),e=_t(e),n=_t(n);var i=ht((.4124564*t+.3575761*e+.1804375*n)/ja),s=ht((.2126729*t+.7151522*e+.072175*n)/za),o=ht((.0193339*t+.119192*e+.9503041*n)/Ba);return rt(116*s-16,500*(i-s),200*(s-o))}function _t(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function wt(t){var e=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*e):e}function Mt(t){return"function"==typeof t?t:function(){return t}}function xt(t){return t}function Ct(t){return function(e,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=null),It(e,n,t,i)}}function It(t,e,n,i){function s(){var t,e=l.status;if(!e&&l.responseText||e>=200&&300>e||304===e){try{t=n.call(o,l)}catch(i){return void a.error.call(o,i)}a.load.call(o,t)}else a.error.call(o,l)}var o={},a=$o.dispatch("beforesend","progress","load","error"),r={},l=new XMLHttpRequest,u=null;return!Xo.XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(t)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=s:l.onreadystatechange=function(){l.readyState>3&&s()},l.onprogress=function(t){var e=$o.event;$o.event=t;try{a.progress.call(o,l)}finally{$o.event=e}},o.header=function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?r[t]:(null==e?delete r[t]:r[t]=e+"",o)},o.mimeType=function(t){return arguments.length?(e=null==t?null:t+"",o):e},o.responseType=function(t){return arguments.length?(u=t,o):u},o.response=function(t){return n=t,o},["get","post"].forEach(function(t){o[t]=function(){return o.send.apply(o,[t].concat(qo(arguments)))}}),o.send=function(n,i,s){if(2===arguments.length&&"function"==typeof i&&(s=i,i=null),l.open(n,t,!0),null==e||"accept"in r||(r.accept=e+",*/*"),l.setRequestHeader)for(var c in r)l.setRequestHeader(c,r[c]);return null!=e&&l.overrideMimeType&&l.overrideMimeType(e),null!=u&&(l.responseType=u),null!=s&&o.on("error",s).on("load",function(t){s(null,t)}),a.beforesend.call(o,l),l.send(null==i?null:i),o},o.abort=function(){return l.abort(),o},$o.rebind(o,a,"on"),null==i?o:o.get(St(i))}function St(t){return 1===t.length?function(e,n){t(null==e?n:null)}:t}function Et(){var t=Lt(),e=kt()-t;e>24?(isFinite(e)&&(clearTimeout(Ya),Ya=setTimeout(Et,e)),qa=0):(qa=1,Xa(Et))}function Lt(){var t=Date.now();for(Ka=$a;Ka;)t>=Ka.t&&(Ka.f=Ka.c(t-Ka.t)),Ka=Ka.n;return t}function kt(){for(var t,e=$a,n=1/0;e;)e.f?e=t?t.n=e.n:$a=e.n:(e.t<n&&(n=e.t),e=(t=e).n);return Ga=t,n}function Dt(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)}function Pt(t,e){var n=Math.pow(10,3*oa(8-e));return{scale:e>8?function(t){return t/n}:function(t){return t*n},symbol:t}}function Tt(t){var e=t.decimal,n=t.thousands,i=t.grouping,s=t.currency,o=i?function(t){for(var e=t.length,s=[],o=0,a=i[0];e>0&&a>0;)s.push(t.substring(e-=a,e+a)),a=i[o=(o+1)%i.length];return s.reverse().join(n)}:xt;return function(t){var n=Qa.exec(t),i=n[1]||" ",a=n[2]||">",r=n[3]||"",l=n[4]||"",u=n[5],c=+n[6],h=n[7],d=n[8],p=n[9],f=1,g="",m="",v=!1;switch(d&&(d=+d.substring(1)),(u||"0"===i&&"="===a)&&(u=i="0",a="=",h&&(c-=Math.floor((c-1)/4))),p){case"n":h=!0,p="g";break;case"%":f=100,m="%",p="f";break;case"p":f=100,m="%",p="r";break;case"b":case"o":case"x":case"X":"#"===l&&(g="0"+p.toLowerCase());case"c":case"d":v=!0,d=0;break;case"s":f=-1,p="r"}"$"===l&&(g=s[0],m=s[1]),"r"!=p||d||(p="g"),null!=d&&("g"==p?d=Math.max(1,Math.min(21,d)):("e"==p||"f"==p)&&(d=Math.max(0,Math.min(20,d)))),p=Ja.get(p)||Nt;var b=u&&h;return function(t){var n=m;if(v&&t%1)return"";var s=0>t||0===t&&0>1/t?(t=-t,"-"):r;if(0>f){var l=$o.formatPrefix(t,d);t=l.scale(t),n=l.symbol+m}else t*=f;t=p(t,d);var y=t.lastIndexOf("."),_=0>y?t:t.substring(0,y),w=0>y?"":e+t.substring(y+1);!u&&h&&(_=o(_));var M=g.length+_.length+w.length+(b?0:s.length),x=c>M?new Array(M=c-M+1).join(i):"";return b&&(_=o(x+_)),s+=g,t=_+w,("<"===a?s+t+x:">"===a?x+s+t:"^"===a?x.substring(0,M>>=1)+s+t+x.substring(M):s+(b?t:x+t))+n}}}function Nt(t){return t+""}function At(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Ot(t,e,n){function i(e){var n=t(e),i=o(n,1);return i-e>e-n?n:i}function s(n){return e(n=t(new er(n-1)),1),n}function o(t,n){return e(t=new er(+t),n),t}function a(t,i,o){var a=s(t),r=[];if(o>1)for(;i>a;)n(a)%o||r.push(new Date(+a)),e(a,1);else for(;i>a;)r.push(new Date(+a)),e(a,1);return r}function r(t,e,n){try{er=At;var i=new At;return i._=t,a(i,e,n)}finally{er=Date}}t.floor=t,t.round=i,t.ceil=s,t.offset=o,t.range=a;var l=t.utc=Vt(t);return l.floor=l,l.round=Vt(i),l.ceil=Vt(s),l.offset=Vt(o),l.range=r,t}function Vt(t){return function(e,n){try{er=At;var i=new At;return i._=e,t(i,n)._}finally{er=Date}}}function Rt(t){function e(t){function e(e){for(var n,s,o,a=[],r=-1,l=0;++r<i;)37===t.charCodeAt(r)&&(a.push(t.substring(l,r)),null!=(s=ir[n=t.charAt(++r)])&&(n=t.charAt(++r)),(o=L[n])&&(n=o(e,null==s?"e"===n?" ":"0":s)),a.push(n),l=r+1);return a.push(t.substring(l,r)),a.join("")}var i=t.length;return e.parse=function(e){var i={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},s=n(i,t,e,0);if(s!=e.length)return null;"p"in i&&(i.H=i.H%12+12*i.p);var o=null!=i.Z&&er!==At,a=new(o?At:er);return"j"in i?a.setFullYear(i.y,0,i.j):"w"in i&&("W"in i||"U"in i)?(a.setFullYear(i.y,0,1),a.setFullYear(i.y,0,"W"in i?(i.w+6)%7+7*i.W-(a.getDay()+5)%7:i.w+7*i.U-(a.getDay()+6)%7)):a.setFullYear(i.y,i.m,i.d),a.setHours(i.H+Math.floor(i.Z/100),i.M+i.Z%100,i.S,i.L),o?a._:a},e.toString=function(){return t},e}function n(t,e,n,i){for(var s,o,a,r=0,l=e.length,u=n.length;l>r;){if(i>=u)return-1;if(s=e.charCodeAt(r++),37===s){if(a=e.charAt(r++),o=k[a in ir?e.charAt(r++):a],!o||(i=o(t,n,i))<0)return-1}else if(s!=n.charCodeAt(i++))return-1}return i}function i(t,e,n){M.lastIndex=0;var i=M.exec(e.substring(n));return i?(t.w=x.get(i[0].toLowerCase()),n+i[0].length):-1}function s(t,e,n){_.lastIndex=0;var i=_.exec(e.substring(n));return i?(t.w=w.get(i[0].toLowerCase()),n+i[0].length):-1}function o(t,e,n){S.lastIndex=0;var i=S.exec(e.substring(n));return i?(t.m=E.get(i[0].toLowerCase()),n+i[0].length):-1}function a(t,e,n){C.lastIndex=0;var i=C.exec(e.substring(n));return i?(t.m=I.get(i[0].toLowerCase()),n+i[0].length):-1}function r(t,e,i){return n(t,L.c.toString(),e,i)}function l(t,e,i){return n(t,L.x.toString(),e,i)}function u(t,e,i){return n(t,L.X.toString(),e,i)}function c(t,e,n){var i=y.get(e.substring(n,n+=2).toLowerCase());return null==i?-1:(t.p=i,n)}var h=t.dateTime,d=t.date,p=t.time,f=t.periods,g=t.days,m=t.shortDays,v=t.months,b=t.shortMonths;e.utc=function(t){function n(t){try{er=At;var e=new er;return e._=t,i(e)}finally{er=Date}}var i=e(t);return n.parse=function(t){try{er=At;var e=i.parse(t);return e&&e._}finally{er=Date}},n.toString=i.toString,n},e.multi=e.utc.multi=ie;var y=$o.map(),_=jt(g),w=zt(g),M=jt(m),x=zt(m),C=jt(v),I=zt(v),S=jt(b),E=zt(b);f.forEach(function(t,e){y.set(t.toLowerCase(),e)});var L={a:function(t){return m[t.getDay()]},A:function(t){return g[t.getDay()]},b:function(t){return b[t.getMonth()]},B:function(t){return v[t.getMonth()]},c:e(h),d:function(t,e){return Ft(t.getDate(),e,2)},e:function(t,e){return Ft(t.getDate(),e,2)},H:function(t,e){return Ft(t.getHours(),e,2)},I:function(t,e){return Ft(t.getHours()%12||12,e,2)},j:function(t,e){return Ft(1+tr.dayOfYear(t),e,3)},L:function(t,e){return Ft(t.getMilliseconds(),e,3)},m:function(t,e){return Ft(t.getMonth()+1,e,2)},M:function(t,e){return Ft(t.getMinutes(),e,2)},p:function(t){return f[+(t.getHours()>=12)]},S:function(t,e){return Ft(t.getSeconds(),e,2)},U:function(t,e){return Ft(tr.sundayOfYear(t),e,2)},w:function(t){return t.getDay()},W:function(t,e){return Ft(tr.mondayOfYear(t),e,2)},x:e(d),X:e(p),y:function(t,e){return Ft(t.getFullYear()%100,e,2)},Y:function(t,e){return Ft(t.getFullYear()%1e4,e,4)},Z:ee,"%":function(){return"%"}},k={a:i,A:s,b:o,B:a,c:r,d:Kt,e:Kt,H:Zt,I:Zt,j:Xt,L:te,m:Yt,M:Qt,p:c,S:Jt,U:Wt,w:Bt,W:Ht,x:l,X:u,y:$t,Y:Ut,Z:Gt,"%":ne};return e}function Ft(t,e,n){var i=0>t?"-":"",s=(i?-t:t)+"",o=s.length;return i+(n>o?new Array(n-o+1).join(e)+s:s)}function jt(t){return new RegExp("^(?:"+t.map($o.requote).join("|")+")","i")}function zt(t){for(var e=new a,n=-1,i=t.length;++n<i;)e.set(t[n].toLowerCase(),n);return e}function Bt(t,e,n){sr.lastIndex=0;var i=sr.exec(e.substring(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function Wt(t,e,n){sr.lastIndex=0;var i=sr.exec(e.substring(n));return i?(t.U=+i[0],n+i[0].length):-1}function Ht(t,e,n){sr.lastIndex=0;var i=sr.exec(e.substring(n));return i?(t.W=+i[0],n+i[0].length):-1}function Ut(t,e,n){sr.lastIndex=0;var i=sr.exec(e.substring(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function $t(t,e,n){sr.lastIndex=0;var i=sr.exec(e.substring(n,n+2));return i?(t.y=qt(+i[0]),n+i[0].length):-1}function Gt(t,e,n){return/^[+-]\d{4}$/.test(e=e.substring(n,n+5))?(t.Z=-e,n+5):-1}function qt(t){return t+(t>68?1900:2e3)}function Yt(t,e,n){sr.lastIndex=0;var i=sr.exec(e.substring(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function Kt(t,e,n){sr.lastIndex=0;var i=sr.exec(e.substring(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function Xt(t,e,n){sr.lastIndex=0;var i=sr.exec(e.substring(n,n+3));return i?(t.j=+i[0],n+i[0].length):-1}function Zt(t,e,n){sr.lastIndex=0;var i=sr.exec(e.substring(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function Qt(t,e,n){sr.lastIndex=0;var i=sr.exec(e.substring(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function Jt(t,e,n){sr.lastIndex=0;var i=sr.exec(e.substring(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function te(t,e,n){sr.lastIndex=0;var i=sr.exec(e.substring(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function ee(t){var e=t.getTimezoneOffset(),n=e>0?"-":"+",i=~~(oa(e)/60),s=oa(e)%60;return n+Ft(i,"0",2)+Ft(s,"0",2)}function ne(t,e,n){or.lastIndex=0;var i=or.exec(e.substring(n,n+1));return i?n+i[0].length:-1}function ie(t){for(var e=t.length,n=-1;++n<e;)t[n][0]=this(t[n][0]);return function(e){for(var n=0,i=t[n];!i[1](e);)i=t[++n];return i[0](e)}}function se(){}function oe(t,e,n){var i=n.s=t+e,s=i-t,o=i-s;n.t=t-o+(e-s)}function ae(t,e){t&&ur.hasOwnProperty(t.type)&&ur[t.type](t,e)}function re(t,e,n){var i,s=-1,o=t.length-n;for(e.lineStart();++s<o;)i=t[s],e.point(i[0],i[1],i[2]);e.lineEnd()}function le(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)re(t[n],e,1);e.polygonEnd()}function ue(){function t(t,e){t*=La,e=e*La/2+xa/4;var n=t-i,a=n>=0?1:-1,r=a*n,l=Math.cos(e),u=Math.sin(e),c=o*u,h=s*l+c*Math.cos(r),d=c*a*Math.sin(r);hr.add(Math.atan2(d,h)),i=t,s=l,o=u}var e,n,i,s,o;dr.point=function(a,r){dr.point=t,i=(e=a)*La,s=Math.cos(r=(n=r)*La/2+xa/4),o=Math.sin(r)},dr.lineEnd=function(){t(e,n)}}function ce(t){var e=t[0],n=t[1],i=Math.cos(n);return[i*Math.cos(e),i*Math.sin(e),Math.sin(n)]}function he(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function de(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function pe(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function fe(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function ge(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function me(t){return[Math.atan2(t[1],t[0]),Z(t[2])]}function ve(t,e){return oa(t[0]-e[0])<Sa&&oa(t[1]-e[1])<Sa;
}function be(t,e){t*=La;var n=Math.cos(e*=La);ye(n*Math.cos(t),n*Math.sin(t),Math.sin(e))}function ye(t,e,n){++pr,gr+=(t-gr)/pr,mr+=(e-mr)/pr,vr+=(n-vr)/pr}function _e(){function t(t,s){t*=La;var o=Math.cos(s*=La),a=o*Math.cos(t),r=o*Math.sin(t),l=Math.sin(s),u=Math.atan2(Math.sqrt((u=n*l-i*r)*u+(u=i*a-e*l)*u+(u=e*r-n*a)*u),e*a+n*r+i*l);fr+=u,br+=u*(e+(e=a)),yr+=u*(n+(n=r)),_r+=u*(i+(i=l)),ye(e,n,i)}var e,n,i;Cr.point=function(s,o){s*=La;var a=Math.cos(o*=La);e=a*Math.cos(s),n=a*Math.sin(s),i=Math.sin(o),Cr.point=t,ye(e,n,i)}}function we(){Cr.point=be}function Me(){function t(t,e){t*=La;var n=Math.cos(e*=La),a=n*Math.cos(t),r=n*Math.sin(t),l=Math.sin(e),u=s*l-o*r,c=o*a-i*l,h=i*r-s*a,d=Math.sqrt(u*u+c*c+h*h),p=i*a+s*r+o*l,f=d&&-X(p)/d,g=Math.atan2(d,p);wr+=f*u,Mr+=f*c,xr+=f*h,fr+=g,br+=g*(i+(i=a)),yr+=g*(s+(s=r)),_r+=g*(o+(o=l)),ye(i,s,o)}var e,n,i,s,o;Cr.point=function(a,r){e=a,n=r,Cr.point=t,a*=La;var l=Math.cos(r*=La);i=l*Math.cos(a),s=l*Math.sin(a),o=Math.sin(r),ye(i,s,o)},Cr.lineEnd=function(){t(e,n),Cr.lineEnd=we,Cr.point=be}}function xe(){return!0}function Ce(t,e,n,i,s){var o=[],a=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n=t[0],i=t[e];if(ve(n,i)){s.lineStart();for(var r=0;e>r;++r)s.point((n=t[r])[0],n[1]);return void s.lineEnd()}var l=new Se(n,t,null,!0),u=new Se(n,null,l,!1);l.o=u,o.push(l),a.push(u),l=new Se(i,t,null,!1),u=new Se(i,null,l,!0),l.o=u,o.push(l),a.push(u)}}),a.sort(e),Ie(o),Ie(a),o.length){for(var r=0,l=n,u=a.length;u>r;++r)a[r].e=l=!l;for(var c,h,d=o[0];;){for(var p=d,f=!0;p.v;)if((p=p.n)===d)return;c=p.z,s.lineStart();do{if(p.v=p.o.v=!0,p.e){if(f)for(var r=0,u=c.length;u>r;++r)s.point((h=c[r])[0],h[1]);else i(p.x,p.n.x,1,s);p=p.n}else{if(f){c=p.p.z;for(var r=c.length-1;r>=0;--r)s.point((h=c[r])[0],h[1])}else i(p.x,p.p.x,-1,s);p=p.p}p=p.o,c=p.z,f=!f}while(!p.v);s.lineEnd()}}}function Ie(t){if(e=t.length){for(var e,n,i=0,s=t[0];++i<e;)s.n=n=t[i],n.p=s,s=n;s.n=n=t[0],n.p=s}}function Se(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function Ee(t,e,n,i){return function(s,o){function a(e,n){var i=s(e,n);t(e=i[0],n=i[1])&&o.point(e,n)}function r(t,e){var n=s(t,e);m.point(n[0],n[1])}function l(){b.point=r,m.lineStart()}function u(){b.point=a,m.lineEnd()}function c(t,e){g.push([t,e]);var n=s(t,e);_.point(n[0],n[1])}function h(){_.lineStart(),g=[]}function d(){c(g[0][0],g[0][1]),_.lineEnd();var t,e=_.clean(),n=y.buffer(),i=n.length;if(g.pop(),f.push(g),g=null,i)if(1&e){t=n[0];var s,i=t.length-1,a=-1;if(i>0){for(w||(o.polygonStart(),w=!0),o.lineStart();++a<i;)o.point((s=t[a])[0],s[1]);o.lineEnd()}}else i>1&&2&e&&n.push(n.pop().concat(n.shift())),p.push(n.filter(Le))}var p,f,g,m=e(o),v=s.invert(i[0],i[1]),b={point:a,lineStart:l,lineEnd:u,polygonStart:function(){b.point=c,b.lineStart=h,b.lineEnd=d,p=[],f=[]},polygonEnd:function(){b.point=a,b.lineStart=l,b.lineEnd=u,p=$o.merge(p);var t=Pe(v,f);p.length?(w||(o.polygonStart(),w=!0),Ce(p,De,t,n,o)):t&&(w||(o.polygonStart(),w=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),w&&(o.polygonEnd(),w=!1),p=f=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}},y=ke(),_=e(y),w=!1;return b}}function Le(t){return t.length>1}function ke(){var t,e=[];return{lineStart:function(){e.push(t=[])},point:function(e,n){t.push([e,n])},lineEnd:g,buffer:function(){var n=e;return e=[],t=null,n},rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))}}}function De(t,e){return((t=t.x)[0]<0?t[1]-Ia-Sa:Ia-t[1])-((e=e.x)[0]<0?e[1]-Ia-Sa:Ia-e[1])}function Pe(t,e){var n=t[0],i=t[1],s=[Math.sin(n),-Math.cos(n),0],o=0,a=0;hr.reset();for(var r=0,l=e.length;l>r;++r){var u=e[r],c=u.length;if(c)for(var h=u[0],d=h[0],p=h[1]/2+xa/4,f=Math.sin(p),g=Math.cos(p),m=1;;){m===c&&(m=0),t=u[m];var v=t[0],b=t[1]/2+xa/4,y=Math.sin(b),_=Math.cos(b),w=v-d,M=w>=0?1:-1,x=M*w,C=x>xa,I=f*y;if(hr.add(Math.atan2(I*M*Math.sin(x),g*_+I*Math.cos(x))),o+=C?w+M*Ca:w,C^d>=n^v>=n){var S=de(ce(h),ce(t));ge(S);var E=de(s,S);ge(E);var L=(C^w>=0?-1:1)*Z(E[2]);(i>L||i===L&&(S[0]||S[1]))&&(a+=C^w>=0?1:-1)}if(!m++)break;d=v,f=y,g=_,h=t}}return(-Sa>o||Sa>o&&0>hr)^1&a}function Te(t){var e,n=NaN,i=NaN,s=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,a){var r=o>0?xa:-xa,l=oa(o-n);oa(l-xa)<Sa?(t.point(n,i=(i+a)/2>0?Ia:-Ia),t.point(s,i),t.lineEnd(),t.lineStart(),t.point(r,i),t.point(o,i),e=0):s!==r&&l>=xa&&(oa(n-s)<Sa&&(n-=s*Sa),oa(o-r)<Sa&&(o-=r*Sa),i=Ne(n,i,o,a),t.point(s,i),t.lineEnd(),t.lineStart(),t.point(r,i),e=0),t.point(n=o,i=a),s=r},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}function Ne(t,e,n,i){var s,o,a=Math.sin(t-n);return oa(a)>Sa?Math.atan((Math.sin(e)*(o=Math.cos(i))*Math.sin(n)-Math.sin(i)*(s=Math.cos(e))*Math.sin(t))/(s*o*a)):(e+i)/2}function Ae(t,e,n,i){var s;if(null==t)s=n*Ia,i.point(-xa,s),i.point(0,s),i.point(xa,s),i.point(xa,0),i.point(xa,-s),i.point(0,-s),i.point(-xa,-s),i.point(-xa,0),i.point(-xa,s);else if(oa(t[0]-e[0])>Sa){var o=t[0]<e[0]?xa:-xa;s=n*o/2,i.point(-o,s),i.point(0,s),i.point(o,s)}else i.point(e[0],e[1])}function Oe(t){function e(t,e){return Math.cos(t)*Math.cos(e)>o}function n(t){var n,o,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(h,d){var p,f=[h,d],g=e(h,d),m=a?g?0:s(h,d):g?s(h+(0>h?xa:-xa),d):0;if(!n&&(u=l=g)&&t.lineStart(),g!==l&&(p=i(n,f),(ve(n,p)||ve(f,p))&&(f[0]+=Sa,f[1]+=Sa,g=e(f[0],f[1]))),g!==l)c=0,g?(t.lineStart(),p=i(f,n),t.point(p[0],p[1])):(p=i(n,f),t.point(p[0],p[1]),t.lineEnd()),n=p;else if(r&&n&&a^g){var v;m&o||!(v=i(f,n,!0))||(c=0,a?(t.lineStart(),t.point(v[0][0],v[0][1]),t.point(v[1][0],v[1][1]),t.lineEnd()):(t.point(v[1][0],v[1][1]),t.lineEnd(),t.lineStart(),t.point(v[0][0],v[0][1])))}!g||n&&ve(n,f)||t.point(f[0],f[1]),n=f,l=g,o=m},lineEnd:function(){l&&t.lineEnd(),n=null},clean:function(){return c|(u&&l)<<1}}}function i(t,e,n){var i=ce(t),s=ce(e),a=[1,0,0],r=de(i,s),l=he(r,r),u=r[0],c=l-u*u;if(!c)return!n&&t;var h=o*l/c,d=-o*u/c,p=de(a,r),f=fe(a,h),g=fe(r,d);pe(f,g);var m=p,v=he(f,m),b=he(m,m),y=v*v-b*(he(f,f)-1);if(!(0>y)){var _=Math.sqrt(y),w=fe(m,(-v-_)/b);if(pe(w,f),w=me(w),!n)return w;var M,x=t[0],C=e[0],I=t[1],S=e[1];x>C&&(M=x,x=C,C=M);var E=C-x,L=oa(E-xa)<Sa,k=L||Sa>E;if(!L&&I>S&&(M=I,I=S,S=M),k?L?I+S>0^w[1]<(oa(w[0]-x)<Sa?I:S):I<=w[1]&&w[1]<=S:E>xa^(x<=w[0]&&w[0]<=C)){var D=fe(m,(-v+_)/b);return pe(D,f),[w,me(D)]}}}function s(e,n){var i=a?t:xa-t,s=0;return-i>e?s|=1:e>i&&(s|=2),-i>n?s|=4:n>i&&(s|=8),s}var o=Math.cos(t),a=o>0,r=oa(o)>Sa,l=cn(t,6*La);return Ee(e,n,l,a?[0,-t]:[-xa,t-xa])}function Ve(t,e,n,i){return function(s){var o,a=s.a,r=s.b,l=a.x,u=a.y,c=r.x,h=r.y,d=0,p=1,f=c-l,g=h-u;if(o=t-l,f||!(o>0)){if(o/=f,0>f){if(d>o)return;p>o&&(p=o)}else if(f>0){if(o>p)return;o>d&&(d=o)}if(o=n-l,f||!(0>o)){if(o/=f,0>f){if(o>p)return;o>d&&(d=o)}else if(f>0){if(d>o)return;p>o&&(p=o)}if(o=e-u,g||!(o>0)){if(o/=g,0>g){if(d>o)return;p>o&&(p=o)}else if(g>0){if(o>p)return;o>d&&(d=o)}if(o=i-u,g||!(0>o)){if(o/=g,0>g){if(o>p)return;o>d&&(d=o)}else if(g>0){if(d>o)return;p>o&&(p=o)}return d>0&&(s.a={x:l+d*f,y:u+d*g}),1>p&&(s.b={x:l+p*f,y:u+p*g}),s}}}}}}function Re(t,e,n,i){function s(i,s){return oa(i[0]-t)<Sa?s>0?0:3:oa(i[0]-n)<Sa?s>0?2:1:oa(i[1]-e)<Sa?s>0?1:0:s>0?3:2}function o(t,e){return a(t.x,e.x)}function a(t,e){var n=s(t,1),i=s(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(r){function l(t){for(var e=0,n=m.length,i=t[1],s=0;n>s;++s)for(var o,a=1,r=m[s],l=r.length,u=r[0];l>a;++a)o=r[a],u[1]<=i?o[1]>i&&K(u,o,t)>0&&++e:o[1]<=i&&K(u,o,t)<0&&--e,u=o;return 0!==e}function u(o,r,l,u){var c=0,h=0;if(null==o||(c=s(o,l))!==(h=s(r,l))||a(o,r)<0^l>0){do u.point(0===c||3===c?t:n,c>1?i:e);while((c=(c+l+4)%4)!==h)}else u.point(r[0],r[1])}function c(s,o){return s>=t&&n>=s&&o>=e&&i>=o}function h(t,e){c(t,e)&&r.point(t,e)}function d(){k.point=f,m&&m.push(v=[]),C=!0,x=!1,w=M=NaN}function p(){g&&(f(b,y),_&&x&&E.rejoin(),g.push(E.buffer())),k.point=h,x&&r.lineEnd()}function f(t,e){t=Math.max(-Sr,Math.min(Sr,t)),e=Math.max(-Sr,Math.min(Sr,e));var n=c(t,e);if(m&&v.push([t,e]),C)b=t,y=e,_=n,C=!1,n&&(r.lineStart(),r.point(t,e));else if(n&&x)r.point(t,e);else{var i={a:{x:w,y:M},b:{x:t,y:e}};L(i)?(x||(r.lineStart(),r.point(i.a.x,i.a.y)),r.point(i.b.x,i.b.y),n||r.lineEnd(),I=!1):n&&(r.lineStart(),r.point(t,e),I=!1)}w=t,M=e,x=n}var g,m,v,b,y,_,w,M,x,C,I,S=r,E=ke(),L=Ve(t,e,n,i),k={point:h,lineStart:d,lineEnd:p,polygonStart:function(){r=E,g=[],m=[],I=!0},polygonEnd:function(){r=S,g=$o.merge(g);var e=l([t,i]),n=I&&e,s=g.length;(n||s)&&(r.polygonStart(),n&&(r.lineStart(),u(null,null,1,r),r.lineEnd()),s&&Ce(g,o,e,u,r),r.polygonEnd()),g=m=v=null}};return k}}function Fe(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return n=e.invert(n,i),n&&t.invert(n[0],n[1])}),n}function je(t){var e=0,n=xa/3,i=en(t),s=i(e,n);return s.parallels=function(t){return arguments.length?i(e=t[0]*xa/180,n=t[1]*xa/180):[180*(e/xa),180*(n/xa)]},s}function ze(t,e){function n(t,e){var n=Math.sqrt(o-2*s*Math.sin(e))/s;return[n*Math.sin(t*=s),a-n*Math.cos(t)]}var i=Math.sin(t),s=(i+Math.sin(e))/2,o=1+i*(2*s-i),a=Math.sqrt(o)/s;return n.invert=function(t,e){var n=a-e;return[Math.atan2(t,n)/s,Z((o-(t*t+n*n)*s*s)/(2*s))]},n}function Be(){function t(t,e){Lr+=s*t-i*e,i=t,s=e}var e,n,i,s;Nr.point=function(o,a){Nr.point=t,e=i=o,n=s=a},Nr.lineEnd=function(){t(e,n)}}function We(t,e){kr>t&&(kr=t),t>Pr&&(Pr=t),Dr>e&&(Dr=e),e>Tr&&(Tr=e)}function He(){function t(t,e){a.push("M",t,",",e,o)}function e(t,e){a.push("M",t,",",e),r.point=n}function n(t,e){a.push("L",t,",",e)}function i(){r.point=t}function s(){a.push("Z")}var o=Ue(4.5),a=[],r={point:t,lineStart:function(){r.point=e},lineEnd:i,polygonStart:function(){r.lineEnd=s},polygonEnd:function(){r.lineEnd=i,r.point=t},pointRadius:function(t){return o=Ue(t),r},result:function(){if(a.length){var t=a.join("");return a=[],t}}};return r}function Ue(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function $e(t,e){gr+=t,mr+=e,++vr}function Ge(){function t(t,i){var s=t-e,o=i-n,a=Math.sqrt(s*s+o*o);br+=a*(e+t)/2,yr+=a*(n+i)/2,_r+=a,$e(e=t,n=i)}var e,n;Or.point=function(i,s){Or.point=t,$e(e=i,n=s)}}function qe(){Or.point=$e}function Ye(){function t(t,e){var n=t-i,o=e-s,a=Math.sqrt(n*n+o*o);br+=a*(i+t)/2,yr+=a*(s+e)/2,_r+=a,a=s*t-i*e,wr+=a*(i+t),Mr+=a*(s+e),xr+=3*a,$e(i=t,s=e)}var e,n,i,s;Or.point=function(o,a){Or.point=t,$e(e=i=o,n=s=a)},Or.lineEnd=function(){t(e,n)}}function Ke(t){function e(e,n){t.moveTo(e,n),t.arc(e,n,a,0,Ca)}function n(e,n){t.moveTo(e,n),r.point=i}function i(e,n){t.lineTo(e,n)}function s(){r.point=e}function o(){t.closePath()}var a=4.5,r={point:e,lineStart:function(){r.point=n},lineEnd:s,polygonStart:function(){r.lineEnd=o},polygonEnd:function(){r.lineEnd=s,r.point=e},pointRadius:function(t){return a=t,r},result:g};return r}function Xe(t){function e(t){return(r?i:n)(t)}function n(e){return Je(e,function(n,i){n=t(n,i),e.point(n[0],n[1])})}function i(e){function n(n,i){n=t(n,i),e.point(n[0],n[1])}function i(){y=NaN,C.point=o,e.lineStart()}function o(n,i){var o=ce([n,i]),a=t(n,i);s(y,_,b,w,M,x,y=a[0],_=a[1],b=n,w=o[0],M=o[1],x=o[2],r,e),e.point(y,_)}function a(){C.point=n,e.lineEnd()}function l(){i(),C.point=u,C.lineEnd=c}function u(t,e){o(h=t,d=e),p=y,f=_,g=w,m=M,v=x,C.point=o}function c(){s(y,_,b,w,M,x,p,f,h,g,m,v,r,e),C.lineEnd=a,a()}var h,d,p,f,g,m,v,b,y,_,w,M,x,C={point:n,lineStart:i,lineEnd:a,polygonStart:function(){e.polygonStart(),C.lineStart=l},polygonEnd:function(){e.polygonEnd(),C.lineStart=i}};return C}function s(e,n,i,r,l,u,c,h,d,p,f,g,m,v){var b=c-e,y=h-n,_=b*b+y*y;if(_>4*o&&m--){var w=r+p,M=l+f,x=u+g,C=Math.sqrt(w*w+M*M+x*x),I=Math.asin(x/=C),S=oa(oa(x)-1)<Sa||oa(i-d)<Sa?(i+d)/2:Math.atan2(M,w),E=t(S,I),L=E[0],k=E[1],D=L-e,P=k-n,T=y*D-b*P;(T*T/_>o||oa((b*D+y*P)/_-.5)>.3||a>r*p+l*f+u*g)&&(s(e,n,i,r,l,u,L,k,S,w/=C,M/=C,x,m,v),v.point(L,k),s(L,k,S,w,M,x,c,h,d,p,f,g,m,v))}}var o=.5,a=Math.cos(30*La),r=16;return e.precision=function(t){return arguments.length?(r=(o=t*t)>0&&16,e):Math.sqrt(o)},e}function Ze(t){var e=Xe(function(e,n){return t([e*ka,n*ka])});return function(t){return nn(e(t))}}function Qe(t){this.stream=t}function Je(t,e){return{point:e,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function tn(t){return en(function(){return t})()}function en(t){function e(t){return t=r(t[0]*La,t[1]*La),[t[0]*d+l,u-t[1]*d]}function n(t){return t=r.invert((t[0]-l)/d,(u-t[1])/d),t&&[t[0]*ka,t[1]*ka]}function i(){r=Fe(a=an(v,b,y),o);var t=o(g,m);return l=p-t[0]*d,u=f+t[1]*d,s()}function s(){return c&&(c.valid=!1,c=null),e}var o,a,r,l,u,c,h=Xe(function(t,e){return t=o(t,e),[t[0]*d+l,u-t[1]*d]}),d=150,p=480,f=250,g=0,m=0,v=0,b=0,y=0,_=Ir,w=xt,M=null,x=null;return e.stream=function(t){return c&&(c.valid=!1),c=nn(_(a,h(w(t)))),c.valid=!0,c},e.clipAngle=function(t){return arguments.length?(_=null==t?(M=t,Ir):Oe((M=+t)*La),s()):M},e.clipExtent=function(t){return arguments.length?(x=t,w=t?Re(t[0][0],t[0][1],t[1][0],t[1][1]):xt,s()):x},e.scale=function(t){return arguments.length?(d=+t,i()):d},e.translate=function(t){return arguments.length?(p=+t[0],f=+t[1],i()):[p,f]},e.center=function(t){return arguments.length?(g=t[0]%360*La,m=t[1]%360*La,i()):[g*ka,m*ka]},e.rotate=function(t){return arguments.length?(v=t[0]%360*La,b=t[1]%360*La,y=t.length>2?t[2]%360*La:0,i()):[v*ka,b*ka,y*ka]},$o.rebind(e,h,"precision"),function(){return o=t.apply(this,arguments),e.invert=o.invert&&n,i()}}function nn(t){return Je(t,function(e,n){t.point(e*La,n*La)})}function sn(t,e){return[t,e]}function on(t,e){return[t>xa?t-Ca:-xa>t?t+Ca:t,e]}function an(t,e,n){return t?e||n?Fe(ln(t),un(e,n)):ln(t):e||n?un(e,n):on}function rn(t){return function(e,n){return e+=t,[e>xa?e-Ca:-xa>e?e+Ca:e,n]}}function ln(t){var e=rn(t);return e.invert=rn(-t),e}function un(t,e){function n(t,e){var n=Math.cos(e),r=Math.cos(t)*n,l=Math.sin(t)*n,u=Math.sin(e),c=u*i+r*s;return[Math.atan2(l*o-c*a,r*i-u*s),Z(c*o+l*a)]}var i=Math.cos(t),s=Math.sin(t),o=Math.cos(e),a=Math.sin(e);return n.invert=function(t,e){var n=Math.cos(e),r=Math.cos(t)*n,l=Math.sin(t)*n,u=Math.sin(e),c=u*o-l*a;return[Math.atan2(l*o+u*a,r*i+c*s),Z(c*i-r*s)]},n}function cn(t,e){var n=Math.cos(t),i=Math.sin(t);return function(s,o,a,r){var l=a*e;null!=s?(s=hn(n,s),o=hn(n,o),(a>0?o>s:s>o)&&(s+=a*Ca)):(s=t+a*Ca,o=t-.5*l);for(var u,c=s;a>0?c>o:o>c;c-=l)r.point((u=me([n,-i*Math.cos(c),-i*Math.sin(c)]))[0],u[1])}}function hn(t,e){var n=ce(e);n[0]-=t,ge(n);var i=X(-n[1]);return((-n[2]<0?-i:i)+2*Math.PI-Sa)%(2*Math.PI)}function dn(t,e,n){var i=$o.range(t,e-Sa,n).concat(e);return function(t){return i.map(function(e){return[t,e]})}}function pn(t,e,n){var i=$o.range(t,e-Sa,n).concat(e);return function(t){return i.map(function(e){return[e,t]})}}function fn(t){return t.source}function gn(t){return t.target}function mn(t,e,n,i){var s=Math.cos(e),o=Math.sin(e),a=Math.cos(i),r=Math.sin(i),l=s*Math.cos(t),u=s*Math.sin(t),c=a*Math.cos(n),h=a*Math.sin(n),d=2*Math.asin(Math.sqrt(et(i-e)+s*a*et(n-t))),p=1/Math.sin(d),f=d?function(t){var e=Math.sin(t*=d)*p,n=Math.sin(d-t)*p,i=n*l+e*c,s=n*u+e*h,a=n*o+e*r;return[Math.atan2(s,i)*ka,Math.atan2(a,Math.sqrt(i*i+s*s))*ka]}:function(){return[t*ka,e*ka]};return f.distance=d,f}function vn(){function t(t,s){var o=Math.sin(s*=La),a=Math.cos(s),r=oa((t*=La)-e),l=Math.cos(r);Vr+=Math.atan2(Math.sqrt((r=a*Math.sin(r))*r+(r=i*o-n*a*l)*r),n*o+i*a*l),e=t,n=o,i=a}var e,n,i;Rr.point=function(s,o){e=s*La,n=Math.sin(o*=La),i=Math.cos(o),Rr.point=t},Rr.lineEnd=function(){Rr.point=Rr.lineEnd=g}}function bn(t,e){function n(e,n){var i=Math.cos(e),s=Math.cos(n),o=t(i*s);return[o*s*Math.sin(e),o*Math.sin(n)]}return n.invert=function(t,n){var i=Math.sqrt(t*t+n*n),s=e(i),o=Math.sin(s),a=Math.cos(s);return[Math.atan2(t*o,i*a),Math.asin(i&&n*o/i)]},n}function yn(t,e){function n(t,e){a>0?-Ia+Sa>e&&(e=-Ia+Sa):e>Ia-Sa&&(e=Ia-Sa);var n=a/Math.pow(s(e),o);return[n*Math.sin(o*t),a-n*Math.cos(o*t)]}var i=Math.cos(t),s=function(t){return Math.tan(xa/4+t/2)},o=t===e?Math.sin(t):Math.log(i/Math.cos(e))/Math.log(s(e)/s(t)),a=i*Math.pow(s(t),o)/o;return o?(n.invert=function(t,e){var n=a-e,i=Y(o)*Math.sqrt(t*t+n*n);return[Math.atan2(t,n)/o,2*Math.atan(Math.pow(a/i,1/o))-Ia]},n):wn}function _n(t,e){function n(t,e){var n=o-e;return[n*Math.sin(s*t),o-n*Math.cos(s*t)]}var i=Math.cos(t),s=t===e?Math.sin(t):(i-Math.cos(e))/(e-t),o=i/s+t;return oa(s)<Sa?sn:(n.invert=function(t,e){var n=o-e;return[Math.atan2(t,n)/s,o-Y(s)*Math.sqrt(t*t+n*n)]},n)}function wn(t,e){return[t,Math.log(Math.tan(xa/4+e/2))]}function Mn(t){var e,n=tn(t),i=n.scale,s=n.translate,o=n.clipExtent;return n.scale=function(){var t=i.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.translate=function(){var t=s.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.clipExtent=function(t){var a=o.apply(n,arguments);if(a===n){if(e=null==t){var r=xa*i(),l=s();o([[l[0]-r,l[1]-r],[l[0]+r,l[1]+r]])}}else e&&(a=null);return a},n.clipExtent(null)}function xn(t,e){return[Math.log(Math.tan(xa/4+e/2)),-t]}function Cn(t){return t[0]}function In(t){return t[1]}function Sn(t){for(var e=t.length,n=[0,1],i=2,s=2;e>s;s++){for(;i>1&&K(t[n[i-2]],t[n[i-1]],t[s])<=0;)--i;n[i++]=s}return n.slice(0,i)}function En(t,e){return t[0]-e[0]||t[1]-e[1]}function Ln(t,e,n){return(n[0]-e[0])*(t[1]-e[1])<(n[1]-e[1])*(t[0]-e[0])}function kn(t,e,n,i){var s=t[0],o=n[0],a=e[0]-s,r=i[0]-o,l=t[1],u=n[1],c=e[1]-l,h=i[1]-u,d=(r*(l-u)-h*(s-o))/(h*a-r*c);return[s+d*a,l+d*c]}function Dn(t){var e=t[0],n=t[t.length-1];return!(e[0]-n[0]||e[1]-n[1])}function Pn(){Qn(this),this.edge=this.site=this.circle=null}function Tn(t){var e=Kr.pop()||new Pn;return e.site=t,e}function Nn(t){Hn(t),Gr.remove(t),Kr.push(t),Qn(t)}function An(t){var e=t.circle,n=e.x,i=e.cy,s={x:n,y:i},o=t.P,a=t.N,r=[t];Nn(t);for(var l=o;l.circle&&oa(n-l.circle.x)<Sa&&oa(i-l.circle.cy)<Sa;)o=l.P,r.unshift(l),Nn(l),l=o;r.unshift(l),Hn(l);for(var u=a;u.circle&&oa(n-u.circle.x)<Sa&&oa(i-u.circle.cy)<Sa;)a=u.N,r.push(u),Nn(u),u=a;r.push(u),Hn(u);var c,h=r.length;for(c=1;h>c;++c)u=r[c],l=r[c-1],Kn(u.edge,l.site,u.site,s);l=r[0],u=r[h-1],u.edge=qn(l.site,u.site,null,s),Wn(l),Wn(u)}function On(t){for(var e,n,i,s,o=t.x,a=t.y,r=Gr._;r;)if(i=Vn(r,a)-o,i>Sa)r=r.L;else{if(s=o-Rn(r,a),!(s>Sa)){i>-Sa?(e=r.P,n=r):s>-Sa?(e=r,n=r.N):e=n=r;break}if(!r.R){e=r;break}r=r.R}var l=Tn(t);if(Gr.insert(e,l),e||n){if(e===n)return Hn(e),n=Tn(e.site),Gr.insert(l,n),l.edge=n.edge=qn(e.site,l.site),Wn(e),void Wn(n);if(!n)return void(l.edge=qn(e.site,l.site));Hn(e),Hn(n);var u=e.site,c=u.x,h=u.y,d=t.x-c,p=t.y-h,f=n.site,g=f.x-c,m=f.y-h,v=2*(d*m-p*g),b=d*d+p*p,y=g*g+m*m,_={x:(m*b-p*y)/v+c,y:(d*y-g*b)/v+h};Kn(n.edge,u,f,_),l.edge=qn(u,t,null,_),n.edge=qn(t,f,null,_),Wn(e),Wn(n)}}function Vn(t,e){var n=t.site,i=n.x,s=n.y,o=s-e;if(!o)return i;var a=t.P;if(!a)return-1/0;n=a.site;var r=n.x,l=n.y,u=l-e;if(!u)return r;var c=r-i,h=1/o-1/u,d=c/u;return h?(-d+Math.sqrt(d*d-2*h*(c*c/(-2*u)-l+u/2+s-o/2)))/h+i:(i+r)/2}function Rn(t,e){var n=t.N;if(n)return Vn(n,e);var i=t.site;return i.y===e?i.x:1/0}function Fn(t){this.site=t,this.edges=[]}function jn(t){for(var e,n,i,s,o,a,r,l,u,c,h=t[0][0],d=t[1][0],p=t[0][1],f=t[1][1],g=$r,m=g.length;m--;)if(o=g[m],o&&o.prepare())for(r=o.edges,l=r.length,a=0;l>a;)c=r[a].end(),i=c.x,s=c.y,u=r[++a%l].start(),e=u.x,n=u.y,(oa(i-e)>Sa||oa(s-n)>Sa)&&(r.splice(a,0,new Xn(Yn(o.site,c,oa(i-h)<Sa&&f-s>Sa?{x:h,y:oa(e-h)<Sa?n:f}:oa(s-f)<Sa&&d-i>Sa?{x:oa(n-f)<Sa?e:d,y:f}:oa(i-d)<Sa&&s-p>Sa?{x:d,y:oa(e-d)<Sa?n:p}:oa(s-p)<Sa&&i-h>Sa?{x:oa(n-p)<Sa?e:h,y:p}:null),o.site,null)),++l)}function zn(t,e){return e.angle-t.angle}function Bn(){Qn(this),this.x=this.y=this.arc=this.site=this.cy=null}function Wn(t){var e=t.P,n=t.N;if(e&&n){var i=e.site,s=t.site,o=n.site;if(i!==o){var a=s.x,r=s.y,l=i.x-a,u=i.y-r,c=o.x-a,h=o.y-r,d=2*(l*h-u*c);if(!(d>=-Ea)){var p=l*l+u*u,f=c*c+h*h,g=(h*p-u*f)/d,m=(l*f-c*p)/d,h=m+r,v=Xr.pop()||new Bn;v.arc=t,v.site=s,v.x=g+a,v.y=h+Math.sqrt(g*g+m*m),v.cy=h,t.circle=v;for(var b=null,y=Yr._;y;)if(v.y<y.y||v.y===y.y&&v.x<=y.x){if(!y.L){b=y.P;break}y=y.L}else{if(!y.R){b=y;break}y=y.R}Yr.insert(b,v),b||(qr=v)}}}}function Hn(t){var e=t.circle;e&&(e.P||(qr=e.N),Yr.remove(e),Xr.push(e),Qn(e),t.circle=null)}function Un(t){for(var e,n=Ur,i=Ve(t[0][0],t[0][1],t[1][0],t[1][1]),s=n.length;s--;)e=n[s],(!$n(e,t)||!i(e)||oa(e.a.x-e.b.x)<Sa&&oa(e.a.y-e.b.y)<Sa)&&(e.a=e.b=null,n.splice(s,1))}function $n(t,e){var n=t.b;if(n)return!0;var i,s,o=t.a,a=e[0][0],r=e[1][0],l=e[0][1],u=e[1][1],c=t.l,h=t.r,d=c.x,p=c.y,f=h.x,g=h.y,m=(d+f)/2,v=(p+g)/2;if(g===p){if(a>m||m>=r)return;if(d>f){if(o){if(o.y>=u)return}else o={x:m,y:l};n={x:m,y:u}}else{if(o){if(o.y<l)return}else o={x:m,y:u};n={x:m,y:l}}}else if(i=(d-f)/(g-p),s=v-i*m,-1>i||i>1)if(d>f){if(o){if(o.y>=u)return}else o={x:(l-s)/i,y:l};n={x:(u-s)/i,y:u}}else{if(o){if(o.y<l)return}else o={x:(u-s)/i,y:u};n={x:(l-s)/i,y:l}}else if(g>p){if(o){if(o.x>=r)return}else o={x:a,y:i*a+s};n={x:r,y:i*r+s}}else{if(o){if(o.x<a)return}else o={x:r,y:i*r+s};n={x:a,y:i*a+s}}return t.a=o,t.b=n,!0}function Gn(t,e){this.l=t,this.r=e,this.a=this.b=null}function qn(t,e,n,i){var s=new Gn(t,e);return Ur.push(s),n&&Kn(s,t,e,n),i&&Kn(s,e,t,i),$r[t.i].edges.push(new Xn(s,t,e)),$r[e.i].edges.push(new Xn(s,e,t)),s}function Yn(t,e,n){var i=new Gn(t,null);return i.a=e,i.b=n,Ur.push(i),i}function Kn(t,e,n,i){t.a||t.b?t.l===n?t.b=i:t.a=i:(t.a=i,t.l=e,t.r=n)}function Xn(t,e,n){var i=t.a,s=t.b;this.edge=t,this.site=e,this.angle=n?Math.atan2(n.y-e.y,n.x-e.x):t.l===e?Math.atan2(s.x-i.x,i.y-s.y):Math.atan2(i.x-s.x,s.y-i.y)}function Zn(){this._=null}function Qn(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function Jn(t,e){var n=e,i=e.R,s=n.U;s?s.L===n?s.L=i:s.R=i:t._=i,i.U=s,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function ti(t,e){var n=e,i=e.L,s=n.U;s?s.L===n?s.L=i:s.R=i:t._=i,i.U=s,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function ei(t){for(;t.L;)t=t.L;return t}function ni(t,e){var n,i,s,o=t.sort(ii).pop();for(Ur=[],$r=new Array(t.length),Gr=new Zn,Yr=new Zn;;)if(s=qr,o&&(!s||o.y<s.y||o.y===s.y&&o.x<s.x))(o.x!==n||o.y!==i)&&($r[o.i]=new Fn(o),On(o),n=o.x,i=o.y),o=t.pop();else{if(!s)break;An(s.arc)}e&&(Un(e),jn(e));var a={cells:$r,edges:Ur};return Gr=Yr=Ur=$r=null,a}function ii(t,e){return e.y-t.y||e.x-t.x}function si(t,e,n){return(t.x-n.x)*(e.y-t.y)-(t.x-e.x)*(n.y-t.y)}function oi(t){return t.x}function ai(t){return t.y}function ri(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function li(t,e,n,i,s,o){if(!t(e,n,i,s,o)){var a=.5*(n+s),r=.5*(i+o),l=e.nodes;l[0]&&li(t,l[0],n,i,a,r),l[1]&&li(t,l[1],a,i,s,r),l[2]&&li(t,l[2],n,r,a,o),l[3]&&li(t,l[3],a,r,s,o)}}function ui(t,e){t=$o.rgb(t),e=$o.rgb(e);var n=t.r,i=t.g,s=t.b,o=e.r-n,a=e.g-i,r=e.b-s;return function(t){return"#"+mt(Math.round(n+o*t))+mt(Math.round(i+a*t))+mt(Math.round(s+r*t))}}function ci(t,e){var n,i={},s={};for(n in t)n in e?i[n]=pi(t[n],e[n]):s[n]=t[n];for(n in e)n in t||(s[n]=e[n]);return function(t){for(n in i)s[n]=i[n](t);return s}}function hi(t,e){return e-=t=+t,function(n){return t+e*n}}function di(t,e){var n,i,s,o=Qr.lastIndex=Jr.lastIndex=0,a=-1,r=[],l=[];for(t+="",e+="";(n=Qr.exec(t))&&(i=Jr.exec(e));)(s=i.index)>o&&(s=e.substring(o,s),r[a]?r[a]+=s:r[++a]=s),(n=n[0])===(i=i[0])?r[a]?r[a]+=i:r[++a]=i:(r[++a]=null,l.push({i:a,x:hi(n,i)})),o=Jr.lastIndex;return o<e.length&&(s=e.substring(o),r[a]?r[a]+=s:r[++a]=s),r.length<2?l[0]?(e=l[0].x,function(t){return e(t)+""}):function(){return e}:(e=l.length,function(t){for(var n,i=0;e>i;++i)r[(n=l[i]).i]=n.x(t);return r.join("")})}function pi(t,e){for(var n,i=$o.interpolators.length;--i>=0&&!(n=$o.interpolators[i](t,e)););return n}function fi(t,e){var n,i=[],s=[],o=t.length,a=e.length,r=Math.min(t.length,e.length);for(n=0;r>n;++n)i.push(pi(t[n],e[n]));for(;o>n;++n)s[n]=t[n];for(;a>n;++n)s[n]=e[n];return function(t){for(n=0;r>n;++n)s[n]=i[n](t);return s}}function gi(t){return function(e){return 0>=e?0:e>=1?1:t(e)}}function mi(t){return function(e){return 1-t(1-e)}}function vi(t){return function(e){return.5*(.5>e?t(2*e):2-t(2-2*e))}}function bi(t){return t*t}function yi(t){return t*t*t}function _i(t){if(0>=t)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(.5>t?n:3*(t-e)+n-.75)}function wi(t){return function(e){return Math.pow(e,t)}}function Mi(t){return 1-Math.cos(t*Ia)}function xi(t){return Math.pow(2,10*(t-1))}function Ci(t){return 1-Math.sqrt(1-t*t)}function Ii(t,e){var n;return arguments.length<2&&(e=.45),arguments.length?n=e/Ca*Math.asin(1/t):(t=1,n=e/4),function(i){return 1+t*Math.pow(2,-10*i)*Math.sin((i-n)*Ca/e)}}function Si(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}}function Ei(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Li(t,e){t=$o.hcl(t),e=$o.hcl(e);var n=t.h,i=t.c,s=t.l,o=e.h-n,a=e.c-i,r=e.l-s;return isNaN(a)&&(a=0,i=isNaN(i)?e.c:i),isNaN(o)?(o=0,n=isNaN(n)?e.h:n):o>180?o-=360:-180>o&&(o+=360),function(t){return at(n+o*t,i+a*t,s+r*t)+""}}function ki(t,e){t=$o.hsl(t),e=$o.hsl(e);var n=t.h,i=t.s,s=t.l,o=e.h-n,a=e.s-i,r=e.l-s;return isNaN(a)&&(a=0,i=isNaN(i)?e.s:i),isNaN(o)?(o=0,n=isNaN(n)?e.h:n):o>180?o-=360:-180>o&&(o+=360),function(t){return st(n+o*t,i+a*t,s+r*t)+""}}function Di(t,e){t=$o.lab(t),e=$o.lab(e);var n=t.l,i=t.a,s=t.b,o=e.l-n,a=e.a-i,r=e.b-s;return function(t){return lt(n+o*t,i+a*t,s+r*t)+""}}function Pi(t,e){return e-=t,function(n){return Math.round(t+e*n)}}function Ti(t){var e=[t.a,t.b],n=[t.c,t.d],i=Ai(e),s=Ni(e,n),o=Ai(Oi(n,e,-s))||0;e[0]*n[1]<n[0]*e[1]&&(e[0]*=-1,e[1]*=-1,i*=-1,s*=-1),this.rotate=(i?Math.atan2(e[1],e[0]):Math.atan2(-n[0],n[1]))*ka,this.translate=[t.e,t.f],this.scale=[i,o],this.skew=o?Math.atan2(s,o)*ka:0}function Ni(t,e){return t[0]*e[0]+t[1]*e[1]}function Ai(t){var e=Math.sqrt(Ni(t,t));return e&&(t[0]/=e,t[1]/=e),e}function Oi(t,e,n){return t[0]+=n*e[0],t[1]+=n*e[1],t}function Vi(t,e){var n,i=[],s=[],o=$o.transform(t),a=$o.transform(e),r=o.translate,l=a.translate,u=o.rotate,c=a.rotate,h=o.skew,d=a.skew,p=o.scale,f=a.scale;return r[0]!=l[0]||r[1]!=l[1]?(i.push("translate(",null,",",null,")"),s.push({i:1,x:hi(r[0],l[0])},{i:3,x:hi(r[1],l[1])})):l[0]||l[1]?i.push("translate("+l+")"):i.push(""),u!=c?(u-c>180?c+=360:c-u>180&&(u+=360),s.push({i:i.push(i.pop()+"rotate(",null,")")-2,x:hi(u,c)})):c&&i.push(i.pop()+"rotate("+c+")"),h!=d?s.push({i:i.push(i.pop()+"skewX(",null,")")-2,x:hi(h,d)}):d&&i.push(i.pop()+"skewX("+d+")"),p[0]!=f[0]||p[1]!=f[1]?(n=i.push(i.pop()+"scale(",null,",",null,")"),s.push({i:n-4,x:hi(p[0],f[0])},{i:n-2,x:hi(p[1],f[1])})):(1!=f[0]||1!=f[1])&&i.push(i.pop()+"scale("+f+")"),n=s.length,function(t){for(var e,o=-1;++o<n;)i[(e=s[o]).i]=e.x(t);return i.join("")}}function Ri(t,e){return e=e-(t=+t)?1/(e-t):0,function(n){return(n-t)*e}}function Fi(t,e){return e=e-(t=+t)?1/(e-t):0,function(n){return Math.max(0,Math.min(1,(n-t)*e))}}function ji(t){for(var e=t.source,n=t.target,i=Bi(e,n),s=[e];e!==i;)e=e.parent,s.push(e);for(var o=s.length;n!==i;)s.splice(o,0,n),n=n.parent;return s}function zi(t){for(var e=[],n=t.parent;null!=n;)e.push(t),t=n,n=n.parent;return e.push(t),e}function Bi(t,e){if(t===e)return t;for(var n=zi(t),i=zi(e),s=n.pop(),o=i.pop(),a=null;s===o;)a=s,s=n.pop(),o=i.pop();return a}function Wi(t){t.fixed|=2}function Hi(t){t.fixed&=-7}function Ui(t){t.fixed|=4,t.px=t.x,t.py=t.y}function $i(t){t.fixed&=-5}function Gi(t,e,n){var i=0,s=0;if(t.charge=0,!t.leaf)for(var o,a=t.nodes,r=a.length,l=-1;++l<r;)o=a[l],null!=o&&(Gi(o,e,n),t.charge+=o.charge,i+=o.charge*o.cx,s+=o.charge*o.cy);if(t.point){t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5);var u=e*n[t.point.index];t.charge+=t.pointCharge=u,i+=u*t.point.x,s+=u*t.point.y}t.cx=i/t.charge,t.cy=s/t.charge}function qi(t,e){return $o.rebind(t,e,"sort","children","value"),t.nodes=t,t.links=Ji,t}function Yi(t,e){for(var n=[t];null!=(t=n.pop());)if(e(t),(s=t.children)&&(i=s.length))for(var i,s;--i>=0;)n.push(s[i])}function Ki(t,e){for(var n=[t],i=[];null!=(t=n.pop());)if(i.push(t),(o=t.children)&&(s=o.length))for(var s,o,a=-1;++a<s;)n.push(o[a]);for(;null!=(t=i.pop());)e(t)}function Xi(t){return t.children}function Zi(t){return t.value}function Qi(t,e){return e.value-t.value}function Ji(t){return $o.merge(t.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}function ts(t){return t.x}function es(t){return t.y}function ns(t,e,n){t.y0=e,t.y=n}function is(t){return $o.range(t.length)}function ss(t){for(var e=-1,n=t[0].length,i=[];++e<n;)i[e]=0;return i}function os(t){for(var e,n=1,i=0,s=t[0][1],o=t.length;o>n;++n)(e=t[n][1])>s&&(i=n,s=e);return i}function as(t){return t.reduce(rs,0)}function rs(t,e){return t+e[1]}function ls(t,e){return us(t,Math.ceil(Math.log(e.length)/Math.LN2+1))}function us(t,e){for(var n=-1,i=+t[0],s=(t[1]-i)/e,o=[];++n<=e;)o[n]=s*n+i;return o}function cs(t){return[$o.min(t),$o.max(t)]}function hs(t,e){return t.value-e.value}function ds(t,e){var n=t._pack_next;t._pack_next=e,e._pack_prev=t,e._pack_next=n,n._pack_prev=e}function ps(t,e){t._pack_next=e,e._pack_prev=t}function fs(t,e){var n=e.x-t.x,i=e.y-t.y,s=t.r+e.r;return.999*s*s>n*n+i*i}function gs(t){function e(t){c=Math.min(t.x-t.r,c),h=Math.max(t.x+t.r,h),d=Math.min(t.y-t.r,d),p=Math.max(t.y+t.r,p)}if((n=t.children)&&(u=n.length)){var n,i,s,o,a,r,l,u,c=1/0,h=-1/0,d=1/0,p=-1/0;if(n.forEach(ms),i=n[0],i.x=-i.r,i.y=0,e(i),u>1&&(s=n[1],s.x=s.r,s.y=0,e(s),u>2))for(o=n[2],ys(i,s,o),e(o),ds(i,o),i._pack_prev=o,ds(o,s),s=i._pack_next,a=3;u>a;a++){ys(i,s,o=n[a]);var f=0,g=1,m=1;for(r=s._pack_next;r!==s;r=r._pack_next,g++)if(fs(r,o)){f=1;break}if(1==f)for(l=i._pack_prev;l!==r._pack_prev&&!fs(l,o);l=l._pack_prev,m++);f?(m>g||g==m&&s.r<i.r?ps(i,s=r):ps(i=l,s),a--):(ds(i,o),s=o,e(o))}var v=(c+h)/2,b=(d+p)/2,y=0;for(a=0;u>a;a++)o=n[a],o.x-=v,o.y-=b,y=Math.max(y,o.r+Math.sqrt(o.x*o.x+o.y*o.y));t.r=y,n.forEach(vs)}}function ms(t){t._pack_next=t._pack_prev=t}function vs(t){delete t._pack_next,delete t._pack_prev}function bs(t,e,n,i){var s=t.children;if(t.x=e+=i*t.x,t.y=n+=i*t.y,t.r*=i,s)for(var o=-1,a=s.length;++o<a;)bs(s[o],e,n,i)}function ys(t,e,n){var i=t.r+n.r,s=e.x-t.x,o=e.y-t.y;if(i&&(s||o)){var a=e.r+n.r,r=s*s+o*o;a*=a,i*=i;var l=.5+(i-a)/(2*r),u=Math.sqrt(Math.max(0,2*a*(i+r)-(i-=r)*i-a*a))/(2*r);n.x=t.x+l*s+u*o,n.y=t.y+l*o-u*s}else n.x=t.x+i,n.y=t.y}function _s(t,e){return t.parent==e.parent?1:2}function ws(t){var e=t.children;return e.length?e[0]:t.t}function Ms(t){var e,n=t.children;return(e=n.length)?n[e-1]:t.t}function xs(t,e,n){var i=n/(e.i-t.i);e.c-=i,e.s+=n,t.c+=i,e.z+=n,e.m+=n}function Cs(t){for(var e,n=0,i=0,s=t.children,o=s.length;--o>=0;)e=s[o],e.z+=n,e.m+=n,n+=e.s+(i+=e.c)}function Is(t,e,n){return t.a.parent===e.parent?t.a:n}function Ss(t){return 1+$o.max(t,function(t){return t.y})}function Es(t){return t.reduce(function(t,e){return t+e.x},0)/t.length}function Ls(t){var e=t.children;return e&&e.length?Ls(e[0]):t}function ks(t){var e,n=t.children;return n&&(e=n.length)?ks(n[e-1]):t}function Ds(t){return{x:t.x,y:t.y,dx:t.dx,dy:t.dy}}function Ps(t,e){var n=t.x+e[3],i=t.y+e[0],s=t.dx-e[1]-e[3],o=t.dy-e[0]-e[2];return 0>s&&(n+=s/2,s=0),0>o&&(i+=o/2,o=0),{x:n,y:i,dx:s,dy:o}}function Ts(t){var e=t[0],n=t[t.length-1];return n>e?[e,n]:[n,e]}function Ns(t){return t.rangeExtent?t.rangeExtent():Ts(t.range())}function As(t,e,n,i){var s=n(t[0],t[1]),o=i(e[0],e[1]);return function(t){return o(s(t))}}function Os(t,e){var n,i=0,s=t.length-1,o=t[i],a=t[s];return o>a&&(n=i,i=s,s=n,n=o,o=a,a=n),t[i]=e.floor(o),t[s]=e.ceil(a),t}function Vs(t){return t?{floor:function(e){return Math.floor(e/t)*t},ceil:function(e){return Math.ceil(e/t)*t}}:cl}function Rs(t,e,n,i){var s=[],o=[],a=0,r=Math.min(t.length,e.length)-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<=r;)s.push(n(t[a-1],t[a])),o.push(i(e[a-1],e[a]));return function(e){var n=$o.bisect(t,e,1,r)-1;return o[n](s[n](e))}}function Fs(t,e,n,i){function s(){var s=Math.min(t.length,e.length)>2?Rs:As,l=i?Fi:Ri;
return a=s(t,e,l,n),r=s(e,t,l,pi),o}function o(t){return a(t)}var a,r;return o.invert=function(t){return r(t)},o.domain=function(e){return arguments.length?(t=e.map(Number),s()):t},o.range=function(t){return arguments.length?(e=t,s()):e},o.rangeRound=function(t){return o.range(t).interpolate(Pi)},o.clamp=function(t){return arguments.length?(i=t,s()):i},o.interpolate=function(t){return arguments.length?(n=t,s()):n},o.ticks=function(e){return Ws(t,e)},o.tickFormat=function(e,n){return Hs(t,e,n)},o.nice=function(e){return zs(t,e),s()},o.copy=function(){return Fs(t,e,n,i)},s()}function js(t,e){return $o.rebind(t,e,"range","rangeRound","interpolate","clamp")}function zs(t,e){return Os(t,Vs(Bs(t,e)[2]))}function Bs(t,e){null==e&&(e=10);var n=Ts(t),i=n[1]-n[0],s=Math.pow(10,Math.floor(Math.log(i/e)/Math.LN10)),o=e/i*s;return.15>=o?s*=10:.35>=o?s*=5:.75>=o&&(s*=2),n[0]=Math.ceil(n[0]/s)*s,n[1]=Math.floor(n[1]/s)*s+.5*s,n[2]=s,n}function Ws(t,e){return $o.range.apply($o,Bs(t,e))}function Hs(t,e,n){var i=Bs(t,e);if(n){var s=Qa.exec(n);if(s.shift(),"s"===s[8]){var o=$o.formatPrefix(Math.max(oa(i[0]),oa(i[1])));return s[7]||(s[7]="."+Us(o.scale(i[2]))),s[8]="f",n=$o.format(s.join("")),function(t){return n(o.scale(t))+o.symbol}}s[7]||(s[7]="."+$s(s[8],i)),n=s.join("")}else n=",."+Us(i[2])+"f";return $o.format(n)}function Us(t){return-Math.floor(Math.log(t)/Math.LN10+.01)}function $s(t,e){var n=Us(e[2]);return t in hl?Math.abs(n-Us(Math.max(oa(e[0]),oa(e[1]))))+ +("e"!==t):n-2*("%"===t)}function Gs(t,e,n,i){function s(t){return(n?Math.log(0>t?0:t):-Math.log(t>0?0:-t))/Math.log(e)}function o(t){return n?Math.pow(e,t):-Math.pow(e,-t)}function a(e){return t(s(e))}return a.invert=function(e){return o(t.invert(e))},a.domain=function(e){return arguments.length?(n=e[0]>=0,t.domain((i=e.map(Number)).map(s)),a):i},a.base=function(n){return arguments.length?(e=+n,t.domain(i.map(s)),a):e},a.nice=function(){var e=Os(i.map(s),n?Math:pl);return t.domain(e),i=e.map(o),a},a.ticks=function(){var t=Ts(i),a=[],r=t[0],l=t[1],u=Math.floor(s(r)),c=Math.ceil(s(l)),h=e%1?2:e;if(isFinite(c-u)){if(n){for(;c>u;u++)for(var d=1;h>d;d++)a.push(o(u)*d);a.push(o(u))}else for(a.push(o(u));u++<c;)for(var d=h-1;d>0;d--)a.push(o(u)*d);for(u=0;a[u]<r;u++);for(c=a.length;a[c-1]>l;c--);a=a.slice(u,c)}return a},a.tickFormat=function(t,e){if(!arguments.length)return dl;arguments.length<2?e=dl:"function"!=typeof e&&(e=$o.format(e));var i,r=Math.max(.1,t/a.ticks().length),l=n?(i=1e-12,Math.ceil):(i=-1e-12,Math.floor);return function(t){return t/o(l(s(t)+i))<=r?e(t):""}},a.copy=function(){return Gs(t.copy(),e,n,i)},js(a,t)}function qs(t,e,n){function i(e){return t(s(e))}var s=Ys(e),o=Ys(1/e);return i.invert=function(e){return o(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain((n=e.map(Number)).map(s)),i):n},i.ticks=function(t){return Ws(n,t)},i.tickFormat=function(t,e){return Hs(n,t,e)},i.nice=function(t){return i.domain(zs(n,t))},i.exponent=function(a){return arguments.length?(s=Ys(e=a),o=Ys(1/e),t.domain(n.map(s)),i):e},i.copy=function(){return qs(t.copy(),e,n)},js(i,t)}function Ys(t){return function(e){return 0>e?-Math.pow(-e,t):Math.pow(e,t)}}function Ks(t,e){function n(n){return o[((s.get(n)||("range"===e.t?s.set(n,t.push(n)):NaN))-1)%o.length]}function i(e,n){return $o.range(t.length).map(function(t){return e+n*t})}var s,o,r;return n.domain=function(i){if(!arguments.length)return t;t=[],s=new a;for(var o,r=-1,l=i.length;++r<l;)s.has(o=i[r])||s.set(o,t.push(o));return n[e.t].apply(n,e.a)},n.range=function(t){return arguments.length?(o=t,r=0,e={t:"range",a:arguments},n):o},n.rangePoints=function(s,a){arguments.length<2&&(a=0);var l=s[0],u=s[1],c=(u-l)/(Math.max(1,t.length-1)+a);return o=i(t.length<2?(l+u)/2:l+c*a/2,c),r=0,e={t:"rangePoints",a:arguments},n},n.rangeBands=function(s,a,l){arguments.length<2&&(a=0),arguments.length<3&&(l=a);var u=s[1]<s[0],c=s[u-0],h=s[1-u],d=(h-c)/(t.length-a+2*l);return o=i(c+d*l,d),u&&o.reverse(),r=d*(1-a),e={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(s,a,l){arguments.length<2&&(a=0),arguments.length<3&&(l=a);var u=s[1]<s[0],c=s[u-0],h=s[1-u],d=Math.floor((h-c)/(t.length-a+2*l)),p=h-c-(t.length-a)*d;return o=i(c+Math.round(p/2),d),u&&o.reverse(),r=Math.round(d*(1-a)),e={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return r},n.rangeExtent=function(){return Ts(e.a[0])},n.copy=function(){return Ks(t,e)},n.domain(t)}function Xs(n,i){function s(){var t=0,e=i.length;for(a=[];++t<e;)a[t-1]=$o.quantile(n,t/e);return o}function o(t){return isNaN(t=+t)?void 0:i[$o.bisect(a,t)]}var a;return o.domain=function(i){return arguments.length?(n=i.filter(e).sort(t),s()):n},o.range=function(t){return arguments.length?(i=t,s()):i},o.quantiles=function(){return a},o.invertExtent=function(t){return t=i.indexOf(t),0>t?[NaN,NaN]:[t>0?a[t-1]:n[0],t<a.length?a[t]:n[n.length-1]]},o.copy=function(){return Xs(n,i)},s()}function Zs(t,e,n){function i(e){return n[Math.max(0,Math.min(a,Math.floor(o*(e-t))))]}function s(){return o=n.length/(e-t),a=n.length-1,i}var o,a;return i.domain=function(n){return arguments.length?(t=+n[0],e=+n[n.length-1],s()):[t,e]},i.range=function(t){return arguments.length?(n=t,s()):n},i.invertExtent=function(e){return e=n.indexOf(e),e=0>e?NaN:e/o+t,[e,e+1/o]},i.copy=function(){return Zs(t,e,n)},s()}function Qs(t,e){function n(n){return n>=n?e[$o.bisect(t,n)]:void 0}return n.domain=function(e){return arguments.length?(t=e,n):t},n.range=function(t){return arguments.length?(e=t,n):e},n.invertExtent=function(n){return n=e.indexOf(n),[t[n-1],t[n]]},n.copy=function(){return Qs(t,e)},n}function Js(t){function e(t){return+t}return e.invert=e,e.domain=e.range=function(n){return arguments.length?(t=n.map(e),e):t},e.ticks=function(e){return Ws(t,e)},e.tickFormat=function(e,n){return Hs(t,e,n)},e.copy=function(){return Js(t)},e}function to(t){return t.innerRadius}function eo(t){return t.outerRadius}function no(t){return t.startAngle}function io(t){return t.endAngle}function so(t){function e(e){function a(){u.push("M",o(t(c),r))}for(var l,u=[],c=[],h=-1,d=e.length,p=Mt(n),f=Mt(i);++h<d;)s.call(this,l=e[h],h)?c.push([+p.call(this,l,h),+f.call(this,l,h)]):c.length&&(a(),c=[]);return c.length&&a(),u.length?u.join(""):null}var n=Cn,i=In,s=xe,o=oo,a=o.key,r=.7;return e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e.defined=function(t){return arguments.length?(s=t,e):s},e.interpolate=function(t){return arguments.length?(a="function"==typeof t?o=t:(o=_l.get(t)||oo).key,e):a},e.tension=function(t){return arguments.length?(r=t,e):r},e}function oo(t){return t.join("L")}function ao(t){return oo(t)+"Z"}function ro(t){for(var e=0,n=t.length,i=t[0],s=[i[0],",",i[1]];++e<n;)s.push("H",(i[0]+(i=t[e])[0])/2,"V",i[1]);return n>1&&s.push("H",i[0]),s.join("")}function lo(t){for(var e=0,n=t.length,i=t[0],s=[i[0],",",i[1]];++e<n;)s.push("V",(i=t[e])[1],"H",i[0]);return s.join("")}function uo(t){for(var e=0,n=t.length,i=t[0],s=[i[0],",",i[1]];++e<n;)s.push("H",(i=t[e])[0],"V",i[1]);return s.join("")}function co(t,e){return t.length<4?oo(t):t[1]+fo(t.slice(1,t.length-1),go(t,e))}function ho(t,e){return t.length<3?oo(t):t[0]+fo((t.push(t[0]),t),go([t[t.length-2]].concat(t,[t[1]]),e))}function po(t,e){return t.length<3?oo(t):t[0]+fo(t,go(t,e))}function fo(t,e){if(e.length<1||t.length!=e.length&&t.length!=e.length+2)return oo(t);var n=t.length!=e.length,i="",s=t[0],o=t[1],a=e[0],r=a,l=1;if(n&&(i+="Q"+(o[0]-2*a[0]/3)+","+(o[1]-2*a[1]/3)+","+o[0]+","+o[1],s=t[1],l=2),e.length>1){r=e[1],o=t[l],l++,i+="C"+(s[0]+a[0])+","+(s[1]+a[1])+","+(o[0]-r[0])+","+(o[1]-r[1])+","+o[0]+","+o[1];for(var u=2;u<e.length;u++,l++)o=t[l],r=e[u],i+="S"+(o[0]-r[0])+","+(o[1]-r[1])+","+o[0]+","+o[1]}if(n){var c=t[l];i+="Q"+(o[0]+2*r[0]/3)+","+(o[1]+2*r[1]/3)+","+c[0]+","+c[1]}return i}function go(t,e){for(var n,i=[],s=(1-e)/2,o=t[0],a=t[1],r=1,l=t.length;++r<l;)n=o,o=a,a=t[r],i.push([s*(a[0]-n[0]),s*(a[1]-n[1])]);return i}function mo(t){if(t.length<3)return oo(t);var e=1,n=t.length,i=t[0],s=i[0],o=i[1],a=[s,s,s,(i=t[1])[0]],r=[o,o,o,i[1]],l=[s,",",o,"L",_o(xl,a),",",_o(xl,r)];for(t.push(t[n-1]);++e<=n;)i=t[e],a.shift(),a.push(i[0]),r.shift(),r.push(i[1]),wo(l,a,r);return t.pop(),l.push("L",i),l.join("")}function vo(t){if(t.length<4)return oo(t);for(var e,n=[],i=-1,s=t.length,o=[0],a=[0];++i<3;)e=t[i],o.push(e[0]),a.push(e[1]);for(n.push(_o(xl,o)+","+_o(xl,a)),--i;++i<s;)e=t[i],o.shift(),o.push(e[0]),a.shift(),a.push(e[1]),wo(n,o,a);return n.join("")}function bo(t){for(var e,n,i=-1,s=t.length,o=s+4,a=[],r=[];++i<4;)n=t[i%s],a.push(n[0]),r.push(n[1]);for(e=[_o(xl,a),",",_o(xl,r)],--i;++i<o;)n=t[i%s],a.shift(),a.push(n[0]),r.shift(),r.push(n[1]),wo(e,a,r);return e.join("")}function yo(t,e){var n=t.length-1;if(n)for(var i,s,o=t[0][0],a=t[0][1],r=t[n][0]-o,l=t[n][1]-a,u=-1;++u<=n;)i=t[u],s=u/n,i[0]=e*i[0]+(1-e)*(o+s*r),i[1]=e*i[1]+(1-e)*(a+s*l);return mo(t)}function _o(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function wo(t,e,n){t.push("C",_o(wl,e),",",_o(wl,n),",",_o(Ml,e),",",_o(Ml,n),",",_o(xl,e),",",_o(xl,n))}function Mo(t,e){return(e[1]-t[1])/(e[0]-t[0])}function xo(t){for(var e=0,n=t.length-1,i=[],s=t[0],o=t[1],a=i[0]=Mo(s,o);++e<n;)i[e]=(a+(a=Mo(s=o,o=t[e+1])))/2;return i[e]=a,i}function Co(t){for(var e,n,i,s,o=[],a=xo(t),r=-1,l=t.length-1;++r<l;)e=Mo(t[r],t[r+1]),oa(e)<Sa?a[r]=a[r+1]=0:(n=a[r]/e,i=a[r+1]/e,s=n*n+i*i,s>9&&(s=3*e/Math.sqrt(s),a[r]=s*n,a[r+1]=s*i));for(r=-1;++r<=l;)s=(t[Math.min(l,r+1)][0]-t[Math.max(0,r-1)][0])/(6*(1+a[r]*a[r])),o.push([s||0,a[r]*s||0]);return o}function Io(t){return t.length<3?oo(t):t[0]+fo(t,Co(t))}function So(t){for(var e,n,i,s=-1,o=t.length;++s<o;)e=t[s],n=e[0],i=e[1]+bl,e[0]=n*Math.cos(i),e[1]=n*Math.sin(i);return t}function Eo(t){function e(e){function l(){g.push("M",r(t(v),h),c,u(t(m.reverse()),h),"Z")}for(var d,p,f,g=[],m=[],v=[],b=-1,y=e.length,_=Mt(n),w=Mt(s),M=n===i?function(){return p}:Mt(i),x=s===o?function(){return f}:Mt(o);++b<y;)a.call(this,d=e[b],b)?(m.push([p=+_.call(this,d,b),f=+w.call(this,d,b)]),v.push([+M.call(this,d,b),+x.call(this,d,b)])):m.length&&(l(),m=[],v=[]);return m.length&&l(),g.length?g.join(""):null}var n=Cn,i=Cn,s=0,o=In,a=xe,r=oo,l=r.key,u=r,c="L",h=.7;return e.x=function(t){return arguments.length?(n=i=t,e):i},e.x0=function(t){return arguments.length?(n=t,e):n},e.x1=function(t){return arguments.length?(i=t,e):i},e.y=function(t){return arguments.length?(s=o=t,e):o},e.y0=function(t){return arguments.length?(s=t,e):s},e.y1=function(t){return arguments.length?(o=t,e):o},e.defined=function(t){return arguments.length?(a=t,e):a},e.interpolate=function(t){return arguments.length?(l="function"==typeof t?r=t:(r=_l.get(t)||oo).key,u=r.reverse||r,c=r.closed?"M":"L",e):l},e.tension=function(t){return arguments.length?(h=t,e):h},e}function Lo(t){return t.radius}function ko(t){return[t.x,t.y]}function Do(t){return function(){var e=t.apply(this,arguments),n=e[0],i=e[1]+bl;return[n*Math.cos(i),n*Math.sin(i)]}}function Po(){return 64}function To(){return"circle"}function No(t){var e=Math.sqrt(t/xa);return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}function Ao(t,e){return ca(t,kl),t.id=e,t}function Oo(t,e,n,i){var s=t.id;return V(t,"function"==typeof n?function(t,o,a){t.__transition__[s].tween.set(e,i(n.call(t,t.__data__,o,a)))}:(n=i(n),function(t){t.__transition__[s].tween.set(e,n)}))}function Vo(t){return null==t&&(t=""),function(){this.textContent=t}}function Ro(t,e,n,i){var s=t.__transition__||(t.__transition__={active:0,count:0}),o=s[n];if(!o){var r=i.time;o=s[n]={tween:new a,time:r,ease:i.ease,delay:i.delay,duration:i.duration},++s.count,$o.timer(function(i){function a(i){return s.active>n?u():(s.active=n,o.event&&o.event.start.call(t,c,e),o.tween.forEach(function(n,i){(i=i.call(t,c,e))&&g.push(i)}),void $o.timer(function(){return f.c=l(i||1)?xe:l,1},0,r))}function l(i){if(s.active!==n)return u();for(var a=i/p,r=h(a),l=g.length;l>0;)g[--l].call(t,r);return a>=1?(o.event&&o.event.end.call(t,c,e),u()):void 0}function u(){return--s.count?delete s[n]:delete t.__transition__,1}var c=t.__data__,h=o.ease,d=o.delay,p=o.duration,f=Ka,g=[];return f.t=d+r,i>=d?a(i-d):void(f.c=a)},0,r)}}function Fo(t,e){t.attr("transform",function(t){return"translate("+e(t)+",0)"})}function jo(t,e){t.attr("transform",function(t){return"translate(0,"+e(t)+")"})}function zo(t){return t.toISOString()}function Bo(t,e,n){function i(e){return t(e)}function s(t,n){var i=t[1]-t[0],s=i/n,o=$o.bisect(Fl,s);return o==Fl.length?[e.year,Bs(t.map(function(t){return t/31536e6}),n)[2]]:o?e[s/Fl[o-1]<Fl[o]/s?o-1:o]:[Bl,Bs(t,n)[2]]}return i.invert=function(e){return Wo(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain(e),i):t.domain().map(Wo)},i.nice=function(t,e){function n(n){return!isNaN(n)&&!t.range(n,Wo(+n+1),e).length}var o=i.domain(),a=Ts(o),r=null==t?s(a,10):"number"==typeof t&&s(a,t);return r&&(t=r[0],e=r[1]),i.domain(Os(o,e>1?{floor:function(e){for(;n(e=t.floor(e));)e=Wo(e-1);return e},ceil:function(e){for(;n(e=t.ceil(e));)e=Wo(+e+1);return e}}:t))},i.ticks=function(t,e){var n=Ts(i.domain()),o=null==t?s(n,10):"number"==typeof t?s(n,t):!t.range&&[{range:t},e];return o&&(t=o[0],e=o[1]),t.range(n[0],Wo(+n[1]+1),1>e?1:e)},i.tickFormat=function(){return n},i.copy=function(){return Bo(t.copy(),e,n)},js(i,t)}function Wo(t){return new Date(t)}function Ho(t){return JSON.parse(t.responseText)}function Uo(t){var e=Yo.createRange();return e.selectNode(Yo.body),e.createContextualFragment(t.responseText)}var $o={version:"3.4.11"};Date.now||(Date.now=function(){return+new Date});var Go=[].slice,qo=function(t){return Go.call(t)},Yo=document,Ko=Yo.documentElement,Xo=window;try{qo(Ko.childNodes)[0].nodeType}catch(Zo){qo=function(t){for(var e=t.length,n=new Array(e);e--;)n[e]=t[e];return n}}try{Yo.createElement("div").style.setProperty("opacity",0,"")}catch(Qo){var Jo=Xo.Element.prototype,ta=Jo.setAttribute,ea=Jo.setAttributeNS,na=Xo.CSSStyleDeclaration.prototype,ia=na.setProperty;Jo.setAttribute=function(t,e){ta.call(this,t,e+"")},Jo.setAttributeNS=function(t,e,n){ea.call(this,t,e,n+"")},na.setProperty=function(t,e,n){ia.call(this,t,e+"",n)}}$o.ascending=t,$o.descending=function(t,e){return t>e?-1:e>t?1:e>=t?0:NaN},$o.min=function(t,e){var n,i,s=-1,o=t.length;if(1===arguments.length){for(;++s<o&&!(null!=(n=t[s])&&n>=n);)n=void 0;for(;++s<o;)null!=(i=t[s])&&n>i&&(n=i)}else{for(;++s<o&&!(null!=(n=e.call(t,t[s],s))&&n>=n);)n=void 0;for(;++s<o;)null!=(i=e.call(t,t[s],s))&&n>i&&(n=i)}return n},$o.max=function(t,e){var n,i,s=-1,o=t.length;if(1===arguments.length){for(;++s<o&&!(null!=(n=t[s])&&n>=n);)n=void 0;for(;++s<o;)null!=(i=t[s])&&i>n&&(n=i)}else{for(;++s<o&&!(null!=(n=e.call(t,t[s],s))&&n>=n);)n=void 0;for(;++s<o;)null!=(i=e.call(t,t[s],s))&&i>n&&(n=i)}return n},$o.extent=function(t,e){var n,i,s,o=-1,a=t.length;if(1===arguments.length){for(;++o<a&&!(null!=(n=s=t[o])&&n>=n);)n=s=void 0;for(;++o<a;)null!=(i=t[o])&&(n>i&&(n=i),i>s&&(s=i))}else{for(;++o<a&&!(null!=(n=s=e.call(t,t[o],o))&&n>=n);)n=void 0;for(;++o<a;)null!=(i=e.call(t,t[o],o))&&(n>i&&(n=i),i>s&&(s=i))}return[n,s]},$o.sum=function(t,e){var n,i=0,s=t.length,o=-1;if(1===arguments.length)for(;++o<s;)isNaN(n=+t[o])||(i+=n);else for(;++o<s;)isNaN(n=+e.call(t,t[o],o))||(i+=n);return i},$o.mean=function(t,n){var i,s=0,o=t.length,a=-1,r=o;if(1===arguments.length)for(;++a<o;)e(i=t[a])?s+=i:--r;else for(;++a<o;)e(i=n.call(t,t[a],a))?s+=i:--r;return r?s/r:void 0},$o.quantile=function(t,e){var n=(t.length-1)*e+1,i=Math.floor(n),s=+t[i-1],o=n-i;return o?s+o*(t[i]-s):s},$o.median=function(n,i){return arguments.length>1&&(n=n.map(i)),n=n.filter(e),n.length?$o.quantile(n.sort(t),.5):void 0};var sa=n(t);$o.bisectLeft=sa.left,$o.bisect=$o.bisectRight=sa.right,$o.bisector=function(e){return n(1===e.length?function(n,i){return t(e(n),i)}:e)},$o.shuffle=function(t){for(var e,n,i=t.length;i;)n=0|Math.random()*i--,e=t[i],t[i]=t[n],t[n]=e;return t},$o.permute=function(t,e){for(var n=e.length,i=new Array(n);n--;)i[n]=t[e[n]];return i},$o.pairs=function(t){for(var e,n=0,i=t.length-1,s=t[0],o=new Array(0>i?0:i);i>n;)o[n]=[e=s,s=t[++n]];return o},$o.zip=function(){if(!(s=arguments.length))return[];for(var t=-1,e=$o.min(arguments,i),n=new Array(e);++t<e;)for(var s,o=-1,a=n[t]=new Array(s);++o<s;)a[o]=arguments[o][t];return n},$o.transpose=function(t){return $o.zip.apply($o,t)},$o.keys=function(t){var e=[];for(var n in t)e.push(n);return e},$o.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},$o.entries=function(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});return e},$o.merge=function(t){for(var e,n,i,s=t.length,o=-1,a=0;++o<s;)a+=t[o].length;for(n=new Array(a);--s>=0;)for(i=t[s],e=i.length;--e>=0;)n[--a]=i[e];return n};var oa=Math.abs;$o.range=function(t,e,n){if(arguments.length<3&&(n=1,arguments.length<2&&(e=t,t=0)),1/0===(e-t)/n)throw new Error("infinite range");var i,o=[],a=s(oa(n)),r=-1;if(t*=a,e*=a,n*=a,0>n)for(;(i=t+n*++r)>e;)o.push(i/a);else for(;(i=t+n*++r)<e;)o.push(i/a);return o},$o.map=function(t){var e=new a;if(t instanceof a)t.forEach(function(t,n){e.set(t,n)});else for(var n in t)e.set(n,t[n]);return e},o(a,{has:r,get:function(t){return this[aa+t]},set:function(t,e){return this[aa+t]=e},remove:l,keys:u,values:function(){var t=[];return this.forEach(function(e,n){t.push(n)}),t},entries:function(){var t=[];return this.forEach(function(e,n){t.push({key:e,value:n})}),t},size:c,empty:h,forEach:function(t){for(var e in this)e.charCodeAt(0)===ra&&t.call(this,e.substring(1),this[e])}});var aa="\x00",ra=aa.charCodeAt(0);$o.nest=function(){function t(e,r,l){if(l>=o.length)return i?i.call(s,r):n?r.sort(n):r;for(var u,c,h,d,p=-1,f=r.length,g=o[l++],m=new a;++p<f;)(d=m.get(u=g(c=r[p])))?d.push(c):m.set(u,[c]);return e?(c=e(),h=function(n,i){c.set(n,t(e,i,l))}):(c={},h=function(n,i){c[n]=t(e,i,l)}),m.forEach(h),c}function e(t,n){if(n>=o.length)return t;var i=[],s=r[n++];return t.forEach(function(t,s){i.push({key:t,values:e(s,n)})}),s?i.sort(function(t,e){return s(t.key,e.key)}):i}var n,i,s={},o=[],r=[];return s.map=function(e,n){return t(n,e,0)},s.entries=function(n){return e(t($o.map,n,0),0)},s.key=function(t){return o.push(t),s},s.sortKeys=function(t){return r[o.length-1]=t,s},s.sortValues=function(t){return n=t,s},s.rollup=function(t){return i=t,s},s},$o.set=function(t){var e=new d;if(t)for(var n=0,i=t.length;i>n;++n)e.add(t[n]);return e},o(d,{has:r,add:function(t){return this[aa+t]=!0,t},remove:function(t){return t=aa+t,t in this&&delete this[t]},values:u,size:c,empty:h,forEach:function(t){for(var e in this)e.charCodeAt(0)===ra&&t.call(this,e.substring(1))}}),$o.behavior={},$o.rebind=function(t,e){for(var n,i=1,s=arguments.length;++i<s;)t[n=arguments[i]]=p(t,e,e[n]);return t};var la=["webkit","ms","moz","Moz","o","O"];$o.dispatch=function(){for(var t=new m,e=-1,n=arguments.length;++e<n;)t[arguments[e]]=v(t);return t},m.prototype.on=function(t,e){var n=t.indexOf("."),i="";if(n>=0&&(i=t.substring(n+1),t=t.substring(0,n)),t)return arguments.length<2?this[t].on(i):this[t].on(i,e);if(2===arguments.length){if(null==e)for(t in this)this.hasOwnProperty(t)&&this[t].on(i,null);return this}},$o.event=null,$o.requote=function(t){return t.replace(ua,"\\$&")};var ua=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,ca={}.__proto__?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)t[n]=e[n]},ha=function(t,e){return e.querySelector(t)},da=function(t,e){return e.querySelectorAll(t)},pa=Ko.matches||Ko[f(Ko,"matchesSelector")],fa=function(t,e){return pa.call(t,e)};"function"==typeof Sizzle&&(ha=function(t,e){return Sizzle(t,e)[0]||null},da=Sizzle,fa=Sizzle.matchesSelector),$o.selection=function(){return ba};var ga=$o.selection.prototype=[];ga.select=function(t){var e,n,i,s,o=[];t=M(t);for(var a=-1,r=this.length;++a<r;){o.push(e=[]),e.parentNode=(i=this[a]).parentNode;for(var l=-1,u=i.length;++l<u;)(s=i[l])?(e.push(n=t.call(s,s.__data__,l,a)),n&&"__data__"in s&&(n.__data__=s.__data__)):e.push(null)}return w(o)},ga.selectAll=function(t){var e,n,i=[];t=x(t);for(var s=-1,o=this.length;++s<o;)for(var a=this[s],r=-1,l=a.length;++r<l;)(n=a[r])&&(i.push(e=qo(t.call(n,n.__data__,r,s))),e.parentNode=n);return w(i)};var ma={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};$o.ns={prefix:ma,qualify:function(t){var e=t.indexOf(":"),n=t;return e>=0&&(n=t.substring(0,e),t=t.substring(e+1)),ma.hasOwnProperty(n)?{space:ma[n],local:t}:t}},ga.attr=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node();return t=$o.ns.qualify(t),t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}for(e in t)this.each(C(e,t[e]));return this}return this.each(C(t,e))},ga.classed=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node(),i=(t=E(t)).length,s=-1;if(e=n.classList){for(;++s<i;)if(!e.contains(t[s]))return!1}else for(e=n.getAttribute("class");++s<i;)if(!S(t[s]).test(e))return!1;return!0}for(e in t)this.each(L(e,t[e]));return this}return this.each(L(t,e))},ga.style=function(t,e,n){var i=arguments.length;if(3>i){if("string"!=typeof t){2>i&&(e="");for(n in t)this.each(D(n,t[n],e));return this}if(2>i)return Xo.getComputedStyle(this.node(),null).getPropertyValue(t);n=""}return this.each(D(t,e,n))},ga.property=function(t,e){if(arguments.length<2){if("string"==typeof t)return this.node()[t];for(e in t)this.each(P(e,t[e]));return this}return this.each(P(t,e))},ga.text=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}:null==t?function(){this.textContent=""}:function(){this.textContent=t}):this.node().textContent},ga.html=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t}):this.node().innerHTML},ga.append=function(t){return t=T(t),this.select(function(){return this.appendChild(t.apply(this,arguments))})},ga.insert=function(t,e){return t=T(t),e=M(e),this.select(function(){return this.insertBefore(t.apply(this,arguments),e.apply(this,arguments)||null)})},ga.remove=function(){return this.each(function(){var t=this.parentNode;t&&t.removeChild(this)})},ga.data=function(t,e){function n(t,n){var i,s,o,r=t.length,h=n.length,d=Math.min(r,h),p=new Array(h),f=new Array(h),g=new Array(r);if(e){var m,v=new a,b=new a,y=[];for(i=-1;++i<r;)m=e.call(s=t[i],s.__data__,i),v.has(m)?g[i]=s:v.set(m,s),y.push(m);for(i=-1;++i<h;)m=e.call(n,o=n[i],i),(s=v.get(m))?(p[i]=s,s.__data__=o):b.has(m)||(f[i]=N(o)),b.set(m,o),v.remove(m);for(i=-1;++i<r;)v.has(y[i])&&(g[i]=t[i])}else{for(i=-1;++i<d;)s=t[i],o=n[i],s?(s.__data__=o,p[i]=s):f[i]=N(o);for(;h>i;++i)f[i]=N(n[i]);for(;r>i;++i)g[i]=t[i]}f.update=p,f.parentNode=p.parentNode=g.parentNode=t.parentNode,l.push(f),u.push(p),c.push(g)}var i,s,o=-1,r=this.length;if(!arguments.length){for(t=new Array(r=(i=this[0]).length);++o<r;)(s=i[o])&&(t[o]=s.__data__);return t}var l=R([]),u=w([]),c=w([]);if("function"==typeof t)for(;++o<r;)n(i=this[o],t.call(i,i.parentNode.__data__,o));else for(;++o<r;)n(i=this[o],t);return u.enter=function(){return l},u.exit=function(){return c},u},ga.datum=function(t){return arguments.length?this.property("__data__",t):this.property("__data__")},ga.filter=function(t){var e,n,i,s=[];"function"!=typeof t&&(t=A(t));for(var o=0,a=this.length;a>o;o++){s.push(e=[]),e.parentNode=(n=this[o]).parentNode;for(var r=0,l=n.length;l>r;r++)(i=n[r])&&t.call(i,i.__data__,r,o)&&e.push(i)}return w(s)},ga.order=function(){for(var t=-1,e=this.length;++t<e;)for(var n,i=this[t],s=i.length-1,o=i[s];--s>=0;)(n=i[s])&&(o&&o!==n.nextSibling&&o.parentNode.insertBefore(n,o),o=n);return this},ga.sort=function(t){t=O.apply(this,arguments);for(var e=-1,n=this.length;++e<n;)this[e].sort(t);return this.order()},ga.each=function(t){return V(this,function(e,n,i){t.call(e,e.__data__,n,i)})},ga.call=function(t){var e=qo(arguments);return t.apply(e[0]=this,e),this},ga.empty=function(){return!this.node()},ga.node=function(){for(var t=0,e=this.length;e>t;t++)for(var n=this[t],i=0,s=n.length;s>i;i++){var o=n[i];if(o)return o}return null},ga.size=function(){var t=0;return this.each(function(){++t}),t};var va=[];$o.selection.enter=R,$o.selection.enter.prototype=va,va.append=ga.append,va.empty=ga.empty,va.node=ga.node,va.call=ga.call,va.size=ga.size,va.select=function(t){for(var e,n,i,s,o,a=[],r=-1,l=this.length;++r<l;){i=(s=this[r]).update,a.push(e=[]),e.parentNode=s.parentNode;for(var u=-1,c=s.length;++u<c;)(o=s[u])?(e.push(i[u]=n=t.call(s.parentNode,o.__data__,u,r)),n.__data__=o.__data__):e.push(null)}return w(a)},va.insert=function(t,e){return arguments.length<2&&(e=F(this)),ga.insert.call(this,t,e)},ga.transition=function(){for(var t,e,n=Il||++Dl,i=[],s=Sl||{time:Date.now(),ease:_i,delay:0,duration:250},o=-1,a=this.length;++o<a;){i.push(t=[]);for(var r=this[o],l=-1,u=r.length;++l<u;)(e=r[l])&&Ro(e,l,n,s),t.push(e)}return Ao(i,n)},ga.interrupt=function(){return this.each(j)},$o.select=function(t){var e=["string"==typeof t?ha(t,Yo):t];return e.parentNode=Ko,w([e])},$o.selectAll=function(t){var e=qo("string"==typeof t?da(t,Yo):t);return e.parentNode=Ko,w([e])};var ba=$o.select(Ko);ga.on=function(t,e,n){var i=arguments.length;if(3>i){if("string"!=typeof t){2>i&&(e=!1);for(n in t)this.each(z(n,t[n],e));return this}if(2>i)return(i=this.node()["__on"+t])&&i._;n=!1}return this.each(z(t,e,n))};var ya=$o.map({mouseenter:"mouseover",mouseleave:"mouseout"});ya.forEach(function(t){"on"+t in Yo&&ya.remove(t)});var _a="onselectstart"in Yo?null:f(Ko.style,"userSelect"),wa=0;$o.mouse=function(t){return U(t,y())};var Ma=/WebKit/.test(Xo.navigator.userAgent)?-1:0;$o.touches=function(t,e){return arguments.length<2&&(e=y().touches),e?qo(e).map(function(e){var n=U(t,e);return n.identifier=e.identifier,n}):[]},$o.behavior.drag=function(){function t(){this.on("mousedown.drag",s).on("touchstart.drag",o)}function e(t,e,s,o,a){return function(){function r(){var t,n,i=e(d,g);i&&(t=i[0]-y[0],n=i[1]-y[1],f|=t|n,y=i,p({type:"drag",x:i[0]+u[0],y:i[1]+u[1],dx:t,dy:n}))}function l(){e(d,g)&&(v.on(o+m,null).on(a+m,null),b(f&&$o.event.target===h),p({type:"dragend"}))}var u,c=this,h=$o.event.target,d=c.parentNode,p=n.of(c,arguments),f=0,g=t(),m=".drag"+(null==g?"":"-"+g),v=$o.select(s()).on(o+m,r).on(a+m,l),b=H(),y=e(d,g);i?(u=i.apply(c,arguments),u=[u.x-y[0],u.y-y[1]]):u=[0,0],p({type:"dragstart"})}}var n=_(t,"drag","dragstart","dragend"),i=null,s=e(g,$o.mouse,q,"mousemove","mouseup"),o=e($,$o.touch,G,"touchmove","touchend");return t.origin=function(e){return arguments.length?(i=e,t):i},$o.rebind(t,n,"on")};var xa=Math.PI,Ca=2*xa,Ia=xa/2,Sa=1e-6,Ea=Sa*Sa,La=xa/180,ka=180/xa,Da=Math.SQRT2,Pa=2,Ta=4;$o.interpolateZoom=function(t,e){function n(t){var e=t*b;if(v){var n=J(g),a=o/(Pa*d)*(n*tt(Da*e+g)-Q(g));return[i+a*u,s+a*c,o*n/J(Da*e+g)]}return[i+t*u,s+t*c,o*Math.exp(Da*e)]}var i=t[0],s=t[1],o=t[2],a=e[0],r=e[1],l=e[2],u=a-i,c=r-s,h=u*u+c*c,d=Math.sqrt(h),p=(l*l-o*o+Ta*h)/(2*o*Pa*d),f=(l*l-o*o-Ta*h)/(2*l*Pa*d),g=Math.log(Math.sqrt(p*p+1)-p),m=Math.log(Math.sqrt(f*f+1)-f),v=m-g,b=(v||Math.log(l/o))/Da;return n.duration=1e3*b,n},$o.behavior.zoom=function(){function t(t){t.on(E,u).on(Oa+".zoom",h).on("dblclick.zoom",d).on(D,c)}function e(t){return[(t[0]-C.x)/C.k,(t[1]-C.y)/C.k]}function n(t){return[t[0]*C.k+C.x,t[1]*C.k+C.y]}function i(t){C.k=Math.max(S[0],Math.min(S[1],t))}function s(t,e){e=n(e),C.x+=t[0]-e[0],C.y+=t[1]-e[1]}function o(){w&&w.domain(y.range().map(function(t){return(t-C.x)/C.k}).map(y.invert)),x&&x.domain(M.range().map(function(t){return(t-C.y)/C.k}).map(M.invert))}function a(t){t({type:"zoomstart"})}function r(t){o(),t({type:"zoom",scale:C.k,translate:[C.x,C.y]})}function l(t){t({type:"zoomend"})}function u(){function t(){c=1,s($o.mouse(i),d),r(u)}function n(){h.on(L,null).on(k,null),p(c&&$o.event.target===o),l(u)}var i=this,o=$o.event.target,u=P.of(i,arguments),c=0,h=$o.select(Xo).on(L,t).on(k,n),d=e($o.mouse(i)),p=H();j.call(i),a(u)}function c(){function t(){var t=$o.touches(p);return d=C.k,t.forEach(function(t){t.identifier in g&&(g[t.identifier]=e(t))}),t}function n(){var e=$o.event.target;$o.select(e).on(_,o).on(w,h),M.push(e);for(var n=$o.event.changedTouches,a=0,l=n.length;l>a;++a)g[n[a].identifier]=null;var u=t(),c=Date.now();if(1===u.length){if(500>c-v){var d=u[0],p=g[d.identifier];i(2*C.k),s(d,p),b(),r(f)}v=c}else if(u.length>1){var d=u[0],y=u[1],x=d[0]-y[0],I=d[1]-y[1];m=x*x+I*I}}function o(){for(var t,e,n,o,a=$o.touches(p),l=0,u=a.length;u>l;++l,o=null)if(n=a[l],o=g[n.identifier]){if(e)break;t=n,e=o}if(o){var c=(c=n[0]-t[0])*c+(c=n[1]-t[1])*c,h=m&&Math.sqrt(c/m);t=[(t[0]+n[0])/2,(t[1]+n[1])/2],e=[(e[0]+o[0])/2,(e[1]+o[1])/2],i(h*d)}v=null,s(t,e),r(f)}function h(){if($o.event.touches.length){for(var e=$o.event.changedTouches,n=0,i=e.length;i>n;++n)delete g[e[n].identifier];for(var s in g)return void t()}$o.selectAll(M).on(y,null),x.on(E,u).on(D,c),I(),l(f)}var d,p=this,f=P.of(p,arguments),g={},m=0,y=".zoom-"+$o.event.changedTouches[0].identifier,_="touchmove"+y,w="touchend"+y,M=[],x=$o.select(p).on(E,null).on(D,n),I=H();j.call(p),n(),a(f)}function h(){var t=P.of(this,arguments);m?clearTimeout(m):(p=e(f=g||$o.mouse(this)),j.call(this),a(t)),m=setTimeout(function(){m=null,l(t)},50),b(),i(Math.pow(2,.002*Na())*C.k),s(f,p),r(t)}function d(){var t=P.of(this,arguments),n=$o.mouse(this),o=e(n),u=Math.log(C.k)/Math.LN2;a(t),i(Math.pow(2,$o.event.shiftKey?Math.ceil(u)-1:Math.floor(u)+1)),s(n,o),r(t),l(t)}var p,f,g,m,v,y,w,M,x,C={x:0,y:0,k:1},I=[960,500],S=Aa,E="mousedown.zoom",L="mousemove.zoom",k="mouseup.zoom",D="touchstart.zoom",P=_(t,"zoomstart","zoom","zoomend");return t.event=function(t){t.each(function(){var t=P.of(this,arguments),e=C;Il?$o.select(this).transition().each("start.zoom",function(){C=this.__chart__||{x:0,y:0,k:1},a(t)}).tween("zoom:zoom",function(){var n=I[0],i=I[1],s=n/2,o=i/2,a=$o.interpolateZoom([(s-C.x)/C.k,(o-C.y)/C.k,n/C.k],[(s-e.x)/e.k,(o-e.y)/e.k,n/e.k]);return function(e){var i=a(e),l=n/i[2];this.__chart__=C={x:s-i[0]*l,y:o-i[1]*l,k:l},r(t)}}).each("end.zoom",function(){l(t)}):(this.__chart__=C,a(t),r(t),l(t))})},t.translate=function(e){return arguments.length?(C={x:+e[0],y:+e[1],k:C.k},o(),t):[C.x,C.y]},t.scale=function(e){return arguments.length?(C={x:C.x,y:C.y,k:+e},o(),t):C.k},t.scaleExtent=function(e){return arguments.length?(S=null==e?Aa:[+e[0],+e[1]],t):S},t.center=function(e){return arguments.length?(g=e&&[+e[0],+e[1]],t):g},t.size=function(e){return arguments.length?(I=e&&[+e[0],+e[1]],t):I},t.x=function(e){return arguments.length?(w=e,y=e.copy(),C={x:0,y:0,k:1},t):w},t.y=function(e){return arguments.length?(x=e,M=e.copy(),C={x:0,y:0,k:1},t):x},$o.rebind(t,P,"on")};var Na,Aa=[0,1/0],Oa="onwheel"in Yo?(Na=function(){return-$o.event.deltaY*($o.event.deltaMode?120:1)},"wheel"):"onmousewheel"in Yo?(Na=function(){return $o.event.wheelDelta},"mousewheel"):(Na=function(){return-$o.event.detail},"MozMousePixelScroll");$o.color=nt,nt.prototype.toString=function(){return this.rgb()+""},$o.hsl=it;var Va=it.prototype=new nt;Va.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),new it(this.h,this.s,this.l/t)},Va.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new it(this.h,this.s,t*this.l)},Va.rgb=function(){return st(this.h,this.s,this.l)},$o.hcl=ot;var Ra=ot.prototype=new nt;Ra.brighter=function(t){return new ot(this.h,this.c,Math.min(100,this.l+Fa*(arguments.length?t:1)))},Ra.darker=function(t){return new ot(this.h,this.c,Math.max(0,this.l-Fa*(arguments.length?t:1)))},Ra.rgb=function(){return at(this.h,this.c,this.l).rgb()},$o.lab=rt;var Fa=18,ja=.95047,za=1,Ba=1.08883,Wa=rt.prototype=new nt;Wa.brighter=function(t){return new rt(Math.min(100,this.l+Fa*(arguments.length?t:1)),this.a,this.b)},Wa.darker=function(t){return new rt(Math.max(0,this.l-Fa*(arguments.length?t:1)),this.a,this.b);
},Wa.rgb=function(){return lt(this.l,this.a,this.b)},$o.rgb=pt;var Ha=pt.prototype=new nt;Ha.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var e=this.r,n=this.g,i=this.b,s=30;return e||n||i?(e&&s>e&&(e=s),n&&s>n&&(n=s),i&&s>i&&(i=s),new pt(Math.min(255,e/t),Math.min(255,n/t),Math.min(255,i/t))):new pt(s,s,s)},Ha.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new pt(t*this.r,t*this.g,t*this.b)},Ha.hsl=function(){return bt(this.r,this.g,this.b)},Ha.toString=function(){return"#"+mt(this.r)+mt(this.g)+mt(this.b)};var Ua=$o.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});Ua.forEach(function(t,e){Ua.set(t,ft(e))}),$o.functor=Mt,$o.xhr=Ct(xt),$o.dsv=function(t,e){function n(t,n,o){arguments.length<3&&(o=n,n=null);var a=It(t,e,null==n?i:s(n),o);return a.row=function(t){return arguments.length?a.response(null==(n=t)?i:s(t)):n},a}function i(t){return n.parse(t.responseText)}function s(t){return function(e){return n.parse(e.responseText,t)}}function o(e){return e.map(a).join(t)}function a(t){return r.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}var r=new RegExp('["'+t+"\n]"),l=t.charCodeAt(0);return n.parse=function(t,e){var i;return n.parseRows(t,function(t,n){if(i)return i(t,n-1);var s=new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}");i=e?function(t,n){return e(s(t),n)}:s})},n.parseRows=function(t,e){function n(){if(c>=u)return a;if(s)return s=!1,o;var e=c;if(34===t.charCodeAt(e)){for(var n=e;n++<u;)if(34===t.charCodeAt(n)){if(34!==t.charCodeAt(n+1))break;++n}c=n+2;var i=t.charCodeAt(n+1);return 13===i?(s=!0,10===t.charCodeAt(n+2)&&++c):10===i&&(s=!0),t.substring(e+1,n).replace(/""/g,'"')}for(;u>c;){var i=t.charCodeAt(c++),r=1;if(10===i)s=!0;else if(13===i)s=!0,10===t.charCodeAt(c)&&(++c,++r);else if(i!==l)continue;return t.substring(e,c-r)}return t.substring(e)}for(var i,s,o={},a={},r=[],u=t.length,c=0,h=0;(i=n())!==a;){for(var d=[];i!==o&&i!==a;)d.push(i),i=n();(!e||(d=e(d,h++)))&&r.push(d)}return r},n.format=function(e){if(Array.isArray(e[0]))return n.formatRows(e);var i=new d,s=[];return e.forEach(function(t){for(var e in t)i.has(e)||s.push(i.add(e))}),[s.map(a).join(t)].concat(e.map(function(e){return s.map(function(t){return a(e[t])}).join(t)})).join("\n")},n.formatRows=function(t){return t.map(o).join("\n")},n},$o.csv=$o.dsv(",","text/csv"),$o.tsv=$o.dsv("	","text/tab-separated-values"),$o.touch=function(t,e,n){if(arguments.length<3&&(n=e,e=y().changedTouches),e)for(var i,s=0,o=e.length;o>s;++s)if((i=e[s]).identifier===n)return U(t,i)};var $a,Ga,qa,Ya,Ka,Xa=Xo[f(Xo,"requestAnimationFrame")]||function(t){setTimeout(t,17)};$o.timer=function(t,e,n){var i=arguments.length;2>i&&(e=0),3>i&&(n=Date.now());var s=n+e,o={c:t,t:s,f:!1,n:null};Ga?Ga.n=o:$a=o,Ga=o,qa||(Ya=clearTimeout(Ya),qa=1,Xa(Et))},$o.timer.flush=function(){Lt(),kt()},$o.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)};var Za=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(Pt);$o.formatPrefix=function(t,e){var n=0;return t&&(0>t&&(t*=-1),e&&(t=$o.round(t,Dt(t,e))),n=1+Math.floor(1e-12+Math.log(t)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),Za[8+n/3]};var Qa=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,Ja=$o.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,e){return t.toPrecision(e)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},r:function(t,e){return(t=$o.round(t,Dt(t,e))).toFixed(Math.max(0,Math.min(20,Dt(t*(1+1e-15),e))))}}),tr=$o.time={},er=Date;At.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){nr.setUTCDate.apply(this._,arguments)},setDay:function(){nr.setUTCDay.apply(this._,arguments)},setFullYear:function(){nr.setUTCFullYear.apply(this._,arguments)},setHours:function(){nr.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){nr.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){nr.setUTCMinutes.apply(this._,arguments)},setMonth:function(){nr.setUTCMonth.apply(this._,arguments)},setSeconds:function(){nr.setUTCSeconds.apply(this._,arguments)},setTime:function(){nr.setTime.apply(this._,arguments)}};var nr=Date.prototype;tr.year=Ot(function(t){return t=tr.day(t),t.setMonth(0,1),t},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t){return t.getFullYear()}),tr.years=tr.year.range,tr.years.utc=tr.year.utc.range,tr.day=Ot(function(t){var e=new er(2e3,0);return e.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),e},function(t,e){t.setDate(t.getDate()+e)},function(t){return t.getDate()-1}),tr.days=tr.day.range,tr.days.utc=tr.day.utc.range,tr.dayOfYear=function(t){var e=tr.year(t);return Math.floor((t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(t,e){e=7-e;var n=tr[t]=Ot(function(t){return(t=tr.day(t)).setDate(t.getDate()-(t.getDay()+e)%7),t},function(t,e){t.setDate(t.getDate()+7*Math.floor(e))},function(t){var n=tr.year(t).getDay();return Math.floor((tr.dayOfYear(t)+(n+e)%7)/7)-(n!==e)});tr[t+"s"]=n.range,tr[t+"s"].utc=n.utc.range,tr[t+"OfYear"]=function(t){var n=tr.year(t).getDay();return Math.floor((tr.dayOfYear(t)+(n+e)%7)/7)}}),tr.week=tr.sunday,tr.weeks=tr.sunday.range,tr.weeks.utc=tr.sunday.utc.range,tr.weekOfYear=tr.sundayOfYear;var ir={"-":"",_:" ",0:"0"},sr=/^\s*\d+/,or=/^%/;$o.locale=function(t){return{numberFormat:Tt(t),timeFormat:Rt(t)}};var ar=$o.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});$o.format=ar.numberFormat,$o.geo={},se.prototype={s:0,t:0,add:function(t){oe(t,this.t,rr),oe(rr.s,this.s,this),this.s?this.t+=rr.t:this.s=rr.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var rr=new se;$o.geo.stream=function(t,e){t&&lr.hasOwnProperty(t.type)?lr[t.type](t,e):ae(t,e)};var lr={Feature:function(t,e){ae(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,s=n.length;++i<s;)ae(n[i].geometry,e)}},ur={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,s=n.length;++i<s;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){re(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,s=n.length;++i<s;)re(n[i],e,0)},Polygon:function(t,e){le(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,s=n.length;++i<s;)le(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,s=n.length;++i<s;)ae(n[i],e)}};$o.geo.area=function(t){return cr=0,$o.geo.stream(t,dr),cr};var cr,hr=new se,dr={sphere:function(){cr+=4*xa},point:g,lineStart:g,lineEnd:g,polygonStart:function(){hr.reset(),dr.lineStart=ue},polygonEnd:function(){var t=2*hr;cr+=0>t?4*xa+t:t,dr.lineStart=dr.lineEnd=dr.point=g}};$o.geo.bounds=function(){function t(t,e){y.push(_=[c=t,d=t]),h>e&&(h=e),e>p&&(p=e)}function e(e,n){var i=ce([e*La,n*La]);if(v){var s=de(v,i),o=[s[1],-s[0],0],a=de(o,s);ge(a),a=me(a);var l=e-f,u=l>0?1:-1,g=a[0]*ka*u,m=oa(l)>180;if(m^(g>u*f&&u*e>g)){var b=a[1]*ka;b>p&&(p=b)}else if(g=(g+360)%360-180,m^(g>u*f&&u*e>g)){var b=-a[1]*ka;h>b&&(h=b)}else h>n&&(h=n),n>p&&(p=n);m?f>e?r(c,e)>r(c,d)&&(d=e):r(e,d)>r(c,d)&&(c=e):d>=c?(c>e&&(c=e),e>d&&(d=e)):e>f?r(c,e)>r(c,d)&&(d=e):r(e,d)>r(c,d)&&(c=e)}else t(e,n);v=i,f=e}function n(){w.point=e}function i(){_[0]=c,_[1]=d,w.point=t,v=null}function s(t,n){if(v){var i=t-f;b+=oa(i)>180?i+(i>0?360:-360):i}else g=t,m=n;dr.point(t,n),e(t,n)}function o(){dr.lineStart()}function a(){s(g,m),dr.lineEnd(),oa(b)>Sa&&(c=-(d=180)),_[0]=c,_[1]=d,v=null}function r(t,e){return(e-=t)<0?e+360:e}function l(t,e){return t[0]-e[0]}function u(t,e){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var c,h,d,p,f,g,m,v,b,y,_,w={point:t,lineStart:n,lineEnd:i,polygonStart:function(){w.point=s,w.lineStart=o,w.lineEnd=a,b=0,dr.polygonStart()},polygonEnd:function(){dr.polygonEnd(),w.point=t,w.lineStart=n,w.lineEnd=i,0>hr?(c=-(d=180),h=-(p=90)):b>Sa?p=90:-Sa>b&&(h=-90),_[0]=c,_[1]=d}};return function(t){p=d=-(c=h=1/0),y=[],$o.geo.stream(t,w);var e=y.length;if(e){y.sort(l);for(var n,i=1,s=y[0],o=[s];e>i;++i)n=y[i],u(n[0],s)||u(n[1],s)?(r(s[0],n[1])>r(s[0],s[1])&&(s[1]=n[1]),r(n[0],s[1])>r(s[0],s[1])&&(s[0]=n[0])):o.push(s=n);for(var a,n,f=-1/0,e=o.length-1,i=0,s=o[e];e>=i;s=n,++i)n=o[i],(a=r(s[1],n[0]))>f&&(f=a,c=n[0],d=s[1])}return y=_=null,1/0===c||1/0===h?[[NaN,NaN],[NaN,NaN]]:[[c,h],[d,p]]}}(),$o.geo.centroid=function(t){pr=fr=gr=mr=vr=br=yr=_r=wr=Mr=xr=0,$o.geo.stream(t,Cr);var e=wr,n=Mr,i=xr,s=e*e+n*n+i*i;return Ea>s&&(e=br,n=yr,i=_r,Sa>fr&&(e=gr,n=mr,i=vr),s=e*e+n*n+i*i,Ea>s)?[NaN,NaN]:[Math.atan2(n,e)*ka,Z(i/Math.sqrt(s))*ka]};var pr,fr,gr,mr,vr,br,yr,_r,wr,Mr,xr,Cr={sphere:g,point:be,lineStart:_e,lineEnd:we,polygonStart:function(){Cr.lineStart=Me},polygonEnd:function(){Cr.lineStart=_e}},Ir=Ee(xe,Te,Ae,[-xa,-xa/2]),Sr=1e9;$o.geo.clipExtent=function(){var t,e,n,i,s,o,a={stream:function(t){return s&&(s.valid=!1),s=o(t),s.valid=!0,s},extent:function(r){return arguments.length?(o=Re(t=+r[0][0],e=+r[0][1],n=+r[1][0],i=+r[1][1]),s&&(s.valid=!1,s=null),a):[[t,e],[n,i]]}};return a.extent([[0,0],[960,500]])},($o.geo.conicEqualArea=function(){return je(ze)}).raw=ze,$o.geo.albers=function(){return $o.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},$o.geo.albersUsa=function(){function t(t){var o=t[0],a=t[1];return e=null,n(o,a),e||(i(o,a),e)||s(o,a),e}var e,n,i,s,o=$o.geo.albers(),a=$o.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),r=$o.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(t,n){e=[t,n]}};return t.invert=function(t){var e=o.scale(),n=o.translate(),i=(t[0]-n[0])/e,s=(t[1]-n[1])/e;return(s>=.12&&.234>s&&i>=-.425&&-.214>i?a:s>=.166&&.234>s&&i>=-.214&&-.115>i?r:o).invert(t)},t.stream=function(t){var e=o.stream(t),n=a.stream(t),i=r.stream(t);return{point:function(t,s){e.point(t,s),n.point(t,s),i.point(t,s)},sphere:function(){e.sphere(),n.sphere(),i.sphere()},lineStart:function(){e.lineStart(),n.lineStart(),i.lineStart()},lineEnd:function(){e.lineEnd(),n.lineEnd(),i.lineEnd()},polygonStart:function(){e.polygonStart(),n.polygonStart(),i.polygonStart()},polygonEnd:function(){e.polygonEnd(),n.polygonEnd(),i.polygonEnd()}}},t.precision=function(e){return arguments.length?(o.precision(e),a.precision(e),r.precision(e),t):o.precision()},t.scale=function(e){return arguments.length?(o.scale(e),a.scale(.35*e),r.scale(e),t.translate(o.translate())):o.scale()},t.translate=function(e){if(!arguments.length)return o.translate();var u=o.scale(),c=+e[0],h=+e[1];return n=o.translate(e).clipExtent([[c-.455*u,h-.238*u],[c+.455*u,h+.238*u]]).stream(l).point,i=a.translate([c-.307*u,h+.201*u]).clipExtent([[c-.425*u+Sa,h+.12*u+Sa],[c-.214*u-Sa,h+.234*u-Sa]]).stream(l).point,s=r.translate([c-.205*u,h+.212*u]).clipExtent([[c-.214*u+Sa,h+.166*u+Sa],[c-.115*u-Sa,h+.234*u-Sa]]).stream(l).point,t},t.scale(1070)};var Er,Lr,kr,Dr,Pr,Tr,Nr={point:g,lineStart:g,lineEnd:g,polygonStart:function(){Lr=0,Nr.lineStart=Be},polygonEnd:function(){Nr.lineStart=Nr.lineEnd=Nr.point=g,Er+=oa(Lr/2)}},Ar={point:We,lineStart:g,lineEnd:g,polygonStart:g,polygonEnd:g},Or={point:$e,lineStart:Ge,lineEnd:qe,polygonStart:function(){Or.lineStart=Ye},polygonEnd:function(){Or.point=$e,Or.lineStart=Ge,Or.lineEnd=qe}};$o.geo.path=function(){function t(t){return t&&("function"==typeof r&&o.pointRadius(+r.apply(this,arguments)),a&&a.valid||(a=s(o)),$o.geo.stream(t,a)),o.result()}function e(){return a=null,t}var n,i,s,o,a,r=4.5;return t.area=function(t){return Er=0,$o.geo.stream(t,s(Nr)),Er},t.centroid=function(t){return gr=mr=vr=br=yr=_r=wr=Mr=xr=0,$o.geo.stream(t,s(Or)),xr?[wr/xr,Mr/xr]:_r?[br/_r,yr/_r]:vr?[gr/vr,mr/vr]:[NaN,NaN]},t.bounds=function(t){return Pr=Tr=-(kr=Dr=1/0),$o.geo.stream(t,s(Ar)),[[kr,Dr],[Pr,Tr]]},t.projection=function(t){return arguments.length?(s=(n=t)?t.stream||Ze(t):xt,e()):n},t.context=function(t){return arguments.length?(o=null==(i=t)?new He:new Ke(t),"function"!=typeof r&&o.pointRadius(r),e()):i},t.pointRadius=function(e){return arguments.length?(r="function"==typeof e?e:(o.pointRadius(+e),+e),t):r},t.projection($o.geo.albersUsa()).context(null)},$o.geo.transform=function(t){return{stream:function(e){var n=new Qe(e);for(var i in t)n[i]=t[i];return n}}},Qe.prototype={point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},$o.geo.projection=tn,$o.geo.projectionMutator=en,($o.geo.equirectangular=function(){return tn(sn)}).raw=sn.invert=sn,$o.geo.rotation=function(t){function e(e){return e=t(e[0]*La,e[1]*La),e[0]*=ka,e[1]*=ka,e}return t=an(t[0]%360*La,t[1]*La,t.length>2?t[2]*La:0),e.invert=function(e){return e=t.invert(e[0]*La,e[1]*La),e[0]*=ka,e[1]*=ka,e},e},on.invert=sn,$o.geo.circle=function(){function t(){var t="function"==typeof i?i.apply(this,arguments):i,e=an(-t[0]*La,-t[1]*La,0).invert,s=[];return n(null,null,1,{point:function(t,n){s.push(t=e(t,n)),t[0]*=ka,t[1]*=ka}}),{type:"Polygon",coordinates:[s]}}var e,n,i=[0,0],s=6;return t.origin=function(e){return arguments.length?(i=e,t):i},t.angle=function(i){return arguments.length?(n=cn((e=+i)*La,s*La),t):e},t.precision=function(i){return arguments.length?(n=cn(e*La,(s=+i)*La),t):s},t.angle(90)},$o.geo.distance=function(t,e){var n,i=(e[0]-t[0])*La,s=t[1]*La,o=e[1]*La,a=Math.sin(i),r=Math.cos(i),l=Math.sin(s),u=Math.cos(s),c=Math.sin(o),h=Math.cos(o);return Math.atan2(Math.sqrt((n=h*a)*n+(n=u*c-l*h*r)*n),l*c+u*h*r)},$o.geo.graticule=function(){function t(){return{type:"MultiLineString",coordinates:e()}}function e(){return $o.range(Math.ceil(o/m)*m,s,m).map(d).concat($o.range(Math.ceil(u/v)*v,l,v).map(p)).concat($o.range(Math.ceil(i/f)*f,n,f).filter(function(t){return oa(t%m)>Sa}).map(c)).concat($o.range(Math.ceil(r/g)*g,a,g).filter(function(t){return oa(t%v)>Sa}).map(h))}var n,i,s,o,a,r,l,u,c,h,d,p,f=10,g=f,m=90,v=360,b=2.5;return t.lines=function(){return e().map(function(t){return{type:"LineString",coordinates:t}})},t.outline=function(){return{type:"Polygon",coordinates:[d(o).concat(p(l).slice(1),d(s).reverse().slice(1),p(u).reverse().slice(1))]}},t.extent=function(e){return arguments.length?t.majorExtent(e).minorExtent(e):t.minorExtent()},t.majorExtent=function(e){return arguments.length?(o=+e[0][0],s=+e[1][0],u=+e[0][1],l=+e[1][1],o>s&&(e=o,o=s,s=e),u>l&&(e=u,u=l,l=e),t.precision(b)):[[o,u],[s,l]]},t.minorExtent=function(e){return arguments.length?(i=+e[0][0],n=+e[1][0],r=+e[0][1],a=+e[1][1],i>n&&(e=i,i=n,n=e),r>a&&(e=r,r=a,a=e),t.precision(b)):[[i,r],[n,a]]},t.step=function(e){return arguments.length?t.majorStep(e).minorStep(e):t.minorStep()},t.majorStep=function(e){return arguments.length?(m=+e[0],v=+e[1],t):[m,v]},t.minorStep=function(e){return arguments.length?(f=+e[0],g=+e[1],t):[f,g]},t.precision=function(e){return arguments.length?(b=+e,c=dn(r,a,90),h=pn(i,n,b),d=dn(u,l,90),p=pn(o,s,b),t):b},t.majorExtent([[-180,-90+Sa],[180,90-Sa]]).minorExtent([[-180,-80-Sa],[180,80+Sa]])},$o.geo.greatArc=function(){function t(){return{type:"LineString",coordinates:[e||i.apply(this,arguments),n||s.apply(this,arguments)]}}var e,n,i=fn,s=gn;return t.distance=function(){return $o.geo.distance(e||i.apply(this,arguments),n||s.apply(this,arguments))},t.source=function(n){return arguments.length?(i=n,e="function"==typeof n?null:n,t):i},t.target=function(e){return arguments.length?(s=e,n="function"==typeof e?null:e,t):s},t.precision=function(){return arguments.length?t:0},t},$o.geo.interpolate=function(t,e){return mn(t[0]*La,t[1]*La,e[0]*La,e[1]*La)},$o.geo.length=function(t){return Vr=0,$o.geo.stream(t,Rr),Vr};var Vr,Rr={sphere:g,point:g,lineStart:vn,lineEnd:g,polygonStart:g,polygonEnd:g},Fr=bn(function(t){return Math.sqrt(2/(1+t))},function(t){return 2*Math.asin(t/2)});($o.geo.azimuthalEqualArea=function(){return tn(Fr)}).raw=Fr;var jr=bn(function(t){var e=Math.acos(t);return e&&e/Math.sin(e)},xt);($o.geo.azimuthalEquidistant=function(){return tn(jr)}).raw=jr,($o.geo.conicConformal=function(){return je(yn)}).raw=yn,($o.geo.conicEquidistant=function(){return je(_n)}).raw=_n;var zr=bn(function(t){return 1/t},Math.atan);($o.geo.gnomonic=function(){return tn(zr)}).raw=zr,wn.invert=function(t,e){return[t,2*Math.atan(Math.exp(e))-Ia]},($o.geo.mercator=function(){return Mn(wn)}).raw=wn;var Br=bn(function(){return 1},Math.asin);($o.geo.orthographic=function(){return tn(Br)}).raw=Br;var Wr=bn(function(t){return 1/(1+t)},function(t){return 2*Math.atan(t)});($o.geo.stereographic=function(){return tn(Wr)}).raw=Wr,xn.invert=function(t,e){return[-e,2*Math.atan(Math.exp(t))-Ia]},($o.geo.transverseMercator=function(){var t=Mn(xn),e=t.center,n=t.rotate;return t.center=function(t){return t?e([-t[1],t[0]]):(t=e(),[t[1],-t[0]])},t.rotate=function(t){return t?n([t[0],t[1],t.length>2?t[2]+90:90]):(t=n(),[t[0],t[1],t[2]-90])},n([0,0,90])}).raw=xn,$o.geom={},$o.geom.hull=function(t){function e(t){if(t.length<3)return[];var e,s=Mt(n),o=Mt(i),a=t.length,r=[],l=[];for(e=0;a>e;e++)r.push([+s.call(this,t[e],e),+o.call(this,t[e],e),e]);for(r.sort(En),e=0;a>e;e++)l.push([r[e][0],-r[e][1]]);var u=Sn(r),c=Sn(l),h=c[0]===u[0],d=c[c.length-1]===u[u.length-1],p=[];for(e=u.length-1;e>=0;--e)p.push(t[r[u[e]][2]]);for(e=+h;e<c.length-d;++e)p.push(t[r[c[e]][2]]);return p}var n=Cn,i=In;return arguments.length?e(t):(e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e)},$o.geom.polygon=function(t){return ca(t,Hr),t};var Hr=$o.geom.polygon.prototype=[];Hr.area=function(){for(var t,e=-1,n=this.length,i=this[n-1],s=0;++e<n;)t=i,i=this[e],s+=t[1]*i[0]-t[0]*i[1];return.5*s},Hr.centroid=function(t){var e,n,i=-1,s=this.length,o=0,a=0,r=this[s-1];for(arguments.length||(t=-1/(6*this.area()));++i<s;)e=r,r=this[i],n=e[0]*r[1]-r[0]*e[1],o+=(e[0]+r[0])*n,a+=(e[1]+r[1])*n;return[o*t,a*t]},Hr.clip=function(t){for(var e,n,i,s,o,a,r=Dn(t),l=-1,u=this.length-Dn(this),c=this[u-1];++l<u;){for(e=t.slice(),t.length=0,s=this[l],o=e[(i=e.length-r)-1],n=-1;++n<i;)a=e[n],Ln(a,c,s)?(Ln(o,c,s)||t.push(kn(o,a,c,s)),t.push(a)):Ln(o,c,s)&&t.push(kn(o,a,c,s)),o=a;r&&t.push(t[0]),c=s}return t};var Ur,$r,Gr,qr,Yr,Kr=[],Xr=[];Fn.prototype.prepare=function(){for(var t,e=this.edges,n=e.length;n--;)t=e[n].edge,t.b&&t.a||e.splice(n,1);return e.sort(zn),e.length},Xn.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},Zn.prototype={insert:function(t,e){var n,i,s;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=ei(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)i=n.U,n===i.L?(s=i.R,s&&s.C?(n.C=s.C=!1,i.C=!0,t=i):(t===n.R&&(Jn(this,n),t=n,n=t.U),n.C=!1,i.C=!0,ti(this,i))):(s=i.L,s&&s.C?(n.C=s.C=!1,i.C=!0,t=i):(t===n.L&&(ti(this,n),t=n,n=t.U),n.C=!1,i.C=!0,Jn(this,i))),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,i,s=t.U,o=t.L,a=t.R;if(n=o?a?ei(a):o:a,s?s.L===t?s.L=n:s.R=n:this._=n,o&&a?(i=n.C,n.C=t.C,n.L=o,o.U=n,n!==a?(s=n.U,n.U=t.U,t=n.R,s.L=t,n.R=a,a.U=n):(n.U=s,s=n,t=n.R)):(i=t.C,t=n),t&&(t.U=s),!i){if(t&&t.C)return void(t.C=!1);do{if(t===this._)break;if(t===s.L){if(e=s.R,e.C&&(e.C=!1,s.C=!0,Jn(this,s),e=s.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,ti(this,e),e=s.R),e.C=s.C,s.C=e.R.C=!1,Jn(this,s),t=this._;break}}else if(e=s.L,e.C&&(e.C=!1,s.C=!0,ti(this,s),e=s.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,Jn(this,e),e=s.L),e.C=s.C,s.C=e.L.C=!1,ti(this,s),t=this._;break}e.C=!0,t=s,s=s.U}while(!t.C);t&&(t.C=!1)}}},$o.geom.voronoi=function(t){function e(t){var e=new Array(t.length),i=r[0][0],s=r[0][1],o=r[1][0],a=r[1][1];return ni(n(t),r).cells.forEach(function(n,r){var l=n.edges,u=n.site,c=e[r]=l.length?l.map(function(t){var e=t.start();return[e.x,e.y]}):u.x>=i&&u.x<=o&&u.y>=s&&u.y<=a?[[i,a],[o,a],[o,s],[i,s]]:[];c.point=t[r]}),e}function n(t){return t.map(function(t,e){return{x:Math.round(o(t,e)/Sa)*Sa,y:Math.round(a(t,e)/Sa)*Sa,i:e}})}var i=Cn,s=In,o=i,a=s,r=Zr;return t?e(t):(e.links=function(t){return ni(n(t)).edges.filter(function(t){return t.l&&t.r}).map(function(e){return{source:t[e.l.i],target:t[e.r.i]}})},e.triangles=function(t){var e=[];return ni(n(t)).cells.forEach(function(n,i){for(var s,o,a=n.site,r=n.edges.sort(zn),l=-1,u=r.length,c=r[u-1].edge,h=c.l===a?c.r:c.l;++l<u;)s=c,o=h,c=r[l].edge,h=c.l===a?c.r:c.l,i<o.i&&i<h.i&&si(a,o,h)<0&&e.push([t[i],t[o.i],t[h.i]])}),e},e.x=function(t){return arguments.length?(o=Mt(i=t),e):i},e.y=function(t){return arguments.length?(a=Mt(s=t),e):s},e.clipExtent=function(t){return arguments.length?(r=null==t?Zr:t,e):r===Zr?null:r},e.size=function(t){return arguments.length?e.clipExtent(t&&[[0,0],t]):r===Zr?null:r&&r[1]},e)};var Zr=[[-1e6,-1e6],[1e6,1e6]];$o.geom.delaunay=function(t){return $o.geom.voronoi().triangles(t)},$o.geom.quadtree=function(t,e,n,i,s){function o(t){function o(t,e,n,i,s,o,a,r){if(!isNaN(n)&&!isNaN(i))if(t.leaf){var l=t.x,c=t.y;if(null!=l)if(oa(l-n)+oa(c-i)<.01)u(t,e,n,i,s,o,a,r);else{var h=t.point;t.x=t.y=t.point=null,u(t,h,l,c,s,o,a,r),u(t,e,n,i,s,o,a,r)}else t.x=n,t.y=i,t.point=e}else u(t,e,n,i,s,o,a,r)}function u(t,e,n,i,s,a,r,l){var u=.5*(s+r),c=.5*(a+l),h=n>=u,d=i>=c,p=(d<<1)+h;t.leaf=!1,t=t.nodes[p]||(t.nodes[p]=ri()),h?s=u:r=u,d?a=c:l=c,o(t,e,n,i,s,a,r,l)}var c,h,d,p,f,g,m,v,b,y=Mt(r),_=Mt(l);if(null!=e)g=e,m=n,v=i,b=s;else if(v=b=-(g=m=1/0),h=[],d=[],f=t.length,a)for(p=0;f>p;++p)c=t[p],c.x<g&&(g=c.x),c.y<m&&(m=c.y),c.x>v&&(v=c.x),c.y>b&&(b=c.y),h.push(c.x),d.push(c.y);else for(p=0;f>p;++p){var w=+y(c=t[p],p),M=+_(c,p);g>w&&(g=w),m>M&&(m=M),w>v&&(v=w),M>b&&(b=M),h.push(w),d.push(M)}var x=v-g,C=b-m;x>C?b=m+x:v=g+C;var I=ri();if(I.add=function(t){o(I,t,+y(t,++p),+_(t,p),g,m,v,b)},I.visit=function(t){li(t,I,g,m,v,b)},p=-1,null==e){for(;++p<f;)o(I,t[p],h[p],d[p],g,m,v,b);--p}else t.forEach(I.add);return h=d=t=c=null,I}var a,r=Cn,l=In;return(a=arguments.length)?(r=oi,l=ai,3===a&&(s=n,i=e,n=e=0),o(t)):(o.x=function(t){return arguments.length?(r=t,o):r},o.y=function(t){return arguments.length?(l=t,o):l},o.extent=function(t){return arguments.length?(null==t?e=n=i=s=null:(e=+t[0][0],n=+t[0][1],i=+t[1][0],s=+t[1][1]),o):null==e?null:[[e,n],[i,s]]},o.size=function(t){return arguments.length?(null==t?e=n=i=s=null:(e=n=0,i=+t[0],s=+t[1]),o):null==e?null:[i-e,s-n]},o)},$o.interpolateRgb=ui,$o.interpolateObject=ci,$o.interpolateNumber=hi,$o.interpolateString=di;var Qr=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Jr=new RegExp(Qr.source,"g");$o.interpolate=pi,$o.interpolators=[function(t,e){var n=typeof e;return("string"===n?Ua.has(e)||/^(#|rgb\(|hsl\()/.test(e)?ui:di:e instanceof nt?ui:Array.isArray(e)?fi:"object"===n&&isNaN(e)?ci:hi)(t,e)}],$o.interpolateArray=fi;var tl=function(){return xt},el=$o.map({linear:tl,poly:wi,quad:function(){return bi},cubic:function(){return yi},sin:function(){return Mi},exp:function(){return xi},circle:function(){return Ci},elastic:Ii,back:Si,bounce:function(){return Ei}}),nl=$o.map({"in":xt,out:mi,"in-out":vi,"out-in":function(t){return vi(mi(t))}});$o.ease=function(t){var e=t.indexOf("-"),n=e>=0?t.substring(0,e):t,i=e>=0?t.substring(e+1):"in";return n=el.get(n)||tl,i=nl.get(i)||xt,gi(i(n.apply(null,Go.call(arguments,1))))},$o.interpolateHcl=Li,$o.interpolateHsl=ki,$o.interpolateLab=Di,$o.interpolateRound=Pi,$o.transform=function(t){var e=Yo.createElementNS($o.ns.prefix.svg,"g");return($o.transform=function(t){if(null!=t){e.setAttribute("transform",t);var n=e.transform.baseVal.consolidate()}return new Ti(n?n.matrix:il)})(t)},Ti.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var il={a:1,b:0,c:0,d:1,e:0,f:0};$o.interpolateTransform=Vi,$o.layout={},$o.layout.bundle=function(){return function(t){for(var e=[],n=-1,i=t.length;++n<i;)e.push(ji(t[n]));return e}},$o.layout.chord=function(){function t(){var t,u,h,d,p,f={},g=[],m=$o.range(o),v=[];for(n=[],i=[],t=0,d=-1;++d<o;){for(u=0,p=-1;++p<o;)u+=s[d][p];g.push(u),v.push($o.range(o)),t+=u}for(a&&m.sort(function(t,e){return a(g[t],g[e])}),r&&v.forEach(function(t,e){t.sort(function(t,n){return r(s[e][t],s[e][n])})}),t=(Ca-c*o)/t,u=0,d=-1;++d<o;){for(h=u,p=-1;++p<o;){var b=m[d],y=v[b][p],_=s[b][y],w=u,M=u+=_*t;f[b+"-"+y]={index:b,subindex:y,startAngle:w,endAngle:M,value:_}}i[b]={index:b,startAngle:h,endAngle:u,value:(u-h)/t},u+=c}for(d=-1;++d<o;)for(p=d-1;++p<o;){var x=f[d+"-"+p],C=f[p+"-"+d];(x.value||C.value)&&n.push(x.value<C.value?{source:C,target:x}:{source:x,target:C})}l&&e()}function e(){n.sort(function(t,e){return l((t.source.value+t.target.value)/2,(e.source.value+e.target.value)/2)})}var n,i,s,o,a,r,l,u={},c=0;return u.matrix=function(t){return arguments.length?(o=(s=t)&&s.length,n=i=null,u):s},u.padding=function(t){return arguments.length?(c=t,n=i=null,u):c},u.sortGroups=function(t){return arguments.length?(a=t,n=i=null,u):a},u.sortSubgroups=function(t){return arguments.length?(r=t,n=null,u):r},u.sortChords=function(t){return arguments.length?(l=t,n&&e(),u):l},u.chords=function(){return n||t(),n},u.groups=function(){return i||t(),i},u},$o.layout.force=function(){function t(t){return function(e,n,i,s){if(e.point!==t){var o=e.cx-t.x,a=e.cy-t.y,r=s-n,l=o*o+a*a;if(l>r*r/m){if(f>l){var u=e.charge/l;t.px-=o*u,t.py-=a*u}return!0}if(e.point&&l&&f>l){var u=e.pointCharge/l;t.px-=o*u,t.py-=a*u}}return!e.charge}}function e(t){t.px=$o.event.x,t.py=$o.event.y,r.resume()}var n,i,s,o,a,r={},l=$o.dispatch("start","tick","end"),u=[1,1],c=.9,h=sl,d=ol,p=-30,f=al,g=.1,m=.64,v=[],b=[];return r.tick=function(){if((i*=.99)<.005)return l.end({type:"end",alpha:i=0}),!0;var e,n,r,h,d,f,m,y,_,w=v.length,M=b.length;for(n=0;M>n;++n)r=b[n],h=r.source,d=r.target,y=d.x-h.x,_=d.y-h.y,(f=y*y+_*_)&&(f=i*o[n]*((f=Math.sqrt(f))-s[n])/f,y*=f,_*=f,d.x-=y*(m=h.weight/(d.weight+h.weight)),d.y-=_*m,h.x+=y*(m=1-m),h.y+=_*m);if((m=i*g)&&(y=u[0]/2,_=u[1]/2,n=-1,m))for(;++n<w;)r=v[n],r.x+=(y-r.x)*m,r.y+=(_-r.y)*m;if(p)for(Gi(e=$o.geom.quadtree(v),i,a),n=-1;++n<w;)(r=v[n]).fixed||e.visit(t(r));for(n=-1;++n<w;)r=v[n],r.fixed?(r.x=r.px,r.y=r.py):(r.x-=(r.px-(r.px=r.x))*c,r.y-=(r.py-(r.py=r.y))*c);l.tick({type:"tick",alpha:i})},r.nodes=function(t){return arguments.length?(v=t,r):v},r.links=function(t){return arguments.length?(b=t,r):b},r.size=function(t){return arguments.length?(u=t,r):u},r.linkDistance=function(t){return arguments.length?(h="function"==typeof t?t:+t,r):h},r.distance=r.linkDistance,r.linkStrength=function(t){return arguments.length?(d="function"==typeof t?t:+t,r):d},r.friction=function(t){return arguments.length?(c=+t,r):c},r.charge=function(t){return arguments.length?(p="function"==typeof t?t:+t,r):p},r.chargeDistance=function(t){return arguments.length?(f=t*t,r):Math.sqrt(f)},r.gravity=function(t){return arguments.length?(g=+t,r):g},r.theta=function(t){return arguments.length?(m=t*t,r):Math.sqrt(m)},r.alpha=function(t){return arguments.length?(t=+t,i?i=t>0?t:0:t>0&&(l.start({type:"start",alpha:i=t}),$o.timer(r.tick)),r):i},r.start=function(){function t(t,i){if(!n){for(n=new Array(l),r=0;l>r;++r)n[r]=[];for(r=0;u>r;++r){var s=b[r];n[s.source.index].push(s.target),n[s.target.index].push(s.source)}}for(var o,a=n[e],r=-1,u=a.length;++r<u;)if(!isNaN(o=a[r][t]))return o;return Math.random()*i}var e,n,i,l=v.length,c=b.length,f=u[0],g=u[1];for(e=0;l>e;++e)(i=v[e]).index=e,i.weight=0;for(e=0;c>e;++e)i=b[e],"number"==typeof i.source&&(i.source=v[i.source]),"number"==typeof i.target&&(i.target=v[i.target]),++i.source.weight,++i.target.weight;for(e=0;l>e;++e)i=v[e],isNaN(i.x)&&(i.x=t("x",f)),isNaN(i.y)&&(i.y=t("y",g)),isNaN(i.px)&&(i.px=i.x),isNaN(i.py)&&(i.py=i.y);if(s=[],"function"==typeof h)for(e=0;c>e;++e)s[e]=+h.call(this,b[e],e);else for(e=0;c>e;++e)s[e]=h;if(o=[],"function"==typeof d)for(e=0;c>e;++e)o[e]=+d.call(this,b[e],e);else for(e=0;c>e;++e)o[e]=d;if(a=[],"function"==typeof p)for(e=0;l>e;++e)a[e]=+p.call(this,v[e],e);else for(e=0;l>e;++e)a[e]=p;
return r.resume()},r.resume=function(){return r.alpha(.1)},r.stop=function(){return r.alpha(0)},r.drag=function(){return n||(n=$o.behavior.drag().origin(xt).on("dragstart.force",Wi).on("drag.force",e).on("dragend.force",Hi)),arguments.length?void this.on("mouseover.force",Ui).on("mouseout.force",$i).call(n):n},$o.rebind(r,l,"on")};var sl=20,ol=1,al=1/0;$o.layout.hierarchy=function(){function t(s){var o,a=[s],r=[];for(s.depth=0;null!=(o=a.pop());)if(r.push(o),(u=n.call(t,o,o.depth))&&(l=u.length)){for(var l,u,c;--l>=0;)a.push(c=u[l]),c.parent=o,c.depth=o.depth+1;i&&(o.value=0),o.children=u}else i&&(o.value=+i.call(t,o,o.depth)||0),delete o.children;return Ki(s,function(t){var n,s;e&&(n=t.children)&&n.sort(e),i&&(s=t.parent)&&(s.value+=t.value)}),r}var e=Qi,n=Xi,i=Zi;return t.sort=function(n){return arguments.length?(e=n,t):e},t.children=function(e){return arguments.length?(n=e,t):n},t.value=function(e){return arguments.length?(i=e,t):i},t.revalue=function(e){return i&&(Yi(e,function(t){t.children&&(t.value=0)}),Ki(e,function(e){var n;e.children||(e.value=+i.call(t,e,e.depth)||0),(n=e.parent)&&(n.value+=e.value)})),e},t},$o.layout.partition=function(){function t(e,n,i,s){var o=e.children;if(e.x=n,e.y=e.depth*s,e.dx=i,e.dy=s,o&&(a=o.length)){var a,r,l,u=-1;for(i=e.value?i/e.value:0;++u<a;)t(r=o[u],n,l=r.value*i,s),n+=l}}function e(t){var n=t.children,i=0;if(n&&(s=n.length))for(var s,o=-1;++o<s;)i=Math.max(i,e(n[o]));return 1+i}function n(n,o){var a=i.call(this,n,o);return t(a[0],0,s[0],s[1]/e(a[0])),a}var i=$o.layout.hierarchy(),s=[1,1];return n.size=function(t){return arguments.length?(s=t,n):s},qi(n,i)},$o.layout.pie=function(){function t(o){var a=o.map(function(n,i){return+e.call(t,n,i)}),r=+("function"==typeof i?i.apply(this,arguments):i),l=(("function"==typeof s?s.apply(this,arguments):s)-r)/$o.sum(a),u=$o.range(o.length);null!=n&&u.sort(n===rl?function(t,e){return a[e]-a[t]}:function(t,e){return n(o[t],o[e])});var c=[];return u.forEach(function(t){var e;c[t]={data:o[t],value:e=a[t],startAngle:r,endAngle:r+=e*l}}),c}var e=Number,n=rl,i=0,s=Ca;return t.value=function(n){return arguments.length?(e=n,t):e},t.sort=function(e){return arguments.length?(n=e,t):n},t.startAngle=function(e){return arguments.length?(i=e,t):i},t.endAngle=function(e){return arguments.length?(s=e,t):s},t};var rl={};$o.layout.stack=function(){function t(r,l){var u=r.map(function(n,i){return e.call(t,n,i)}),c=u.map(function(e){return e.map(function(e,n){return[o.call(t,e,n),a.call(t,e,n)]})}),h=n.call(t,c,l);u=$o.permute(u,h),c=$o.permute(c,h);var d,p,f,g=i.call(t,c,l),m=u.length,v=u[0].length;for(p=0;v>p;++p)for(s.call(t,u[0][p],f=g[p],c[0][p][1]),d=1;m>d;++d)s.call(t,u[d][p],f+=c[d-1][p][1],c[d][p][1]);return r}var e=xt,n=is,i=ss,s=ns,o=ts,a=es;return t.values=function(n){return arguments.length?(e=n,t):e},t.order=function(e){return arguments.length?(n="function"==typeof e?e:ll.get(e)||is,t):n},t.offset=function(e){return arguments.length?(i="function"==typeof e?e:ul.get(e)||ss,t):i},t.x=function(e){return arguments.length?(o=e,t):o},t.y=function(e){return arguments.length?(a=e,t):a},t.out=function(e){return arguments.length?(s=e,t):s},t};var ll=$o.map({"inside-out":function(t){var e,n,i=t.length,s=t.map(os),o=t.map(as),a=$o.range(i).sort(function(t,e){return s[t]-s[e]}),r=0,l=0,u=[],c=[];for(e=0;i>e;++e)n=a[e],l>r?(r+=o[n],u.push(n)):(l+=o[n],c.push(n));return c.reverse().concat(u)},reverse:function(t){return $o.range(t.length).reverse()},"default":is}),ul=$o.map({silhouette:function(t){var e,n,i,s=t.length,o=t[0].length,a=[],r=0,l=[];for(n=0;o>n;++n){for(e=0,i=0;s>e;e++)i+=t[e][n][1];i>r&&(r=i),a.push(i)}for(n=0;o>n;++n)l[n]=(r-a[n])/2;return l},wiggle:function(t){var e,n,i,s,o,a,r,l,u,c=t.length,h=t[0],d=h.length,p=[];for(p[0]=l=u=0,n=1;d>n;++n){for(e=0,s=0;c>e;++e)s+=t[e][n][1];for(e=0,o=0,r=h[n][0]-h[n-1][0];c>e;++e){for(i=0,a=(t[e][n][1]-t[e][n-1][1])/(2*r);e>i;++i)a+=(t[i][n][1]-t[i][n-1][1])/r;o+=a*t[e][n][1]}p[n]=l-=s?o/s*r:0,u>l&&(u=l)}for(n=0;d>n;++n)p[n]-=u;return p},expand:function(t){var e,n,i,s=t.length,o=t[0].length,a=1/s,r=[];for(n=0;o>n;++n){for(e=0,i=0;s>e;e++)i+=t[e][n][1];if(i)for(e=0;s>e;e++)t[e][n][1]/=i;else for(e=0;s>e;e++)t[e][n][1]=a}for(n=0;o>n;++n)r[n]=0;return r},zero:ss});$o.layout.histogram=function(){function t(t,o){for(var a,r,l=[],u=t.map(n,this),c=i.call(this,u,o),h=s.call(this,c,u,o),o=-1,d=u.length,p=h.length-1,f=e?1:1/d;++o<p;)a=l[o]=[],a.dx=h[o+1]-(a.x=h[o]),a.y=0;if(p>0)for(o=-1;++o<d;)r=u[o],r>=c[0]&&r<=c[1]&&(a=l[$o.bisect(h,r,1,p)-1],a.y+=f,a.push(t[o]));return l}var e=!0,n=Number,i=cs,s=ls;return t.value=function(e){return arguments.length?(n=e,t):n},t.range=function(e){return arguments.length?(i=Mt(e),t):i},t.bins=function(e){return arguments.length?(s="number"==typeof e?function(t){return us(t,e)}:Mt(e),t):s},t.frequency=function(n){return arguments.length?(e=!!n,t):e},t},$o.layout.pack=function(){function t(t,o){var a=n.call(this,t,o),r=a[0],l=s[0],u=s[1],c=null==e?Math.sqrt:"function"==typeof e?e:function(){return e};if(r.x=r.y=0,Ki(r,function(t){t.r=+c(t.value)}),Ki(r,gs),i){var h=i*(e?1:Math.max(2*r.r/l,2*r.r/u))/2;Ki(r,function(t){t.r+=h}),Ki(r,gs),Ki(r,function(t){t.r-=h})}return bs(r,l/2,u/2,e?1:1/Math.max(2*r.r/l,2*r.r/u)),a}var e,n=$o.layout.hierarchy().sort(hs),i=0,s=[1,1];return t.size=function(e){return arguments.length?(s=e,t):s},t.radius=function(n){return arguments.length?(e=null==n||"function"==typeof n?n:+n,t):e},t.padding=function(e){return arguments.length?(i=+e,t):i},qi(t,n)},$o.layout.tree=function(){function t(t,s){var c=a.call(this,t,s),h=c[0],d=e(h);if(Ki(d,n),d.parent.m=-d.z,Yi(d,i),u)Yi(h,o);else{var p=h,f=h,g=h;Yi(h,function(t){t.x<p.x&&(p=t),t.x>f.x&&(f=t),t.depth>g.depth&&(g=t)});var m=r(p,f)/2-p.x,v=l[0]/(f.x+r(f,p)/2+m),b=l[1]/(g.depth||1);Yi(h,function(t){t.x=(t.x+m)*v,t.y=t.depth*b})}return c}function e(t){for(var e,n={A:null,children:[t]},i=[n];null!=(e=i.pop());)for(var s,o=e.children,a=0,r=o.length;r>a;++a)i.push((o[a]=s={_:o[a],parent:e,children:(s=o[a].children)&&s.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:a}).a=s);return n.children[0]}function n(t){var e=t.children,n=t.parent.children,i=t.i?n[t.i-1]:null;if(e.length){Cs(t);var o=(e[0].z+e[e.length-1].z)/2;i?(t.z=i.z+r(t._,i._),t.m=t.z-o):t.z=o}else i&&(t.z=i.z+r(t._,i._));t.parent.A=s(t,i,t.parent.A||n[0])}function i(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function s(t,e,n){if(e){for(var i,s=t,o=t,a=e,l=s.parent.children[0],u=s.m,c=o.m,h=a.m,d=l.m;a=Ms(a),s=ws(s),a&&s;)l=ws(l),o=Ms(o),o.a=t,i=a.z+h-s.z-u+r(a._,s._),i>0&&(xs(Is(a,t,n),t,i),u+=i,c+=i),h+=a.m,u+=s.m,d+=l.m,c+=o.m;a&&!Ms(o)&&(o.t=a,o.m+=h-c),s&&!ws(l)&&(l.t=s,l.m+=u-d,n=t)}return n}function o(t){t.x*=l[0],t.y=t.depth*l[1]}var a=$o.layout.hierarchy().sort(null).value(null),r=_s,l=[1,1],u=null;return t.separation=function(e){return arguments.length?(r=e,t):r},t.size=function(e){return arguments.length?(u=null==(l=e)?o:null,t):u?null:l},t.nodeSize=function(e){return arguments.length?(u=null==(l=e)?null:o,t):u?l:null},qi(t,a)},$o.layout.cluster=function(){function t(t,o){var a,r=e.call(this,t,o),l=r[0],u=0;Ki(l,function(t){var e=t.children;e&&e.length?(t.x=Es(e),t.y=Ss(e)):(t.x=a?u+=n(t,a):0,t.y=0,a=t)});var c=Ls(l),h=ks(l),d=c.x-n(c,h)/2,p=h.x+n(h,c)/2;return Ki(l,s?function(t){t.x=(t.x-l.x)*i[0],t.y=(l.y-t.y)*i[1]}:function(t){t.x=(t.x-d)/(p-d)*i[0],t.y=(1-(l.y?t.y/l.y:1))*i[1]}),r}var e=$o.layout.hierarchy().sort(null).value(null),n=_s,i=[1,1],s=!1;return t.separation=function(e){return arguments.length?(n=e,t):n},t.size=function(e){return arguments.length?(s=null==(i=e),t):s?null:i},t.nodeSize=function(e){return arguments.length?(s=null!=(i=e),t):s?i:null},qi(t,e)},$o.layout.treemap=function(){function t(t,e){for(var n,i,s=-1,o=t.length;++s<o;)i=(n=t[s]).value*(0>e?0:e),n.area=isNaN(i)||0>=i?0:i}function e(n){var o=n.children;if(o&&o.length){var a,r,l,u=h(n),c=[],d=o.slice(),f=1/0,g="slice"===p?u.dx:"dice"===p?u.dy:"slice-dice"===p?1&n.depth?u.dy:u.dx:Math.min(u.dx,u.dy);for(t(d,u.dx*u.dy/n.value),c.area=0;(l=d.length)>0;)c.push(a=d[l-1]),c.area+=a.area,"squarify"!==p||(r=i(c,g))<=f?(d.pop(),f=r):(c.area-=c.pop().area,s(c,g,u,!1),g=Math.min(u.dx,u.dy),c.length=c.area=0,f=1/0);c.length&&(s(c,g,u,!0),c.length=c.area=0),o.forEach(e)}}function n(e){var i=e.children;if(i&&i.length){var o,a=h(e),r=i.slice(),l=[];for(t(r,a.dx*a.dy/e.value),l.area=0;o=r.pop();)l.push(o),l.area+=o.area,null!=o.z&&(s(l,o.z?a.dx:a.dy,a,!r.length),l.length=l.area=0);i.forEach(n)}}function i(t,e){for(var n,i=t.area,s=0,o=1/0,a=-1,r=t.length;++a<r;)(n=t[a].area)&&(o>n&&(o=n),n>s&&(s=n));return i*=i,e*=e,i?Math.max(e*s*f/i,i/(e*o*f)):1/0}function s(t,e,n,i){var s,o=-1,a=t.length,r=n.x,u=n.y,c=e?l(t.area/e):0;if(e==n.dx){for((i||c>n.dy)&&(c=n.dy);++o<a;)s=t[o],s.x=r,s.y=u,s.dy=c,r+=s.dx=Math.min(n.x+n.dx-r,c?l(s.area/c):0);s.z=!0,s.dx+=n.x+n.dx-r,n.y+=c,n.dy-=c}else{for((i||c>n.dx)&&(c=n.dx);++o<a;)s=t[o],s.x=r,s.y=u,s.dx=c,u+=s.dy=Math.min(n.y+n.dy-u,c?l(s.area/c):0);s.z=!1,s.dy+=n.y+n.dy-u,n.x+=c,n.dx-=c}}function o(i){var s=a||r(i),o=s[0];return o.x=0,o.y=0,o.dx=u[0],o.dy=u[1],a&&r.revalue(o),t([o],o.dx*o.dy/o.value),(a?n:e)(o),d&&(a=s),s}var a,r=$o.layout.hierarchy(),l=Math.round,u=[1,1],c=null,h=Ds,d=!1,p="squarify",f=.5*(1+Math.sqrt(5));return o.size=function(t){return arguments.length?(u=t,o):u},o.padding=function(t){function e(e){var n=t.call(o,e,e.depth);return null==n?Ds(e):Ps(e,"number"==typeof n?[n,n,n,n]:n)}function n(e){return Ps(e,t)}if(!arguments.length)return c;var i;return h=null==(c=t)?Ds:"function"==(i=typeof t)?e:"number"===i?(t=[t,t,t,t],n):n,o},o.round=function(t){return arguments.length?(l=t?Math.round:Number,o):l!=Number},o.sticky=function(t){return arguments.length?(d=t,a=null,o):d},o.ratio=function(t){return arguments.length?(f=t,o):f},o.mode=function(t){return arguments.length?(p=t+"",o):p},qi(o,r)},$o.random={normal:function(t,e){var n=arguments.length;return 2>n&&(e=1),1>n&&(t=0),function(){var n,i,s;do n=2*Math.random()-1,i=2*Math.random()-1,s=n*n+i*i;while(!s||s>1);return t+e*n*Math.sqrt(-2*Math.log(s)/s)}},logNormal:function(){var t=$o.random.normal.apply($o,arguments);return function(){return Math.exp(t())}},bates:function(t){var e=$o.random.irwinHall(t);return function(){return e()/t}},irwinHall:function(t){return function(){for(var e=0,n=0;t>n;n++)e+=Math.random();return e}}},$o.scale={};var cl={floor:xt,ceil:xt};$o.scale.linear=function(){return Fs([0,1],[0,1],pi,!1)};var hl={s:1,g:1,p:1,r:1,e:1};$o.scale.log=function(){return Gs($o.scale.linear().domain([0,1]),10,!0,[1,10])};var dl=$o.format(".0e"),pl={floor:function(t){return-Math.ceil(-t)},ceil:function(t){return-Math.floor(-t)}};$o.scale.pow=function(){return qs($o.scale.linear(),1,[0,1])},$o.scale.sqrt=function(){return $o.scale.pow().exponent(.5)},$o.scale.ordinal=function(){return Ks([],{t:"range",a:[[]]})},$o.scale.category10=function(){return $o.scale.ordinal().range(fl)},$o.scale.category20=function(){return $o.scale.ordinal().range(gl)},$o.scale.category20b=function(){return $o.scale.ordinal().range(ml)},$o.scale.category20c=function(){return $o.scale.ordinal().range(vl)};var fl=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(gt),gl=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(gt),ml=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(gt),vl=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(gt);$o.scale.quantile=function(){return Xs([],[])},$o.scale.quantize=function(){return Zs(0,1,[0,1])},$o.scale.threshold=function(){return Qs([.5],[0,1])},$o.scale.identity=function(){return Js([0,1])},$o.svg={},$o.svg.arc=function(){function t(){var t=e.apply(this,arguments),o=n.apply(this,arguments),a=i.apply(this,arguments)+bl,r=s.apply(this,arguments)+bl,l=(a>r&&(l=a,a=r,r=l),r-a),u=xa>l?"0":"1",c=Math.cos(a),h=Math.sin(a),d=Math.cos(r),p=Math.sin(r);return l>=yl?t?"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+-o+"A"+o+","+o+" 0 1,1 0,"+o+"M0,"+t+"A"+t+","+t+" 0 1,0 0,"+-t+"A"+t+","+t+" 0 1,0 0,"+t+"Z":"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+-o+"A"+o+","+o+" 0 1,1 0,"+o+"Z":t?"M"+o*c+","+o*h+"A"+o+","+o+" 0 "+u+",1 "+o*d+","+o*p+"L"+t*d+","+t*p+"A"+t+","+t+" 0 "+u+",0 "+t*c+","+t*h+"Z":"M"+o*c+","+o*h+"A"+o+","+o+" 0 "+u+",1 "+o*d+","+o*p+"L0,0Z"}var e=to,n=eo,i=no,s=io;return t.innerRadius=function(n){return arguments.length?(e=Mt(n),t):e},t.outerRadius=function(e){return arguments.length?(n=Mt(e),t):n},t.startAngle=function(e){return arguments.length?(i=Mt(e),t):i},t.endAngle=function(e){return arguments.length?(s=Mt(e),t):s},t.centroid=function(){var t=(e.apply(this,arguments)+n.apply(this,arguments))/2,o=(i.apply(this,arguments)+s.apply(this,arguments))/2+bl;return[Math.cos(o)*t,Math.sin(o)*t]},t};var bl=-Ia,yl=Ca-Sa;$o.svg.line=function(){return so(xt)};var _l=$o.map({linear:oo,"linear-closed":ao,step:ro,"step-before":lo,"step-after":uo,basis:mo,"basis-open":vo,"basis-closed":bo,bundle:yo,cardinal:po,"cardinal-open":co,"cardinal-closed":ho,monotone:Io});_l.forEach(function(t,e){e.key=t,e.closed=/-closed$/.test(t)});var wl=[0,2/3,1/3,0],Ml=[0,1/3,2/3,0],xl=[0,1/6,2/3,1/6];$o.svg.line.radial=function(){var t=so(So);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},lo.reverse=uo,uo.reverse=lo,$o.svg.area=function(){return Eo(xt)},$o.svg.area.radial=function(){var t=Eo(So);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},$o.svg.chord=function(){function t(t,r){var l=e(this,o,t,r),u=e(this,a,t,r);return"M"+l.p0+i(l.r,l.p1,l.a1-l.a0)+(n(l,u)?s(l.r,l.p1,l.r,l.p0):s(l.r,l.p1,u.r,u.p0)+i(u.r,u.p1,u.a1-u.a0)+s(u.r,u.p1,l.r,l.p0))+"Z"}function e(t,e,n,i){var s=e.call(t,n,i),o=r.call(t,s,i),a=l.call(t,s,i)+bl,c=u.call(t,s,i)+bl;return{r:o,a0:a,a1:c,p0:[o*Math.cos(a),o*Math.sin(a)],p1:[o*Math.cos(c),o*Math.sin(c)]}}function n(t,e){return t.a0==e.a0&&t.a1==e.a1}function i(t,e,n){return"A"+t+","+t+" 0 "+ +(n>xa)+",1 "+e}function s(t,e,n,i){return"Q 0,0 "+i}var o=fn,a=gn,r=Lo,l=no,u=io;return t.radius=function(e){return arguments.length?(r=Mt(e),t):r},t.source=function(e){return arguments.length?(o=Mt(e),t):o},t.target=function(e){return arguments.length?(a=Mt(e),t):a},t.startAngle=function(e){return arguments.length?(l=Mt(e),t):l},t.endAngle=function(e){return arguments.length?(u=Mt(e),t):u},t},$o.svg.diagonal=function(){function t(t,s){var o=e.call(this,t,s),a=n.call(this,t,s),r=(o.y+a.y)/2,l=[o,{x:o.x,y:r},{x:a.x,y:r},a];return l=l.map(i),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var e=fn,n=gn,i=ko;return t.source=function(n){return arguments.length?(e=Mt(n),t):e},t.target=function(e){return arguments.length?(n=Mt(e),t):n},t.projection=function(e){return arguments.length?(i=e,t):i},t},$o.svg.diagonal.radial=function(){var t=$o.svg.diagonal(),e=ko,n=t.projection;return t.projection=function(t){return arguments.length?n(Do(e=t)):e},t},$o.svg.symbol=function(){function t(t,i){return(Cl.get(e.call(this,t,i))||No)(n.call(this,t,i))}var e=To,n=Po;return t.type=function(n){return arguments.length?(e=Mt(n),t):e},t.size=function(e){return arguments.length?(n=Mt(e),t):n},t};var Cl=$o.map({circle:No,cross:function(t){var e=Math.sqrt(t/5)/2;return"M"+-3*e+","+-e+"H"+-e+"V"+-3*e+"H"+e+"V"+-e+"H"+3*e+"V"+e+"H"+e+"V"+3*e+"H"+-e+"V"+e+"H"+-3*e+"Z"},diamond:function(t){var e=Math.sqrt(t/(2*Ll)),n=e*Ll;return"M0,"+-e+"L"+n+",0 0,"+e+" "+-n+",0Z"},square:function(t){var e=Math.sqrt(t)/2;return"M"+-e+","+-e+"L"+e+","+-e+" "+e+","+e+" "+-e+","+e+"Z"},"triangle-down":function(t){var e=Math.sqrt(t/El),n=e*El/2;return"M0,"+n+"L"+e+","+-n+" "+-e+","+-n+"Z"},"triangle-up":function(t){var e=Math.sqrt(t/El),n=e*El/2;return"M0,"+-n+"L"+e+","+n+" "+-e+","+n+"Z"}});$o.svg.symbolTypes=Cl.keys();var Il,Sl,El=Math.sqrt(3),Ll=Math.tan(30*La),kl=[],Dl=0;kl.call=ga.call,kl.empty=ga.empty,kl.node=ga.node,kl.size=ga.size,$o.transition=function(t){return arguments.length?Il?t.transition():t:ba.transition()},$o.transition.prototype=kl,kl.select=function(t){var e,n,i,s=this.id,o=[];t=M(t);for(var a=-1,r=this.length;++a<r;){o.push(e=[]);for(var l=this[a],u=-1,c=l.length;++u<c;)(i=l[u])&&(n=t.call(i,i.__data__,u,a))?("__data__"in i&&(n.__data__=i.__data__),Ro(n,u,s,i.__transition__[s]),e.push(n)):e.push(null)}return Ao(o,s)},kl.selectAll=function(t){var e,n,i,s,o,a=this.id,r=[];t=x(t);for(var l=-1,u=this.length;++l<u;)for(var c=this[l],h=-1,d=c.length;++h<d;)if(i=c[h]){o=i.__transition__[a],n=t.call(i,i.__data__,h,l),r.push(e=[]);for(var p=-1,f=n.length;++p<f;)(s=n[p])&&Ro(s,p,a,o),e.push(s)}return Ao(r,a)},kl.filter=function(t){var e,n,i,s=[];"function"!=typeof t&&(t=A(t));for(var o=0,a=this.length;a>o;o++){s.push(e=[]);for(var n=this[o],r=0,l=n.length;l>r;r++)(i=n[r])&&t.call(i,i.__data__,r,o)&&e.push(i)}return Ao(s,this.id)},kl.tween=function(t,e){var n=this.id;return arguments.length<2?this.node().__transition__[n].tween.get(t):V(this,null==e?function(e){e.__transition__[n].tween.remove(t)}:function(i){i.__transition__[n].tween.set(t,e)})},kl.attr=function(t,e){function n(){this.removeAttribute(r)}function i(){this.removeAttributeNS(r.space,r.local)}function s(t){return null==t?n:(t+="",function(){var e,n=this.getAttribute(r);return n!==t&&(e=a(n,t),function(t){this.setAttribute(r,e(t))})})}function o(t){return null==t?i:(t+="",function(){var e,n=this.getAttributeNS(r.space,r.local);return n!==t&&(e=a(n,t),function(t){this.setAttributeNS(r.space,r.local,e(t))})})}if(arguments.length<2){for(e in t)this.attr(e,t[e]);return this}var a="transform"==t?Vi:pi,r=$o.ns.qualify(t);return Oo(this,"attr."+t,e,r.local?o:s)},kl.attrTween=function(t,e){function n(t,n){var i=e.call(this,t,n,this.getAttribute(s));return i&&function(t){this.setAttribute(s,i(t))}}function i(t,n){var i=e.call(this,t,n,this.getAttributeNS(s.space,s.local));return i&&function(t){this.setAttributeNS(s.space,s.local,i(t))}}var s=$o.ns.qualify(t);return this.tween("attr."+t,s.local?i:n)},kl.style=function(t,e,n){function i(){this.style.removeProperty(t)}function s(e){return null==e?i:(e+="",function(){var i,s=Xo.getComputedStyle(this,null).getPropertyValue(t);return s!==e&&(i=pi(s,e),function(e){this.style.setProperty(t,i(e),n)})})}var o=arguments.length;if(3>o){if("string"!=typeof t){2>o&&(e="");for(n in t)this.style(n,t[n],e);return this}n=""}return Oo(this,"style."+t,e,s)},kl.styleTween=function(t,e,n){function i(i,s){var o=e.call(this,i,s,Xo.getComputedStyle(this,null).getPropertyValue(t));return o&&function(e){this.style.setProperty(t,o(e),n)}}return arguments.length<3&&(n=""),this.tween("style."+t,i)},kl.text=function(t){return Oo(this,"text",t,Vo)},kl.remove=function(){return this.each("end.transition",function(){var t;this.__transition__.count<2&&(t=this.parentNode)&&t.removeChild(this)})},kl.ease=function(t){var e=this.id;return arguments.length<1?this.node().__transition__[e].ease:("function"!=typeof t&&(t=$o.ease.apply($o,arguments)),V(this,function(n){n.__transition__[e].ease=t}))},kl.delay=function(t){var e=this.id;return arguments.length<1?this.node().__transition__[e].delay:V(this,"function"==typeof t?function(n,i,s){n.__transition__[e].delay=+t.call(n,n.__data__,i,s)}:(t=+t,function(n){n.__transition__[e].delay=t}))},kl.duration=function(t){var e=this.id;return arguments.length<1?this.node().__transition__[e].duration:V(this,"function"==typeof t?function(n,i,s){n.__transition__[e].duration=Math.max(1,t.call(n,n.__data__,i,s))}:(t=Math.max(1,t),function(n){n.__transition__[e].duration=t}))},kl.each=function(t,e){var n=this.id;if(arguments.length<2){var i=Sl,s=Il;Il=n,V(this,function(e,i,s){Sl=e.__transition__[n],t.call(e,e.__data__,i,s)}),Sl=i,Il=s}else V(this,function(i){var s=i.__transition__[n];(s.event||(s.event=$o.dispatch("start","end"))).on(t,e)});return this},kl.transition=function(){for(var t,e,n,i,s=this.id,o=++Dl,a=[],r=0,l=this.length;l>r;r++){a.push(t=[]);for(var e=this[r],u=0,c=e.length;c>u;u++)(n=e[u])&&(i=Object.create(n.__transition__[s]),i.delay+=i.duration,Ro(n,u,o,i)),t.push(n)}return Ao(a,o)},$o.svg.axis=function(){function t(t){t.each(function(){var t,u=$o.select(this),c=this.__chart__||n,h=this.__chart__=n.copy(),d=null==l?h.ticks?h.ticks.apply(h,r):h.domain():l,p=null==e?h.tickFormat?h.tickFormat.apply(h,r):xt:e,f=u.selectAll(".tick").data(d,h),g=f.enter().insert("g",".domain").attr("class","tick").style("opacity",Sa),m=$o.transition(f.exit()).style("opacity",Sa).remove(),v=$o.transition(f.order()).style("opacity",1),b=Ns(h),y=u.selectAll(".domain").data([0]),_=(y.enter().append("path").attr("class","domain"),$o.transition(y));g.append("line"),g.append("text");var w=g.select("line"),M=v.select("line"),x=f.select("text").text(p),C=g.select("text"),I=v.select("text");switch(i){case"bottom":t=Fo,w.attr("y2",s),C.attr("y",Math.max(s,0)+a),M.attr("x2",0).attr("y2",s),I.attr("x",0).attr("y",Math.max(s,0)+a),x.attr("dy",".71em").style("text-anchor","middle"),_.attr("d","M"+b[0]+","+o+"V0H"+b[1]+"V"+o);break;case"top":t=Fo,w.attr("y2",-s),C.attr("y",-(Math.max(s,0)+a)),M.attr("x2",0).attr("y2",-s),I.attr("x",0).attr("y",-(Math.max(s,0)+a)),x.attr("dy","0em").style("text-anchor","middle"),_.attr("d","M"+b[0]+","+-o+"V0H"+b[1]+"V"+-o);break;case"left":t=jo,w.attr("x2",-s),C.attr("x",-(Math.max(s,0)+a)),M.attr("x2",-s).attr("y2",0),I.attr("x",-(Math.max(s,0)+a)).attr("y",0),x.attr("dy",".32em").style("text-anchor","end"),_.attr("d","M"+-o+","+b[0]+"H0V"+b[1]+"H"+-o);break;case"right":t=jo,w.attr("x2",s),C.attr("x",Math.max(s,0)+a),M.attr("x2",s).attr("y2",0),I.attr("x",Math.max(s,0)+a).attr("y",0),x.attr("dy",".32em").style("text-anchor","start"),_.attr("d","M"+o+","+b[0]+"H0V"+b[1]+"H"+o)}if(h.rangeBand){var S=h,E=S.rangeBand()/2;c=h=function(t){return S(t)+E}}else c.rangeBand?c=h:m.call(t,h);g.call(t,c),v.call(t,h)})}var e,n=$o.scale.linear(),i=Pl,s=6,o=6,a=3,r=[10],l=null;return t.scale=function(e){return arguments.length?(n=e,t):n},t.orient=function(e){return arguments.length?(i=e in Tl?e+"":Pl,t):i},t.ticks=function(){return arguments.length?(r=arguments,t):r},t.tickValues=function(e){return arguments.length?(l=e,t):l},t.tickFormat=function(n){return arguments.length?(e=n,t):e},t.tickSize=function(e){var n=arguments.length;return n?(s=+e,o=+arguments[n-1],t):s},t.innerTickSize=function(e){return arguments.length?(s=+e,t):s},t.outerTickSize=function(e){return arguments.length?(o=+e,t):o},t.tickPadding=function(e){return arguments.length?(a=+e,t):a},t.tickSubdivide=function(){return arguments.length&&t},t};var Pl="bottom",Tl={top:1,right:1,bottom:1,left:1};$o.svg.brush=function(){function t(o){o.each(function(){var o=$o.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",s).on("touchstart.brush",s),a=o.selectAll(".background").data([0]);a.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),o.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var r=o.selectAll(".resize").data(f,xt);r.exit().remove(),r.enter().append("g").attr("class",function(t){return"resize "+t}).style("cursor",function(t){return Nl[t]}).append("rect").attr("x",function(t){return/[ew]$/.test(t)?-3:null}).attr("y",function(t){return/^[ns]/.test(t)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),r.style("display",t.empty()?"none":null);var c,h=$o.transition(o),d=$o.transition(a);l&&(c=Ns(l),d.attr("x",c[0]).attr("width",c[1]-c[0]),n(h)),u&&(c=Ns(u),d.attr("y",c[0]).attr("height",c[1]-c[0]),i(h)),e(h)})}function e(t){t.selectAll(".resize").attr("transform",function(t){return"translate("+c[+/e$/.test(t)]+","+h[+/^s/.test(t)]+")"})}function n(t){t.select(".extent").attr("x",c[0]),t.selectAll(".extent,.n>rect,.s>rect").attr("width",c[1]-c[0])}function i(t){t.select(".extent").attr("y",h[0]),t.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function s(){function s(){32==$o.event.keyCode&&(L||(y=null,D[0]-=c[1],D[1]-=h[1],L=2),b())}function f(){32==$o.event.keyCode&&2==L&&(D[0]+=c[1],D[1]+=h[1],L=0,b())}function g(){var t=$o.mouse(w),s=!1;_&&(t[0]+=_[0],t[1]+=_[1]),L||($o.event.altKey?(y||(y=[(c[0]+c[1])/2,(h[0]+h[1])/2]),D[0]=c[+(t[0]<y[0])],D[1]=h[+(t[1]<y[1])]):y=null),S&&m(t,l,0)&&(n(C),s=!0),E&&m(t,u,1)&&(i(C),s=!0),s&&(e(C),x({type:"brush",mode:L?"move":"resize"}))}function m(t,e,n){var i,s,r=Ns(e),l=r[0],u=r[1],f=D[n],g=n?h:c,m=g[1]-g[0];return L&&(l-=f,u-=m+f),i=(n?p:d)?Math.max(l,Math.min(u,t[n])):t[n],L?s=(i+=f)+m:(y&&(f=Math.max(l,Math.min(u,2*y[n]-i))),i>f?(s=i,i=f):s=f),g[0]!=i||g[1]!=s?(n?a=null:o=null,g[0]=i,g[1]=s,!0):void 0}function v(){g(),C.style("pointer-events","all").selectAll(".resize").style("display",t.empty()?"none":null),$o.select("body").style("cursor",null),P.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),k(),x({type:"brushend"})}var y,_,w=this,M=$o.select($o.event.target),x=r.of(w,arguments),C=$o.select(w),I=M.datum(),S=!/^(n|s)$/.test(I)&&l,E=!/^(e|w)$/.test(I)&&u,L=M.classed("extent"),k=H(),D=$o.mouse(w),P=$o.select(Xo).on("keydown.brush",s).on("keyup.brush",f);if($o.event.changedTouches?P.on("touchmove.brush",g).on("touchend.brush",v):P.on("mousemove.brush",g).on("mouseup.brush",v),C.interrupt().selectAll("*").interrupt(),L)D[0]=c[0]-D[0],D[1]=h[0]-D[1];else if(I){var T=+/w$/.test(I),N=+/^n/.test(I);_=[c[1-T]-D[0],h[1-N]-D[1]],D[0]=c[T],D[1]=h[N]}else $o.event.altKey&&(y=D.slice());C.style("pointer-events","none").selectAll(".resize").style("display",null),$o.select("body").style("cursor",M.style("cursor")),x({type:"brushstart"}),g()}var o,a,r=_(t,"brushstart","brush","brushend"),l=null,u=null,c=[0,0],h=[0,0],d=!0,p=!0,f=Al[0];return t.event=function(t){t.each(function(){var t=r.of(this,arguments),e={x:c,y:h,i:o,j:a},n=this.__chart__||e;this.__chart__=e,Il?$o.select(this).transition().each("start.brush",function(){o=n.i,a=n.j,c=n.x,h=n.y,t({type:"brushstart"})}).tween("brush:brush",function(){var n=fi(c,e.x),i=fi(h,e.y);return o=a=null,function(s){c=e.x=n(s),h=e.y=i(s),t({type:"brush",mode:"resize"})}}).each("end.brush",function(){o=e.i,a=e.j,t({type:"brush",mode:"resize"}),t({type:"brushend"})}):(t({type:"brushstart"}),t({type:"brush",mode:"resize"}),t({type:"brushend"}))})},t.x=function(e){return arguments.length?(l=e,f=Al[!l<<1|!u],t):l},t.y=function(e){return arguments.length?(u=e,f=Al[!l<<1|!u],t):u},t.clamp=function(e){return arguments.length?(l&&u?(d=!!e[0],p=!!e[1]):l?d=!!e:u&&(p=!!e),t):l&&u?[d,p]:l?d:u?p:null},t.extent=function(e){var n,i,s,r,d;return arguments.length?(l&&(n=e[0],i=e[1],u&&(n=n[0],i=i[0]),o=[n,i],l.invert&&(n=l(n),i=l(i)),n>i&&(d=n,n=i,i=d),(n!=c[0]||i!=c[1])&&(c=[n,i])),u&&(s=e[0],r=e[1],l&&(s=s[1],r=r[1]),a=[s,r],u.invert&&(s=u(s),r=u(r)),s>r&&(d=s,s=r,r=d),(s!=h[0]||r!=h[1])&&(h=[s,r])),t):(l&&(o?(n=o[0],i=o[1]):(n=c[0],i=c[1],l.invert&&(n=l.invert(n),i=l.invert(i)),n>i&&(d=n,n=i,i=d))),u&&(a?(s=a[0],r=a[1]):(s=h[0],r=h[1],u.invert&&(s=u.invert(s),r=u.invert(r)),s>r&&(d=s,s=r,r=d))),l&&u?[[n,s],[i,r]]:l?[n,i]:u&&[s,r])},t.clear=function(){return t.empty()||(c=[0,0],h=[0,0],o=a=null),t},t.empty=function(){return!!l&&c[0]==c[1]||!!u&&h[0]==h[1]},$o.rebind(t,r,"on")};var Nl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Al=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Ol=tr.format=ar.timeFormat,Vl=Ol.utc,Rl=Vl("%Y-%m-%dT%H:%M:%S.%LZ");Ol.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?zo:Rl,zo.parse=function(t){var e=new Date(t);return isNaN(e)?null:e},zo.toString=Rl.toString,tr.second=Ot(function(t){return new er(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(t.getTime()+1e3*Math.floor(e))},function(t){return t.getSeconds()}),tr.seconds=tr.second.range,tr.seconds.utc=tr.second.utc.range,tr.minute=Ot(function(t){return new er(6e4*Math.floor(t/6e4))},function(t,e){t.setTime(t.getTime()+6e4*Math.floor(e))},function(t){return t.getMinutes()}),tr.minutes=tr.minute.range,tr.minutes.utc=tr.minute.utc.range,tr.hour=Ot(function(t){var e=t.getTimezoneOffset()/60;return new er(36e5*(Math.floor(t/36e5-e)+e))},function(t,e){t.setTime(t.getTime()+36e5*Math.floor(e))},function(t){return t.getHours()}),tr.hours=tr.hour.range,tr.hours.utc=tr.hour.utc.range,tr.month=Ot(function(t){return t=tr.day(t),t.setDate(1),t},function(t,e){t.setMonth(t.getMonth()+e)},function(t){return t.getMonth()}),tr.months=tr.month.range,tr.months.utc=tr.month.utc.range;var Fl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],jl=[[tr.second,1],[tr.second,5],[tr.second,15],[tr.second,30],[tr.minute,1],[tr.minute,5],[tr.minute,15],[tr.minute,30],[tr.hour,1],[tr.hour,3],[tr.hour,6],[tr.hour,12],[tr.day,1],[tr.day,2],[tr.week,1],[tr.month,1],[tr.month,3],[tr.year,1]],zl=Ol.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%I:%M",function(t){return t.getMinutes()}],["%I %p",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",xe]]),Bl={range:function(t,e,n){return $o.range(Math.ceil(t/n)*n,+e,n).map(Wo)},floor:xt,ceil:xt};jl.year=tr.year,tr.scale=function(){return Bo($o.scale.linear(),jl,zl)};var Wl=jl.map(function(t){return[t[0].utc,t[1]]}),Hl=Vl.multi([[".%L",function(t){return t.getUTCMilliseconds()}],[":%S",function(t){return t.getUTCSeconds()}],["%I:%M",function(t){return t.getUTCMinutes()}],["%I %p",function(t){return t.getUTCHours()}],["%a %d",function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],["%b %d",function(t){return 1!=t.getUTCDate()}],["%B",function(t){return t.getUTCMonth()}],["%Y",xe]]);Wl.year=tr.year.utc,tr.scale.utc=function(){return Bo($o.scale.linear(),Wl,Hl)},$o.text=Ct(function(t){return t.responseText}),$o.json=function(t,e){return It(t,"application/json",Ho,e)},$o.html=function(t,e){return It(t,"text/html",Uo,e)},$o.xml=Ct(function(t){return t.responseXML}),"function"==typeof define&&define.amd?define($o):"object"==typeof module&&module.exports&&(module.exports=$o),this.d3=$o}(),function(t){function e(t){var e=t.__resizeTriggers__,n=e.firstElementChild,i=e.lastElementChild,s=n.firstElementChild;i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight,s.style.width=n.offsetWidth+1+"px",s.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight}function n(t){return t.offsetWidth!=t.__resizeLast__.width||t.offsetHeight!=t.__resizeLast__.height}function i(t){var i=this;e(this),this.__resizeRAF__&&u(this.__resizeRAF__),this.__resizeRAF__=l(function(){n(i)&&(i.__resizeLast__.width=i.offsetWidth,i.__resizeLast__.height=i.offsetHeight,i.__resizeListeners__.forEach(function(e){e.call(i,t)}))})}function s(){if(!a){var t=(_?_:"")+".resize-triggers { "+(w?w:"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t)),e.appendChild(n),a=!0}}var o=document.attachEvent,a=!1,r=t.fn.resize;if(t.fn.resize=function(t){return this.each(function(){this==window?r.call(jQuery(this),t):addResizeListener(this,t);
})},t.fn.removeResize=function(t){return this.each(function(){removeResizeListener(this,t)})},!o){var l=function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){return window.setTimeout(t,20)};return function(e){return t(e)}}(),u=function(){var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(e){return t(e)}}(),c=!1,h="animation",d="",p="animationstart",f="Webkit Moz O ms".split(" "),g="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),m="",v=document.createElement("fakeelement");if(void 0!==v.style.animationName&&(c=!0),c===!1)for(var b=0;b<f.length;b++)if(void 0!==v.style[f[b]+"AnimationName"]){m=f[b],h=m+"Animation",d="-"+m.toLowerCase()+"-",p=g[b],c=!0;break}var y="resizeanim",_="@"+d+"keyframes "+y+" { from { opacity: 0; } to { opacity: 0; } } ",w=d+"animation: 1ms "+y+"; "}window.addResizeListener=function(t,n){o?t.attachEvent("onresize",n):(t.__resizeTriggers__||("static"==getComputedStyle(t).position&&(t.style.position="relative"),s(),t.__resizeLast__={},t.__resizeListeners__=[],(t.__resizeTriggers__=document.createElement("div")).className="resize-triggers",t.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',t.appendChild(t.__resizeTriggers__),e(t),t.addEventListener("scroll",i,!0),p&&t.__resizeTriggers__.addEventListener(p,function(n){n.animationName==y&&e(t)})),t.__resizeListeners__.push(n))},window.removeResizeListener=function(t,e){o?t.detachEvent("onresize",e):(t.__resizeListeners__.splice(t.__resizeListeners__.indexOf(e),1),t.__resizeListeners__.length||(t.removeEventListener("scroll",i),t.__resizeTriggers__=!t.removeChild(t.__resizeTriggers__)))}}(jQuery),!function(t,e){"function"==typeof define&&define.amd?define(["jquery"],function(n){return e(t,n)}):"object"==typeof exports?e(t,require("jquery")):e(t,t.jQuery)}("undefined"!=typeof window?window:this,function(t,e){"use strict";function n(t,e){for(var n=t.length;--n;)if(+t[n]!==+e[n])return!1;return!0}function i(t){var n={range:!0,animate:!0};return"boolean"==typeof t?n.animate=t:e.extend(n,t),n}function s(t,n,i,s,o,a,r,l,u){this.elements="array"===e.type(t)?[+t[0],+t[2],+t[4],+t[1],+t[3],+t[5],0,0,1]:[t,n,i,s,o,a,r||0,l||0,u||1]}function o(t,e,n){this.elements=[t,e,n]}function a(t,n){if(!(this instanceof a))return new a(t,n);1!==t.nodeType&&e.error("Panzoom called on non-Element node"),e.contains(h,t)||e.error("Panzoom element must be attached to the document");var i=e.data(t,d);if(i)return i;this.options=n=e.extend({},a.defaults,n),this.elem=t;var s=this.$elem=e(t);this.$set=n.$set&&n.$set.length?n.$set:s,this.$doc=e(t.ownerDocument||h),this.$parent=s.parent(),this.isSVG=v.test(t.namespaceURI)&&"svg"!==t.nodeName.toLowerCase(),this.panning=!1,this._buildTransform(),this._transform=!this.isSVG&&e.cssProps.transform.replace(m,"-$1").toLowerCase(),this._buildTransition(),this.resetDimensions();var o=e(),r=this;e.each(["$zoomIn","$zoomOut","$zoomRange","$reset"],function(t,e){r[e]=n[e]||o}),this.enable(),e.data(t,d,this)}var r="over out down up move enter leave cancel".split(" "),l=e.extend({},e.event.mouseHooks),u={};if(t.PointerEvent)e.each(r,function(t,n){e.event.fixHooks[u[n]="pointer"+n]=l});else{var c=l.props;l.props=c.concat(["touches","changedTouches","targetTouches","altKey","ctrlKey","metaKey","shiftKey"]),l.filter=function(t,e){var n,i=c.length;if(!e.pageX&&e.touches&&(n=e.touches[0]))for(;i--;)t[c[i]]=n[c[i]];return t},e.each(r,function(t,n){if(2>t)u[n]="mouse"+n;else{var i="touch"+("down"===n?"start":"up"===n?"end":n);e.event.fixHooks[i]=l,u[n]=i+" mouse"+n}})}e.pointertouch=u;var h=t.document,d="__pz__",p=Array.prototype.slice,f=!!t.PointerEvent,g=function(){var t=h.createElement("input");return t.setAttribute("oninput","return"),"function"==typeof t.oninput}(),m=/([A-Z])/g,v=/^http:[\w\.\/]+svg$/,b=/^inline/,y="(\\-?[\\d\\.e]+)",_="\\,?\\s*",w=new RegExp("^matrix\\("+y+_+y+_+y+_+y+_+y+_+y+"\\)$");return s.prototype={x:function(t){var e=t instanceof o,n=this.elements,i=t.elements;return e&&3===i.length?new o(n[0]*i[0]+n[1]*i[1]+n[2]*i[2],n[3]*i[0]+n[4]*i[1]+n[5]*i[2],n[6]*i[0]+n[7]*i[1]+n[8]*i[2]):i.length===n.length?new s(n[0]*i[0]+n[1]*i[3]+n[2]*i[6],n[0]*i[1]+n[1]*i[4]+n[2]*i[7],n[0]*i[2]+n[1]*i[5]+n[2]*i[8],n[3]*i[0]+n[4]*i[3]+n[5]*i[6],n[3]*i[1]+n[4]*i[4]+n[5]*i[7],n[3]*i[2]+n[4]*i[5]+n[5]*i[8],n[6]*i[0]+n[7]*i[3]+n[8]*i[6],n[6]*i[1]+n[7]*i[4]+n[8]*i[7],n[6]*i[2]+n[7]*i[5]+n[8]*i[8]):!1},inverse:function(){var t=1/this.determinant(),e=this.elements;return new s(t*(e[8]*e[4]-e[7]*e[5]),t*-(e[8]*e[1]-e[7]*e[2]),t*(e[5]*e[1]-e[4]*e[2]),t*-(e[8]*e[3]-e[6]*e[5]),t*(e[8]*e[0]-e[6]*e[2]),t*-(e[5]*e[0]-e[3]*e[2]),t*(e[7]*e[3]-e[6]*e[4]),t*-(e[7]*e[0]-e[6]*e[1]),t*(e[4]*e[0]-e[3]*e[1]))},determinant:function(){var t=this.elements;return t[0]*(t[8]*t[4]-t[7]*t[5])-t[3]*(t[8]*t[1]-t[7]*t[2])+t[6]*(t[5]*t[1]-t[4]*t[2])}},o.prototype.e=s.prototype.e=function(t){return this.elements[t]},a.rmatrix=w,a.events=e.pointertouch,a.defaults={eventNamespace:".panzoom",transition:!0,cursor:"move",disablePan:!1,disableZoom:!1,increment:.3,minScale:.4,maxScale:5,rangeStep:.05,duration:200,easing:"ease-in-out",contain:!1},a.prototype={constructor:a,instance:function(){return this},enable:function(){this._initStyle(),this._bind(),this.disabled=!1},disable:function(){this.disabled=!0,this._resetStyle(),this._unbind()},isDisabled:function(){return this.disabled},destroy:function(){this.disable(),e.removeData(this.elem,d)},resetDimensions:function(){var t=this.$parent;this.container={width:t.innerWidth(),height:t.innerHeight()};var n,i=t.offset(),s=this.elem,o=this.$elem;this.isSVG?(n=s.getBoundingClientRect(),n={left:n.left-i.left,top:n.top-i.top,width:n.width,height:n.height,margin:{left:0,top:0}}):n={left:e.css(s,"left",!0)||0,top:e.css(s,"top",!0)||0,width:o.innerWidth(),height:o.innerHeight(),margin:{top:e.css(s,"marginTop",!0)||0,left:e.css(s,"marginLeft",!0)||0}},n.widthBorder=e.css(s,"borderLeftWidth",!0)+e.css(s,"borderRightWidth",!0)||0,n.heightBorder=e.css(s,"borderTopWidth",!0)+e.css(s,"borderBottomWidth",!0)||0,this.dimensions=n},reset:function(t){t=i(t);var e=this.setMatrix(this._origTransform,t);t.silent||this._trigger("reset",e)},resetZoom:function(t){t=i(t);var e=this.getMatrix(this._origTransform);t.dValue=e[3],this.zoom(e[0],t)},resetPan:function(t){var e=this.getMatrix(this._origTransform);this.pan(e[4],e[5],i(t))},setTransform:function(t){for(var n=this.isSVG?"attr":"style",i=this.$set,s=i.length;s--;)e[n](i[s],"transform",t)},getTransform:function(t){var n=this.$set,i=n[0];return t?this.setTransform(t):t=e[this.isSVG?"attr":"style"](i,"transform"),"none"===t||w.test(t)||this.setTransform(t=e.css(i,"transform")),t||"none"},getMatrix:function(t){var e=w.exec(t||this.getTransform());return e&&e.shift(),e||[1,0,0,1,0,0]},setMatrix:function(t,n){if(!this.disabled){n||(n={}),"string"==typeof t&&(t=this.getMatrix(t));var i,s,o,a,r,l,u,c,h,d,p=+t[0],f=this.$parent,g="undefined"!=typeof n.contain?n.contain:this.options.contain;return g&&(i=this._checkDims(),s=this.container,h=i.width+i.widthBorder,d=i.height+i.heightBorder,o=(h*Math.abs(p)-s.width)/2,a=(d*Math.abs(p)-s.height)/2,u=i.left+i.margin.left,c=i.top+i.margin.top,"invert"===g?(r=h>s.width?h-s.width:0,l=d>s.height?d-s.height:0,o+=(s.width-h)/2,a+=(s.height-d)/2,t[4]=Math.max(Math.min(t[4],o-u),-o-u-r),t[5]=Math.max(Math.min(t[5],a-c),-a-c-l+i.heightBorder)):(a+=i.heightBorder/2,r=s.width>h?s.width-h:0,l=s.height>d?s.height-d:0,"center"===f.css("textAlign")&&b.test(e.css(this.elem,"display"))?r=0:o=a=0,t[4]=Math.min(Math.max(t[4],o-u),-o-u+r),t[5]=Math.min(Math.max(t[5],a-c),-a-c+l))),"skip"!==n.animate&&this.transition(!n.animate),n.range&&this.$zoomRange.val(p),this.setTransform("matrix("+t.join(",")+")"),n.silent||this._trigger("change",t),t}},isPanning:function(){return this.panning},transition:function(t){if(this._transition)for(var n=t||!this.options.transition?"none":this._transition,i=this.$set,s=i.length;s--;)e.style(i[s],"transition")!==n&&e.style(i[s],"transition",n)},pan:function(t,e,n){if(!this.options.disablePan){n||(n={});var i=n.matrix;i||(i=this.getMatrix()),n.relative&&(t+=+i[4],e+=+i[5]),i[4]=t,i[5]=e,this.setMatrix(i,n),n.silent||this._trigger("pan",i[4],i[5])}},zoom:function(t,n){"object"==typeof t?(n=t,t=null):n||(n={});var i=e.extend({},this.options,n);if(!i.disableZoom){var a=!1,r=i.matrix||this.getMatrix();"number"!=typeof t&&(t=+r[0]+i.increment*(t?-1:1),a=!0),t>i.maxScale?t=i.maxScale:t<i.minScale&&(t=i.minScale);var l=i.focal;if(l&&!i.disablePan){var u=this._checkDims(),c=l.clientX,h=l.clientY;this.isSVG||(c-=(u.width+u.widthBorder)/2,h-=(u.height+u.heightBorder)/2);var d=new o(c,h,1),p=new s(r),f=this.parentOffset||this.$parent.offset(),g=new s(1,0,f.left-this.$doc.scrollLeft(),0,1,f.top-this.$doc.scrollTop()),m=p.inverse().x(g.inverse().x(d)),v=t/r[0];p=p.x(new s([v,0,0,v,0,0])),d=g.x(p.x(m)),r[4]=+r[4]+(c-d.e(0)),r[5]=+r[5]+(h-d.e(1))}r[0]=t,r[3]="number"==typeof i.dValue?i.dValue:t,this.setMatrix(r,{animate:"boolean"==typeof i.animate?i.animate:a,range:!i.noSetRange}),i.silent||this._trigger("zoom",r[0],i)}},option:function(t,n){var i;if(!t)return e.extend({},this.options);if("string"==typeof t){if(1===arguments.length)return void 0!==this.options[t]?this.options[t]:null;i={},i[t]=n}else i=t;this._setOptions(i)},_setOptions:function(t){e.each(t,e.proxy(function(t,n){switch(t){case"disablePan":this._resetStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._unbind()}switch(this.options[t]=n,t){case"disablePan":this._initStyle();case"$zoomIn":case"$zoomOut":case"$zoomRange":case"$reset":this[t]=n;case"disableZoom":case"onStart":case"onChange":case"onZoom":case"onPan":case"onEnd":case"onReset":case"eventNamespace":this._bind();break;case"cursor":e.style(this.elem,"cursor",n);break;case"minScale":this.$zoomRange.attr("min",n);break;case"maxScale":this.$zoomRange.attr("max",n);break;case"rangeStep":this.$zoomRange.attr("step",n);break;case"startTransform":this._buildTransform();break;case"duration":case"easing":this._buildTransition();case"transition":this.transition();break;case"$set":n instanceof e&&n.length&&(this.$set=n,this._initStyle(),this._buildTransform())}},this))},_initStyle:function(){var t={"backface-visibility":"hidden","transform-origin":this.isSVG?"0 0":"50% 50%"};this.options.disablePan||(t.cursor=this.options.cursor),this.$set.css(t)},_resetStyle:function(){this.$elem.css({cursor:"",transition:""}),this.$parent.css({overflow:"",position:""})},_bind:function(){var t=this,n=this.options,i=n.eventNamespace,s=f?"pointerdown"+i:"touchstart"+i+" mousedown"+i,o=f?"pointerup"+i:"touchend"+i+" click"+i,r={},l=this.$reset,u=this.$zoomRange;if(e.each(["Start","Change","Zoom","Pan","End","Reset"],function(){var t=n["on"+this];e.isFunction(t)&&(r["panzoom"+this.toLowerCase()+i]=t)}),n.disablePan&&n.disableZoom||(r[s]=function(e){var i;("touchstart"===e.type?!(i=e.touches)||(1!==i.length||n.disablePan)&&2!==i.length:n.disablePan||1!==e.which)||(e.preventDefault(),e.stopPropagation(),t._startMove(e,i))}),this.$elem.on(r),l.length&&l.on(o,function(e){e.preventDefault(),t.reset()}),u.length&&u.attr({step:n.rangeStep===a.defaults.rangeStep&&u.attr("step")||n.rangeStep,min:n.minScale,max:n.maxScale}).prop({value:this.getMatrix()[0]}),!n.disableZoom){var c=this.$zoomIn,h=this.$zoomOut;c.length&&h.length&&(c.on(o,function(e){e.preventDefault(),t.zoom()}),h.on(o,function(e){e.preventDefault(),t.zoom(!0)})),u.length&&(r={},r[(f?"pointerdown":"mousedown")+i]=function(){t.transition(!0)},r[(g?"input":"change")+i]=function(){t.zoom(+this.value,{noSetRange:!0})},u.on(r))}},_unbind:function(){this.$elem.add(this.$zoomIn).add(this.$zoomOut).add(this.$reset).off(this.options.eventNamespace)},_buildTransform:function(){return this._origTransform=this.getTransform(this.options.startTransform)},_buildTransition:function(){if(this._transform){var t=this.options;this._transition=this._transform+" "+t.duration+"ms "+t.easing}},_checkDims:function(){var t=this.dimensions;return t.width&&t.height||this.resetDimensions(),this.dimensions},_getDistance:function(t){var e=t[0],n=t[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-e.clientX),2)+Math.pow(Math.abs(n.clientY-e.clientY),2))},_getMiddle:function(t){var e=t[0],n=t[1];return{clientX:(n.clientX-e.clientX)/2+e.clientX,clientY:(n.clientY-e.clientY)/2+e.clientY}},_trigger:function(t){"string"==typeof t&&(t="panzoom"+t),this.$elem.triggerHandler(t,[this].concat(p.call(arguments,1)))},_startMove:function(t,i){var s,o,a,r,l,u,c,d,p=this,g=this.options,m=g.eventNamespace,v=this.getMatrix(),b=v.slice(0),y=+b[4],_=+b[5],w={matrix:v,animate:"skip"};f?(o="pointermove",a="pointerup"):"touchstart"===t.type?(o="touchmove",a="touchend"):(o="mousemove",a="mouseup"),o+=m,a+=m,this.transition(!0),this.panning=!0,this._trigger("start",t,i),i&&2===i.length?(r=this._getDistance(i),l=+v[0],u=this._getMiddle(i),s=function(t){t.preventDefault();var e=p._getMiddle(i=t.touches),n=p._getDistance(i)-r;p.zoom(n*(g.increment/100)+l,{focal:e,matrix:v,animate:!1}),p.pan(+v[4]+e.clientX-u.clientX,+v[5]+e.clientY-u.clientY,w),u=e}):(c=t.pageX,d=t.pageY,s=function(t){t.preventDefault(),p.pan(y+t.pageX-c,_+t.pageY-d,w)}),e(h).off(m).on(o,s).on(a,function(t){t.preventDefault(),e(this).off(m),p.panning=!1,t.type="panzoomend",p._trigger(t,v,!n(v,b))})}},e.Panzoom=a,e.fn.panzoom=function(t){var n,i,s,o;return"string"==typeof t?(o=[],i=p.call(arguments,1),this.each(function(){n=e.data(this,d),n?"_"!==t.charAt(0)&&"function"==typeof(s=n[t])&&void 0!==(s=s.apply(n,i))&&o.push(s):o.push(void 0)}),o.length?1===o.length?o[0]:o:this):this.each(function(){new a(this,t)})},a}),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){function e(e){var a=e||window.event,r=l.call(arguments,1),u=0,c=0,h=0,d=0;if(e=t.event.fix(a),e.type="mousewheel","detail"in a&&(h=-1*a.detail),"wheelDelta"in a&&(h=a.wheelDelta),"wheelDeltaY"in a&&(h=a.wheelDeltaY),"wheelDeltaX"in a&&(c=-1*a.wheelDeltaX),"axis"in a&&a.axis===a.HORIZONTAL_AXIS&&(c=-1*h,h=0),u=0===h?c:h,"deltaY"in a&&(h=-1*a.deltaY,u=h),"deltaX"in a&&(c=a.deltaX,0===h&&(u=-1*c)),0!==h||0!==c){if(1===a.deltaMode){var p=t.data(this,"mousewheel-line-height");u*=p,h*=p,c*=p}else if(2===a.deltaMode){var f=t.data(this,"mousewheel-page-height");u*=f,h*=f,c*=f}return d=Math.max(Math.abs(h),Math.abs(c)),(!o||o>d)&&(o=d,i(a,d)&&(o/=40)),i(a,d)&&(u/=40,c/=40,h/=40),u=Math[u>=1?"floor":"ceil"](u/o),c=Math[c>=1?"floor":"ceil"](c/o),h=Math[h>=1?"floor":"ceil"](h/o),e.deltaX=c,e.deltaY=h,e.deltaFactor=o,e.deltaMode=0,r.unshift(e,u,c,h),s&&clearTimeout(s),s=setTimeout(n,200),(t.event.dispatch||t.event.handle).apply(this,r)}}function n(){o=null}function i(t,e){return c.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120===0}var s,o,a=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],r="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],l=Array.prototype.slice;if(t.event.fixHooks)for(var u=a.length;u;)t.event.fixHooks[a[--u]]=t.event.mouseHooks;var c=t.event.special.mousewheel={version:"3.1.9",setup:function(){if(this.addEventListener)for(var n=r.length;n;)this.addEventListener(r[--n],e,!1);else this.onmousewheel=e;t.data(this,"mousewheel-line-height",c.getLineHeight(this)),t.data(this,"mousewheel-page-height",c.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=r.length;t;)this.removeEventListener(r[--t],e,!1);else this.onmousewheel=null},getLineHeight:function(e){return parseInt(t(e)["offsetParent"in t.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0}};t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),Array.prototype.push||(Array.prototype.push=function(){for(var t=0,e=arguments.length;e>t;t++)this[this.length]=arguments[t];return this.length}),Array.prototype.shift||(Array.prototype.shift=function(){if(this.length>0){for(var t=this[0],e=0,n=this.length-1;n>e;e++)this[e]=this[e+1];return this.length=this.length-1,t}}),Array.prototype.splice||(Array.prototype.splice=function(t,e){var n=this.slice(t+e),i=this.slice(t,t+e);this.length=t;for(var s=[],o=0,a=arguments.length;a>o;o++)s[o]=arguments[o];var r=s.length>2?n=s.slice(2).concat(n):n;for(o=0,a=r.length;a>o;o++)this.push(r[o]);return i});var log4javascript=function(){function isUndefined(t){return"undefined"==typeof t}function EventSupport(){}function Log4JavaScript(){}function toStr(t){return t&&t.toString?t.toString():String(t)}function getExceptionMessage(t){return t.message?t.message:t.description?t.description:toStr(t)}function getUrlFileName(t){var e=Math.max(t.lastIndexOf("/"),t.lastIndexOf("\\"));return t.substr(e+1)}function getExceptionStringRep(t){if(t){var e="Exception: "+getExceptionMessage(t);try{t.lineNumber&&(e+=" on line number "+t.lineNumber),t.fileName&&(e+=" in file "+getUrlFileName(t.fileName))}catch(n){logLog.warn("Unable to obtain file and line information for error")}return showStackTraces&&t.stack&&(e+=newLine+"Stack trace:"+newLine+t.stack),e}return null}function bool(t){return Boolean(t)}function trim(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}function splitIntoLines(t){var e=t.replace(/\r\n/g,"\n").replace(/\r/g,"\n");return e.split("\n")}function array_remove(t,e){for(var n=-1,i=0,s=t.length;s>i;i++)if(t[i]===e){n=i;break}return n>=0?(t.splice(n,1),!0):!1}function array_contains(t,e){for(var n=0,i=t.length;i>n;n++)if(t[n]==e)return!0;return!1}function extractBooleanFromParam(t,e){return isUndefined(t)?e:bool(t)}function extractStringFromParam(t,e){return isUndefined(t)?e:String(t)}function extractIntFromParam(t,e){if(isUndefined(t))return e;try{var n=parseInt(t,10);return isNaN(n)?e:n}catch(i){return logLog.warn("Invalid int param "+t,i),e}}function extractFunctionFromParam(t,e){return"function"==typeof t?t:e}function isError(t){return t instanceof Error}function getListenersPropertyName(t){return"__log4javascript_listeners__"+t}function addEvent(t,e,n,i,s){if(s=s?s:window,t.addEventListener)t.addEventListener(e,n,i);else if(t.attachEvent)t.attachEvent("on"+e,n);else{var o=getListenersPropertyName(e);t[o]||(t[o]=[],t["on"+e]=function(t){t=getEvent(t,s);for(var n,i=getListenersPropertyName(e),o=this[i].concat([]);n=o.shift();)n.call(this,t)}),t[o].push(n)}}function removeEvent(t,e,n,i){if(t.removeEventListener)t.removeEventListener(e,n,i);else if(t.detachEvent)t.detachEvent("on"+e,n);else{var s=getListenersPropertyName(e);t[s]&&array_remove(t[s],n)}}function getEvent(t,e){return e=e?e:window,t?t:e.event}function stopEventPropagation(t){t.stopPropagation?t.stopPropagation():"undefined"!=typeof t.cancelBubble&&(t.cancelBubble=!0),t.returnValue=!1}function handleError(t,e){logLog.error(t,e),log4javascript.dispatchEvent("error",{message:t,exception:e})}function Timer(t,e){this.name=t,this.level=isUndefined(e)?Level.INFO:e,this.start=new Date}function Logger(t){this.name=t,this.parent=null,this.children=[];var e=[],n=null,i=this.name===rootLoggerName,s=this.name===nullLoggerName,o=null,a=!1;this.addChild=function(t){this.children.push(t),t.parent=this,t.invalidateAppenderCache()};var r=!0;this.getAdditivity=function(){return r},this.setAdditivity=function(t){var e=r!=t;r=t,e&&this.invalidateAppenderCache()},this.addAppender=function(t){s?handleError("Logger.addAppender: you may not add an appender to the null logger"):t instanceof log4javascript.Appender?array_contains(e,t)||(e.push(t),t.setAddedToLogger(this),this.invalidateAppenderCache()):handleError("Logger.addAppender: appender supplied ('"+toStr(t)+"') is not a subclass of Appender")},this.removeAppender=function(t){array_remove(e,t),t.setRemovedFromLogger(this),this.invalidateAppenderCache()},this.removeAllAppenders=function(){var t=e.length;if(t>0){for(var n=0;t>n;n++)e[n].setRemovedFromLogger(this);e.length=0,this.invalidateAppenderCache()}},this.getEffectiveAppenders=function(){if(null===o||a){var t=i||!this.getAdditivity()?[]:this.parent.getEffectiveAppenders();o=t.concat(e),a=!1}return o},this.invalidateAppenderCache=function(){a=!0;for(var t=0,e=this.children.length;e>t;t++)this.children[t].invalidateAppenderCache()},this.log=function(t,e){if(enabled&&t.isGreaterOrEqual(this.getEffectiveLevel())){var n,i=e.length-1,s=e[i];e.length>1&&isError(s)&&(n=s,i--);for(var o=[],a=0;i>=a;a++)o[a]=e[a];var r=new LoggingEvent(this,new Date,t,o,n);this.callAppenders(r)}},this.callAppenders=function(t){for(var e=this.getEffectiveAppenders(),n=0,i=e.length;i>n;n++)e[n].doAppend(t)},this.setLevel=function(t){i&&null===t?handleError("Logger.setLevel: you cannot set the level of the root logger to null"):t instanceof Level?n=t:handleError("Logger.setLevel: level supplied to logger "+this.name+" is not an instance of log4javascript.Level")},this.getLevel=function(){return n},this.getEffectiveLevel=function(){for(var t=this;null!==t;t=t.parent){var e=t.getLevel();if(null!==e)return e}},this.group=function(t,e){if(enabled)for(var n=this.getEffectiveAppenders(),i=0,s=n.length;s>i;i++)n[i].group(t,e)},this.groupEnd=function(){if(enabled)for(var t=this.getEffectiveAppenders(),e=0,n=t.length;n>e;e++)t[e].groupEnd()};var l={};this.time=function(t,e){enabled&&(isUndefined(t)?handleError("Logger.time: a name for the timer must be supplied"):!e||e instanceof Level?l[t]=new Timer(t,e):handleError("Logger.time: level supplied to timer "+t+" is not an instance of log4javascript.Level"))},this.timeEnd=function(t){if(enabled)if(isUndefined(t))handleError("Logger.timeEnd: a name for the timer must be supplied");else if(l[t]){var e=l[t],n=e.getElapsedTime();this.log(e.level,["Timer "+toStr(t)+" completed in "+n+"ms"]),delete l[t]}else logLog.warn("Logger.timeEnd: no timer found with name "+t)},this.assert=function(t){if(enabled&&!t){for(var e=[],n=1,i=arguments.length;i>n;n++)e.push(arguments[n]);e=e.length>0?e:["Assertion Failure"],e.push(newLine),e.push(t),this.log(Level.ERROR,e)}},this.toString=function(){return"Logger["+this.name+"]"}}function SimpleLayout(){this.customFields=[]}function NullLayout(){this.customFields=[]}function XmlLayout(t){this.combineMessages=extractBooleanFromParam(t,!0),this.customFields=[]}function escapeNewLines(t){return t.replace(/\r\n|\r|\n/g,"\\r\\n")}function JsonLayout(t,e){this.readable=extractBooleanFromParam(t,!1),this.combineMessages=extractBooleanFromParam(e,!0),this.batchHeader=this.readable?"["+newLine:"[",this.batchFooter=this.readable?"]"+newLine:"]",this.batchSeparator=this.readable?","+newLine:",",this.setKeys(),this.colon=this.readable?": ":":",this.tab=this.readable?"	":"",this.lineBreak=this.readable?newLine:"",this.customFields=[]}function HttpPostDataLayout(){this.setKeys(),this.customFields=[],this.returnsPostData=!0}function formatObjectExpansion(t,e,n){function i(t,e,n){function o(t){for(var e=splitIntoLines(t),i=1,s=e.length;s>i;i++)e[i]=n+e[i];return e.join(newLine)}var a,r,l,u,c,h,d;if(n||(n=""),null===t)return"null";if("undefined"==typeof t)return"undefined";if("string"==typeof t)return o(t);if("object"==typeof t&&array_contains(s,t)){try{h=toStr(t)}catch(p){h="Error formatting property. Details: "+getExceptionStringRep(p)}return h+" [already expanded]"}if(t instanceof Array&&e>0){for(s.push(t),h="["+newLine,l=e-1,u=n+"  ",c=[],a=0,r=t.length;r>a;a++)try{d=i(t[a],l,u),c.push(u+d)}catch(p){c.push(u+"Error formatting array member. Details: "+getExceptionStringRep(p))}return h+=c.join(","+newLine)+newLine+n+"]"}if("[object Date]"==Object.prototype.toString.call(t))return t.toString();if("object"==typeof t&&e>0){s.push(t),h="{"+newLine,l=e-1,u=n+"  ",c=[];for(a in t)try{d=i(t[a],l,u),c.push(u+a+": "+d)}catch(p){c.push(u+a+": Error formatting property. Details: "+getExceptionStringRep(p))}return h+=c.join(","+newLine)+newLine+n+"}"}return o(toStr(t))}var s=[];return i(t,e,n)}function PatternLayout(t){t?this.pattern=t:this.pattern=PatternLayout.DEFAULT_CONVERSION_PATTERN,this.customFields=[]}function AlertAppender(){}function BrowserConsoleAppender(){}function isHttpRequestSuccessful(t){return isUndefined(t.status)||0===t.status||t.status>=200&&t.status<300||1223==t.status}function AjaxAppender(t,e){function n(t){return S?(handleError("AjaxAppender: configuration option '"+t+"' may not be set after the appender has been initialized"),!1):!0}function i(){if(h&&enabled){I=!0;var t;if(p)x.length>0?(t=x.shift(),l(o(t),i)):(I=!1,d&&a());else{for(;t=x.shift();)l(o(t));I=!1,d&&a()}}}function s(){var t=!1;if(h&&enabled){for(var e,n=c.getLayout().allowBatching()?f:1,s=[];e=M.shift();)s.push(e),M.length>=n&&(x.push(s),s=[]);s.length>0&&x.push(s),t=x.length>0,p=!1,d=!1,i()}return t}function o(t){for(var e,n=[],i="";e=t.shift();)n.push(c.getLayout().formatWithException(e));return i=1==t.length?n.join(""):c.getLayout().batchHeader+n.join(c.getLayout().batchSeparator)+c.getLayout().batchFooter,_==c.defaults.contentType&&(i=c.getLayout().returnsPostData?i:urlEncode(b)+"="+urlEncode(i),i.length>0&&(i+="&"),i+="layout="+urlEncode(c.getLayout().toString())),i}function a(){window.setTimeout(i,g)}function r(){var t="AjaxAppender: could not create XMLHttpRequest object. AjaxAppender disabled";handleError(t),h=!1,v&&v(t)}function l(n,i){try{var s=getXmlHttp(r);if(h){e&&withCredentialsSupported&&(s.withCredentials=!0),s.onreadystatechange=function(){if(4==s.readyState){if(isHttpRequestSuccessful(s))m&&m(s),i&&i(s);else{var e="AjaxAppender.append: XMLHttpRequest request to URL "+t+" returned status code "+s.status;handleError(e),v&&v(e)}s.onreadystatechange=emptyFunction,s=null}},s.open("POST",t,!0);try{for(var o,a=0;o=C[a++];)s.setRequestHeader(o.name,o.value);s.setRequestHeader("Content-Type",_)}catch(l){var u="AjaxAppender.append: your browser's XMLHttpRequest implementation does not support setRequestHeader, therefore cannot post data. AjaxAppender disabled";return handleError(u),h=!1,void(v&&v(u))}s.send(n)}}catch(c){var d="AjaxAppender.append: error sending log message to "+t;handleError(d,c),h=!1,v&&v(d+". Details: "+getExceptionStringRep(c))}}function u(){if(S=!0,y){var t=window.onbeforeunload;window.onbeforeunload=function(){return t&&t(),s()?"Sending log messages":void 0}}d&&a()}var c=this,h=!0;t||(handleError("AjaxAppender: URL must be specified in constructor"),h=!1);var d=this.defaults.timed,p=this.defaults.waitForResponse,f=this.defaults.batchSize,g=this.defaults.timerInterval,m=this.defaults.requestSuccessCallback,v=this.defaults.failCallback,b=this.defaults.postVarName,y=this.defaults.sendAllOnUnload,_=this.defaults.contentType,w=null,M=[],x=[],C=[],I=!1,S=!1;this.getSessionId=function(){return w},this.setSessionId=function(t){w=extractStringFromParam(t,null),this.layout.setCustomField("sessionid",w)},this.setLayout=function(t){n("layout")&&(this.layout=t,null!==w&&this.setSessionId(w))},this.isTimed=function(){return d},this.setTimed=function(t){n("timed")&&(d=bool(t))},this.getTimerInterval=function(){return g},this.setTimerInterval=function(t){n("timerInterval")&&(g=extractIntFromParam(t,g))},this.isWaitForResponse=function(){return p},this.setWaitForResponse=function(t){n("waitForResponse")&&(p=bool(t))},this.getBatchSize=function(){return f},this.setBatchSize=function(t){n("batchSize")&&(f=extractIntFromParam(t,f))},this.isSendAllOnUnload=function(){return y},this.setSendAllOnUnload=function(t){n("sendAllOnUnload")&&(y=extractBooleanFromParam(t,y))},this.setRequestSuccessCallback=function(t){m=extractFunctionFromParam(t,m)},this.setFailCallback=function(t){v=extractFunctionFromParam(t,v)},this.getPostVarName=function(){return b},this.setPostVarName=function(t){n("postVarName")&&(b=extractStringFromParam(t,b))},this.getHeaders=function(){return C},this.addHeader=function(t,e){"content-type"==t.toLowerCase()?_=e:C.push({name:t,value:e})},this.sendAll=i,this.sendAllRemaining=s,this.append=function(t){if(h){S||u(),M.push(t);var e=this.getLayout().allowBatching()?f:1;if(M.length>=e){for(var n,s=[];n=M.shift();)s.push(n);x.push(s),d||p&&(!p||I)||i()}}}}function setCookie(t,e,n,i){var s;if(i=i?"; path="+i:"",n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),s="; expires="+o.toGMTString()}else s="";document.cookie=escape(t)+"="+escape(e)+s+i}function getCookie(t){for(var e=escape(t)+"=",n=document.cookie.split(";"),i=0,s=n.length;s>i;i++){for(var o=n[i];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(e))return unescape(o.substring(e.length,o.length))}return null}function getBaseUrl(){for(var t=document.getElementsByTagName("script"),e=0,n=t.length;n>e;++e)if(-1!=t[e].src.indexOf("log4javascript")){var i=t[e].src.lastIndexOf("/");return-1==i?"":t[e].src.substr(0,i+1)}return null}function isLoaded(t){try{return bool(t.loaded)}catch(e){return!1}}function padWithSpaces(t,e){if(t.length<e){for(var n=[],i=Math.max(0,e-t.length),s=0;i>s;s++)n[s]=" ";t+=n.join("")}return t}EventSupport.prototype={eventTypes:[],eventListeners:{},setEventTypes:function(t){if(t instanceof Array){this.eventTypes=t,this.eventListeners={};for(var e=0,n=this.eventTypes.length;n>e;e++)this.eventListeners[this.eventTypes[e]]=[]}else handleError("log4javascript.EventSupport ["+this+"]: setEventTypes: eventTypes parameter must be an Array")},addEventListener:function(t,e){"function"==typeof e?(array_contains(this.eventTypes,t)||handleError("log4javascript.EventSupport ["+this+"]: addEventListener: no event called '"+t+"'"),this.eventListeners[t].push(e)):handleError("log4javascript.EventSupport ["+this+"]: addEventListener: listener must be a function")},removeEventListener:function(t,e){"function"==typeof e?(array_contains(this.eventTypes,t)||handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: no event called '"+t+"'"),array_remove(this.eventListeners[t],e)):handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: listener must be a function")},dispatchEvent:function(t,e){if(array_contains(this.eventTypes,t))for(var n=this.eventListeners[t],i=0,s=n.length;s>i;i++)n[i](this,t,e);else handleError("log4javascript.EventSupport ["+this+"]: dispatchEvent: no event called '"+t+"'")}};var applicationStartDate=new Date,uniqueId="log4javascript_"+applicationStartDate.getTime()+"_"+Math.floor(1e8*Math.random()),emptyFunction=function(){},newLine="\r\n",pageLoaded=!1;Log4JavaScript.prototype=new EventSupport,log4javascript=new Log4JavaScript,log4javascript.version="1.4.9",log4javascript.edition="log4javascript";var urlEncode="undefined"!=typeof window.encodeURIComponent?function(t){return encodeURIComponent(t)}:function(t){return escape(t).replace(/\+/g,"%2B").replace(/"/g,"%22").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/=/g,"%3D")},urlDecode="undefined"!=typeof window.decodeURIComponent?function(t){return decodeURIComponent(t)}:function(t){return unescape(t).replace(/%2B/g,"+").replace(/%22/g,'"').replace(/%27/g,"'").replace(/%2F/g,"/").replace(/%3D/g,"=")};Function.prototype.apply||(Function.prototype.apply=function(obj,args){var methodName="__apply__";"undefined"!=typeof obj[methodName]&&(methodName+=String(Math.random()).substr(2)),obj[methodName]=this;for(var argsStrings=[],i=0,len=args.length;len>i;i++)argsStrings[i]="args["+i+"]";var script="obj."+methodName+"("+argsStrings.join(",")+")",returnValue=eval(script);return delete obj[methodName],returnValue}),Function.prototype.call||(Function.prototype.call=function(t){for(var e=[],n=1,i=arguments.length;i>n;n++)e[n-1]=arguments[n];return this.apply(t,e)});var logLog={quietMode:!1,debugMessages:[],setQuietMode:function(t){this.quietMode=bool(t)},numberOfErrors:0,
alertAllErrors:!1,setAlertAllErrors:function(t){this.alertAllErrors=t},debug:function(t){this.debugMessages.push(t)},displayDebug:function(){alert(this.debugMessages.join(newLine))},warn:function(t,e){},error:function(t,e){if((1==++this.numberOfErrors||this.alertAllErrors)&&!this.quietMode){var n="log4javascript error: "+t;e&&(n+=newLine+newLine+"Original error: "+getExceptionStringRep(e)),alert(n)}}};log4javascript.logLog=logLog,log4javascript.setEventTypes(["load","error"]),log4javascript.handleError=handleError;var enabled=!("undefined"!=typeof log4javascript_disabled&&log4javascript_disabled);log4javascript.setEnabled=function(t){enabled=bool(t)},log4javascript.isEnabled=function(){return enabled};var useTimeStampsInMilliseconds=!0;log4javascript.setTimeStampsInMilliseconds=function(t){useTimeStampsInMilliseconds=bool(t)},log4javascript.isTimeStampsInMilliseconds=function(){return useTimeStampsInMilliseconds},log4javascript.evalInScope=function(expr){return eval(expr)};var showStackTraces=!1;log4javascript.setShowStackTraces=function(t){showStackTraces=bool(t)};var Level=function(t,e){this.level=t,this.name=e};Level.prototype={toString:function(){return this.name},equals:function(t){return this.level==t.level},isGreaterOrEqual:function(t){return this.level>=t.level}},Level.ALL=new Level(Number.MIN_VALUE,"ALL"),Level.TRACE=new Level(1e4,"TRACE"),Level.DEBUG=new Level(2e4,"DEBUG"),Level.INFO=new Level(3e4,"INFO"),Level.WARN=new Level(4e4,"WARN"),Level.ERROR=new Level(5e4,"ERROR"),Level.FATAL=new Level(6e4,"FATAL"),Level.OFF=new Level(Number.MAX_VALUE,"OFF"),log4javascript.Level=Level,Timer.prototype.getElapsedTime=function(){return(new Date).getTime()-this.start.getTime()};var anonymousLoggerName="[anonymous]",defaultLoggerName="[default]",nullLoggerName="[null]",rootLoggerName="root";Logger.prototype={trace:function(){this.log(Level.TRACE,arguments)},debug:function(){this.log(Level.DEBUG,arguments)},info:function(){this.log(Level.INFO,arguments)},warn:function(){this.log(Level.WARN,arguments)},error:function(){this.log(Level.ERROR,arguments)},fatal:function(){this.log(Level.FATAL,arguments)},isEnabledFor:function(t){return t.isGreaterOrEqual(this.getEffectiveLevel())},isTraceEnabled:function(){return this.isEnabledFor(Level.TRACE)},isDebugEnabled:function(){return this.isEnabledFor(Level.DEBUG)},isInfoEnabled:function(){return this.isEnabledFor(Level.INFO)},isWarnEnabled:function(){return this.isEnabledFor(Level.WARN)},isErrorEnabled:function(){return this.isEnabledFor(Level.ERROR)},isFatalEnabled:function(){return this.isEnabledFor(Level.FATAL)}},Logger.prototype.trace.isEntryPoint=!0,Logger.prototype.debug.isEntryPoint=!0,Logger.prototype.info.isEntryPoint=!0,Logger.prototype.warn.isEntryPoint=!0,Logger.prototype.error.isEntryPoint=!0,Logger.prototype.fatal.isEntryPoint=!0;var loggers={},loggerNames=[],ROOT_LOGGER_DEFAULT_LEVEL=Level.DEBUG,rootLogger=new Logger(rootLoggerName);rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),log4javascript.getRootLogger=function(){return rootLogger},log4javascript.getLogger=function(t){if("string"!=typeof t&&(t=anonymousLoggerName,logLog.warn("log4javascript.getLogger: non-string logger name "+toStr(t)+" supplied, returning anonymous logger")),t==rootLoggerName&&handleError("log4javascript.getLogger: root logger may not be obtained by name"),!loggers[t]){var e=new Logger(t);loggers[t]=e,loggerNames.push(t);var n,i=t.lastIndexOf(".");if(i>-1){var s=t.substring(0,i);n=log4javascript.getLogger(s)}else n=rootLogger;n.addChild(e)}return loggers[t]};var defaultLogger=null;log4javascript.getDefaultLogger=function(){if(!defaultLogger){defaultLogger=log4javascript.getLogger(defaultLoggerName);var t=new log4javascript.PopUpAppender;defaultLogger.addAppender(t)}return defaultLogger};var nullLogger=null;log4javascript.getNullLogger=function(){return nullLogger||(nullLogger=new Logger(nullLoggerName),nullLogger.setLevel(Level.OFF)),nullLogger},log4javascript.resetConfiguration=function(){rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),loggers={}};var LoggingEvent=function(t,e,n,i,s){this.logger=t,this.timeStamp=e,this.timeStampInMilliseconds=e.getTime(),this.timeStampInSeconds=Math.floor(this.timeStampInMilliseconds/1e3),this.milliseconds=this.timeStamp.getMilliseconds(),this.level=n,this.messages=i,this.exception=s};LoggingEvent.prototype={getThrowableStrRep:function(){return this.exception?getExceptionStringRep(this.exception):""},getCombinedMessages:function(){return 1==this.messages.length?this.messages[0]:this.messages.join(newLine)},toString:function(){return"LoggingEvent["+this.level+"]"}},log4javascript.LoggingEvent=LoggingEvent;var Layout=function(){};Layout.prototype={defaults:{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url"},loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url",batchHeader:"",batchFooter:"",batchSeparator:"",returnsPostData:!1,overrideTimeStampsSetting:!1,useTimeStampsInMilliseconds:null,format:function(){handleError("Layout.format: layout supplied has no format() method")},ignoresThrowable:function(){handleError("Layout.ignoresThrowable: layout supplied has no ignoresThrowable() method")},getContentType:function(){return"text/plain"},allowBatching:function(){return!0},setTimeStampsInMilliseconds:function(t){this.overrideTimeStampsSetting=!0,this.useTimeStampsInMilliseconds=bool(t)},isTimeStampsInMilliseconds:function(){return this.overrideTimeStampsSetting?this.useTimeStampsInMilliseconds:useTimeStampsInMilliseconds},getTimeStampValue:function(t){return this.isTimeStampsInMilliseconds()?t.timeStampInMilliseconds:t.timeStampInSeconds},getDataValues:function(t,e){var n=[[this.loggerKey,t.logger.name],[this.timeStampKey,this.getTimeStampValue(t)],[this.levelKey,t.level.name],[this.urlKey,window.location.href],[this.messageKey,e?t.getCombinedMessages():t.messages]];if(this.isTimeStampsInMilliseconds()||n.push([this.millisecondsKey,t.milliseconds]),t.exception&&n.push([this.exceptionKey,getExceptionStringRep(t.exception)]),this.hasCustomFields())for(var i=0,s=this.customFields.length;s>i;i++){var o=this.customFields[i].value;"function"==typeof o&&(o=o(this,t)),n.push([this.customFields[i].name,o])}return n},setKeys:function(t,e,n,i,s,o,a){this.loggerKey=extractStringFromParam(t,this.defaults.loggerKey),this.timeStampKey=extractStringFromParam(e,this.defaults.timeStampKey),this.levelKey=extractStringFromParam(n,this.defaults.levelKey),this.messageKey=extractStringFromParam(i,this.defaults.messageKey),this.exceptionKey=extractStringFromParam(s,this.defaults.exceptionKey),this.urlKey=extractStringFromParam(o,this.defaults.urlKey),this.millisecondsKey=extractStringFromParam(a,this.defaults.millisecondsKey)},setCustomField:function(t,e){for(var n=!1,i=0,s=this.customFields.length;s>i;i++)this.customFields[i].name===t&&(this.customFields[i].value=e,n=!0);n||this.customFields.push({name:t,value:e})},hasCustomFields:function(){return this.customFields.length>0},formatWithException:function(t){var e=this.format(t);return t.exception&&this.ignoresThrowable()&&(e+=t.getThrowableStrRep()),e},toString:function(){handleError("Layout.toString: all layouts must override this method")}},log4javascript.Layout=Layout;var Appender=function(){};Appender.prototype=new EventSupport,Appender.prototype.layout=new PatternLayout,Appender.prototype.threshold=Level.ALL,Appender.prototype.loggers=[],Appender.prototype.doAppend=function(t){enabled&&t.level.level>=this.threshold.level&&this.append(t)},Appender.prototype.append=function(t){},Appender.prototype.setLayout=function(t){t instanceof Layout?this.layout=t:handleError("Appender.setLayout: layout supplied to "+this.toString()+" is not a subclass of Layout")},Appender.prototype.getLayout=function(){return this.layout},Appender.prototype.setThreshold=function(t){t instanceof Level?this.threshold=t:handleError("Appender.setThreshold: threshold supplied to "+this.toString()+" is not a subclass of Level")},Appender.prototype.getThreshold=function(){return this.threshold},Appender.prototype.setAddedToLogger=function(t){this.loggers.push(t)},Appender.prototype.setRemovedFromLogger=function(t){array_remove(this.loggers,t)},Appender.prototype.group=emptyFunction,Appender.prototype.groupEnd=emptyFunction,Appender.prototype.toString=function(){handleError("Appender.toString: all appenders must override this method")},log4javascript.Appender=Appender,SimpleLayout.prototype=new Layout,SimpleLayout.prototype.format=function(t){return t.level.name+" - "+t.getCombinedMessages()},SimpleLayout.prototype.ignoresThrowable=function(){return!0},SimpleLayout.prototype.toString=function(){return"SimpleLayout"},log4javascript.SimpleLayout=SimpleLayout,NullLayout.prototype=new Layout,NullLayout.prototype.format=function(t){return t.messages},NullLayout.prototype.ignoresThrowable=function(){return!0},NullLayout.prototype.formatWithException=function(t){var e=t.messages,n=t.exception;return n?e.concat([n]):e},NullLayout.prototype.toString=function(){return"NullLayout"},log4javascript.NullLayout=NullLayout,XmlLayout.prototype=new Layout,XmlLayout.prototype.isCombinedMessages=function(){return this.combineMessages},XmlLayout.prototype.getContentType=function(){return"text/xml"},XmlLayout.prototype.escapeCdata=function(t){return t.replace(/\]\]>/,"]]>]]&gt;<![CDATA[")},XmlLayout.prototype.format=function(t){function e(t){return t="string"==typeof t?t:toStr(t),"<log4javascript:message><![CDATA["+s.escapeCdata(t)+"]]></log4javascript:message>"}var n,i,s=this,o='<log4javascript:event logger="'+t.logger.name+'" timestamp="'+this.getTimeStampValue(t)+'"';if(this.isTimeStampsInMilliseconds()||(o+=' milliseconds="'+t.milliseconds+'"'),o+=' level="'+t.level.name+'">'+newLine,this.combineMessages)o+=e(t.getCombinedMessages());else{for(o+="<log4javascript:messages>"+newLine,n=0,i=t.messages.length;i>n;n++)o+=e(t.messages[n])+newLine;o+="</log4javascript:messages>"+newLine}if(this.hasCustomFields())for(n=0,i=this.customFields.length;i>n;n++)o+='<log4javascript:customfield name="'+this.customFields[n].name+'"><![CDATA['+this.customFields[n].value.toString()+"]]></log4javascript:customfield>"+newLine;return t.exception&&(o+="<log4javascript:exception><![CDATA["+getExceptionStringRep(t.exception)+"]]></log4javascript:exception>"+newLine),o+="</log4javascript:event>"+newLine+newLine},XmlLayout.prototype.ignoresThrowable=function(){return!1},XmlLayout.prototype.toString=function(){return"XmlLayout"},log4javascript.XmlLayout=XmlLayout,JsonLayout.prototype=new Layout,JsonLayout.prototype.isReadable=function(){return this.readable},JsonLayout.prototype.isCombinedMessages=function(){return this.combineMessages},JsonLayout.prototype.format=function(t){function e(t,n,i){var o,a=typeof t;if(t instanceof Date)o=String(t.getTime());else if(i&&t instanceof Array){o="["+s.lineBreak;for(var r=0,l=t.length;l>r;r++){var u=n+s.tab;o+=u+e(t[r],u,!1),r<t.length-1&&(o+=","),o+=s.lineBreak}o+=n+"]"}else o="number"!==a&&"boolean"!==a?'"'+escapeNewLines(toStr(t).replace(/\"/g,'\\"'))+'"':t;return o}var n,i,s=this,o=this.getDataValues(t,this.combineMessages),a="{"+this.lineBreak;for(n=0,i=o.length-1;i>=n;n++)a+=this.tab+'"'+o[n][0]+'"'+this.colon+e(o[n][1],this.tab,!0),i>n&&(a+=","),a+=this.lineBreak;return a+="}"+this.lineBreak},JsonLayout.prototype.ignoresThrowable=function(){return!1},JsonLayout.prototype.toString=function(){return"JsonLayout"},JsonLayout.prototype.getContentType=function(){return"application/json"},log4javascript.JsonLayout=JsonLayout,HttpPostDataLayout.prototype=new Layout,HttpPostDataLayout.prototype.allowBatching=function(){return!1},HttpPostDataLayout.prototype.format=function(t){for(var e=this.getDataValues(t),n=[],i=0,s=e.length;s>i;i++){var o=e[i][1]instanceof Date?String(e[i][1].getTime()):e[i][1];n.push(urlEncode(e[i][0])+"="+urlEncode(o))}return n.join("&")},HttpPostDataLayout.prototype.ignoresThrowable=function(t){return!1},HttpPostDataLayout.prototype.toString=function(){return"HttpPostDataLayout"},log4javascript.HttpPostDataLayout=HttpPostDataLayout;var SimpleDateFormat;!function(){var t=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/,e=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=0,s=1,o=2,a=3,r=4,l=5,u={G:i,y:a,M:r,w:o,W:o,D:o,d:o,F:o,E:s,a:i,H:o,k:o,K:o,h:o,m:o,s:o,S:o,Z:l},c=864e5,h=7*c,d=1,p=function(t,e,n){var i=new Date(t,e,n,0,0,0);return i.setMilliseconds(0),i};Date.prototype.getDifference=function(t){return this.getTime()-t.getTime()},Date.prototype.isBefore=function(t){return this.getTime()<t.getTime()},Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())},Date.prototype.getTimeSince=function(t){return this.getUTCTime()-t.getUTCTime()},Date.prototype.getPreviousSunday=function(){var t=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0),e=new Date(t.getTime()-this.getDay()*c);return p(e.getFullYear(),e.getMonth(),e.getDate())},Date.prototype.getWeekInYear=function(t){isUndefined(this.minimalDaysInFirstWeek)&&(t=d);var e=this.getPreviousSunday(),n=p(this.getFullYear(),0,1),i=e.isBefore(n)?0:1+Math.floor(e.getTimeSince(n)/h),s=7-n.getDay(),o=i;return t>s&&o--,o},Date.prototype.getWeekInMonth=function(t){isUndefined(this.minimalDaysInFirstWeek)&&(t=d);var e=this.getPreviousSunday(),n=p(this.getFullYear(),this.getMonth(),1),i=e.isBefore(n)?0:1+Math.floor(e.getTimeSince(n)/h),s=7-n.getDay(),o=i;return s>=t&&o++,o},Date.prototype.getDayInYear=function(){var t=p(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(t)/c)},SimpleDateFormat=function(t){this.formatString=t},SimpleDateFormat.prototype.setMinimalDaysInFirstWeek=function(t){this.minimalDaysInFirstWeek=t},SimpleDateFormat.prototype.getMinimalDaysInFirstWeek=function(){return isUndefined(this.minimalDaysInFirstWeek)?d:this.minimalDaysInFirstWeek};var f=function(t,e){for(;t.length<e;)t="0"+t;return t},g=function(t,e,n){return e>=4?t:t.substr(0,Math.max(n,e))},m=function(t,e){var n=""+t;return f(n,e)};SimpleDateFormat.prototype.format=function(c){for(var h,d="",p=this.formatString;h=t.exec(p);){var v=h[1],b=h[2],y=h[3],_=h[4];if(v)d+="''"==v?"'":v.substring(1,v.length-1);else if(y);else if(_)d+=_;else if(b){var w=b.charAt(0),M=b.length,x="";switch(w){case"G":x="AD";break;case"y":x=c.getFullYear();break;case"M":x=c.getMonth();break;case"w":x=c.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":x=c.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":x=c.getDayInYear();break;case"d":x=c.getDate();break;case"F":x=1+Math.floor((c.getDate()-1)/7);break;case"E":x=n[c.getDay()];break;case"a":x=c.getHours()>=12?"PM":"AM";break;case"H":x=c.getHours();break;case"k":x=c.getHours()||24;break;case"K":x=c.getHours()%12;break;case"h":x=c.getHours()%12||12;break;case"m":x=c.getMinutes();break;case"s":x=c.getSeconds();break;case"S":x=c.getMilliseconds();break;case"Z":x=c.getTimezoneOffset()}switch(u[w]){case i:d+=g(x,M,2);break;case s:d+=g(x,M,3);break;case o:d+=m(x,M);break;case a:if(3>=M){var C=""+x;d+=C.substr(2,2)}else d+=m(x,M);break;case r:d+=M>=3?g(e[x],M,M):m(x+1,M);break;case l:var I=x>0,S=I?"-":"+",E=Math.abs(x),L=""+Math.floor(E/60);L=f(L,2);var k=""+E%60;k=f(k,2),d+=S+L+k}}p=p.substr(h.index+h[0].length)}return d}}(),log4javascript.SimpleDateFormat=SimpleDateFormat,PatternLayout.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n",PatternLayout.DEFAULT_CONVERSION_PATTERN="%m%n",PatternLayout.ISO8601_DATEFORMAT="yyyy-MM-dd HH:mm:ss,SSS",PatternLayout.DATETIME_DATEFORMAT="dd MMM yyyy HH:mm:ss,SSS",PatternLayout.ABSOLUTETIME_DATEFORMAT="HH:mm:ss,SSS",PatternLayout.prototype=new Layout,PatternLayout.prototype.format=function(t){for(var e,n=/%(-?[0-9]+)?(\.?[0-9]+)?([acdfmMnpr%])(\{([^\}]+)\})?|([^%]+)/,i="",s=this.pattern;e=n.exec(s);){var o=e[0],a=e[1],r=e[2],l=e[3],u=e[5],c=e[6];if(c)i+=""+c;else{var h="";switch(l){case"a":case"m":var d=0;u&&(d=parseInt(u,10),isNaN(d)&&(handleError("PatternLayout.format: invalid specifier '"+u+"' for conversion character '"+l+"' - should be a number"),d=0));for(var p="a"===l?t.messages[0]:t.messages,f=0,g=p.length;g>f;f++)f>0&&" "!==h.charAt(h.length-1)&&(h+=" "),h+=0===d?p[f]:formatObjectExpansion(p[f],d);break;case"c":var m=t.logger.name;if(u){var v=parseInt(u,10),b=t.logger.name.split(".");h=v>=b.length?m:b.slice(b.length-v).join(".")}else h=m;break;case"d":var y=PatternLayout.ISO8601_DATEFORMAT;u&&(y=u,"ISO8601"==y?y=PatternLayout.ISO8601_DATEFORMAT:"ABSOLUTE"==y?y=PatternLayout.ABSOLUTETIME_DATEFORMAT:"DATE"==y&&(y=PatternLayout.DATETIME_DATEFORMAT)),h=new SimpleDateFormat(y).format(t.timeStamp);break;case"f":if(this.hasCustomFields()){var _=0;u&&(_=parseInt(u,10),isNaN(_)?handleError("PatternLayout.format: invalid specifier '"+u+"' for conversion character 'f' - should be a number"):0===_?handleError("PatternLayout.format: invalid specifier '"+u+"' for conversion character 'f' - must be greater than zero"):_>this.customFields.length?handleError("PatternLayout.format: invalid specifier '"+u+"' for conversion character 'f' - there aren't that many custom fields"):_-=1);var w=this.customFields[_].value;"function"==typeof w&&(w=w(this,t)),h=w}break;case"n":h=newLine;break;case"p":h=t.level.name;break;case"r":h=""+t.timeStamp.getDifference(applicationStartDate);break;case"%":h="%";break;default:h=o}var M;if(r){M=parseInt(r.substr(1),10);var x=h.length;x>M&&(h=h.substring(x-M,x))}if(a)if("-"==a.charAt(0))for(M=parseInt(a.substr(1),10);h.length<M;)h+=" ";else for(M=parseInt(a,10);h.length<M;)h=" "+h;i+=h}s=s.substr(e.index+e[0].length)}return i},PatternLayout.prototype.ignoresThrowable=function(){return!0},PatternLayout.prototype.toString=function(){return"PatternLayout"},log4javascript.PatternLayout=PatternLayout,AlertAppender.prototype=new Appender,AlertAppender.prototype.layout=new SimpleLayout,AlertAppender.prototype.append=function(t){alert(this.getLayout().formatWithException(t))},AlertAppender.prototype.toString=function(){return"AlertAppender"},log4javascript.AlertAppender=AlertAppender,BrowserConsoleAppender.prototype=new log4javascript.Appender,BrowserConsoleAppender.prototype.layout=new NullLayout,BrowserConsoleAppender.prototype.threshold=Level.DEBUG,BrowserConsoleAppender.prototype.append=function(t){var e,n=this,i=function(){var e=n.getLayout().formatWithException(t);return"string"==typeof e?[e]:e};if((e=window.console)&&e.log){var s,o=i();s=e.debug&&Level.DEBUG.isGreaterOrEqual(t.level)?"debug":e.info&&Level.INFO.equals(t.level)?"info":e.warn&&Level.WARN.equals(t.level)?"warn":e.error&&t.level.isGreaterOrEqual(Level.ERROR)?"error":"log",e[s].apply?e[s].apply(e,o):e[s](o)}else"undefined"!=typeof opera&&opera.postError&&opera.postError(i())},BrowserConsoleAppender.prototype.group=function(t){window.console&&window.console.group&&window.console.group(t)},BrowserConsoleAppender.prototype.groupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},BrowserConsoleAppender.prototype.toString=function(){return"BrowserConsoleAppender"},log4javascript.BrowserConsoleAppender=BrowserConsoleAppender;var xhrFactory=function(){return new XMLHttpRequest},xmlHttpFactories=[xhrFactory,function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],withCredentialsSupported=!1,getXmlHttp=function(t){for(var e,n=null,i=0,s=xmlHttpFactories.length;s>i;i++){e=xmlHttpFactories[i];try{return n=e(),withCredentialsSupported=e==xhrFactory&&"withCredentials"in n,getXmlHttp=e,n}catch(o){}}t?t():handleError("getXmlHttp: unable to obtain XMLHttpRequest object")};AjaxAppender.prototype=new Appender,AjaxAppender.prototype.defaults={waitForResponse:!1,timed:!1,timerInterval:1e3,batchSize:1,sendAllOnUnload:!1,requestSuccessCallback:null,failCallback:null,postVarName:"data",contentType:"application/x-www-form-urlencoded"},AjaxAppender.prototype.layout=new HttpPostDataLayout,AjaxAppender.prototype.toString=function(){return"AjaxAppender"},log4javascript.AjaxAppender=AjaxAppender;var ConsoleAppender;if(function(){function t(t,e,n,i,s){this.create(!1,null,t,e,n,i,s,this.defaults.focusPopUp)}function e(t,e,n,i,s,o){this.create(!0,t,e,n,i,s,o,!1)}var n=function(){return['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">','<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">',"<head>","<title>log4javascript</title>",'<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"<!-- Make IE8 behave like IE7, having gone to all the trouble of making IE work -->",'<meta http-equiv="X-UA-Compatible" content="IE=7" />','<script type="text/javascript">var isIe = false, isIePre7 = false;</script>','<!--[if IE]><script type="text/javascript">isIe = true</script><![endif]-->','<!--[if lt IE 7]><script type="text/javascript">isIePre7 = true</script><![endif]-->','<script type="text/javascript">',"//<![CDATA[","var loggingEnabled=true;var logQueuedEventsTimer=null;var logEntries=[];var logEntriesAndSeparators=[];var logItems=[];var renderDelay=100;var unrenderedLogItemsExist=false;var rootGroup,currentGroup=null;var loaded=false;var currentLogItem=null;var logMainContainer;function copyProperties(obj,props){for(var i in props){obj[i]=props[i];}}","function LogItem(){}","LogItem.prototype={mainContainer:null,wrappedContainer:null,unwrappedContainer:null,group:null,appendToLog:function(){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].appendToLog();}","this.group.update();},doRemove:function(doUpdate,removeFromGroup){if(this.rendered){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].remove();}","this.unwrappedElementContainer=null;this.wrappedElementContainer=null;this.mainElementContainer=null;}","if(this.group&&removeFromGroup){this.group.removeChild(this,doUpdate);}","if(this===currentLogItem){currentLogItem=null;}},remove:function(doUpdate,removeFromGroup){this.doRemove(doUpdate,removeFromGroup);},render:function(){},accept:function(visitor){visitor.visit(this);},getUnwrappedDomContainer:function(){return this.group.unwrappedElementContainer.contentDiv;},getWrappedDomContainer:function(){return this.group.wrappedElementContainer.contentDiv;},getMainDomContainer:function(){return this.group.mainElementContainer.contentDiv;}};LogItem.serializedItemKeys={LOG_ENTRY:0,GROUP_START:1,GROUP_END:2};function LogItemContainerElement(){}",'LogItemContainerElement.prototype={appendToLog:function(){var insertBeforeFirst=(newestAtTop&&this.containerDomNode.hasChildNodes());if(insertBeforeFirst){this.containerDomNode.insertBefore(this.mainDiv,this.containerDomNode.firstChild);}else{this.containerDomNode.appendChild(this.mainDiv);}}};function SeparatorElementContainer(containerDomNode){this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.className="separator";this.mainDiv.innerHTML="&nbsp;";}',"SeparatorElementContainer.prototype=new LogItemContainerElement();SeparatorElementContainer.prototype.remove=function(){this.mainDiv.parentNode.removeChild(this.mainDiv);this.mainDiv=null;};function Separator(){this.rendered=false;}","Separator.prototype=new LogItem();copyProperties(Separator.prototype,{render:function(){var containerDomNode=this.group.contentDiv;if(isIe){this.unwrappedElementContainer=new SeparatorElementContainer(this.getUnwrappedDomContainer());this.wrappedElementContainer=new SeparatorElementContainer(this.getWrappedDomContainer());this.elementContainers=[this.unwrappedElementContainer,this.wrappedElementContainer];}else{this.mainElementContainer=new SeparatorElementContainer(this.getMainDomContainer());this.elementContainers=[this.mainElementContainer];}",'this.content=this.formattedMessage;this.rendered=true;}});function GroupElementContainer(group,containerDomNode,isRoot,isWrapped){this.group=group;this.containerDomNode=containerDomNode;this.isRoot=isRoot;this.isWrapped=isWrapped;this.expandable=false;if(this.isRoot){if(isIe){this.contentDiv=logMainContainer.appendChild(document.createElement("div"));this.contentDiv.id=this.isWrapped?"log_wrapped":"log_unwrapped";}else{this.contentDiv=logMainContainer;}}else{var groupElementContainer=this;this.mainDiv=document.createElement("div");this.mainDiv.className="group";this.headingDiv=this.mainDiv.appendChild(document.createElement("div"));this.headingDiv.className="groupheading";this.expander=this.headingDiv.appendChild(document.createElement("span"));this.expander.className="expander unselectable greyedout";this.expander.unselectable=true;var expanderText=this.group.expanded?"-":"+";this.expanderTextNode=this.expander.appendChild(document.createTextNode(expanderText));this.headingDiv.appendChild(document.createTextNode(" "+this.group.name));this.contentDiv=this.mainDiv.appendChild(document.createElement("div"));var contentCssClass=this.group.expanded?"expanded":"collapsed";this.contentDiv.className="groupcontent "+contentCssClass;this.expander.onclick=function(){if(groupElementContainer.group.expandable){groupElementContainer.group.toggleExpanded();}};}}','GroupElementContainer.prototype=new LogItemContainerElement();copyProperties(GroupElementContainer.prototype,{toggleExpanded:function(){if(!this.isRoot){var oldCssClass,newCssClass,expanderText;if(this.group.expanded){newCssClass="expanded";oldCssClass="collapsed";expanderText="-";}else{newCssClass="collapsed";oldCssClass="expanded";expanderText="+";}',"replaceClass(this.contentDiv,newCssClass,oldCssClass);this.expanderTextNode.nodeValue=expanderText;}},remove:function(){if(!this.isRoot){this.headingDiv=null;this.expander.onclick=null;this.expander=null;this.expanderTextNode=null;this.contentDiv=null;this.containerDomNode=null;this.mainDiv.parentNode.removeChild(this.mainDiv);this.mainDiv=null;}},reverseChildren:function(){var node=null;var childDomNodes=[];while((node=this.contentDiv.firstChild)){this.contentDiv.removeChild(node);childDomNodes.push(node);}",'while((node=childDomNodes.pop())){this.contentDiv.appendChild(node);}},update:function(){if(!this.isRoot){if(this.group.expandable){removeClass(this.expander,"greyedout");}else{addClass(this.expander,"greyedout");}}},clear:function(){if(this.isRoot){this.contentDiv.innerHTML="";}}});function Group(name,isRoot,initiallyExpanded){this.name=name;this.group=null;this.isRoot=isRoot;this.initiallyExpanded=initiallyExpanded;this.elementContainers=[];this.children=[];this.expanded=initiallyExpanded;this.rendered=false;this.expandable=false;}',"Group.prototype=new LogItem();copyProperties(Group.prototype,{addChild:function(logItem){this.children.push(logItem);logItem.group=this;},render:function(){if(isIe){var unwrappedDomContainer,wrappedDomContainer;if(this.isRoot){unwrappedDomContainer=logMainContainer;wrappedDomContainer=logMainContainer;}else{unwrappedDomContainer=this.getUnwrappedDomContainer();wrappedDomContainer=this.getWrappedDomContainer();}","this.unwrappedElementContainer=new GroupElementContainer(this,unwrappedDomContainer,this.isRoot,false);this.wrappedElementContainer=new GroupElementContainer(this,wrappedDomContainer,this.isRoot,true);this.elementContainers=[this.unwrappedElementContainer,this.wrappedElementContainer];}else{var mainDomContainer=this.isRoot?logMainContainer:this.getMainDomContainer();this.mainElementContainer=new GroupElementContainer(this,mainDomContainer,this.isRoot,false);this.elementContainers=[this.mainElementContainer];}","this.rendered=true;},toggleExpanded:function(){this.expanded=!this.expanded;for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].toggleExpanded();}},expand:function(){if(!this.expanded){this.toggleExpanded();}},accept:function(visitor){visitor.visitGroup(this);},reverseChildren:function(){if(this.rendered){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].reverseChildren();}}},update:function(){var previouslyExpandable=this.expandable;this.expandable=(this.children.length!==0);if(this.expandable!==previouslyExpandable){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].update();}}},flatten:function(){var visitor=new GroupFlattener();this.accept(visitor);return visitor.logEntriesAndSeparators;},removeChild:function(child,doUpdate){array_remove(this.children,child);child.group=null;if(doUpdate){this.update();}},remove:function(doUpdate,removeFromGroup){for(var i=0,len=this.children.length;i<len;i++){this.children[i].remove(false,false);}","this.children=[];this.update();if(this===currentGroup){currentGroup=this.group;}","this.doRemove(doUpdate,removeFromGroup);},serialize:function(items){items.push([LogItem.serializedItemKeys.GROUP_START,this.name]);for(var i=0,len=this.children.length;i<len;i++){this.children[i].serialize(items);}","if(this!==currentGroup){items.push([LogItem.serializedItemKeys.GROUP_END]);}},clear:function(){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].clear();}}});function LogEntryElementContainer(){}",'LogEntryElementContainer.prototype=new LogItemContainerElement();copyProperties(LogEntryElementContainer.prototype,{remove:function(){this.doRemove();},doRemove:function(){this.mainDiv.parentNode.removeChild(this.mainDiv);this.mainDiv=null;this.contentElement=null;this.containerDomNode=null;},setContent:function(content,wrappedContent){if(content===this.formattedMessage){this.contentElement.innerHTML="";this.contentElement.appendChild(document.createTextNode(this.formattedMessage));}else{this.contentElement.innerHTML=content;}},setSearchMatch:function(isMatch){var oldCssClass=isMatch?"searchnonmatch":"searchmatch";var newCssClass=isMatch?"searchmatch":"searchnonmatch";replaceClass(this.mainDiv,newCssClass,oldCssClass);},clearSearch:function(){removeClass(this.mainDiv,"searchmatch");removeClass(this.mainDiv,"searchnonmatch");}});function LogEntryWrappedElementContainer(logEntry,containerDomNode){this.logEntry=logEntry;this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.appendChild(document.createTextNode(this.logEntry.formattedMessage));this.mainDiv.className="logentry wrapped "+this.logEntry.level;this.contentElement=this.mainDiv;}','LogEntryWrappedElementContainer.prototype=new LogEntryElementContainer();LogEntryWrappedElementContainer.prototype.setContent=function(content,wrappedContent){if(content===this.formattedMessage){this.contentElement.innerHTML="";this.contentElement.appendChild(document.createTextNode(this.formattedMessage));}else{this.contentElement.innerHTML=wrappedContent;}};function LogEntryUnwrappedElementContainer(logEntry,containerDomNode){this.logEntry=logEntry;this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.className="logentry unwrapped "+this.logEntry.level;this.pre=this.mainDiv.appendChild(document.createElement("pre"));this.pre.appendChild(document.createTextNode(this.logEntry.formattedMessage));this.pre.className="unwrapped";this.contentElement=this.pre;}','LogEntryUnwrappedElementContainer.prototype=new LogEntryElementContainer();LogEntryUnwrappedElementContainer.prototype.remove=function(){this.doRemove();this.pre=null;};function LogEntryMainElementContainer(logEntry,containerDomNode){this.logEntry=logEntry;this.containerDomNode=containerDomNode;this.mainDiv=document.createElement("div");this.mainDiv.className="logentry nonielogentry "+this.logEntry.level;this.contentElement=this.mainDiv.appendChild(document.createElement("span"));this.contentElement.appendChild(document.createTextNode(this.logEntry.formattedMessage));}',"LogEntryMainElementContainer.prototype=new LogEntryElementContainer();function LogEntry(level,formattedMessage){this.level=level;this.formattedMessage=formattedMessage;this.rendered=false;}",'LogEntry.prototype=new LogItem();copyProperties(LogEntry.prototype,{render:function(){var logEntry=this;var containerDomNode=this.group.contentDiv;if(isIe){this.formattedMessage=this.formattedMessage.replace(/\\r\\n/g,"\\r");this.unwrappedElementContainer=new LogEntryUnwrappedElementContainer(this,this.getUnwrappedDomContainer());this.wrappedElementContainer=new LogEntryWrappedElementContainer(this,this.getWrappedDomContainer());this.elementContainers=[this.unwrappedElementContainer,this.wrappedElementContainer];}else{this.mainElementContainer=new LogEntryMainElementContainer(this,this.getMainDomContainer());this.elementContainers=[this.mainElementContainer];}','this.content=this.formattedMessage;this.rendered=true;},setContent:function(content,wrappedContent){if(content!=this.content){if(isIe&&(content!==this.formattedMessage)){content=content.replace(/\\r\\n/g,"\\r");}',"for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].setContent(content,wrappedContent);}",'this.content=content;}},getSearchMatches:function(){var matches=[];var i,len;if(isIe){var unwrappedEls=getElementsByClass(this.unwrappedElementContainer.mainDiv,"searchterm","span");var wrappedEls=getElementsByClass(this.wrappedElementContainer.mainDiv,"searchterm","span");for(i=0,len=unwrappedEls.length;i<len;i++){matches[i]=new Match(this.level,null,unwrappedEls[i],wrappedEls[i]);}}else{var els=getElementsByClass(this.mainElementContainer.mainDiv,"searchterm","span");for(i=0,len=els.length;i<len;i++){matches[i]=new Match(this.level,els[i]);}}',"return matches;},setSearchMatch:function(isMatch){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].setSearchMatch(isMatch);}},clearSearch:function(){for(var i=0,len=this.elementContainers.length;i<len;i++){this.elementContainers[i].clearSearch();}},accept:function(visitor){visitor.visitLogEntry(this);},serialize:function(items){items.push([LogItem.serializedItemKeys.LOG_ENTRY,this.level,this.formattedMessage]);}});function LogItemVisitor(){}","LogItemVisitor.prototype={visit:function(logItem){},visitParent:function(logItem){if(logItem.group){logItem.group.accept(this);}},visitChildren:function(logItem){for(var i=0,len=logItem.children.length;i<len;i++){logItem.children[i].accept(this);}},visitLogEntry:function(logEntry){this.visit(logEntry);},visitSeparator:function(separator){this.visit(separator);},visitGroup:function(group){this.visit(group);}};function GroupFlattener(){this.logEntriesAndSeparators=[];}",'GroupFlattener.prototype=new LogItemVisitor();GroupFlattener.prototype.visitGroup=function(group){this.visitChildren(group);};GroupFlattener.prototype.visitLogEntry=function(logEntry){this.logEntriesAndSeparators.push(logEntry);};GroupFlattener.prototype.visitSeparator=function(separator){this.logEntriesAndSeparators.push(separator);};window.onload=function(){if(location.search){var queryBits=unescape(location.search).substr(1).split("&"),nameValueBits;for(var i=0,len=queryBits.length;i<len;i++){nameValueBits=queryBits[i].split("=");if(nameValueBits[0]=="log4javascript_domain"){document.domain=nameValueBits[1];break;}}}','logMainContainer=$("log");if(isIePre7){addClass(logMainContainer,"oldIe");}','rootGroup=new Group("root",true);rootGroup.render();currentGroup=rootGroup;setCommandInputWidth();setLogContainerHeight();toggleLoggingEnabled();toggleSearchEnabled();toggleSearchFilter();toggleSearchHighlight();applyFilters();checkAllLevels();toggleWrap();toggleNewestAtTop();toggleScrollToLatest();renderQueuedLogItems();loaded=true;$("command").value="";$("command").autocomplete="off";$("command").onkeydown=function(evt){evt=getEvent(evt);if(evt.keyCode==10||evt.keyCode==13){evalCommandLine();stopPropagation(evt);}else if(evt.keyCode==27){this.value="";this.focus();}else if(evt.keyCode==38&&commandHistory.length>0){currentCommandIndex=Math.max(0,currentCommandIndex-1);this.value=commandHistory[currentCommandIndex];moveCaretToEnd(this);}else if(evt.keyCode==40&&commandHistory.length>0){currentCommandIndex=Math.min(commandHistory.length-1,currentCommandIndex+1);this.value=commandHistory[currentCommandIndex];moveCaretToEnd(this);}};$("command").onkeypress=function(evt){evt=getEvent(evt);if(evt.keyCode==38&&commandHistory.length>0&&evt.preventDefault){evt.preventDefault();}};$("command").onkeyup=function(evt){evt=getEvent(evt);if(evt.keyCode==27&&evt.preventDefault){evt.preventDefault();this.focus();}};document.onkeydown=function keyEventHandler(evt){evt=getEvent(evt);switch(evt.keyCode){case 69:if(evt.shiftKey&&(evt.ctrlKey||evt.metaKey)){evalLastCommand();cancelKeyEvent(evt);return false;}',"break;case 75:if(evt.shiftKey&&(evt.ctrlKey||evt.metaKey)){focusSearch();cancelKeyEvent(evt);return false;}","break;case 40:case 76:if(evt.shiftKey&&(evt.ctrlKey||evt.metaKey)){focusCommandLine();cancelKeyEvent(evt);return false;}","break;}};setTimeout(setLogContainerHeight,20);setShowCommandLine(showCommandLine);doSearch();};window.onunload=function(){if(mainWindowExists()){appender.unload();}",'appender=null;};function toggleLoggingEnabled(){setLoggingEnabled($("enableLogging").checked);}',"function setLoggingEnabled(enable){loggingEnabled=enable;}","var appender=null;function setAppender(appenderParam){appender=appenderParam;}",'function setShowCloseButton(showCloseButton){$("closeButton").style.display=showCloseButton?"inline":"none";}','function setShowHideButton(showHideButton){$("hideButton").style.display=showHideButton?"inline":"none";}',"var newestAtTop=false;function LogItemContentReverser(){}","LogItemContentReverser.prototype=new LogItemVisitor();LogItemContentReverser.prototype.visitGroup=function(group){group.reverseChildren();this.visitChildren(group);};function setNewestAtTop(isNewestAtTop){var oldNewestAtTop=newestAtTop;var i,iLen,j,jLen;newestAtTop=Boolean(isNewestAtTop);if(oldNewestAtTop!=newestAtTop){var visitor=new LogItemContentReverser();rootGroup.accept(visitor);if(currentSearch){var currentMatch=currentSearch.matches[currentMatchIndex];var matchIndex=0;var matches=[];var actOnLogEntry=function(logEntry){var logEntryMatches=logEntry.getSearchMatches();for(j=0,jLen=logEntryMatches.length;j<jLen;j++){matches[matchIndex]=logEntryMatches[j];if(currentMatch&&logEntryMatches[j].equals(currentMatch)){currentMatchIndex=matchIndex;}","matchIndex++;}};if(newestAtTop){for(i=logEntries.length-1;i>=0;i--){actOnLogEntry(logEntries[i]);}}else{for(i=0,iLen=logEntries.length;i<iLen;i++){actOnLogEntry(logEntries[i]);}}","currentSearch.matches=matches;if(currentMatch){currentMatch.setCurrent();}}else if(scrollToLatest){doScrollToLatest();}}",'$("newestAtTop").checked=isNewestAtTop;}','function toggleNewestAtTop(){var isNewestAtTop=$("newestAtTop").checked;setNewestAtTop(isNewestAtTop);}',"var scrollToLatest=true;function setScrollToLatest(isScrollToLatest){scrollToLatest=isScrollToLatest;if(scrollToLatest){doScrollToLatest();}",'$("scrollToLatest").checked=isScrollToLatest;}','function toggleScrollToLatest(){var isScrollToLatest=$("scrollToLatest").checked;setScrollToLatest(isScrollToLatest);}','function doScrollToLatest(){var l=logMainContainer;if(typeof l.scrollTop!="undefined"){if(newestAtTop){l.scrollTop=0;}else{var latestLogEntry=l.lastChild;if(latestLogEntry){l.scrollTop=l.scrollHeight;}}}}',"var closeIfOpenerCloses=true;function setCloseIfOpenerCloses(isCloseIfOpenerCloses){closeIfOpenerCloses=isCloseIfOpenerCloses;}","var maxMessages=null;function setMaxMessages(max){maxMessages=max;pruneLogEntries();}",'var showCommandLine=false;function setShowCommandLine(isShowCommandLine){showCommandLine=isShowCommandLine;if(loaded){$("commandLine").style.display=showCommandLine?"block":"none";setCommandInputWidth();setLogContainerHeight();}}','function focusCommandLine(){if(loaded){$("command").focus();}}','function focusSearch(){if(loaded){$("searchBox").focus();}}',"function getLogItems(){var items=[];for(var i=0,len=logItems.length;i<len;i++){logItems[i].serialize(items);}","return items;}","function setLogItems(items){var loggingReallyEnabled=loggingEnabled;loggingEnabled=true;for(var i=0,len=items.length;i<len;i++){switch(items[i][0]){case LogItem.serializedItemKeys.LOG_ENTRY:log(items[i][1],items[i][2]);break;case LogItem.serializedItemKeys.GROUP_START:group(items[i][1]);break;case LogItem.serializedItemKeys.GROUP_END:groupEnd();break;}}","loggingEnabled=loggingReallyEnabled;}","function log(logLevel,formattedMessage){if(loggingEnabled){var logEntry=new LogEntry(logLevel,formattedMessage);logEntries.push(logEntry);logEntriesAndSeparators.push(logEntry);logItems.push(logEntry);currentGroup.addChild(logEntry);if(loaded){if(logQueuedEventsTimer!==null){clearTimeout(logQueuedEventsTimer);}","logQueuedEventsTimer=setTimeout(renderQueuedLogItems,renderDelay);unrenderedLogItemsExist=true;}}}","function renderQueuedLogItems(){logQueuedEventsTimer=null;var pruned=pruneLogEntries();var initiallyHasMatches=currentSearch?currentSearch.hasMatches():false;for(var i=0,len=logItems.length;i<len;i++){if(!logItems[i].rendered){logItems[i].render();logItems[i].appendToLog();if(currentSearch&&(logItems[i]instanceof LogEntry)){currentSearch.applyTo(logItems[i]);}}}","if(currentSearch){if(pruned){if(currentSearch.hasVisibleMatches()){if(currentMatchIndex===null){setCurrentMatchIndex(0);}","displayMatches();}else{displayNoMatches();}}else if(!initiallyHasMatches&&currentSearch.hasVisibleMatches()){setCurrentMatchIndex(0);displayMatches();}}","if(scrollToLatest){doScrollToLatest();}","unrenderedLogItemsExist=false;}","function pruneLogEntries(){if((maxMessages!==null)&&(logEntriesAndSeparators.length>maxMessages)){var numberToDelete=logEntriesAndSeparators.length-maxMessages;var prunedLogEntries=logEntriesAndSeparators.slice(0,numberToDelete);if(currentSearch){currentSearch.removeMatches(prunedLogEntries);}","var group;for(var i=0;i<numberToDelete;i++){group=logEntriesAndSeparators[i].group;array_remove(logItems,logEntriesAndSeparators[i]);array_remove(logEntries,logEntriesAndSeparators[i]);logEntriesAndSeparators[i].remove(true,true);if(group.children.length===0&&group!==currentGroup&&group!==rootGroup){array_remove(logItems,group);group.remove(true,true);}}","logEntriesAndSeparators=array_removeFromStart(logEntriesAndSeparators,numberToDelete);return true;}","return false;}",'function group(name,startExpanded){if(loggingEnabled){initiallyExpanded=(typeof startExpanded==="undefined")?true:Boolean(startExpanded);var newGroup=new Group(name,false,initiallyExpanded);currentGroup.addChild(newGroup);currentGroup=newGroup;logItems.push(newGroup);if(loaded){if(logQueuedEventsTimer!==null){clearTimeout(logQueuedEventsTimer);}',"logQueuedEventsTimer=setTimeout(renderQueuedLogItems,renderDelay);unrenderedLogItemsExist=true;}}}","function groupEnd(){currentGroup=(currentGroup===rootGroup)?rootGroup:currentGroup.group;}","function mainPageReloaded(){currentGroup=rootGroup;var separator=new Separator();logEntriesAndSeparators.push(separator);logItems.push(separator);currentGroup.addChild(separator);}","function closeWindow(){if(appender&&mainWindowExists()){appender.close(true);}else{window.close();}}","function hide(){if(appender&&mainWindowExists()){appender.hide();}}",'var mainWindow=window;var windowId="log4javascriptConsoleWindow_"+new Date().getTime()+"_"+(""+Math.random()).substr(2);function setMainWindow(win){mainWindow=win;mainWindow[windowId]=window;if(opener&&closeIfOpenerCloses){pollOpener();}}',"function pollOpener(){if(closeIfOpenerCloses){if(mainWindowExists()){setTimeout(pollOpener,500);}else{closeWindow();}}}","function mainWindowExists(){try{return(mainWindow&&!mainWindow.closed&&mainWindow[windowId]==window);}catch(ex){}","return false;}",'var logLevels=["TRACE","DEBUG","INFO","WARN","ERROR","FATAL"];function getCheckBox(logLevel){return $("switch_"+logLevel);}','function getIeWrappedLogContainer(){return $("log_wrapped");}','function getIeUnwrappedLogContainer(){return $("log_unwrapped");}',"function applyFilters(){for(var i=0;i<logLevels.length;i++){if(getCheckBox(logLevels[i]).checked){addClass(logMainContainer,logLevels[i]);}else{removeClass(logMainContainer,logLevels[i]);}}","updateSearchFromFilters();}",'function toggleAllLevels(){var turnOn=$("switch_ALL").checked;for(var i=0;i<logLevels.length;i++){getCheckBox(logLevels[i]).checked=turnOn;if(turnOn){addClass(logMainContainer,logLevels[i]);}else{removeClass(logMainContainer,logLevels[i]);}}}','function checkAllLevels(){for(var i=0;i<logLevels.length;i++){if(!getCheckBox(logLevels[i]).checked){getCheckBox("ALL").checked=false;return;}}','getCheckBox("ALL").checked=true;}',"function clearLog(){rootGroup.clear();currentGroup=rootGroup;logEntries=[];logItems=[];logEntriesAndSeparators=[];doSearch();}",'function toggleWrap(){var enable=$("wrap").checked;if(enable){addClass(logMainContainer,"wrap");}else{removeClass(logMainContainer,"wrap");}',"refreshCurrentMatch();}","var searchTimer=null;function scheduleSearch(){try{clearTimeout(searchTimer);}catch(ex){}","searchTimer=setTimeout(doSearch,500);}","function Search(searchTerm,isRegex,searchRegex,isCaseSensitive){this.searchTerm=searchTerm;this.isRegex=isRegex;this.searchRegex=searchRegex;this.isCaseSensitive=isCaseSensitive;this.matches=[];}","Search.prototype={hasMatches:function(){return this.matches.length>0;},hasVisibleMatches:function(){if(this.hasMatches()){for(var i=0;i<this.matches.length;i++){if(this.matches[i].isVisible()){return true;}}}","return false;},match:function(logEntry){var entryText=String(logEntry.formattedMessage);var matchesSearch=false;if(this.isRegex){matchesSearch=this.searchRegex.test(entryText);}else if(this.isCaseSensitive){matchesSearch=(entryText.indexOf(this.searchTerm)>-1);}else{matchesSearch=(entryText.toLowerCase().indexOf(this.searchTerm.toLowerCase())>-1);}","return matchesSearch;},getNextVisibleMatchIndex:function(){for(var i=currentMatchIndex+1;i<this.matches.length;i++){if(this.matches[i].isVisible()){return i;}}","for(i=0;i<=currentMatchIndex;i++){if(this.matches[i].isVisible()){return i;}}","return-1;},getPreviousVisibleMatchIndex:function(){for(var i=currentMatchIndex-1;i>=0;i--){if(this.matches[i].isVisible()){return i;}}","for(var i=this.matches.length-1;i>=currentMatchIndex;i--){if(this.matches[i].isVisible()){return i;}}",'return-1;},applyTo:function(logEntry){var doesMatch=this.match(logEntry);if(doesMatch){logEntry.group.expand();logEntry.setSearchMatch(true);var logEntryContent;var wrappedLogEntryContent;var searchTermReplacementStartTag="<span class=\\"searchterm\\">";var searchTermReplacementEndTag="<"+"/span>";var preTagName=isIe?"pre":"span";var preStartTag="<"+preTagName+" class=\\"pre\\">";var preEndTag="<"+"/"+preTagName+">";var startIndex=0;var searchIndex,matchedText,textBeforeMatch;if(this.isRegex){var flags=this.isCaseSensitive?"g":"gi";var capturingRegex=new RegExp("("+this.searchRegex.source+")",flags);var rnd=(""+Math.random()).substr(2);var startToken="%%s"+rnd+"%%";var endToken="%%e"+rnd+"%%";logEntryContent=logEntry.formattedMessage.replace(capturingRegex,startToken+"$1"+endToken);logEntryContent=escapeHtml(logEntryContent);var result;var searchString=logEntryContent;logEntryContent="";wrappedLogEntryContent="";while((searchIndex=searchString.indexOf(startToken,startIndex))>-1){var endTokenIndex=searchString.indexOf(endToken,searchIndex);matchedText=searchString.substring(searchIndex+startToken.length,endTokenIndex);textBeforeMatch=searchString.substring(startIndex,searchIndex);logEntryContent+=preStartTag+textBeforeMatch+preEndTag;logEntryContent+=searchTermReplacementStartTag+preStartTag+matchedText+',"preEndTag+searchTermReplacementEndTag;if(isIe){wrappedLogEntryContent+=textBeforeMatch+searchTermReplacementStartTag+","matchedText+searchTermReplacementEndTag;}","startIndex=endTokenIndex+endToken.length;}",'logEntryContent+=preStartTag+searchString.substr(startIndex)+preEndTag;if(isIe){wrappedLogEntryContent+=searchString.substr(startIndex);}}else{logEntryContent="";wrappedLogEntryContent="";var searchTermReplacementLength=searchTermReplacementStartTag.length+',"this.searchTerm.length+searchTermReplacementEndTag.length;var searchTermLength=this.searchTerm.length;var searchTermLowerCase=this.searchTerm.toLowerCase();var logTextLowerCase=logEntry.formattedMessage.toLowerCase();while((searchIndex=logTextLowerCase.indexOf(searchTermLowerCase,startIndex))>-1){matchedText=escapeHtml(logEntry.formattedMessage.substr(searchIndex,this.searchTerm.length));textBeforeMatch=escapeHtml(logEntry.formattedMessage.substring(startIndex,searchIndex));var searchTermReplacement=searchTermReplacementStartTag+","preStartTag+matchedText+preEndTag+searchTermReplacementEndTag;logEntryContent+=preStartTag+textBeforeMatch+preEndTag+searchTermReplacement;if(isIe){wrappedLogEntryContent+=textBeforeMatch+searchTermReplacementStartTag+","matchedText+searchTermReplacementEndTag;}","startIndex=searchIndex+searchTermLength;}","var textAfterLastMatch=escapeHtml(logEntry.formattedMessage.substr(startIndex));logEntryContent+=preStartTag+textAfterLastMatch+preEndTag;if(isIe){wrappedLogEntryContent+=textAfterLastMatch;}}","logEntry.setContent(logEntryContent,wrappedLogEntryContent);var logEntryMatches=logEntry.getSearchMatches();this.matches=this.matches.concat(logEntryMatches);}else{logEntry.setSearchMatch(false);logEntry.setContent(logEntry.formattedMessage,logEntry.formattedMessage);}","return doesMatch;},removeMatches:function(logEntries){var matchesToRemoveCount=0;var currentMatchRemoved=false;var matchesToRemove=[];var i,iLen,j,jLen;for(i=0,iLen=this.matches.length;i<iLen;i++){for(j=0,jLen=logEntries.length;j<jLen;j++){if(this.matches[i].belongsTo(logEntries[j])){matchesToRemove.push(this.matches[i]);if(i===currentMatchIndex){currentMatchRemoved=true;}}}}","var newMatch=currentMatchRemoved?null:this.matches[currentMatchIndex];if(currentMatchRemoved){for(i=currentMatchIndex,iLen=this.matches.length;i<iLen;i++){if(this.matches[i].isVisible()&&!array_contains(matchesToRemove,this.matches[i])){newMatch=this.matches[i];break;}}}","for(i=0,iLen=matchesToRemove.length;i<iLen;i++){array_remove(this.matches,matchesToRemove[i]);matchesToRemove[i].remove();}","if(this.hasVisibleMatches()){if(newMatch===null){setCurrentMatchIndex(0);}else{var newMatchIndex=0;for(i=0,iLen=this.matches.length;i<iLen;i++){if(newMatch===this.matches[i]){newMatchIndex=i;break;}}","setCurrentMatchIndex(newMatchIndex);}}else{currentMatchIndex=null;displayNoMatches();}}};function getPageOffsetTop(el,container){var currentEl=el;var y=0;while(currentEl&&currentEl!=container){y+=currentEl.offsetTop;currentEl=currentEl.offsetParent;}","return y;}",'function scrollIntoView(el){var logContainer=logMainContainer;if(!$("wrap").checked){var logContainerLeft=logContainer.scrollLeft;var logContainerRight=logContainerLeft+logContainer.offsetWidth;var elLeft=el.offsetLeft;var elRight=elLeft+el.offsetWidth;if(elLeft<logContainerLeft||elRight>logContainerRight){logContainer.scrollLeft=elLeft-(logContainer.offsetWidth-el.offsetWidth)/2;}}',"var logContainerTop=logContainer.scrollTop;var logContainerBottom=logContainerTop+logContainer.offsetHeight;var elTop=getPageOffsetTop(el)-getToolBarsHeight();var elBottom=elTop+el.offsetHeight;if(elTop<logContainerTop||elBottom>logContainerBottom){logContainer.scrollTop=elTop-(logContainer.offsetHeight-el.offsetHeight)/2;}}","function Match(logEntryLevel,spanInMainDiv,spanInUnwrappedPre,spanInWrappedDiv){this.logEntryLevel=logEntryLevel;this.spanInMainDiv=spanInMainDiv;if(isIe){this.spanInUnwrappedPre=spanInUnwrappedPre;this.spanInWrappedDiv=spanInWrappedDiv;}","this.mainSpan=isIe?spanInUnwrappedPre:spanInMainDiv;}",'Match.prototype={equals:function(match){return this.mainSpan===match.mainSpan;},setCurrent:function(){if(isIe){addClass(this.spanInUnwrappedPre,"currentmatch");addClass(this.spanInWrappedDiv,"currentmatch");var elementToScroll=$("wrap").checked?this.spanInWrappedDiv:this.spanInUnwrappedPre;scrollIntoView(elementToScroll);}else{addClass(this.spanInMainDiv,"currentmatch");scrollIntoView(this.spanInMainDiv);}},belongsTo:function(logEntry){if(isIe){return isDescendant(this.spanInUnwrappedPre,logEntry.unwrappedPre);}else{return isDescendant(this.spanInMainDiv,logEntry.mainDiv);}},setNotCurrent:function(){if(isIe){removeClass(this.spanInUnwrappedPre,"currentmatch");removeClass(this.spanInWrappedDiv,"currentmatch");}else{removeClass(this.spanInMainDiv,"currentmatch");}},isOrphan:function(){return isOrphan(this.mainSpan);},isVisible:function(){return getCheckBox(this.logEntryLevel).checked;},remove:function(){if(isIe){this.spanInUnwrappedPre=null;this.spanInWrappedDiv=null;}else{this.spanInMainDiv=null;}}};var currentSearch=null;var currentMatchIndex=null;function doSearch(){var searchBox=$("searchBox");var searchTerm=searchBox.value;var isRegex=$("searchRegex").checked;var isCaseSensitive=$("searchCaseSensitive").checked;var i;if(searchTerm===""){$("searchReset").disabled=true;$("searchNav").style.display="none";removeClass(document.body,"searching");removeClass(searchBox,"hasmatches");removeClass(searchBox,"nomatches");for(i=0;i<logEntries.length;i++){logEntries[i].clearSearch();logEntries[i].setContent(logEntries[i].formattedMessage,logEntries[i].formattedMessage);}','currentSearch=null;setLogContainerHeight();}else{$("searchReset").disabled=false;$("searchNav").style.display="block";var searchRegex;var regexValid;if(isRegex){try{searchRegex=isCaseSensitive?new RegExp(searchTerm,"g"):new RegExp(searchTerm,"gi");regexValid=true;replaceClass(searchBox,"validregex","invalidregex");searchBox.title="Valid regex";}catch(ex){regexValid=false;replaceClass(searchBox,"invalidregex","validregex");searchBox.title="Invalid regex: "+(ex.message?ex.message:(ex.description?ex.description:"unknown error"));return;}}else{searchBox.title="";removeClass(searchBox,"validregex");removeClass(searchBox,"invalidregex");}','addClass(document.body,"searching");currentSearch=new Search(searchTerm,isRegex,searchRegex,isCaseSensitive);for(i=0;i<logEntries.length;i++){currentSearch.applyTo(logEntries[i]);}',"setLogContainerHeight();if(currentSearch.hasVisibleMatches()){setCurrentMatchIndex(0);displayMatches();}else{displayNoMatches();}}}","function updateSearchFromFilters(){if(currentSearch){if(currentSearch.hasMatches()){if(currentMatchIndex===null){currentMatchIndex=0;}","var currentMatch=currentSearch.matches[currentMatchIndex];if(currentMatch.isVisible()){displayMatches();setCurrentMatchIndex(currentMatchIndex);}else{currentMatch.setNotCurrent();var nextVisibleMatchIndex=currentSearch.getNextVisibleMatchIndex();if(nextVisibleMatchIndex>-1){setCurrentMatchIndex(nextVisibleMatchIndex);displayMatches();}else{displayNoMatches();}}}else{displayNoMatches();}}}","function refreshCurrentMatch(){if(currentSearch&&currentSearch.hasVisibleMatches()){setCurrentMatchIndex(currentMatchIndex);}}",'function displayMatches(){replaceClass($("searchBox"),"hasmatches","nomatches");$("searchBox").title=""+currentSearch.matches.length+" matches found";$("searchNav").style.display="block";setLogContainerHeight();}','function displayNoMatches(){replaceClass($("searchBox"),"nomatches","hasmatches");$("searchBox").title="No matches found";$("searchNav").style.display="none";setLogContainerHeight();}','function toggleSearchEnabled(enable){enable=(typeof enable=="undefined")?!$("searchDisable").checked:enable;$("searchBox").disabled=!enable;$("searchReset").disabled=!enable;$("searchRegex").disabled=!enable;$("searchNext").disabled=!enable;$("searchPrevious").disabled=!enable;$("searchCaseSensitive").disabled=!enable;$("searchNav").style.display=(enable&&($("searchBox").value!=="")&&currentSearch&&currentSearch.hasVisibleMatches())?"block":"none";if(enable){removeClass($("search"),"greyedout");addClass(document.body,"searching");if($("searchHighlight").checked){addClass(logMainContainer,"searchhighlight");}else{removeClass(logMainContainer,"searchhighlight");}','if($("searchFilter").checked){addClass(logMainContainer,"searchfilter");}else{removeClass(logMainContainer,"searchfilter");}','$("searchDisable").checked=!enable;}else{addClass($("search"),"greyedout");removeClass(document.body,"searching");removeClass(logMainContainer,"searchhighlight");removeClass(logMainContainer,"searchfilter");}',"setLogContainerHeight();}",'function toggleSearchFilter(){var enable=$("searchFilter").checked;if(enable){addClass(logMainContainer,"searchfilter");}else{removeClass(logMainContainer,"searchfilter");}',"refreshCurrentMatch();}",'function toggleSearchHighlight(){var enable=$("searchHighlight").checked;if(enable){addClass(logMainContainer,"searchhighlight");}else{removeClass(logMainContainer,"searchhighlight");}}','function clearSearch(){$("searchBox").value="";doSearch();}','function searchNext(){if(currentSearch!==null&&currentMatchIndex!==null){currentSearch.matches[currentMatchIndex].setNotCurrent();var nextMatchIndex=currentSearch.getNextVisibleMatchIndex();if(nextMatchIndex>currentMatchIndex||confirm("Reached the end of the page. Start from the top?")){setCurrentMatchIndex(nextMatchIndex);}}}','function searchPrevious(){if(currentSearch!==null&&currentMatchIndex!==null){currentSearch.matches[currentMatchIndex].setNotCurrent();var previousMatchIndex=currentSearch.getPreviousVisibleMatchIndex();if(previousMatchIndex<currentMatchIndex||confirm("Reached the start of the page. Continue from the bottom?")){setCurrentMatchIndex(previousMatchIndex);}}}',"function setCurrentMatchIndex(index){currentMatchIndex=index;currentSearch.matches[currentMatchIndex].setCurrent();}",'function addClass(el,cssClass){if(!hasClass(el,cssClass)){if(el.className){el.className+=" "+cssClass;}else{el.className=cssClass;}}}','function hasClass(el,cssClass){if(el.className){var classNames=el.className.split(" ");return array_contains(classNames,cssClass);}',"return false;}",'function removeClass(el,cssClass){if(hasClass(el,cssClass)){var existingClasses=el.className.split(" ");var newClasses=[];for(var i=0,len=existingClasses.length;i<len;i++){if(existingClasses[i]!=cssClass){newClasses[newClasses.length]=existingClasses[i];}}','el.className=newClasses.join(" ");}}',"function replaceClass(el,newCssClass,oldCssClass){removeClass(el,oldCssClass);addClass(el,newCssClass);}","function getElementsByClass(el,cssClass,tagName){var elements=el.getElementsByTagName(tagName);var matches=[];for(var i=0,len=elements.length;i<len;i++){if(hasClass(elements[i],cssClass)){matches.push(elements[i]);}}","return matches;}","function $(id){return document.getElementById(id);}","function isDescendant(node,ancestorNode){while(node!=null){if(node===ancestorNode){return true;}","node=node.parentNode;}","return false;}","function isOrphan(node){var currentNode=node;while(currentNode){if(currentNode==document.body){return false;}","currentNode=currentNode.parentNode;}","return true;}",'function escapeHtml(str){return str.replace(/&/g,"&amp;").replace(/[<]/g,"&lt;").replace(/>/g,"&gt;");}',"function getWindowWidth(){if(window.innerWidth){return window.innerWidth;}else if(document.documentElement&&document.documentElement.clientWidth){return document.documentElement.clientWidth;}else if(document.body){return document.body.clientWidth;}","return 0;}","function getWindowHeight(){if(window.innerHeight){return window.innerHeight;}else if(document.documentElement&&document.documentElement.clientHeight){return document.documentElement.clientHeight;}else if(document.body){return document.body.clientHeight;}","return 0;}",'function getToolBarsHeight(){return $("switches").offsetHeight;}','function getChromeHeight(){var height=getToolBarsHeight();if(showCommandLine){height+=$("commandLine").offsetHeight;}',"return height;}",'function setLogContainerHeight(){if(logMainContainer){var windowHeight=getWindowHeight();$("body").style.height=getWindowHeight()+"px";logMainContainer.style.height=""+','Math.max(0,windowHeight-getChromeHeight())+"px";}}','function setCommandInputWidth(){if(showCommandLine){$("command").style.width=""+Math.max(0,$("commandLineContainer").offsetWidth-','($("evaluateButton").offsetWidth+13))+"px";}}',"window.onresize=function(){setCommandInputWidth();setLogContainerHeight();};if(!Array.prototype.push){Array.prototype.push=function(){for(var i=0,len=arguments.length;i<len;i++){this[this.length]=arguments[i];}","return this.length;};}","if(!Array.prototype.pop){Array.prototype.pop=function(){if(this.length>0){var val=this[this.length-1];this.length=this.length-1;return val;}};}","if(!Array.prototype.shift){Array.prototype.shift=function(){if(this.length>0){var firstItem=this[0];for(var i=0,len=this.length-1;i<len;i++){this[i]=this[i+1];}","this.length=this.length-1;return firstItem;}};}","if(!Array.prototype.splice){Array.prototype.splice=function(startIndex,deleteCount){var itemsAfterDeleted=this.slice(startIndex+deleteCount);var itemsDeleted=this.slice(startIndex,startIndex+deleteCount);this.length=startIndex;var argumentsArray=[];for(var i=0,len=arguments.length;i<len;i++){argumentsArray[i]=arguments[i];}","var itemsToAppend=(argumentsArray.length>2)?itemsAfterDeleted=argumentsArray.slice(2).concat(itemsAfterDeleted):itemsAfterDeleted;for(i=0,len=itemsToAppend.length;i<len;i++){this.push(itemsToAppend[i]);}","return itemsDeleted;};}","function array_remove(arr,val){var index=-1;for(var i=0,len=arr.length;i<len;i++){if(arr[i]===val){index=i;break;}}","if(index>=0){arr.splice(index,1);return index;}else{return false;}}","function array_removeFromStart(array,numberToRemove){if(Array.prototype.splice){array.splice(0,numberToRemove);}else{for(var i=numberToRemove,len=array.length;i<len;i++){array[i-numberToRemove]=array[i];}","array.length=array.length-numberToRemove;}","return array;}","function array_contains(arr,val){for(var i=0,len=arr.length;i<len;i++){if(arr[i]==val){return true;}}","return false;}","function getErrorMessage(ex){if(ex.message){return ex.message;}else if(ex.description){return ex.description;}",'return""+ex;}',"function moveCaretToEnd(input){if(input.setSelectionRange){input.focus();var length=input.value.length;input.setSelectionRange(length,length);}else if(input.createTextRange){var range=input.createTextRange();range.collapse(false);range.select();}","input.focus();}",'function stopPropagation(evt){if(evt.stopPropagation){evt.stopPropagation();}else if(typeof evt.cancelBubble!="undefined"){evt.cancelBubble=true;}}',"function getEvent(evt){return evt?evt:event;}","function getTarget(evt){return evt.target?evt.target:evt.srcElement;}",'function getRelatedTarget(evt){if(evt.relatedTarget){return evt.relatedTarget;}else if(evt.srcElement){switch(evt.type){case"mouseover":return evt.fromElement;case"mouseout":return evt.toElement;default:return evt.srcElement;}}}',"function cancelKeyEvent(evt){evt.returnValue=false;stopPropagation(evt);}",'function evalCommandLine(){var expr=$("command").value;evalCommand(expr);$("command").value="";}',"function evalLastCommand(){if(lastCommand!=null){evalCommand(lastCommand);}}",'var lastCommand=null;var commandHistory=[];var currentCommandIndex=0;function evalCommand(expr){if(appender){appender.evalCommandAndAppend(expr);}else{var prefix=">>> "+expr+"\\r\\n";try{log("INFO",prefix+eval(expr));}catch(ex){log("ERROR",prefix+"Error: "+getErrorMessage(ex));}}',"if(expr!=commandHistory[commandHistory.length-1]){commandHistory.push(expr);if(appender){appender.storeCommandHistory(commandHistory);}}","currentCommandIndex=(expr==commandHistory[currentCommandIndex])?currentCommandIndex+1:commandHistory.length;lastCommand=expr;}","//]]>","</script>",'<style type="text/css">',"body{background-color:white;color:black;padding:0;margin:0;font-family:tahoma,verdana,arial,helvetica,sans-serif;overflow:hidden}div#switchesContainer input{margin-bottom:0}div.toolbar{border-top:solid #ffffff 1px;border-bottom:solid #aca899 1px;background-color:#f1efe7;padding:3px 5px;font-size:68.75%}div.toolbar,div#search input{font-family:tahoma,verdana,arial,helvetica,sans-serif}div.toolbar input.button{padding:0 5px;font-size:100%}div.toolbar input.hidden{display:none}div#switches input#clearButton{margin-left:20px}div#levels label{font-weight:bold}div#levels label,div#options label{margin-right:5px}div#levels label#wrapLabel{font-weight:normal}div#search label{margin-right:10px}div#search label.searchboxlabel{margin-right:0}div#search input{font-size:100%}div#search input.validregex{color:green}div#search input.invalidregex{color:red}div#search input.nomatches{color:white;background-color:#ff6666}div#search input.nomatches{color:white;background-color:#ff6666}div#searchNav{display:none}div#commandLine{display:none}div#commandLine input#command{font-size:100%;font-family:Courier New,Courier}div#commandLine input#evaluateButton{}*.greyedout{color:gray !important;border-color:gray !important}*.greyedout *.alwaysenabled{color:black}*.unselectable{-khtml-user-select:none;-moz-user-select:none;user-select:none}div#log{font-family:Courier New,Courier;font-size:75%;width:100%;overflow:auto;clear:both;position:relative}div.group{border-color:#cccccc;border-style:solid;border-width:1px 0 1px 1px;overflow:visible}div.oldIe div.group,div.oldIe div.group *,div.oldIe *.logentry{height:1%}div.group div.groupheading span.expander{border:solid black 1px;font-family:Courier New,Courier;font-size:0.833em;background-color:#eeeeee;position:relative;top:-1px;color:black;padding:0 2px;cursor:pointer;cursor:hand;height:1%}div.group div.groupcontent{margin-left:10px;padding-bottom:2px;overflow:visible}div.group div.expanded{display:block}div.group div.collapsed{display:none}*.logentry{overflow:visible;display:none;white-space:pre}span.pre{white-space:pre}pre.unwrapped{display:inline !important}pre.unwrapped pre.pre,div.wrapped pre.pre{display:inline}div.wrapped pre.pre{white-space:normal}div.wrapped{display:none}body.searching *.logentry span.currentmatch{color:white !important;background-color:green !important}body.searching div.searchhighlight *.logentry span.searchterm{color:black;background-color:yellow}div.wrap *.logentry{white-space:normal !important;border-width:0 0 1px 0;border-color:#dddddd;border-style:dotted}div.wrap #log_wrapped,#log_unwrapped{display:block}div.wrap #log_unwrapped,#log_wrapped{display:none}div.wrap *.logentry span.pre{overflow:visible;white-space:normal}div.wrap *.logentry pre.unwrapped{display:none}div.wrap *.logentry span.wrapped{display:inline}div.searchfilter *.searchnonmatch{display:none !important}div#log *.TRACE,label#label_TRACE{color:#666666}div#log *.DEBUG,label#label_DEBUG{color:green}div#log *.INFO,label#label_INFO{color:#000099}div#log *.WARN,label#label_WARN{color:#999900}div#log *.ERROR,label#label_ERROR{color:red}div#log *.FATAL,label#label_FATAL{color:#660066}div.TRACE#log *.TRACE,div.DEBUG#log *.DEBUG,div.INFO#log *.INFO,div.WARN#log *.WARN,div.ERROR#log *.ERROR,div.FATAL#log *.FATAL{display:block}div#log div.separator{background-color:#cccccc;margin:5px 0;line-height:1px}","</style>","</head>",'<body id="body">','<div id="switchesContainer">','<div id="switches">','<div id="levels" class="toolbar">',"Filters:",'<input type="checkbox" id="switch_TRACE" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide trace messages" /><label for="switch_TRACE" id="label_TRACE">trace</label>','<input type="checkbox" id="switch_DEBUG" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide debug messages" /><label for="switch_DEBUG" id="label_DEBUG">debug</label>','<input type="checkbox" id="switch_INFO" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide info messages" /><label for="switch_INFO" id="label_INFO">info</label>','<input type="checkbox" id="switch_WARN" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide warn messages" /><label for="switch_WARN" id="label_WARN">warn</label>','<input type="checkbox" id="switch_ERROR" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide error messages" /><label for="switch_ERROR" id="label_ERROR">error</label>','<input type="checkbox" id="switch_FATAL" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide fatal messages" /><label for="switch_FATAL" id="label_FATAL">fatal</label>','<input type="checkbox" id="switch_ALL" onclick="toggleAllLevels(); applyFilters()" checked="checked" title="Show/hide all messages" /><label for="switch_ALL" id="label_ALL">all</label>',"</div>",'<div id="search" class="toolbar">','<label for="searchBox" class="searchboxlabel">Search:</label> <input type="text" id="searchBox" onclick="toggleSearchEnabled(true)" onkeyup="scheduleSearch()" size="20" />','<input type="button" id="searchReset" disabled="disabled" value="Reset" onclick="clearSearch()" class="button" title="Reset the search" />','<input type="checkbox" id="searchRegex" onclick="doSearch()" title="If checked, search is treated as a regular expression" /><label for="searchRegex">Regex</label>','<input type="checkbox" id="searchCaseSensitive" onclick="doSearch()" title="If checked, search is case sensitive" /><label for="searchCaseSensitive">Match case</label>','<input type="checkbox" id="searchDisable" onclick="toggleSearchEnabled()" title="Enable/disable search" /><label for="searchDisable" class="alwaysenabled">Disable</label>','<div id="searchNav">','<input type="button" id="searchNext" disabled="disabled" value="Next" onclick="searchNext()" class="button" title="Go to the next matching log entry" />','<input type="button" id="searchPrevious" disabled="disabled" value="Previous" onclick="searchPrevious()" class="button" title="Go to the previous matching log entry" />','<input type="checkbox" id="searchFilter" onclick="toggleSearchFilter()" title="If checked, non-matching log entries are filtered out" /><label for="searchFilter">Filter</label>','<input type="checkbox" id="searchHighlight" onclick="toggleSearchHighlight()" title="Highlight matched search terms" /><label for="searchHighlight" class="alwaysenabled">Highlight all</label>',"</div>","</div>",'<div id="options" class="toolbar">',"Options:",'<input type="checkbox" id="enableLogging" onclick="toggleLoggingEnabled()" checked="checked" title="Enable/disable logging" /><label for="enableLogging" id="enableLoggingLabel">Log</label>','<input type="checkbox" id="wrap" onclick="toggleWrap()" title="Enable / disable word wrap" /><label for="wrap" id="wrapLabel">Wrap</label>','<input type="checkbox" id="newestAtTop" onclick="toggleNewestAtTop()" title="If checked, causes newest messages to appear at the top" /><label for="newestAtTop" id="newestAtTopLabel">Newest at the top</label>','<input type="checkbox" id="scrollToLatest" onclick="toggleScrollToLatest()" checked="checked" title="If checked, window automatically scrolls to a new message when it is added" /><label for="scrollToLatest" id="scrollToLatestLabel">Scroll to latest</label>','<input type="button" id="clearButton" value="Clear" onclick="clearLog()" class="button" title="Clear all log messages"  />','<input type="button" id="hideButton" value="Hide" onclick="hide()" class="hidden button" title="Hide the console" />','<input type="button" id="closeButton" value="Close" onclick="closeWindow()" class="hidden button" title="Close the window" />',"</div>","</div>","</div>",'<div id="log" class="TRACE DEBUG INFO WARN ERROR FATAL"></div>','<div id="commandLine" class="toolbar">','<div id="commandLineContainer">','<input type="text" id="command" title="Enter a JavaScript command here and hit return or press \'Evaluate\'" />','<input type="button" id="evaluateButton" value="Evaluate" class="button" title="Evaluate the command" onclick="evalCommandLine()" />',"</div>","</div>","</body>","</html>",""];
},i=[];ConsoleAppender=function(){};var s=1;ConsoleAppender.prototype=new Appender,ConsoleAppender.prototype.create=function(t,e,o,a,r,l,u,c){function h(t,e){this.loggingEvent=t,this.levelName=t.level.name,this.formattedMessage=e}function d(t,e){this.name=t,this.initiallyExpanded=e}function p(){}var f=this,g=!1,m=!1,v=!1,b=!1,y=[],_=!0,w=s++;a=extractBooleanFromParam(a,this.defaults.initiallyMinimized),o=extractBooleanFromParam(o,this.defaults.lazyInit),r=extractBooleanFromParam(r,this.defaults.useDocumentWrite);var M=this.defaults.newestMessageAtTop,x=this.defaults.scrollToLatestMessage;l=l?l:this.defaults.width,u=u?u:this.defaults.height;var C=this.defaults.maxMessages,I=this.defaults.showCommandLine,S=this.defaults.commandLineObjectExpansionDepth,E=this.defaults.showHideButton,L=this.defaults.showCloseButton;this.defaults.showLogEntryDeleteButtons;this.setLayout(this.defaults.layout);var k,D,P,T,N,A=t?"InPageAppender":"PopUpAppender",O=function(t){return m?(handleError(A+": configuration option '"+t+"' may not be set after the appender has been initialized"),!1):!0},V=function(){return v&&_&&!b};this.isNewestMessageAtTop=function(){return M},this.setNewestMessageAtTop=function(t){M=bool(t),V()&&T().setNewestAtTop(M)},this.isScrollToLatestMessage=function(){return x},this.setScrollToLatestMessage=function(t){x=bool(t),V()&&T().setScrollToLatest(x)},this.getWidth=function(){return l},this.setWidth=function(t){O("width")&&(l=extractStringFromParam(t,l))},this.getHeight=function(){return u},this.setHeight=function(t){O("height")&&(u=extractStringFromParam(t,u))},this.getMaxMessages=function(){return C},this.setMaxMessages=function(t){C=extractIntFromParam(t,C),V()&&T().setMaxMessages(C)},this.isShowCommandLine=function(){return I},this.setShowCommandLine=function(t){I=bool(t),V()&&T().setShowCommandLine(I)},this.isShowHideButton=function(){return E},this.setShowHideButton=function(t){E=bool(t),V()&&T().setShowHideButton(E)},this.isShowCloseButton=function(){return L},this.setShowCloseButton=function(t){L=bool(t),V()&&T().setShowCloseButton(L)},this.getCommandLineObjectExpansionDepth=function(){return S},this.setCommandLineObjectExpansionDepth=function(t){S=extractIntFromParam(t,S)};var R=a;this.isInitiallyMinimized=function(){return a},this.setInitiallyMinimized=function(t){O("initiallyMinimized")&&(a=bool(t),R=a)},this.isUseDocumentWrite=function(){return r},this.setUseDocumentWrite=function(t){O("useDocumentWrite")&&(r=bool(t))},h.prototype.append=function(){T().log(this.levelName,this.formattedMessage)},d.prototype.append=function(){T().group(this.name,this.initiallyExpanded)},p.prototype.append=function(){T().groupEnd()};var F=function(){P(),g?b&&et&&D():k(),P()&&j()};this.append=function(t){if(_){var e=f.getLayout().formatWithException(t);y.push(new h(t,e)),F()}},this.group=function(t,e){_&&(y.push(new d(t,e)),F())},this.groupEnd=function(){_&&(y.push(new p),F())};var j=function(){for(;y.length>0;)y.shift().append();c&&T().focus()};this.setAddedToLogger=function(t){this.loggers.push(t),enabled&&!o&&k()},this.clear=function(){V()&&T().clearLog(),y.length=0},this.focus=function(){V()&&T().focus()},this.focusCommandLine=function(){V()&&T().focusCommandLine()},this.focusSearch=function(){V()&&T().focusSearch()};var z=window;this.getCommandWindow=function(){return z},this.setCommandWindow=function(t){z=t},this.executeLastCommand=function(){V()&&T().evalLastCommand()};var B=new PatternLayout("%m");this.getCommandLayout=function(){return B},this.setCommandLayout=function(t){B=t},this.evalCommandAndAppend=function(t){var e={appendResult:!0,isError:!1},n="";try{var i,s;!z.eval&&z.execScript&&z.execScript("null");var o={};for(s=0,len=W.length;s<len;s++)o[W[s][0]]=W[s][1];var a=[],r=function(t){a.push([t,z[t]])};r("appender"),z.appender=f,r("commandReturnValue"),z.commandReturnValue=e,r("commandLineFunctionsHash"),z.commandLineFunctionsHash=o;var l=function(t){r(t),z[t]=function(){return this.commandLineFunctionsHash[t](f,arguments,e)}};for(s=0,len=W.length;s<len;s++)l(W[s][0]);for(z===window&&z.execScript?(r("evalExpr"),r("result"),window.evalExpr=t,z.execScript("window.result=eval(window.evalExpr);"),i=window.result):i=z.eval(t),n=isUndefined(i)?i:formatObjectExpansion(i,S),s=0,len=a.length;s<len;s++)z[a[s][0]]=a[s][1]}catch(u){n="Error evaluating command: "+getExceptionStringRep(u),e.isError=!0}if(e.appendResult){var c=">>> "+t;isUndefined(n)||(c+=newLine+n);var h=e.isError?Level.ERROR:Level.INFO,d=new LoggingEvent(null,new Date,h,[c],null),p=this.getLayout();this.setLayout(B),this.append(d),this.setLayout(p)}};var W=i.concat([]);this.addCommandLineFunction=function(t,e){W.push([t,e])};var H="log4javascriptCommandHistory";this.storeCommandHistory=function(t){setCookie(H,t.join(","))};var U=function(t){var e=n();t.open();for(var i=0,s=e.length;s>i;i++)t.writeln(e[i]);t.close()};this.setEventTypes(["load","unload"]);var $=function(){var t=T();t.setAppender(f),t.setNewestAtTop(M),t.setScrollToLatest(x),t.setMaxMessages(C),t.setShowCommandLine(I),t.setShowHideButton(E),t.setShowCloseButton(L),t.setMainWindow(window);var e=getCookie(H);e&&(t.commandHistory=e.split(","),t.currentCommandIndex=t.commandHistory.length),f.dispatchEvent("load",{win:t})};this.unload=function(){logLog.debug("unload "+this+", caller: "+this.unload.caller),b||(logLog.debug("really doing unload "+this),b=!0,v=!1,m=!1,f.dispatchEvent("unload",{}))};var G=function(t,e,n,i){function s(){try{b&&clearInterval(o),t(T())&&(clearInterval(o),n())}catch(e){clearInterval(o),_=!1,handleError(i,e)}}var o=setInterval(s,e)},q=function(){var t=document.domain!=location.hostname;return r?"":getBaseUrl()+"console.html"+(t?"?log4javascript_domain="+escape(document.domain):"")};if(t){var Y=null,K=[];this.addCssProperty=function(t,e){O("cssProperties")&&K.push([t,e])};var X,Z=!1,Q=uniqueId+"_InPageAppender_"+w;this.hide=function(){g&&m&&(V()&&T().$("command").blur(),X.style.display="none",R=!0)},this.show=function(){g&&(m?(X.style.display="block",this.setShowCommandLine(I),R=!1):Z||D(!0))},this.isVisible=function(){return!R&&!b},this.close=function(t){b||t&&!confirm("This will permanently remove the console from the page. No more messages will be logged. Do you wish to continue?")||(X.parentNode.removeChild(X),this.unload())},N=function(){function t(){try{a||f.show(),$(),v=!0,j()}catch(t){_=!1,handleError(n,t)}}function e(){try{var e=function(t){return isLoaded(t)};r&&U(T().document),e(T())?t():G(e,100,t,n)}catch(i){_=!1,handleError(n,i)}}var n="InPageAppender.open: unable to create console iframe";R=!1,X=Y.appendChild(document.createElement("div")),X.style.width=l,X.style.height=u,X.style.border="solid gray 1px";for(var i=0,s=K.length;s>i;i++)X.style[K[i][0]]=K[i][1];var o=r?"":" src='"+q()+"'";X.innerHTML="<iframe id='"+Q+"' name='"+Q+"' width='100%' height='100%' frameborder='0'"+o+" scrolling='no'></iframe>",b=!1;var c=function(t){try{return bool(t)&&bool(t.document)}catch(e){return!1}};c(T())?e():G(c,100,e,n),m=!0},D=function(t){if(t||!a){var n=function(){if(e)try{var t=document.getElementById(e);1==t.nodeType&&(Y=t),N()}catch(n){handleError("InPageAppender.init: invalid container element '"+e+"' supplied",n)}else Y=document.createElement("div"),Y.style.position="fixed",Y.style.left="0",Y.style.right="0",Y.style.bottom="0",document.body.appendChild(Y),f.addCssProperty("borderWidth","1px 0 0 0"),f.addCssProperty("zIndex",1e6),N()};pageLoaded&&e&&e.appendChild?(Y=e,N()):pageLoaded?n():log4javascript.addEventListener("load",n),Z=!0}},k=function(){D(),g=!0},T=function(){var t=window.frames[Q];return t?t:void 0},P=function(){return _&&!b?(m&&!v&&T()&&isLoaded(T())&&(v=!0),v):!1}}else{var J=f.defaults.useOldPopUp,tt=f.defaults.complainAboutPopUpBlocking,et=this.defaults.reopenWhenClosed;this.isUseOldPopUp=function(){return J},this.setUseOldPopUp=function(t){O("useOldPopUp")&&(J=bool(t))},this.isComplainAboutPopUpBlocking=function(){return tt},this.setComplainAboutPopUpBlocking=function(t){O("complainAboutPopUpBlocking")&&(tt=bool(t))},this.isFocusPopUp=function(){return c},this.setFocusPopUp=function(t){c=bool(t)},this.isReopenWhenClosed=function(){return et},this.setReopenWhenClosed=function(t){et=bool(t)},this.close=function(){logLog.debug("close "+this);try{nt.close(),this.unload()}catch(t){}},this.hide=function(){logLog.debug("hide "+this),V()&&this.close()},this.show=function(){logLog.debug("show "+this),m||N()},this.isVisible=function(){return P()};var nt;N=function(){function t(){T().setCloseIfOpenerCloses(!J||!r),$(),v=!0,j(),G(a,500,c,"PopUpAppender.checkPopUpClosed: error checking pop-up window")}var e="width="+l+",height="+u+",status,resizable",n="";try{var i=window.frameElement;i&&(n="_"+i.tagName+"_"+(i.name||i.id||""))}catch(s){n="_inaccessibleParentFrame"}var o="PopUp_"+location.host.replace(/[^a-z0-9]/gi,"_")+"_"+w+n;J&&r||(o=o+"_"+uniqueId);var a=function(t){if(b)return!0;try{return bool(t)&&t.closed}catch(e){}return!1},c=function(){b||f.unload()};try{if(nt=window.open(q(),o,e),b=!1,m=!0,nt&&nt.document)if(r&&J&&isLoaded(nt))nt.mainPageReloaded(),t();else{r&&U(nt.document);var h=function(t){return bool(t)&&isLoaded(t)};isLoaded(nt)?t():G(h,100,t,"PopUpAppender.init: unable to create console window")}else _=!1,logLog.warn("PopUpAppender.init: pop-ups blocked, please unblock to use PopUpAppender"),tt&&handleError("log4javascript: pop-up windows appear to be blocked. Please unblock them to use pop-up logging.")}catch(d){handleError("PopUpAppender.init: error creating pop-up",d)}},D=function(){a||N()},k=function(){D(),g=!0},T=function(){return nt},P=function(){if(_&&!isUndefined(nt)&&!b){if(nt.closed||v&&isUndefined(nt.closed))return f.unload(),logLog.debug("PopUpAppender: pop-up closed"),!1;!v&&isLoaded(nt)&&(v=!0)}return _&&v&&!b}}this.getConsoleWindow=T},ConsoleAppender.addGlobalCommandLineFunction=function(t,e){i.push([t,e])},t.prototype=new ConsoleAppender,t.prototype.defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,focusPopUp:!1,lazyInit:!0,useOldPopUp:!0,complainAboutPopUpBlocking:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"600",height:"400",reopenWhenClosed:!1,maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!0,showLogEntryDeleteButtons:!0,useDocumentWrite:!0},t.prototype.toString=function(){return"PopUpAppender"},log4javascript.PopUpAppender=t,e.prototype=new ConsoleAppender,e.prototype.defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,lazyInit:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"100%",height:"220px",maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!1,showLogEntryDeleteButtons:!0,useDocumentWrite:!0},e.prototype.toString=function(){return"InPageAppender"},log4javascript.InPageAppender=e,log4javascript.InlineAppender=e}(),function(){function t(t){var e=0;for(var n in t)e=Math.max(toStr(n).length,e);var i=[];for(n in t){var s,o="  "+padWithSpaces(toStr(n),e+2);try{s=splitIntoLines(toStr(t[n])).join(padWithSpaces(newLine,e+6))}catch(a){s="[Error obtaining property. Details: "+getExceptionMessage(a)+"]"}i.push(o+s)}return i.join(newLine)}function e(t,n,i,l,u){function c(t){return t.nodeType==s.TEXT_NODE&&/^[ \t\r\n]*$/.test(t.nodeValue)}function h(t){return t.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function d(t){for(var e=t.style.cssText.split(";"),n="",i=0,s=e.length;s>i;i++){var o=e[i].split(":"),a=[];/^\s*$/.test(o[0])||a.push(trim(o[0]).toLowerCase()+":"+trim(o[1])),n=a.join(";")}return n}function p(t){if(t.prefix)return t.prefix;if(t.outerHTML){var e=new RegExp("<([^:]+):"+t.tagName+"[^>]*>","i");if(e.test(t.outerHTML))return RegExp.$1.toLowerCase()}return""}n="undefined"==typeof n?!0:!!n,"string"!=typeof i&&(i=""),l=!!l,u=!!u;var f,g="<",m=">";if(!n||t.nodeType==s.DOCUMENT_FRAGMENT_NODE){f="";for(var v=0,b=t.childNodes.length;b>v;v++)f+=e(t.childNodes[v],!0,i+r);return f}switch(t.nodeType){case s.ELEMENT_NODE:var y=t.tagName.toLowerCase();f=l?newLine+i:"",f+=g;var _=p(t),w=!!_;for(w&&(f+=_+":"),f+=y,v=0,b=t.attributes.length;b>v;v++){var M=t.attributes[v];M.specified&&null!==M.nodeValue&&"style"!==M.nodeName.toLowerCase()&&"string"==typeof M.nodeValue&&0!==M.nodeName.indexOf("_moz")&&(f+=" "+M.nodeName.toLowerCase()+'="',f+=h(M.nodeValue),f+='"')}if(t.style.cssText){var x=d(t);""!==x&&(f+=' style="'+d(t)+'"')}if(array_contains(a,y)||w&&!t.hasChildNodes())f+="/"+m;else{f+=m;for(var C=!(1===t.childNodes.length&&t.childNodes[0].nodeType===s.TEXT_NODE),I=array_contains(o,y),v=0,b=t.childNodes.length;b>v;v++)f+=e(t.childNodes[v],!0,i+r,C,I);var S=g+"/"+y+m;f+=C?newLine+i+S:S}return f;case s.TEXT_NODE:if(c(t))f="";else{if(u)f=t.nodeValue;else{for(var E=splitIntoLines(trim(t.nodeValue)),L=[],v=0,b=E.length;b>v;v++)L[v]=trim(E[v]);f=L.join(newLine+i)}l&&(f=newLine+i+f)}return f;case s.CDATA_SECTION_NODE:return"<![CDATA["+t.nodeValue+"]]>"+newLine;case s.DOCUMENT_NODE:f="";for(var v=0,b=t.childNodes.length;b>v;v++)f+=e(t.childNodes[v],!0,i);return f;default:return""}}function n(){ConsoleAppender.addGlobalCommandLineFunction("$",function(t,e,n){return document.getElementById(e[0])}),ConsoleAppender.addGlobalCommandLineFunction("dir",function(e,n,i){for(var s=[],o=0,a=n.length;a>o;o++)s[o]=t(n[o]);return s.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("dirxml",function(t,n,i){for(var s=[],o=0,a=n.length;a>o;o++){t.getCommandWindow();s[o]=e(n[o])}return s.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("cd",function(t,e,n){var i,s;return 0===e.length||""===e[0]?(i=window,s="Command line set to run in main window"):e[0].window==e[0]?(i=e[0],s="Command line set to run in frame '"+e[0].name+"'"):(i=window.frames[e[0]],i?s="Command line set to run in frame '"+e[0]+"'":(n.isError=!0,s="Frame '"+e[0]+"' does not exist",i=t.getCommandWindow())),t.setCommandWindow(i),s}),ConsoleAppender.addGlobalCommandLineFunction("clear",function(t,e,n){n.appendResult=!1,t.clear()}),ConsoleAppender.addGlobalCommandLineFunction("keys",function(t,e,n){var i=[];for(var s in e[0])i.push(s);return i}),ConsoleAppender.addGlobalCommandLineFunction("values",function(t,e,n){var i=[];for(var s in e[0])try{i.push(e[0][s])}catch(o){logLog.warn("values(): Unable to obtain value for key "+s+". Details: "+getExceptionMessage(o))}return i}),ConsoleAppender.addGlobalCommandLineFunction("expansionDepth",function(t,e,n){var i=parseInt(e[0],10);return isNaN(i)||0>i?(n.isError=!0,""+e[0]+" is not a valid expansion depth"):(t.setCommandLineObjectExpansionDepth(i),"Object expansion depth set to "+i)})}function i(){n()}var s={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},o=["script","pre"],a=["br","img","hr","param","link","area","input","col","base","meta"],r="  ";i()}(),log4javascript.setDocumentReady=function(){pageLoaded=!0,log4javascript.dispatchEvent("load",{})},window.addEventListener)window.addEventListener("load",log4javascript.setDocumentReady,!1);else if(window.attachEvent)window.attachEvent("onload",log4javascript.setDocumentReady);else{var oldOnload=window.onload;"function"!=typeof window.onload?window.onload=log4javascript.setDocumentReady:window.onload=function(t){oldOnload&&oldOnload(t),log4javascript.setDocumentReady()}}return window.log4javascript=log4javascript,log4javascript}();BITS=[16,8,4,2,1],BASE32="0123456789bcdefghjkmnpqrstuvwxyz",NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}},BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}},NEIGHBORS.bottom.odd=NEIGHBORS.left.even,NEIGHBORS.top.odd=NEIGHBORS.right.even,NEIGHBORS.left.odd=NEIGHBORS.bottom.even,NEIGHBORS.right.odd=NEIGHBORS.top.even,BORDERS.bottom.odd=BORDERS.left.even,BORDERS.top.odd=BORDERS.right.even,BORDERS.left.odd=BORDERS.bottom.even,BORDERS.right.odd=BORDERS.top.even,!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.proj4=t()}}(function(){return function t(e,n,i){function s(a,r){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!r&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};e[a][0].call(u.exports,function(t){var n=e[a][1][t];return s(n?n:t)},u,u.exports,t,e,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)s(i[a]);return s}({1:[function(t,e){function n(t,e,i){if(!(this instanceof n))return new n(t,e,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&"undefined"==typeof e){var s=t.split(",");this.x=parseFloat(s[0],10),this.y=parseFloat(s[1],10),this.z=parseFloat(s[2],10)||0}else this.x=t,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var i=t("mgrs");n.fromMGRS=function(t){return new n(i.toPoint(t))},n.prototype.toMGRS=function(t){return i.forward([this.x,this.y],t)},e.exports=n},{mgrs:66}],2:[function(t,e){function n(t,e){if(!(this instanceof n))return new n(t);e=e||function(t){if(t)throw t};var o=i(t);if("object"!=typeof o)return void e(t);var r=a(o),l=n.projections.get(r.projName);l?(s(this,r),s(this,l),this.init(),e(null,this)):e(t)}var i=t("./parseCode"),s=t("./extend"),o=t("./projections"),a=t("./deriveConstants");n.projections=o,n.projections.start(),e.exports=n},{"./deriveConstants":32,"./extend":33,"./parseCode":36,"./projections":38}],3:[function(t,e){e.exports=function(t,e,n){var i,s,o,a=n.x,r=n.y,l=n.z||0;for(o=0;3>o;o++)if(!e||2!==o||void 0!==n.z)switch(0===o?(i=a,s="x"):1===o?(i=r,s="y"):(i=l,s="z"),t.axis[o]){case"e":n[s]=i;break;case"w":n[s]=-i;break;case"n":n[s]=i;break;case"s":n[s]=-i;break;case"u":void 0!==n[s]&&(n.z=i);break;case"d":void 0!==n[s]&&(n.z=-i);break;default:return null}return n}},{}],4:[function(t,e){var n=Math.PI/2,i=t("./sign");e.exports=function(t){return Math.abs(t)<n?t:t-i(t)*Math.PI}},{"./sign":21}],5:[function(t,e){var n=2*Math.PI,i=t("./sign");e.exports=function(t){return Math.abs(t)<Math.PI?t:t-i(t)*n}},{"./sign":21}],6:[function(t,e){e.exports=function(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}},{}],7:[function(t,e){e.exports=function(t){return 1-.25*t*(1+t/16*(3+1.25*t))}},{}],8:[function(t,e){e.exports=function(t){return.375*t*(1+.25*t*(1+.46875*t))}},{}],9:[function(t,e){e.exports=function(t){return.05859375*t*t*(1+.75*t)}},{}],10:[function(t,e){e.exports=function(t){return t*t*t*(35/3072)}},{}],11:[function(t,e){e.exports=function(t,e,n){var i=e*n;return t/Math.sqrt(1-i*i)}},{}],12:[function(t,e){e.exports=function(t,e,n,i,s){var o,a;o=t/e;for(var r=0;15>r;r++)if(a=(t-(e*o-n*Math.sin(2*o)+i*Math.sin(4*o)-s*Math.sin(6*o)))/(e-2*n*Math.cos(2*o)+4*i*Math.cos(4*o)-6*s*Math.cos(6*o)),o+=a,Math.abs(a)<=1e-10)return o;return NaN}},{}],13:[function(t,e){var n=Math.PI/2;e.exports=function(t,e){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-i)<1e-6)return 0>e?-1*n:n;for(var s,o,a,r,l=Math.asin(.5*e),u=0;30>u;u++)if(o=Math.sin(l),a=Math.cos(l),r=t*o,s=Math.pow(1-r*r,2)/(2*a)*(e/(1-t*t)-o/(1-r*r)+.5/t*Math.log((1-r)/(1+r))),l+=s,Math.abs(s)<=1e-10)return l;return NaN}},{}],14:[function(t,e){e.exports=function(t,e,n,i,s){return t*s-e*Math.sin(2*s)+n*Math.sin(4*s)-i*Math.sin(6*s)}},{}],15:[function(t,e){e.exports=function(t,e,n){var i=t*e;return n/Math.sqrt(1-i*i)}},{}],16:[function(t,e){var n=Math.PI/2;e.exports=function(t,e){for(var i,s,o=.5*t,a=n-2*Math.atan(e),r=0;15>=r;r++)if(i=t*Math.sin(a),s=n-2*Math.atan(e*Math.pow((1-i)/(1+i),o))-a,a+=s,Math.abs(s)<=1e-10)return a;return-9999}},{}],17:[function(t,e){var n=1,i=.25,s=.046875,o=.01953125,a=.01068115234375,r=.75,l=.46875,u=.013020833333333334,c=.007120768229166667,h=.3645833333333333,d=.005696614583333333,p=.3076171875;e.exports=function(t){var e=[];e[0]=n-t*(i+t*(s+t*(o+t*a))),e[1]=t*(r-t*(s+t*(o+t*a)));var f=t*t;return e[2]=f*(l-t*(u+t*c)),f*=t,e[3]=f*(h-t*d),e[4]=f*t*p,e}},{}],18:[function(t,e){var n=t("./pj_mlfn"),i=1e-10,s=20;e.exports=function(t,e,o){for(var a=1/(1-e),r=t,l=s;l;--l){var u=Math.sin(r),c=1-e*u*u;if(c=(n(r,u,Math.cos(r),o)-t)*c*Math.sqrt(c)*a,r-=c,Math.abs(c)<i)return r}return r}},{"./pj_mlfn":19}],19:[function(t,e){e.exports=function(t,e,n,i){return n*=e,e*=e,i[0]*t-n*(i[1]+e*(i[2]+e*(i[3]+e*i[4])))}},{}],20:[function(t,e){e.exports=function(t,e){var n;return t>1e-7?(n=t*e,(1-t*t)*(e/(1-n*n)-.5/t*Math.log((1-n)/(1+n)))):2*e}},{}],21:[function(t,e){e.exports=function(t){return 0>t?-1:1}},{}],22:[function(t,e){e.exports=function(t,e){return Math.pow((1-t)/(1+t),e)}},{}],23:[function(t,e){e.exports=function(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}},{}],24:[function(t,e){var n=Math.PI/2;e.exports=function(t,e,i){var s=t*i,o=.5*t;return s=Math.pow((1-s)/(1+s),o),Math.tan(.5*(n-e))/s}},{}],25:[function(t,e,n){n.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},n.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},n.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},n.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},n.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},n.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},n.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},n.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},n.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},n.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},n.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},n.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},n.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},n.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},n.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},n.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},{}],26:[function(t,e,n){n.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},n.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},n.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},n.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},n.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},n.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},n.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},n.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},n.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},n.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},n.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},n.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},n.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},n.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},n.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},n.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},n.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},n.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},n.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},n.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},n.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},n.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},n.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},n.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},n.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},n.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},n.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},n.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},n.hough={a:6378270,rf:297,ellipseName:"Hough"},n.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},n.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},n.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},n.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},n.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},n.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},n.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},n.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},n.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},n.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},n.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},n.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"},n.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"},n.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},{}],27:[function(t,e,n){n.greenwich=0,n.lisbon=-9.131906111111,n.paris=2.337229166667,n.bogota=-74.080916666667,n.madrid=-3.687938888889,n.rome=12.452333333333,n.bern=7.439583333333,n.jakarta=106.807719444444,n.ferro=-17.666666666667,n.brussels=4.367975,n.stockholm=18.058277777778,n.athens=23.7163375,n.oslo=10.722916666667},{}],28:[function(t,e){function n(t,e,n){var i;return Array.isArray(n)?(i=a(t,e,n),3===n.length?[i.x,i.y,i.z]:[i.x,i.y]):a(t,e,n)}function i(t){return t instanceof o?t:t.oProj?t.oProj:o(t)}function s(t,e,s){t=i(t);var o,a=!1;return"undefined"==typeof e?(e=t,t=r,a=!0):("undefined"!=typeof e.x||Array.isArray(e))&&(s=e,e=t,t=r,a=!0),e=i(e),s?n(t,e,s):(o={forward:function(i){return n(t,e,i)},inverse:function(i){return n(e,t,i)}},a&&(o.oProj=e),o)}var o=t("./Proj"),a=t("./transform"),r=o("WGS84");e.exports=s},{"./Proj":2,"./transform":64}],29:[function(t,e){var n=Math.PI/2,i=1,s=2,o=3,a=4,r=5,l=484813681109536e-20,u=1.0026,c=.3826834323650898,h=function(t){if(!(this instanceof h))return new h(t);if(this.datum_type=a,t){if(t.datumCode&&"none"===t.datumCode&&(this.datum_type=r),t.datum_params){for(var e=0;e<t.datum_params.length;e++)t.datum_params[e]=parseFloat(t.datum_params[e]);(0!==t.datum_params[0]||0!==t.datum_params[1]||0!==t.datum_params[2])&&(this.datum_type=i),t.datum_params.length>3&&(0!==t.datum_params[3]||0!==t.datum_params[4]||0!==t.datum_params[5]||0!==t.datum_params[6])&&(this.datum_type=s,t.datum_params[3]*=l,t.datum_params[4]*=l,t.datum_params[5]*=l,t.datum_params[6]=t.datum_params[6]/1e6+1)}this.datum_type=t.grids?o:this.datum_type,this.a=t.a,this.b=t.b,this.es=t.es,this.ep2=t.ep2,this.datum_params=t.datum_params,this.datum_type===o&&(this.grids=t.grids)}};h.prototype={compare_datums:function(t){return this.datum_type!==t.datum_type?!1:this.a!==t.a||Math.abs(this.es-t.es)>5e-11?!1:this.datum_type===i?this.datum_params[0]===t.datum_params[0]&&this.datum_params[1]===t.datum_params[1]&&this.datum_params[2]===t.datum_params[2]:this.datum_type===s?this.datum_params[0]===t.datum_params[0]&&this.datum_params[1]===t.datum_params[1]&&this.datum_params[2]===t.datum_params[2]&&this.datum_params[3]===t.datum_params[3]&&this.datum_params[4]===t.datum_params[4]&&this.datum_params[5]===t.datum_params[5]&&this.datum_params[6]===t.datum_params[6]:this.datum_type===o||t.datum_type===o?this.nadgrids===t.nadgrids:!0},geodetic_to_geocentric:function(t){var e,i,s,o,a,r,l,u=t.x,c=t.y,h=t.z?t.z:0,d=0;if(-n>c&&c>-1.001*n)c=-n;else if(c>n&&1.001*n>c)c=n;else if(-n>c||c>n)return null;return u>Math.PI&&(u-=2*Math.PI),a=Math.sin(c),l=Math.cos(c),r=a*a,o=this.a/Math.sqrt(1-this.es*r),e=(o+h)*l*Math.cos(u),i=(o+h)*l*Math.sin(u),s=(o*(1-this.es)+h)*a,t.x=e,t.y=i,t.z=s,d},geocentric_to_geodetic:function(t){var e,i,s,o,a,r,l,u,c,h,d,p,f,g,m,v,b,y=1e-12,_=y*y,w=30,M=t.x,x=t.y,C=t.z?t.z:0;if(f=!1,e=Math.sqrt(M*M+x*x),i=Math.sqrt(M*M+x*x+C*C),e/this.a<y){if(f=!0,m=0,i/this.a<y)return v=n,void(b=-this.b)}else m=Math.atan2(x,M);s=C/i,o=e/i,a=1/Math.sqrt(1-this.es*(2-this.es)*o*o),u=o*(1-this.es)*a,c=s*a,g=0;do g++,l=this.a/Math.sqrt(1-this.es*c*c),b=e*u+C*c-l*(1-this.es*c*c),r=this.es*l/(l+b),a=1/Math.sqrt(1-r*(2-r)*o*o),h=o*(1-r)*a,d=s*a,p=d*u-h*c,u=h,c=d;while(p*p>_&&w>g);return v=Math.atan(d/Math.abs(h)),t.x=m,t.y=v,t.z=b,t},geocentric_to_geodetic_noniter:function(t){var e,i,s,o,a,r,l,h,d,p,f,g,m,v,b,y,_,w=t.x,M=t.y,x=t.z?t.z:0;if(w=parseFloat(w),M=parseFloat(M),x=parseFloat(x),_=!1,0!==w)e=Math.atan2(M,w);else if(M>0)e=n;else if(0>M)e=-n;else if(_=!0,e=0,x>0)i=n;else{if(!(0>x))return i=n,void(s=-this.b);i=-n}return a=w*w+M*M,o=Math.sqrt(a),r=x*u,h=Math.sqrt(r*r+a),p=r/h,g=o/h,f=p*p*p,l=x+this.b*this.ep2*f,y=o-this.a*this.es*g*g*g,d=Math.sqrt(l*l+y*y),m=l/d,v=y/d,b=this.a/Math.sqrt(1-this.es*m*m),s=v>=c?o/v-b:-c>=v?o/-v-b:x/m+b*(this.es-1),_===!1&&(i=Math.atan(m/v)),t.x=e,t.y=i,t.z=s,t},geocentric_to_wgs84:function(t){if(this.datum_type===i)t.x+=this.datum_params[0],t.y+=this.datum_params[1],t.z+=this.datum_params[2];else if(this.datum_type===s){var e=this.datum_params[0],n=this.datum_params[1],o=this.datum_params[2],a=this.datum_params[3],r=this.datum_params[4],l=this.datum_params[5],u=this.datum_params[6],c=u*(t.x-l*t.y+r*t.z)+e,h=u*(l*t.x+t.y-a*t.z)+n,d=u*(-r*t.x+a*t.y+t.z)+o;t.x=c,t.y=h,t.z=d}},geocentric_from_wgs84:function(t){if(this.datum_type===i)t.x-=this.datum_params[0],t.y-=this.datum_params[1],t.z-=this.datum_params[2];else if(this.datum_type===s){var e=this.datum_params[0],n=this.datum_params[1],o=this.datum_params[2],a=this.datum_params[3],r=this.datum_params[4],l=this.datum_params[5],u=this.datum_params[6],c=(t.x-e)/u,h=(t.y-n)/u,d=(t.z-o)/u;t.x=c+l*h-r*d,t.y=-l*c+h+a*d,t.z=r*c-a*h+d}}},e.exports=h},{}],30:[function(t,e){var n=1,i=2,s=3,o=5,a=6378137,r=.006694379990141316;e.exports=function(t,e,l){function u(t){return t===n||t===i}var c,h,d;if(t.compare_datums(e))return l;if(t.datum_type===o||e.datum_type===o)return l;var p=t.a,f=t.es,g=e.a,m=e.es,v=t.datum_type;if(v===s)if(0===this.apply_gridshift(t,0,l))t.a=a,t.es=r;else{if(!t.datum_params)return t.a=p,t.es=t.es,l;for(c=1,h=0,d=t.datum_params.length;d>h;h++)c*=t.datum_params[h];if(0===c)return t.a=p,t.es=t.es,l;v=t.datum_params.length>3?i:n}return e.datum_type===s&&(e.a=a,e.es=r),(t.es!==e.es||t.a!==e.a||u(v)||u(e.datum_type))&&(t.geodetic_to_geocentric(l),u(t.datum_type)&&t.geocentric_to_wgs84(l),u(e.datum_type)&&e.geocentric_from_wgs84(l),e.geocentric_to_geodetic(l)),e.datum_type===s&&this.apply_gridshift(e,1,l),t.a=p,t.es=f,e.a=g,e.es=m,l}},{}],31:[function(t,e){function n(t){var e=this;if(2===arguments.length){var i=arguments[1];n[t]="string"==typeof i?"+"===i[0]?s(arguments[1]):o(arguments[1]):i}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?n.apply(e,t):n(t)});if("string"==typeof t){if(t in n)return n[t]}else"EPSG"in t?n["EPSG:"+t.EPSG]=t:"ESRI"in t?n["ESRI:"+t.ESRI]=t:"IAU2000"in t?n["IAU2000:"+t.IAU2000]=t:console.log(t);return}}var i=t("./global"),s=t("./projString"),o=t("./wkt");i(n),e.exports=n},{"./global":34,"./projString":37,"./wkt":65}],32:[function(t,e){var n=t("./constants/Datum"),i=t("./constants/Ellipsoid"),s=t("./extend"),o=t("./datum"),a=1e-10,r=.16666666666666666,l=.04722222222222222,u=.022156084656084655;e.exports=function(t){if(t.datumCode&&"none"!==t.datumCode){
var e=n[t.datumCode];e&&(t.datum_params=e.towgs84?e.towgs84.split(","):null,t.ellps=e.ellipse,t.datumName=e.datumName?e.datumName:t.datumCode)}if(!t.a){var c=i[t.ellps]?i[t.ellps]:i.WGS84;s(t,c)}return t.rf&&!t.b&&(t.b=(1-1/t.rf)*t.a),(0===t.rf||Math.abs(t.a-t.b)<a)&&(t.sphere=!0,t.b=t.a),t.a2=t.a*t.a,t.b2=t.b*t.b,t.es=(t.a2-t.b2)/t.a2,t.e=Math.sqrt(t.es),t.R_A&&(t.a*=1-t.es*(r+t.es*(l+t.es*u)),t.a2=t.a*t.a,t.b2=t.b*t.b,t.es=0),t.ep2=(t.a2-t.b2)/t.b2,t.k0||(t.k0=1),t.axis||(t.axis="enu"),t.datum=o(t),t}},{"./constants/Datum":25,"./constants/Ellipsoid":26,"./datum":29,"./extend":33}],33:[function(t,e){e.exports=function(t,e){t=t||{};var n,i;if(!e)return t;for(i in e)n=e[i],void 0!==n&&(t[i]=n);return t}},{}],34:[function(t,e){e.exports=function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}},{}],35:[function(t,e){var n=t("./core");n.defaultDatum="WGS84",n.Proj=t("./Proj"),n.WGS84=new n.Proj("WGS84"),n.Point=t("./Point"),n.toPoint=t("./common/toPoint"),n.defs=t("./defs"),n.transform=t("./transform"),n.mgrs=t("mgrs"),n.version=t("../package.json").version,t("./includedProjections")(n),e.exports=n},{"../package.json":67,"./Point":1,"./Proj":2,"./common/toPoint":23,"./core":28,"./defs":31,"./includedProjections":"gWUPNW","./transform":64,mgrs:66}],36:[function(t,e){function n(t){return"string"==typeof t}function i(t){return t in r}function s(t){var e=["GEOGCS","GEOCCS","PROJCS","LOCAL_CS"];return e.reduce(function(e,n){return e+1+t.indexOf(n)},0)}function o(t){return"+"===t[0]}function a(t){return n(t)?i(t)?r[t]:s(t)?l(t):o(t)?u(t):void 0:t}var r=t("./defs"),l=t("./wkt"),u=t("./projString");e.exports=a},{"./defs":31,"./projString":37,"./wkt":65}],37:[function(t,e){var n=.017453292519943295,i=t("./constants/PrimeMeridian");e.exports=function(t){var e={},s={};t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).forEach(function(t){var e=t.split("=");e.push(!0),s[e[0].toLowerCase()]=e[1]});var o,a,r,l={proj:"projName",datum:"datumCode",rf:function(t){e.rf=parseFloat(t,10)},lat_0:function(t){e.lat0=t*n},lat_1:function(t){e.lat1=t*n},lat_2:function(t){e.lat2=t*n},lat_ts:function(t){e.lat_ts=t*n},lon_0:function(t){e.long0=t*n},lon_1:function(t){e.long1=t*n},lon_2:function(t){e.long2=t*n},alpha:function(t){e.alpha=parseFloat(t)*n},lonc:function(t){e.longc=t*n},x_0:function(t){e.x0=parseFloat(t,10)},y_0:function(t){e.y0=parseFloat(t,10)},k_0:function(t){e.k0=parseFloat(t,10)},k:function(t){e.k0=parseFloat(t,10)},r_a:function(){e.R_A=!0},zone:function(t){e.zone=parseInt(t,10)},south:function(){e.utmSouth=!0},towgs84:function(t){e.datum_params=t.split(",").map(function(t){return parseFloat(t,10)})},to_meter:function(t){e.to_meter=parseFloat(t,10)},from_greenwich:function(t){e.from_greenwich=t*n},pm:function(t){e.from_greenwich=(i[t]?i[t]:parseFloat(t,10))*n},nadgrids:function(t){"@null"===t?e.datumCode="none":e.nadgrids=t},axis:function(t){var n="ewnsud";3===t.length&&-1!==n.indexOf(t.substr(0,1))&&-1!==n.indexOf(t.substr(1,1))&&-1!==n.indexOf(t.substr(2,1))&&(e.axis=t)}};for(o in s)a=s[o],o in l?(r=l[o],"function"==typeof r?r(a):e[r]=a):e[o]=a;return"string"==typeof e.datumCode&&"WGS84"!==e.datumCode&&(e.datumCode=e.datumCode.toLowerCase()),e}},{"./constants/PrimeMeridian":27}],38:[function(t,e,n){function i(t,e){var n=a.length;return t.names?(a[n]=t,t.names.forEach(function(t){o[t.toLowerCase()]=n}),this):(console.log(e),!0)}var s=[t("./projections/merc"),t("./projections/longlat")],o={},a=[];n.add=i,n.get=function(t){if(!t)return!1;var e=t.toLowerCase();return"undefined"!=typeof o[e]&&a[o[e]]?a[o[e]]:void 0},n.start=function(){s.forEach(i)}},{"./projections/longlat":50,"./projections/merc":51}],39:[function(t,e,n){var i=1e-10,s=t("../common/msfnz"),o=t("../common/qsfnz"),a=t("../common/adjust_lon"),r=t("../common/asinz");n.init=function(){Math.abs(this.lat1+this.lat2)<i||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=s(this.e3,this.sin_po,this.cos_po),this.qs1=o(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=s(this.e3,this.sin_po,this.cos_po),this.qs2=o(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=o(this.e3,this.sin_po,this.cos_po),this.ns0=Math.abs(this.lat1-this.lat2)>i?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},n.forward=function(t){var e=t.x,n=t.y;this.sin_phi=Math.sin(n),this.cos_phi=Math.cos(n);var i=o(this.e3,this.sin_phi,this.cos_phi),s=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,r=this.ns0*a(e-this.long0),l=s*Math.sin(r)+this.x0,u=this.rh-s*Math.cos(r)+this.y0;return t.x=l,t.y=u,t},n.inverse=function(t){var e,n,i,s,o,r;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),i=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),i=-1),s=0,0!==e&&(s=Math.atan2(i*t.x,i*t.y)),i=e*this.ns0/this.a,this.sphere?r=Math.asin((this.c-i*i)/(2*this.ns0)):(n=(this.c-i*i)/this.ns0,r=this.phi1z(this.e3,n)),o=a(s/this.ns0+this.long0),t.x=o,t.y=r,t},n.phi1z=function(t,e){var n,s,o,a,l,u=r(.5*e);if(i>t)return u;for(var c=t*t,h=1;25>=h;h++)if(n=Math.sin(u),s=Math.cos(u),o=t*n,a=1-o*o,l=.5*a*a/s*(e/(1-c)-n/a+.5/t*Math.log((1-o)/(1+o))),u+=l,Math.abs(l)<=1e-7)return u;return null},n.names=["Albers_Conic_Equal_Area","Albers","aea"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/msfnz":15,"../common/qsfnz":20}],40:[function(t,e,n){var i=t("../common/adjust_lon"),s=Math.PI/2,o=1e-10,a=t("../common/mlfn"),r=t("../common/e0fn"),l=t("../common/e1fn"),u=t("../common/e2fn"),c=t("../common/e3fn"),h=t("../common/gN"),d=t("../common/asinz"),p=t("../common/imlfn");n.init=function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},n.forward=function(t){var e,n,d,p,f,g,m,v,b,y,_,w,M,x,C,I,S,E,L,k,D,P,T,N=t.x,A=t.y,O=Math.sin(t.y),V=Math.cos(t.y),R=i(N-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=o?(t.x=this.x0+this.a*(s-A)*Math.sin(R),t.y=this.y0-this.a*(s-A)*Math.cos(R),t):Math.abs(this.sin_p12+1)<=o?(t.x=this.x0+this.a*(s+A)*Math.sin(R),t.y=this.y0+this.a*(s+A)*Math.cos(R),t):(E=this.sin_p12*O+this.cos_p12*V*Math.cos(R),I=Math.acos(E),S=I/Math.sin(I),t.x=this.x0+this.a*S*V*Math.sin(R),t.y=this.y0+this.a*S*(this.cos_p12*O-this.sin_p12*V*Math.cos(R)),t):(e=r(this.es),n=l(this.es),d=u(this.es),p=c(this.es),Math.abs(this.sin_p12-1)<=o?(f=this.a*a(e,n,d,p,s),g=this.a*a(e,n,d,p,A),t.x=this.x0+(f-g)*Math.sin(R),t.y=this.y0-(f-g)*Math.cos(R),t):Math.abs(this.sin_p12+1)<=o?(f=this.a*a(e,n,d,p,s),g=this.a*a(e,n,d,p,A),t.x=this.x0+(f+g)*Math.sin(R),t.y=this.y0+(f+g)*Math.cos(R),t):(m=O/V,v=h(this.a,this.e,this.sin_p12),b=h(this.a,this.e,O),y=Math.atan((1-this.es)*m+this.es*v*this.sin_p12/(b*V)),_=Math.atan2(Math.sin(R),this.cos_p12*Math.tan(y)-this.sin_p12*Math.cos(R)),L=0===_?Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.abs(Math.abs(_)-Math.PI)<=o?-Math.asin(this.cos_p12*Math.sin(y)-this.sin_p12*Math.cos(y)):Math.asin(Math.sin(R)*Math.cos(y)/Math.sin(_)),w=this.e*this.sin_p12/Math.sqrt(1-this.es),M=this.e*this.cos_p12*Math.cos(_)/Math.sqrt(1-this.es),x=w*M,C=M*M,k=L*L,D=k*L,P=D*L,T=P*L,I=v*L*(1-k*C*(1-C)/6+D/8*x*(1-2*C)+P/120*(C*(4-7*C)-3*w*w*(1-7*C))-T/48*x),t.x=this.x0+I*Math.sin(_),t.y=this.y0+I*Math.cos(_),t))},n.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,n,f,g,m,v,b,y,_,w,M,x,C,I,S,E,L,k,D,P,T,N,A;if(this.sphere){if(e=Math.sqrt(t.x*t.x+t.y*t.y),e>2*s*this.a)return;return n=e/this.a,f=Math.sin(n),g=Math.cos(n),m=this.long0,Math.abs(e)<=o?v=this.lat0:(v=d(g*this.sin_p12+t.y*f*this.cos_p12/e),b=Math.abs(this.lat0)-s,m=i(Math.abs(b)<=o?this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y):this.long0+Math.atan2(t.x*f,e*this.cos_p12*g-t.y*this.sin_p12*f))),t.x=m,t.y=v,t}return y=r(this.es),_=l(this.es),w=u(this.es),M=c(this.es),Math.abs(this.sin_p12-1)<=o?(x=this.a*a(y,_,w,M,s),e=Math.sqrt(t.x*t.x+t.y*t.y),C=x-e,v=p(C/this.a,y,_,w,M),m=i(this.long0+Math.atan2(t.x,-1*t.y)),t.x=m,t.y=v,t):Math.abs(this.sin_p12+1)<=o?(x=this.a*a(y,_,w,M,s),e=Math.sqrt(t.x*t.x+t.y*t.y),C=e-x,v=p(C/this.a,y,_,w,M),m=i(this.long0+Math.atan2(t.x,t.y)),t.x=m,t.y=v,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),E=Math.atan2(t.x,t.y),I=h(this.a,this.e,this.sin_p12),L=Math.cos(E),k=this.e*this.cos_p12*L,D=-k*k/(1-this.es),P=3*this.es*(1-D)*this.sin_p12*this.cos_p12*L/(1-this.es),T=e/I,N=T-D*(1+D)*Math.pow(T,3)/6-P*(1+3*D)*Math.pow(T,4)/24,A=1-D*N*N/2-T*N*N*N/6,S=Math.asin(this.sin_p12*Math.cos(N)+this.cos_p12*Math.sin(N)*L),m=i(this.long0+Math.asin(Math.sin(E)*Math.sin(N)/Math.cos(S))),v=Math.atan((1-this.es*A*this.sin_p12/Math.sin(S))*Math.tan(S)/(1-this.es)),t.x=m,t.y=v,t)},n.names=["Azimuthal_Equidistant","aeqd"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],41:[function(t,e,n){var i=t("../common/mlfn"),s=t("../common/e0fn"),o=t("../common/e1fn"),a=t("../common/e2fn"),r=t("../common/e3fn"),l=t("../common/gN"),u=t("../common/adjust_lon"),c=t("../common/adjust_lat"),h=t("../common/imlfn"),d=Math.PI/2,p=1e-10;n.init=function(){this.sphere||(this.e0=s(this.es),this.e1=o(this.es),this.e2=a(this.es),this.e3=r(this.es),this.ml0=this.a*i(this.e0,this.e1,this.e2,this.e3,this.lat0))},n.forward=function(t){var e,n,s=t.x,o=t.y;if(s=u(s-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(o)*Math.sin(s)),n=this.a*(Math.atan2(Math.tan(o),Math.cos(s))-this.lat0);else{var a=Math.sin(o),r=Math.cos(o),c=l(this.a,this.e,a),h=Math.tan(o)*Math.tan(o),d=s*Math.cos(o),p=d*d,f=this.es*r*r/(1-this.es),g=this.a*i(this.e0,this.e1,this.e2,this.e3,o);e=c*d*(1-p*h*(1/6-(8-h+8*f)*p/120)),n=g-this.ml0+c*a/r*p*(.5+(5-h+6*f)*p/24)}return t.x=e+this.x0,t.y=n+this.y0,t},n.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,n,i=t.x/this.a,s=t.y/this.a;if(this.sphere){var o=s+this.lat0;e=Math.asin(Math.sin(o)*Math.cos(i)),n=Math.atan2(Math.tan(i),Math.cos(o))}else{var a=this.ml0/this.a+s,r=h(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(r)-d)<=p)return t.x=this.long0,t.y=d,0>s&&(t.y*=-1),t;var f=l(this.a,this.e,Math.sin(r)),g=f*f*f/this.a/this.a*(1-this.es),m=Math.pow(Math.tan(r),2),v=i*this.a/f,b=v*v;e=r-f*Math.tan(r)/g*v*v*(.5-(1+3*m)*v*v/24),n=v*(1-b*(m/3+(1+3*m)*m*b/15))/Math.cos(r)}return t.x=u(n+this.long0),t.y=c(e),t},n.names=["Cassini","Cassini_Soldner","cass"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],42:[function(t,e,n){var i=t("../common/adjust_lon"),s=t("../common/qsfnz"),o=t("../common/msfnz"),a=t("../common/iqsfnz");n.init=function(){this.sphere||(this.k0=o(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},n.forward=function(t){var e,n,o=t.x,a=t.y,r=i(o-this.long0);if(this.sphere)e=this.x0+this.a*r*Math.cos(this.lat_ts),n=this.y0+this.a*Math.sin(a)/Math.cos(this.lat_ts);else{var l=s(this.e,Math.sin(a));e=this.x0+this.a*this.k0*r,n=this.y0+this.a*l*.5/this.k0}return t.x=e,t.y=n,t},n.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,n;return this.sphere?(e=i(this.long0+t.x/this.a/Math.cos(this.lat_ts)),n=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(n=a(this.e,2*t.y*this.k0/this.a),e=i(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=n,t},n.names=["cea"]},{"../common/adjust_lon":5,"../common/iqsfnz":13,"../common/msfnz":15,"../common/qsfnz":20}],43:[function(t,e,n){var i=t("../common/adjust_lon"),s=t("../common/adjust_lat");n.init=function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},n.forward=function(t){var e=t.x,n=t.y,o=i(e-this.long0),a=s(n-this.lat0);return t.x=this.x0+this.a*o*this.rc,t.y=this.y0+this.a*a,t},n.inverse=function(t){var e=t.x,n=t.y;return t.x=i(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=s(this.lat0+(n-this.y0)/this.a),t},n.names=["Equirectangular","Equidistant_Cylindrical","eqc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5}],44:[function(t,e,n){var i=t("../common/e0fn"),s=t("../common/e1fn"),o=t("../common/e2fn"),a=t("../common/e3fn"),r=t("../common/msfnz"),l=t("../common/mlfn"),u=t("../common/adjust_lon"),c=t("../common/adjust_lat"),h=t("../common/imlfn"),d=1e-10;n.init=function(){Math.abs(this.lat1+this.lat2)<d||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=i(this.es),this.e1=s(this.es),this.e2=o(this.es),this.e3=a(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=r(this.e,this.sinphi,this.cosphi),this.ml1=l(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<d?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=r(this.e,this.sinphi,this.cosphi),this.ml2=l(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=l(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},n.forward=function(t){var e,n=t.x,i=t.y;if(this.sphere)e=this.a*(this.g-i);else{var s=l(this.e0,this.e1,this.e2,this.e3,i);e=this.a*(this.g-s)}var o=this.ns*u(n-this.long0),a=this.x0+e*Math.sin(o),r=this.y0+this.rh-e*Math.cos(o);return t.x=a,t.y=r,t},n.inverse=function(t){t.x-=this.x0,t.y=this.rh-t.y+this.y0;var e,n,i,s;this.ns>=0?(n=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(n=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var o=0;if(0!==n&&(o=Math.atan2(e*t.x,e*t.y)),this.sphere)return s=u(this.long0+o/this.ns),i=c(this.g-n/this.a),t.x=s,t.y=i,t;var a=this.g-n/this.a;return i=h(a,this.e0,this.e1,this.e2,this.e3),s=u(this.long0+o/this.ns),t.x=s,t.y=i,t},n.names=["Equidistant_Conic","eqdc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/imlfn":12,"../common/mlfn":14,"../common/msfnz":15}],45:[function(t,e,n){var i=Math.PI/4,s=t("../common/srat"),o=Math.PI/2,a=20;n.init=function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+i)/(Math.pow(Math.tan(.5*this.lat0+i),this.C)*s(this.e*t,this.ratexp))},n.forward=function(t){var e=t.x,n=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*n+i),this.C)*s(this.e*Math.sin(n),this.ratexp))-o,t.x=this.C*e,t},n.inverse=function(t){for(var e=1e-14,n=t.x/this.C,r=t.y,l=Math.pow(Math.tan(.5*r+i)/this.K,1/this.C),u=a;u>0&&(r=2*Math.atan(l*s(this.e*Math.sin(t.y),-.5*this.e))-o,!(Math.abs(r-t.y)<e));--u)t.y=r;return u?(t.x=n,t.y=r,t):null},n.names=["gauss"]},{"../common/srat":22}],46:[function(t,e,n){var i=t("../common/adjust_lon"),s=1e-10,o=t("../common/asinz");n.init=function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},n.forward=function(t){var e,n,o,a,r,l,u,c,h=t.x,d=t.y;return o=i(h-this.long0),e=Math.sin(d),n=Math.cos(d),a=Math.cos(o),l=this.sin_p14*e+this.cos_p14*n*a,r=1,l>0||Math.abs(l)<=s?(u=this.x0+this.a*r*n*Math.sin(o)/l,c=this.y0+this.a*r*(this.cos_p14*e-this.sin_p14*n*a)/l):(u=this.x0+this.infinity_dist*n*Math.sin(o),c=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*n*a)),t.x=u,t.y=c,t},n.inverse=function(t){var e,n,s,a,r,l;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(a=Math.atan2(e,this.rc),n=Math.sin(a),s=Math.cos(a),l=o(s*this.sin_p14+t.y*n*this.cos_p14/e),r=Math.atan2(t.x*n,e*this.cos_p14*s-t.y*this.sin_p14*n),r=i(this.long0+r)):(l=this.phic0,r=0),t.x=r,t.y=l,t},n.names=["gnom"]},{"../common/adjust_lon":5,"../common/asinz":6}],47:[function(t,e,n){var i=t("../common/adjust_lon");n.init=function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},n.forward=function(t){var e,n,s,o,a,r,l,u=t.x,c=t.y,h=i(u-this.long0);return e=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),n=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/e)-this.s45),s=-h*this.alfa,o=Math.asin(Math.cos(this.ad)*Math.sin(n)+Math.sin(this.ad)*Math.cos(n)*Math.cos(s)),a=Math.asin(Math.cos(n)*Math.sin(s)/Math.cos(o)),r=this.n*a,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(o/2+this.s45),this.n),t.y=l*Math.cos(r)/1,t.x=l*Math.sin(r)/1,this.czech||(t.y*=-1,t.x*=-1),t},n.inverse=function(t){var e,n,i,s,o,a,r,l,u=t.x;t.x=t.y,t.y=u,this.czech||(t.y*=-1,t.x*=-1),a=Math.sqrt(t.x*t.x+t.y*t.y),o=Math.atan2(t.y,t.x),s=o/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(s)),n=Math.asin(Math.cos(i)*Math.sin(s)/Math.cos(e)),t.x=this.long0-n/this.alfa,r=e,l=0;var c=0;do t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(r))/(1-this.e*Math.sin(r)),this.e/2))-this.s45),Math.abs(r-t.y)<1e-10&&(l=1),r=t.y,c+=1;while(0===l&&15>c);return c>=15?null:t},n.names=["Krovak","krovak"]},{"../common/adjust_lon":5}],48:[function(t,e,n){var i=Math.PI/2,s=Math.PI/4,o=1e-10,a=t("../common/qsfnz"),r=t("../common/adjust_lon");n.S_POLE=1,n.N_POLE=2,n.EQUIT=3,n.OBLIQ=4,n.init=function(){var t=Math.abs(this.lat0);if(this.mode=Math.abs(t-i)<o?this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<o?this.EQUIT:this.OBLIQ,this.es>0){var e;switch(this.qp=a(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=a(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},n.forward=function(t){var e,n,l,u,c,h,d,p,f,g,m=t.x,v=t.y;if(m=r(m-this.long0),this.sphere){if(c=Math.sin(v),g=Math.cos(v),l=Math.cos(m),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(n=this.mode===this.EQUIT?1+g*l:1+this.sinph0*c+this.cosph0*g*l,o>=n)return null;n=Math.sqrt(2/n),e=n*g*Math.sin(m),n*=this.mode===this.EQUIT?c:this.cosph0*c-this.sinph0*g*l}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(l=-l),Math.abs(v+this.phi0)<o)return null;n=s-.5*v,n=2*(this.mode===this.S_POLE?Math.cos(n):Math.sin(n)),e=n*Math.sin(m),n*=l}}else{switch(d=0,p=0,f=0,l=Math.cos(m),u=Math.sin(m),c=Math.sin(v),h=a(this.e,c),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(d=h/this.qp,p=Math.sqrt(1-d*d)),this.mode){case this.OBLIQ:f=1+this.sinb1*d+this.cosb1*p*l;break;case this.EQUIT:f=1+p*l;break;case this.N_POLE:f=i+v,h=this.qp-h;break;case this.S_POLE:f=v-i,h=this.qp+h}if(Math.abs(f)<o)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:f=Math.sqrt(2/f),n=this.mode===this.OBLIQ?this.ymf*f*(this.cosb1*d-this.sinb1*p*l):(f=Math.sqrt(2/(1+p*l)))*d*this.ymf,e=this.xmf*f*p*u;break;case this.N_POLE:case this.S_POLE:h>=0?(e=(f=Math.sqrt(h))*u,n=l*(this.mode===this.S_POLE?f:-f)):e=n=0}}return t.x=this.a*e+this.x0,t.y=this.a*n+this.y0,t},n.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,n,s,a,l,u,c,h=t.x/this.a,d=t.y/this.a;if(this.sphere){var p,f=0,g=0;if(p=Math.sqrt(h*h+d*d),n=.5*p,n>1)return null;switch(n=2*Math.asin(n),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(g=Math.sin(n),f=Math.cos(n)),this.mode){case this.EQUIT:n=Math.abs(p)<=o?0:Math.asin(d*g/p),h*=g,d=f*p;break;case this.OBLIQ:n=Math.abs(p)<=o?this.phi0:Math.asin(f*this.sinph0+d*g*this.cosph0/p),h*=g*this.cosph0,d=(f-Math.sin(n)*this.sinph0)*p;break;case this.N_POLE:d=-d,n=i-n;break;case this.S_POLE:n-=i}e=0!==d||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(h,d):0}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(h/=this.dd,d*=this.dd,u=Math.sqrt(h*h+d*d),o>u)return t.x=0,t.y=this.phi0,t;a=2*Math.asin(.5*u/this.rq),s=Math.cos(a),h*=a=Math.sin(a),this.mode===this.OBLIQ?(c=s*this.sinb1+d*a*this.cosb1/u,l=this.qp*c,d=u*this.cosb1*s-d*this.sinb1*a):(c=d*a/u,l=this.qp*c,d=u*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(d=-d),l=h*h+d*d,!l)return t.x=0,t.y=this.phi0,t;c=1-l/this.qp,this.mode===this.S_POLE&&(c=-c)}e=Math.atan2(h,d),n=this.authlat(Math.asin(c),this.apa)}return t.x=r(this.long0+e),t.y=n,t},n.P00=.3333333333333333,n.P01=.17222222222222222,n.P02=.10257936507936508,n.P10=.06388888888888888,n.P11=.0664021164021164,n.P20=.016415012942191543,n.authset=function(t){var e,n=[];return n[0]=t*this.P00,e=t*t,n[0]+=e*this.P01,n[1]=e*this.P10,e*=t,n[0]+=e*this.P02,n[1]+=e*this.P11,n[2]=e*this.P20,n},n.authlat=function(t,e){var n=t+t;return t+e[0]*Math.sin(n)+e[1]*Math.sin(n+n)+e[2]*Math.sin(n+n+n)},n.names=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"]},{"../common/adjust_lon":5,"../common/qsfnz":20}],49:[function(t,e,n){var i=1e-10,s=t("../common/msfnz"),o=t("../common/tsfnz"),a=Math.PI/2,r=t("../common/sign"),l=t("../common/adjust_lon"),u=t("../common/phi2z");n.init=function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<i)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),n=Math.cos(this.lat1),a=s(this.e,e,n),r=o(this.e,this.lat1,e),l=Math.sin(this.lat2),u=Math.cos(this.lat2),c=s(this.e,l,u),h=o(this.e,this.lat2,l),d=o(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>i?Math.log(a/c)/Math.log(r/h):e,isNaN(this.ns)&&(this.ns=e),this.f0=a/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(d,this.ns),this.title||(this.title="Lambert Conformal Conic")}},n.forward=function(t){var e=t.x,n=t.y;Math.abs(2*Math.abs(n)-Math.PI)<=i&&(n=r(n)*(a-2*i));var s,u,c=Math.abs(Math.abs(n)-a);if(c>i)s=o(this.e,n,Math.sin(n)),u=this.a*this.f0*Math.pow(s,this.ns);else{if(c=n*this.ns,0>=c)return null;u=0}var h=this.ns*l(e-this.long0);return t.x=this.k0*u*Math.sin(h)+this.x0,t.y=this.k0*(this.rh-u*Math.cos(h))+this.y0,t},n.inverse=function(t){var e,n,i,s,o,r=(t.x-this.x0)/this.k0,c=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(r*r+c*c),n=1):(e=-Math.sqrt(r*r+c*c),n=-1);var h=0;if(0!==e&&(h=Math.atan2(n*r,n*c)),0!==e||this.ns>0){if(n=1/this.ns,i=Math.pow(e/(this.a*this.f0),n),s=u(this.e,i),-9999===s)return null}else s=-a;return o=l(h/this.ns+this.long0),t.x=o,t.y=s,t},n.names=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],50:[function(t,e,n){function i(t){return t}n.init=function(){},n.forward=i,n.inverse=i,n.names=["longlat","identity"]},{}],51:[function(t,e,n){var i=t("../common/msfnz"),s=Math.PI/2,o=1e-10,a=57.29577951308232,r=t("../common/adjust_lon"),l=Math.PI/4,u=t("../common/tsfnz"),c=t("../common/phi2z");n.init=function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.k0=this.sphere?Math.cos(this.lat_ts):i(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k0=this.k?this.k:1)},n.forward=function(t){var e=t.x,n=t.y;if(n*a>90&&-90>n*a&&e*a>180&&-180>e*a)return null;var i,c;if(Math.abs(Math.abs(n)-s)<=o)return null;if(this.sphere)i=this.x0+this.a*this.k0*r(e-this.long0),c=this.y0+this.a*this.k0*Math.log(Math.tan(l+.5*n));else{var h=Math.sin(n),d=u(this.e,n,h);i=this.x0+this.a*this.k0*r(e-this.long0),c=this.y0-this.a*this.k0*Math.log(d)}return t.x=i,t.y=c,t},n.inverse=function(t){var e,n,i=t.x-this.x0,o=t.y-this.y0;if(this.sphere)n=s-2*Math.atan(Math.exp(-o/(this.a*this.k0)));else{var a=Math.exp(-o/(this.a*this.k0));if(n=c(this.e,a),-9999===n)return null}return e=r(this.long0+i/(this.a*this.k0)),t.x=e,t.y=n,t},n.names=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/tsfnz":24}],52:[function(t,e,n){var i=t("../common/adjust_lon");n.init=function(){},n.forward=function(t){var e=t.x,n=t.y,s=i(e-this.long0),o=this.x0+this.a*s,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+n/2.5))*1.25;return t.x=o,t.y=a,t},n.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e=i(this.long0+t.x/this.a),n=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=n,t},n.names=["Miller_Cylindrical","mill"]},{"../common/adjust_lon":5}],53:[function(t,e,n){var i=t("../common/adjust_lon"),s=1e-10;n.init=function(){},n.forward=function(t){for(var e=t.x,n=t.y,o=i(e-this.long0),a=n,r=Math.PI*Math.sin(n),l=0;!0;l++){var u=-(a+Math.sin(a)-r)/(1+Math.cos(a));if(a+=u,Math.abs(u)<s)break}a/=2,Math.PI/2-Math.abs(n)<s&&(o=0);var c=.900316316158*this.a*o*Math.cos(a)+this.x0,h=1.4142135623731*this.a*Math.sin(a)+this.y0;return t.x=c,t.y=h,t},n.inverse=function(t){var e,n;t.x-=this.x0,t.y-=this.y0,n=t.y/(1.4142135623731*this.a),Math.abs(n)>.999999999999&&(n=.999999999999),e=Math.asin(n);var s=i(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));s<-Math.PI&&(s=-Math.PI),s>Math.PI&&(s=Math.PI),n=(2*e+Math.sin(2*e))/Math.PI,Math.abs(n)>1&&(n=1);var o=Math.asin(n);return t.x=s,t.y=o,t},n.names=["Mollweide","moll"]},{"../common/adjust_lon":5}],54:[function(t,e,n){var i=484813681109536e-20;n.iterations=1,n.init=function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},n.forward=function(t){var e,n=t.x,s=t.y,o=s-this.lat0,a=n-this.long0,r=o/i*1e-5,l=a,u=1,c=0;for(e=1;10>=e;e++)u*=r,c+=this.A[e]*u;var h,d,p=c,f=l,g=1,m=0,v=0,b=0;for(e=1;6>=e;e++)h=g*p-m*f,d=m*p+g*f,g=h,m=d,v=v+this.B_re[e]*g-this.B_im[e]*m,b=b+this.B_im[e]*g+this.B_re[e]*m;return t.x=b*this.a+this.x0,t.y=v*this.a+this.y0,t},n.inverse=function(t){var e,n,s,o=t.x,a=t.y,r=o-this.x0,l=a-this.y0,u=l/this.a,c=r/this.a,h=1,d=0,p=0,f=0;for(e=1;6>=e;e++)n=h*u-d*c,s=d*u+h*c,h=n,d=s,p=p+this.C_re[e]*h-this.C_im[e]*d,f=f+this.C_im[e]*h+this.C_re[e]*d;for(var g=0;g<this.iterations;g++){var m,v,b=p,y=f,_=u,w=c;for(e=2;6>=e;e++)m=b*p-y*f,v=y*p+b*f,b=m,y=v,_+=(e-1)*(this.B_re[e]*b-this.B_im[e]*y),w+=(e-1)*(this.B_im[e]*b+this.B_re[e]*y);b=1,y=0;var M=this.B_re[1],x=this.B_im[1];for(e=2;6>=e;e++)m=b*p-y*f,v=y*p+b*f,b=m,y=v,M+=e*(this.B_re[e]*b-this.B_im[e]*y),x+=e*(this.B_im[e]*b+this.B_re[e]*y);var C=M*M+x*x;p=(_*M+w*x)/C,f=(w*M-_*x)/C}var I=p,S=f,E=1,L=0;for(e=1;9>=e;e++)E*=I,L+=this.D[e]*E;var k=this.lat0+L*i*1e5,D=this.long0+S;return t.x=D,t.y=k,t},n.names=["New_Zealand_Map_Grid","nzmg"]},{}],55:[function(t,e,n){var i=t("../common/tsfnz"),s=t("../common/adjust_lon"),o=t("../common/phi2z"),a=Math.PI/2,r=Math.PI/4,l=1e-10;n.init=function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),e=Math.cos(this.lat0),n=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(e,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-n*n);var o=i(this.e,this.lat0,t),a=this.bl/e*Math.sqrt((1-this.es)/(1-n*n));1>a*a&&(a=1);var r,l;if(isNaN(this.longc)){var u=i(this.e,this.lat1,Math.sin(this.lat1)),c=i(this.e,this.lat2,Math.sin(this.lat2));this.el=this.lat0>=0?(a+Math.sqrt(a*a-1))*Math.pow(o,this.bl):(a-Math.sqrt(a*a-1))*Math.pow(o,this.bl);var h=Math.pow(u,this.bl),d=Math.pow(c,this.bl);r=this.el/h,l=.5*(r-1/r);var p=(this.el*this.el-d*h)/(this.el*this.el+d*h),f=(d-h)/(d+h),g=s(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(p*Math.tan(.5*this.bl*g)/f)/this.bl,this.long0=s(this.long0);var m=s(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*m)/l),this.alpha=Math.asin(a*Math.sin(this.gamma0))}else r=this.lat0>=0?a+Math.sqrt(a*a-1):a-Math.sqrt(a*a-1),this.el=r*Math.pow(o,this.bl),l=.5*(r-1/r),this.gamma0=Math.asin(Math.sin(this.alpha)/a),this.long0=this.longc-Math.asin(l*Math.tan(this.gamma0))/this.bl;this.uc=this.no_off?0:this.lat0>=0?this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha)):-1*this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha))},n.forward=function(t){var e,n,o,u=t.x,c=t.y,h=s(u-this.long0);if(Math.abs(Math.abs(c)-a)<=l)o=c>0?-1:1,n=this.al/this.bl*Math.log(Math.tan(r+o*this.gamma0*.5)),e=-1*o*a*this.al/this.bl;else{var d=i(this.e,c,Math.sin(c)),p=this.el/Math.pow(d,this.bl),f=.5*(p-1/p),g=.5*(p+1/p),m=Math.sin(this.bl*h),v=(f*Math.sin(this.gamma0)-m*Math.cos(this.gamma0))/g;n=Math.abs(Math.abs(v)-1)<=l?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-v)/(1+v))/this.bl,e=Math.abs(Math.cos(this.bl*h))<=l?this.al*this.bl*h:this.al*Math.atan2(f*Math.cos(this.gamma0)+m*Math.sin(this.gamma0),Math.cos(this.bl*h))/this.bl}return this.no_rot?(t.x=this.x0+e,t.y=this.y0+n):(e-=this.uc,t.x=this.x0+n*Math.cos(this.alpha)+e*Math.sin(this.alpha),t.y=this.y0+e*Math.cos(this.alpha)-n*Math.sin(this.alpha)),t},n.inverse=function(t){var e,n;this.no_rot?(n=t.y-this.y0,e=t.x-this.x0):(n=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),e=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),e+=this.uc);var i=Math.exp(-1*this.bl*n/this.al),r=.5*(i-1/i),u=.5*(i+1/i),c=Math.sin(this.bl*e/this.al),h=(c*Math.cos(this.gamma0)+r*Math.sin(this.gamma0))/u,d=Math.pow(this.el/Math.sqrt((1+h)/(1-h)),1/this.bl);
return Math.abs(h-1)<l?(t.x=this.long0,t.y=a):Math.abs(h+1)<l?(t.x=this.long0,t.y=-1*a):(t.y=o(this.e,d),t.x=s(this.long0-Math.atan2(r*Math.cos(this.gamma0)-c*Math.sin(this.gamma0),Math.cos(this.bl*e/this.al))/this.bl)),t},n.names=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},{"../common/adjust_lon":5,"../common/phi2z":16,"../common/tsfnz":24}],56:[function(t,e,n){var i=t("../common/e0fn"),s=t("../common/e1fn"),o=t("../common/e2fn"),a=t("../common/e3fn"),r=t("../common/adjust_lon"),l=t("../common/adjust_lat"),u=t("../common/mlfn"),c=1e-10,h=t("../common/gN"),d=20;n.init=function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=i(this.es),this.e1=s(this.es),this.e2=o(this.es),this.e3=a(this.es),this.ml0=this.a*u(this.e0,this.e1,this.e2,this.e3,this.lat0)},n.forward=function(t){var e,n,i,s=t.x,o=t.y,a=r(s-this.long0);if(i=a*Math.sin(o),this.sphere)Math.abs(o)<=c?(e=this.a*a,n=-1*this.a*this.lat0):(e=this.a*Math.sin(i)/Math.tan(o),n=this.a*(l(o-this.lat0)+(1-Math.cos(i))/Math.tan(o)));else if(Math.abs(o)<=c)e=this.a*a,n=-1*this.ml0;else{var d=h(this.a,this.e,Math.sin(o))/Math.tan(o);e=d*Math.sin(i),n=this.a*u(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+d*(1-Math.cos(i))}return t.x=e+this.x0,t.y=n+this.y0,t},n.inverse=function(t){var e,n,i,s,o,a,l,h,p;if(i=t.x-this.x0,s=t.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=c)e=r(i/this.a+this.long0),n=0;else{a=this.lat0+s/this.a,l=i*i/this.a/this.a+a*a,h=a;var f;for(o=d;o;--o)if(f=Math.tan(h),p=-1*(a*(h*f+1)-h-.5*(h*h+l)*f)/((h-a)/f-1),h+=p,Math.abs(p)<=c){n=h;break}e=r(this.long0+Math.asin(i*Math.tan(h)/this.a)/Math.sin(n))}else if(Math.abs(s+this.ml0)<=c)n=0,e=r(this.long0+i/this.a);else{a=(this.ml0+s)/this.a,l=i*i/this.a/this.a+a*a,h=a;var g,m,v,b,y;for(o=d;o;--o)if(y=this.e*Math.sin(h),g=Math.sqrt(1-y*y)*Math.tan(h),m=this.a*u(this.e0,this.e1,this.e2,this.e3,h),v=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),b=m/this.a,p=(a*(g*b+1)-b-.5*g*(b*b+l))/(this.es*Math.sin(2*h)*(b*b+l-2*a*b)/(4*g)+(a-b)*(g*v-2/Math.sin(2*h))-v),h-=p,Math.abs(p)<=c){n=h;break}g=Math.sqrt(1-this.es*Math.pow(Math.sin(n),2))*Math.tan(n),e=r(this.long0+Math.asin(i*g/this.a)/Math.sin(n))}return t.x=e,t.y=n,t},n.names=["Polyconic","poly"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/mlfn":14}],57:[function(t,e,n){var i=t("../common/adjust_lon"),s=t("../common/adjust_lat"),o=t("../common/pj_enfn"),a=20,r=t("../common/pj_mlfn"),l=t("../common/pj_inv_mlfn"),u=Math.PI/2,c=1e-10,h=t("../common/asinz");n.init=function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=o(this.es)},n.forward=function(t){var e,n,s=t.x,o=t.y;if(s=i(s-this.long0),this.sphere){if(this.m)for(var l=this.n*Math.sin(o),u=a;u;--u){var h=(this.m*o+Math.sin(o)-l)/(this.m+Math.cos(o));if(o-=h,Math.abs(h)<c)break}else o=1!==this.n?Math.asin(this.n*Math.sin(o)):o;e=this.a*this.C_x*s*(this.m+Math.cos(o)),n=this.a*this.C_y*o}else{var d=Math.sin(o),p=Math.cos(o);n=this.a*r(o,d,p,this.en),e=this.a*s*p/Math.sqrt(1-this.es*d*d)}return t.x=e,t.y=n,t},n.inverse=function(t){var e,n,o,a;return t.x-=this.x0,o=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,o/=this.C_x*(this.m+Math.cos(e)),this.m?e=h((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=h(Math.sin(e)/this.n)),o=i(o+this.long0),e=s(e)):(e=l(t.y/this.a,this.es,this.en),a=Math.abs(e),u>a?(a=Math.sin(e),n=this.long0+t.x*Math.sqrt(1-this.es*a*a)/(this.a*Math.cos(e)),o=i(n)):u>a-c&&(o=this.long0)),t.x=o,t.y=e,t},n.names=["Sinusoidal","sinu"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/asinz":6,"../common/pj_enfn":17,"../common/pj_inv_mlfn":18,"../common/pj_mlfn":19}],58:[function(t,e,n){n.init=function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),n=this.a,i=this.rf,s=1/i,o=2*s-Math.pow(s,2),a=this.e=Math.sqrt(o);this.R=this.k0*n*Math.sqrt(1-o)/(1-o*Math.pow(e,2)),this.alpha=Math.sqrt(1+o/(1-o)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var r=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+t/2)),u=Math.log((1+a*e)/(1-a*e));this.K=r-this.alpha*l+this.alpha*a/2*u},n.forward=function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),n=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),i=-this.alpha*(e+n)+this.K,s=2*(Math.atan(Math.exp(i))-Math.PI/4),o=this.alpha*(t.x-this.lambda0),a=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(o))),r=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(o));return t.y=this.R/2*Math.log((1+Math.sin(r))/(1-Math.sin(r)))+this.y0,t.x=this.R*a+this.x0,t},n.inverse=function(t){for(var e=t.x-this.x0,n=t.y-this.y0,i=e/this.R,s=2*(Math.atan(Math.exp(n/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(i)),a=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(s))),r=this.lambda0+a/this.alpha,l=0,u=o,c=-1e3,h=0;Math.abs(u-c)>1e-7;){if(++h>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(u))/2)),c=u,u=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=r,t.y=u,t},n.names=["somerc"]},{}],59:[function(t,e,n){var i=Math.PI/2,s=1e-10,o=t("../common/sign"),a=t("../common/msfnz"),r=t("../common/tsfnz"),l=t("../common/phi2z"),u=t("../common/adjust_lon");n.ssfn_=function(t,e,n){return e*=n,Math.tan(.5*(i+t))*Math.pow((1-e)/(1+e),.5*n)},n.init=function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=s&&(this.k0=.5*(1+o(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=s&&(this.con=this.lat0>0?1:-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=s&&(this.k0=.5*this.cons*a(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/r(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=a(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-i,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},n.forward=function(t){var e,n,o,a,l,c,h=t.x,d=t.y,p=Math.sin(d),f=Math.cos(d),g=u(h-this.long0);return Math.abs(Math.abs(h-this.long0)-Math.PI)<=s&&Math.abs(d+this.lat0)<=s?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*p+this.coslat0*f*Math.cos(g)),t.x=this.a*e*f*Math.sin(g)+this.x0,t.y=this.a*e*(this.coslat0*p-this.sinlat0*f*Math.cos(g))+this.y0,t):(n=2*Math.atan(this.ssfn_(d,p,this.e))-i,a=Math.cos(n),o=Math.sin(n),Math.abs(this.coslat0)<=s?(l=r(this.e,d*this.con,this.con*p),c=2*this.a*this.k0*l/this.cons,t.x=this.x0+c*Math.sin(h-this.long0),t.y=this.y0-this.con*c*Math.cos(h-this.long0),t):(Math.abs(this.sinlat0)<s?(e=2*this.a*this.k0/(1+a*Math.cos(g)),t.y=e*o):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*a*Math.cos(g))),t.y=e*(this.cosX0*o-this.sinX0*a*Math.cos(g))+this.y0),t.x=e*a*Math.sin(g)+this.x0,t))},n.inverse=function(t){t.x-=this.x0,t.y-=this.y0;var e,n,o,a,r,c=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var h=2*Math.atan(c/(.5*this.a*this.k0));return e=this.long0,n=this.lat0,s>=c?(t.x=e,t.y=n,t):(n=Math.asin(Math.cos(h)*this.sinlat0+t.y*Math.sin(h)*this.coslat0/c),e=u(Math.abs(this.coslat0)<s?this.lat0>0?this.long0+Math.atan2(t.x,-1*t.y):this.long0+Math.atan2(t.x,t.y):this.long0+Math.atan2(t.x*Math.sin(h),c*this.coslat0*Math.cos(h)-t.y*this.sinlat0*Math.sin(h))),t.x=e,t.y=n,t)}if(Math.abs(this.coslat0)<=s){if(s>=c)return n=this.lat0,e=this.long0,t.x=e,t.y=n,t;t.x*=this.con,t.y*=this.con,o=c*this.cons/(2*this.a*this.k0),n=this.con*l(this.e,o),e=this.con*u(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else a=2*Math.atan(c*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,s>=c?r=this.X0:(r=Math.asin(Math.cos(a)*this.sinX0+t.y*Math.sin(a)*this.cosX0/c),e=u(this.long0+Math.atan2(t.x*Math.sin(a),c*this.cosX0*Math.cos(a)-t.y*this.sinX0*Math.sin(a)))),n=-1*l(this.e,Math.tan(.5*(i+r)));return t.x=e,t.y=n,t},n.names=["stere"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],60:[function(t,e,n){var i=t("./gauss"),s=t("../common/adjust_lon");n.init=function(){i.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},n.forward=function(t){var e,n,o,a;return t.x=s(t.x-this.long0),i.forward.apply(this,[t]),e=Math.sin(t.y),n=Math.cos(t.y),o=Math.cos(t.x),a=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*n*o),t.x=a*n*Math.sin(t.x),t.y=a*(this.cosc0*e-this.sinc0*n*o),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},n.inverse=function(t){var e,n,o,a,r;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,r=Math.sqrt(t.x*t.x+t.y*t.y)){var l=2*Math.atan2(r,this.R2);e=Math.sin(l),n=Math.cos(l),a=Math.asin(n*this.sinc0+t.y*e*this.cosc0/r),o=Math.atan2(t.x*e,r*this.cosc0*n-t.y*this.sinc0*e)}else a=this.phic0,o=0;return t.x=o,t.y=a,i.inverse.apply(this,[t]),t.x=s(t.x+this.long0),t},n.names=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"]},{"../common/adjust_lon":5,"./gauss":45}],61:[function(t,e,n){var i=t("../common/e0fn"),s=t("../common/e1fn"),o=t("../common/e2fn"),a=t("../common/e3fn"),r=t("../common/mlfn"),l=t("../common/adjust_lon"),u=Math.PI/2,c=1e-10,h=t("../common/sign"),d=t("../common/asinz");n.init=function(){this.e0=i(this.es),this.e1=s(this.es),this.e2=o(this.es),this.e3=a(this.es),this.ml0=this.a*r(this.e0,this.e1,this.e2,this.e3,this.lat0)},n.forward=function(t){var e,n,i,s=t.x,o=t.y,a=l(s-this.long0),u=Math.sin(o),c=Math.cos(o);if(this.sphere){var h=c*Math.sin(a);if(Math.abs(Math.abs(h)-1)<1e-10)return 93;n=.5*this.a*this.k0*Math.log((1+h)/(1-h)),e=Math.acos(c*Math.cos(a)/Math.sqrt(1-h*h)),0>o&&(e=-e),i=this.a*this.k0*(e-this.lat0)}else{var d=c*a,p=Math.pow(d,2),f=this.ep2*Math.pow(c,2),g=Math.tan(o),m=Math.pow(g,2);e=1-this.es*Math.pow(u,2);var v=this.a/Math.sqrt(e),b=this.a*r(this.e0,this.e1,this.e2,this.e3,o);n=this.k0*v*d*(1+p/6*(1-m+f+p/20*(5-18*m+Math.pow(m,2)+72*f-58*this.ep2)))+this.x0,i=this.k0*(b-this.ml0+v*g*p*(.5+p/24*(5-m+9*f+4*Math.pow(f,2)+p/30*(61-58*m+Math.pow(m,2)+600*f-330*this.ep2))))+this.y0}return t.x=n,t.y=i,t},n.inverse=function(t){var e,n,i,s,o,a,r=6;if(this.sphere){var p=Math.exp(t.x/(this.a*this.k0)),f=.5*(p-1/p),g=this.lat0+t.y/(this.a*this.k0),m=Math.cos(g);e=Math.sqrt((1-m*m)/(1+f*f)),o=d(e),0>g&&(o=-o),a=0===f&&0===m?this.long0:l(Math.atan2(f,m)+this.long0)}else{var v=t.x-this.x0,b=t.y-this.y0;for(e=(this.ml0+b/this.k0)/this.a,n=e,s=0;i=(e+this.e1*Math.sin(2*n)-this.e2*Math.sin(4*n)+this.e3*Math.sin(6*n))/this.e0-n,n+=i,!(Math.abs(i)<=c);s++)if(s>=r)return 95;if(Math.abs(n)<u){var y=Math.sin(n),_=Math.cos(n),w=Math.tan(n),M=this.ep2*Math.pow(_,2),x=Math.pow(M,2),C=Math.pow(w,2),I=Math.pow(C,2);e=1-this.es*Math.pow(y,2);var S=this.a/Math.sqrt(e),E=S*(1-this.es)/e,L=v/(S*this.k0),k=Math.pow(L,2);o=n-S*w*k/E*(.5-k/24*(5+3*C+10*M-4*x-9*this.ep2-k/30*(61+90*C+298*M+45*I-252*this.ep2-3*x))),a=l(this.long0+L*(1-k/6*(1+2*C+M-k/20*(5-2*M+28*C-3*x+8*this.ep2+24*I)))/_)}else o=u*h(b),a=this.long0}return t.x=a,t.y=o,t},n.names=["Transverse_Mercator","Transverse Mercator","tmerc"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/mlfn":14,"../common/sign":21}],62:[function(t,e,n){var i=.017453292519943295,s=t("./tmerc");n.dependsOn="tmerc",n.init=function(){this.zone&&(this.lat0=0,this.long0=(6*Math.abs(this.zone)-183)*i,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,s.init.apply(this),this.forward=s.forward,this.inverse=s.inverse)},n.names=["Universal Transverse Mercator System","utm"]},{"./tmerc":61}],63:[function(t,e,n){var i=t("../common/adjust_lon"),s=Math.PI/2,o=1e-10,a=t("../common/asinz");n.init=function(){this.R=this.a},n.forward=function(t){var e,n,r=t.x,l=t.y,u=i(r-this.long0);Math.abs(l)<=o&&(e=this.x0+this.R*u,n=this.y0);var c=a(2*Math.abs(l/Math.PI));(Math.abs(u)<=o||Math.abs(Math.abs(l)-s)<=o)&&(e=this.x0,n=l>=0?this.y0+Math.PI*this.R*Math.tan(.5*c):this.y0+Math.PI*this.R*-Math.tan(.5*c));var h=.5*Math.abs(Math.PI/u-u/Math.PI),d=h*h,p=Math.sin(c),f=Math.cos(c),g=f/(p+f-1),m=g*g,v=g*(2/p-1),b=v*v,y=Math.PI*this.R*(h*(g-b)+Math.sqrt(d*(g-b)*(g-b)-(b+d)*(m-b)))/(b+d);0>u&&(y=-y),e=this.x0+y;var _=d+g;return y=Math.PI*this.R*(v*_-h*Math.sqrt((b+d)*(d+1)-_*_))/(b+d),n=l>=0?this.y0+y:this.y0-y,t.x=e,t.y=n,t},n.inverse=function(t){var e,n,s,a,r,l,u,c,h,d,p,f,g;return t.x-=this.x0,t.y-=this.y0,p=Math.PI*this.R,s=t.x/p,a=t.y/p,r=s*s+a*a,l=-Math.abs(a)*(1+r),u=l-2*a*a+s*s,c=-2*l+1+2*a*a+r*r,g=a*a/c+(2*u*u*u/c/c/c-9*l*u/c/c)/27,h=(l-u*u/3/c)/c,d=2*Math.sqrt(-h/3),p=3*g/h/d,Math.abs(p)>1&&(p=p>=0?1:-1),f=Math.acos(p)/3,n=t.y>=0?(-d*Math.cos(f+Math.PI/3)-u/3/c)*Math.PI:-(-d*Math.cos(f+Math.PI/3)-u/3/c)*Math.PI,e=Math.abs(s)<o?this.long0:i(this.long0+Math.PI*(r-1+Math.sqrt(1+2*(s*s-a*a)+r*r))/2/s),t.x=e,t.y=n,t},n.names=["Van_der_Grinten_I","VanDerGrinten","vandg"]},{"../common/adjust_lon":5,"../common/asinz":6}],64:[function(t,e){var n=.017453292519943295,i=57.29577951308232,s=1,o=2,a=t("./datum_transform"),r=t("./adjust_axis"),l=t("./Proj"),u=t("./common/toPoint");e.exports=function c(t,e,h){function d(t,e){return(t.datum.datum_type===s||t.datum.datum_type===o)&&"WGS84"!==e.datumCode}var p;return Array.isArray(h)&&(h=u(h)),t.datum&&e.datum&&(d(t,e)||d(e,t))&&(p=new l("WGS84"),c(t,p,h),t=p),"enu"!==t.axis&&r(t,!1,h),"longlat"===t.projName?(h.x*=n,h.y*=n):(t.to_meter&&(h.x*=t.to_meter,h.y*=t.to_meter),t.inverse(h)),t.from_greenwich&&(h.x+=t.from_greenwich),h=a(t.datum,e.datum,h),e.from_greenwich&&(h.x-=e.from_greenwich),"longlat"===e.projName?(h.x*=i,h.y*=i):(e.forward(h),e.to_meter&&(h.x/=e.to_meter,h.y/=e.to_meter)),"enu"!==e.axis&&r(e,!0,h),h}},{"./Proj":2,"./adjust_axis":3,"./common/toPoint":23,"./datum_transform":30}],65:[function(t,e){function n(t,e,n){t[e]=n.map(function(t){var e={};return i(t,e),e}).reduce(function(t,e){return l(t,e)},{})}function i(t,e){var s;return Array.isArray(t)?(s=t.shift(),"PARAMETER"===s&&(s=t.shift()),void(1===t.length?Array.isArray(t[0])?(e[s]={},i(t[0],e[s])):e[s]=t[0]:t.length?"TOWGS84"===s?e[s]=t:(e[s]={},["UNIT","PRIMEM","VERT_DATUM"].indexOf(s)>-1?(e[s]={name:t[0].toLowerCase(),convert:t[1]},3===t.length&&(e[s].auth=t[2])):"SPHEROID"===s?(e[s]={name:t[0],a:t[1],rf:t[2]},4===t.length&&(e[s].auth=t[3])):["GEOGCS","GEOCCS","DATUM","VERT_CS","COMPD_CS","LOCAL_CS","FITTED_CS","LOCAL_DATUM"].indexOf(s)>-1?(t[0]=["name",t[0]],n(e,s,t)):t.every(function(t){return Array.isArray(t)})?n(e,s,t):i(t,e[s])):e[s]=!0)):void(e[t]=!0)}function s(t,e){var n=e[0],i=e[1];!(n in t)&&i in t&&(t[n]=t[i],3===e.length&&(t[n]=e[2](t[n])))}function o(t){return t*r}function a(t){function e(e){var n=t.to_meter||1;return parseFloat(e,10)*n}"GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):t.projName="object"==typeof t.PROJECTION?Object.keys(t.PROJECTION)[0]:t.PROJECTION,t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&(t.to_meter=parseFloat(t.UNIT.convert,10))),t.GEOGCS&&(t.datumCode=t.GEOGCS.DATUM?t.GEOGCS.DATUM.name.toLowerCase():t.GEOGCS.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),("new_zealand_geodetic_datum_1949"===t.datumCode||"new_zealand_1949"===t.datumCode)&&(t.datumCode="nzgd49"),"wgs_1984"===t.datumCode&&("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),t.GEOGCS.DATUM&&t.GEOGCS.DATUM.SPHEROID&&(t.ellps=t.GEOGCS.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=t.GEOGCS.DATUM.SPHEROID.a,t.rf=parseFloat(t.GEOGCS.DATUM.SPHEROID.rf,10)),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36")),t.b&&!isFinite(t.b)&&(t.b=t.a);var n=function(e){return s(t,e)},i=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",o],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",o],["x0","false_easting",e],["y0","false_northing",e],["long0","central_meridian",o],["lat0","latitude_of_origin",o],["lat0","standard_parallel_1",o],["lat1","standard_parallel_1",o],["lat2","standard_parallel_2",o],["alpha","azimuth",o],["srsCode","name"]];i.forEach(n),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.PROJECTION&&"Lambert_Azimuthal_Equal_Area"!==t.PROJECTION||(t.long0=t.longc)}var r=.017453292519943295,l=t("./extend");e.exports=function(t,e){var n=JSON.parse((","+t).replace(/\s*\,\s*([A-Z_0-9]+?)(\[)/g,',["$1",').slice(1).replace(/\s*\,\s*([A-Z_0-9]+?)\]/g,',"$1"]')),s=n.shift(),o=n.shift();n.unshift(["name",o]),n.unshift(["type",s]),n.unshift("output");var r={};return i(n,r),a(r.output),l(e,r.output)}},{"./extend":33}],66:[function(t,e,n){function i(t){return t*(Math.PI/180)}function s(t){return 180*(t/Math.PI)}function o(t){var e,n,s,o,a,l,u,c,h,d=t.lat,p=t.lon,f=6378137,g=.00669438,m=.9996,v=i(d),b=i(p);h=Math.floor((p+180)/6)+1,180===p&&(h=60),d>=56&&64>d&&p>=3&&12>p&&(h=32),d>=72&&84>d&&(p>=0&&9>p?h=31:p>=9&&21>p?h=33:p>=21&&33>p?h=35:p>=33&&42>p&&(h=37)),e=6*(h-1)-180+3,c=i(e),n=g/(1-g),s=f/Math.sqrt(1-g*Math.sin(v)*Math.sin(v)),o=Math.tan(v)*Math.tan(v),a=n*Math.cos(v)*Math.cos(v),l=Math.cos(v)*(b-c),u=f*((1-g/4-3*g*g/64-5*g*g*g/256)*v-(3*g/8+3*g*g/32+45*g*g*g/1024)*Math.sin(2*v)+(15*g*g/256+45*g*g*g/1024)*Math.sin(4*v)-35*g*g*g/3072*Math.sin(6*v));var y=m*s*(l+(1-o+a)*l*l*l/6+(5-18*o+o*o+72*a-58*n)*l*l*l*l*l/120)+5e5,_=m*(u+s*Math.tan(v)*(l*l/2+(5-o+9*a+4*a*a)*l*l*l*l/24+(61-58*o+o*o+600*a-330*n)*l*l*l*l*l*l/720));return 0>d&&(_+=1e7),{northing:Math.round(_),easting:Math.round(y),zoneNumber:h,zoneLetter:r(d)}}function a(t){var e=t.northing,n=t.easting,i=t.zoneLetter,o=t.zoneNumber;if(0>o||o>60)return null;var r,l,u,c,h,d,p,f,g,m,v=.9996,b=6378137,y=.00669438,_=(1-Math.sqrt(1-y))/(1+Math.sqrt(1-y)),w=n-5e5,M=e;"N">i&&(M-=1e7),f=6*(o-1)-180+3,r=y/(1-y),p=M/v,g=p/(b*(1-y/4-3*y*y/64-5*y*y*y/256)),m=g+(3*_/2-27*_*_*_/32)*Math.sin(2*g)+(21*_*_/16-55*_*_*_*_/32)*Math.sin(4*g)+151*_*_*_/96*Math.sin(6*g),l=b/Math.sqrt(1-y*Math.sin(m)*Math.sin(m)),u=Math.tan(m)*Math.tan(m),c=r*Math.cos(m)*Math.cos(m),h=b*(1-y)/Math.pow(1-y*Math.sin(m)*Math.sin(m),1.5),d=w/(l*v);var x=m-l*Math.tan(m)/h*(d*d/2-(5+3*u+10*c-4*c*c-9*r)*d*d*d*d/24+(61+90*u+298*c+45*u*u-252*r-3*c*c)*d*d*d*d*d*d/720);x=s(x);var C=(d-(1+2*u+c)*d*d*d/6+(5-2*c+28*u-3*c*c+8*r+24*u*u)*d*d*d*d*d/120)/Math.cos(m);C=f+s(C);var I;if(t.accuracy){var S=a({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});I={top:S.lat,right:S.lon,bottom:x,left:C}}else I={lat:x,lon:C};return I}function r(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function l(t,e){var n=""+t.easting,i=""+t.northing;return t.zoneNumber+t.zoneLetter+u(t.easting,t.northing,t.zoneNumber)+n.substr(n.length-5,e)+i.substr(i.length-5,e)}function u(t,e,n){var i=c(n),s=Math.floor(t/1e5),o=Math.floor(e/1e5)%20;return h(s,o,i)}function c(t){var e=t%m;return 0===e&&(e=m),e}function h(t,e,n){var i=n-1,s=v.charCodeAt(i),o=b.charCodeAt(i),a=s+t-1,r=o+e,l=!1;a>x&&(a=a-x+y-1,l=!0),(a===_||_>s&&a>_||(a>_||_>s)&&l)&&a++,(a===w||w>s&&a>w||(a>w||w>s)&&l)&&(a++,a===_&&a++),a>x&&(a=a-x+y-1),r>M?(r=r-M+y-1,l=!0):l=!1,(r===_||_>o&&r>_||(r>_||_>o)&&l)&&r++,(r===w||w>o&&r>w||(r>w||w>o)&&l)&&(r++,r===_&&r++),r>M&&(r=r-M+y-1);var u=String.fromCharCode(a)+String.fromCharCode(r);return u}function d(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,n=t.length,i=null,s="",o=0;!/[A-Z]/.test(e=t.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+t;s+=e,o++}var a=parseInt(s,10);if(0===o||o+3>n)throw"MGRSPoint bad conversion from: "+t;var r=t.charAt(o++);if("A">=r||"B"===r||"Y"===r||r>="Z"||"I"===r||"O"===r)throw"MGRSPoint zone letter "+r+" not handled: "+t;i=t.substring(o,o+=2);for(var l=c(a),u=p(i.charAt(0),l),h=f(i.charAt(1),l);h<g(r);)h+=2e6;var d=n-o;if(d%2!==0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var m,v,b,y,_,w=d/2,M=0,x=0;return w>0&&(m=1e5/Math.pow(10,w),v=t.substring(o,o+w),M=parseFloat(v)*m,b=t.substring(o+w),x=parseFloat(b)*m),y=M+u,_=x+h,{easting:y,northing:_,zoneLetter:r,zoneNumber:a,accuracy:m}}function p(t,e){for(var n=v.charCodeAt(e-1),i=1e5,s=!1;n!==t.charCodeAt(0);){if(n++,n===_&&n++,n===w&&n++,n>x){if(s)throw"Bad character: "+t;n=y,s=!0}i+=1e5}return i}function f(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var n=b.charCodeAt(e-1),i=0,s=!1;n!==t.charCodeAt(0);){if(n++,n===_&&n++,n===w&&n++,n>M){if(s)throw"Bad character: "+t;n=y,s=!0}i+=1e5}return i}function g(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}var m=6,v="AJSAJS",b="AFAFAF",y=65,_=73,w=79,M=86,x=90;n.forward=function(t,e){return e=e||5,l(o({lat:t[1],lon:t[0]}),e)},n.inverse=function(t){var e=a(d(t.toUpperCase()));return[e.left,e.bottom,e.right,e.top]},n.toPoint=function(t){var e=n.inverse(t);return[(e[2]+e[0])/2,(e[3]+e[1])/2]}},{}],67:[function(t,e){e.exports={name:"proj4",version:"2.2.1",description:"Proj4js is a JavaScript library to transform point coordinates from one coordinate system to another, including datum transformations.",main:"lib/index.js",directories:{test:"test",doc:"docs"},scripts:{test:"./node_modules/istanbul/lib/cli.js test ./node_modules/mocha/bin/_mocha test/test.js"},repository:{type:"git",url:"git://github.com/proj4js/proj4js.git"},author:"",license:"MIT",jam:{main:"dist/proj4.js",include:["dist/proj4.js","README.md","AUTHORS","LICENSE.md"]},devDependencies:{"grunt-cli":"~0.1.13",grunt:"~0.4.2","grunt-contrib-connect":"~0.6.0","grunt-contrib-jshint":"~0.8.0",chai:"~1.8.1",mocha:"~1.17.1","grunt-mocha-phantomjs":"~0.4.0",browserify:"~3.24.5","grunt-browserify":"~1.3.0","grunt-contrib-uglify":"~0.3.2",curl:"git://github.com/cujojs/curl.git",istanbul:"~0.2.4",tin:"~0.4.0"},dependencies:{mgrs:"0.0.0"}}},{}],"./includedProjections":[function(t,e){e.exports=t("gWUPNW")},{}],gWUPNW:[function(t,e){var n=[t("./lib/projections/tmerc"),t("./lib/projections/utm"),t("./lib/projections/sterea"),t("./lib/projections/stere"),t("./lib/projections/somerc"),t("./lib/projections/omerc"),t("./lib/projections/lcc"),t("./lib/projections/krovak"),t("./lib/projections/cass"),t("./lib/projections/laea"),t("./lib/projections/aea"),t("./lib/projections/gnom"),t("./lib/projections/cea"),t("./lib/projections/eqc"),t("./lib/projections/poly"),t("./lib/projections/nzmg"),t("./lib/projections/mill"),t("./lib/projections/sinu"),t("./lib/projections/moll"),t("./lib/projections/eqdc"),t("./lib/projections/vandg"),t("./lib/projections/aeqd")];e.exports=function(t){n.forEach(function(e){t.Proj.projections.add(e)})}},{"./lib/projections/aea":39,"./lib/projections/aeqd":40,"./lib/projections/cass":41,"./lib/projections/cea":42,"./lib/projections/eqc":43,"./lib/projections/eqdc":44,"./lib/projections/gnom":46,"./lib/projections/krovak":47,"./lib/projections/laea":48,"./lib/projections/lcc":49,"./lib/projections/mill":52,"./lib/projections/moll":53,"./lib/projections/nzmg":54,"./lib/projections/omerc":55,"./lib/projections/poly":56,"./lib/projections/sinu":57,"./lib/projections/somerc":58,"./lib/projections/stere":59,"./lib/projections/sterea":60,"./lib/projections/tmerc":61,"./lib/projections/utm":62,"./lib/projections/vandg":63}]},{},[35])(35)}),function(){var t=this,e=t._,n=Array.prototype,i=Object.prototype,s=Function.prototype,o=n.push,a=n.slice,r=n.concat,l=i.toString,u=i.hasOwnProperty,c=Array.isArray,h=Object.keys,d=s.bind,p=function(t){return t instanceof p?t:this instanceof p?void(this._wrapped=t):new p(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports._=p):t._=p,p.VERSION="1.7.0";var f=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,s){return t.call(e,n,i,s)};case 4:return function(n,i,s,o){return t.call(e,n,i,s,o)}}return function(){return t.apply(e,arguments)}};p.iteratee=function(t,e,n){return null==t?p.identity:p.isFunction(t)?f(t,e,n):p.isObject(t)?p.matches(t):p.property(t)},p.each=p.forEach=function(t,e,n){if(null==t)return t;e=f(e,n);var i,s=t.length;if(s===+s)for(i=0;s>i;i++)e(t[i],i,t);else{var o=p.keys(t);for(i=0,s=o.length;s>i;i++)e(t[o[i]],o[i],t)}return t},p.map=p.collect=function(t,e,n){if(null==t)return[];e=p.iteratee(e,n);for(var i,s=t.length!==+t.length&&p.keys(t),o=(s||t).length,a=Array(o),r=0;o>r;r++)i=s?s[r]:r,a[r]=e(t[i],i,t);return a};var g="Reduce of empty array with no initial value";p.reduce=p.foldl=p.inject=function(t,e,n,i){null==t&&(t=[]),e=f(e,i,4);var s,o=t.length!==+t.length&&p.keys(t),a=(o||t).length,r=0;if(arguments.length<3){if(!a)throw new TypeError(g);n=t[o?o[r++]:r++]}for(;a>r;r++)s=o?o[r]:r,n=e(n,t[s],s,t);return n},p.reduceRight=p.foldr=function(t,e,n,i){null==t&&(t=[]),e=f(e,i,4);var s,o=t.length!==+t.length&&p.keys(t),a=(o||t).length;if(arguments.length<3){if(!a)throw new TypeError(g);n=t[o?o[--a]:--a]}for(;a--;)s=o?o[a]:a,n=e(n,t[s],s,t);return n},p.find=p.detect=function(t,e,n){var i;return e=p.iteratee(e,n),p.some(t,function(t,n,s){return e(t,n,s)?(i=t,!0):void 0}),i},p.filter=p.select=function(t,e,n){var i=[];return null==t?i:(e=p.iteratee(e,n),p.each(t,function(t,n,s){e(t,n,s)&&i.push(t)}),i)},p.reject=function(t,e,n){return p.filter(t,p.negate(p.iteratee(e)),n)},p.every=p.all=function(t,e,n){if(null==t)return!0;e=p.iteratee(e,n);var i,s,o=t.length!==+t.length&&p.keys(t),a=(o||t).length;for(i=0;a>i;i++)if(s=o?o[i]:i,!e(t[s],s,t))return!1;return!0},p.some=p.any=function(t,e,n){if(null==t)return!1;e=p.iteratee(e,n);var i,s,o=t.length!==+t.length&&p.keys(t),a=(o||t).length;for(i=0;a>i;i++)if(s=o?o[i]:i,e(t[s],s,t))return!0;return!1},p.contains=p.include=function(t,e){return null==t?!1:(t.length!==+t.length&&(t=p.values(t)),p.indexOf(t,e)>=0)},p.invoke=function(t,e){var n=a.call(arguments,2),i=p.isFunction(e);return p.map(t,function(t){return(i?e:t[e]).apply(t,n)})},p.pluck=function(t,e){return p.map(t,p.property(e))},p.where=function(t,e){return p.filter(t,p.matches(e))},p.findWhere=function(t,e){return p.find(t,p.matches(e))},p.max=function(t,e,n){var i,s,o=-1/0,a=-1/0;if(null==e&&null!=t){t=t.length===+t.length?t:p.values(t);for(var r=0,l=t.length;l>r;r++)i=t[r],i>o&&(o=i)}else e=p.iteratee(e,n),p.each(t,function(t,n,i){s=e(t,n,i),(s>a||s===-1/0&&o===-1/0)&&(o=t,a=s)});return o},p.min=function(t,e,n){var i,s,o=1/0,a=1/0;if(null==e&&null!=t){t=t.length===+t.length?t:p.values(t);for(var r=0,l=t.length;l>r;r++)i=t[r],o>i&&(o=i)}else e=p.iteratee(e,n),p.each(t,function(t,n,i){s=e(t,n,i),(a>s||1/0===s&&1/0===o)&&(o=t,a=s)});return o},p.shuffle=function(t){for(var e,n=t&&t.length===+t.length?t:p.values(t),i=n.length,s=Array(i),o=0;i>o;o++)e=p.random(0,o),e!==o&&(s[o]=s[e]),s[e]=n[o];return s},p.sample=function(t,e,n){return null==e||n?(t.length!==+t.length&&(t=p.values(t)),t[p.random(t.length-1)]):p.shuffle(t).slice(0,Math.max(0,e))},p.sortBy=function(t,e,n){return e=p.iteratee(e,n),p.pluck(p.map(t,function(t,n,i){return{value:t,index:n,criteria:e(t,n,i)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return t.index-e.index}),"value")};var m=function(t){return function(e,n,i){var s={};return n=p.iteratee(n,i),p.each(e,function(i,o){var a=n(i,o,e);t(s,i,a)}),s}};p.groupBy=m(function(t,e,n){p.has(t,n)?t[n].push(e):t[n]=[e]}),p.indexBy=m(function(t,e,n){t[n]=e}),p.countBy=m(function(t,e,n){p.has(t,n)?t[n]++:t[n]=1}),p.sortedIndex=function(t,e,n,i){n=p.iteratee(n,i,1);for(var s=n(e),o=0,a=t.length;a>o;){var r=o+a>>>1;n(t[r])<s?o=r+1:a=r}return o},p.toArray=function(t){return t?p.isArray(t)?a.call(t):t.length===+t.length?p.map(t,p.identity):p.values(t):[]},p.size=function(t){return null==t?0:t.length===+t.length?t.length:p.keys(t).length},p.partition=function(t,e,n){e=p.iteratee(e,n);var i=[],s=[];return p.each(t,function(t,n,o){(e(t,n,o)?i:s).push(t)}),[i,s]},p.first=p.head=p.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:0>e?[]:a.call(t,0,e)},p.initial=function(t,e,n){return a.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},p.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},p.rest=p.tail=p.drop=function(t,e,n){return a.call(t,null==e||n?1:e)},p.compact=function(t){return p.filter(t,p.identity)};var v=function(t,e,n,i){if(e&&p.every(t,p.isArray))return r.apply(i,t);for(var s=0,a=t.length;a>s;s++){var l=t[s];p.isArray(l)||p.isArguments(l)?e?o.apply(i,l):v(l,e,n,i):n||i.push(l)}return i};p.flatten=function(t,e){return v(t,e,!1,[])},p.without=function(t){return p.difference(t,a.call(arguments,1))},p.uniq=p.unique=function(t,e,n,i){if(null==t)return[];p.isBoolean(e)||(i=n,n=e,e=!1),null!=n&&(n=p.iteratee(n,i));for(var s=[],o=[],a=0,r=t.length;r>a;a++){var l=t[a];if(e)a&&o===l||s.push(l),o=l;else if(n){var u=n(l,a,t);p.indexOf(o,u)<0&&(o.push(u),s.push(l))}else p.indexOf(s,l)<0&&s.push(l)}return s},p.union=function(){return p.uniq(v(arguments,!0,!0,[]))},p.intersection=function(t){if(null==t)return[];for(var e=[],n=arguments.length,i=0,s=t.length;s>i;i++){var o=t[i];if(!p.contains(e,o)){for(var a=1;n>a&&p.contains(arguments[a],o);a++);a===n&&e.push(o)}}return e},p.difference=function(t){var e=v(a.call(arguments,1),!0,!0,[]);return p.filter(t,function(t){return!p.contains(e,t)})},p.zip=function(t){if(null==t)return[];for(var e=p.max(arguments,"length").length,n=Array(e),i=0;e>i;i++)n[i]=p.pluck(arguments,i);return n},p.object=function(t,e){if(null==t)return{};for(var n={},i=0,s=t.length;s>i;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},p.indexOf=function(t,e,n){if(null==t)return-1;var i=0,s=t.length;if(n){if("number"!=typeof n)return i=p.sortedIndex(t,e),t[i]===e?i:-1;i=0>n?Math.max(0,s+n):n}for(;s>i;i++)if(t[i]===e)return i;return-1},p.lastIndexOf=function(t,e,n){if(null==t)return-1;var i=t.length;for("number"==typeof n&&(i=0>n?i+n+1:Math.min(i,n+1));--i>=0;)if(t[i]===e)return i;return-1},p.range=function(t,e,n){arguments.length<=1&&(e=t||0,
t=0),n=n||1;for(var i=Math.max(Math.ceil((e-t)/n),0),s=Array(i),o=0;i>o;o++,t+=n)s[o]=t;return s};var b=function(){};p.bind=function(t,e){var n,i;if(d&&t.bind===d)return d.apply(t,a.call(arguments,1));if(!p.isFunction(t))throw new TypeError("Bind must be called on a function");return n=a.call(arguments,2),i=function(){if(!(this instanceof i))return t.apply(e,n.concat(a.call(arguments)));b.prototype=t.prototype;var s=new b;b.prototype=null;var o=t.apply(s,n.concat(a.call(arguments)));return p.isObject(o)?o:s}},p.partial=function(t){var e=a.call(arguments,1);return function(){for(var n=0,i=e.slice(),s=0,o=i.length;o>s;s++)i[s]===p&&(i[s]=arguments[n++]);for(;n<arguments.length;)i.push(arguments[n++]);return t.apply(this,i)}},p.bindAll=function(t){var e,n,i=arguments.length;if(1>=i)throw new Error("bindAll must be passed function names");for(e=1;i>e;e++)n=arguments[e],t[n]=p.bind(t[n],t);return t},p.memoize=function(t,e){var n=function(i){var s=n.cache,o=e?e.apply(this,arguments):i;return p.has(s,o)||(s[o]=t.apply(this,arguments)),s[o]};return n.cache={},n},p.delay=function(t,e){var n=a.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},p.defer=function(t){return p.delay.apply(p,[t,1].concat(a.call(arguments,1)))},p.throttle=function(t,e,n){var i,s,o,a=null,r=0;n||(n={});var l=function(){r=n.leading===!1?0:p.now(),a=null,o=t.apply(i,s),a||(i=s=null)};return function(){var u=p.now();r||n.leading!==!1||(r=u);var c=e-(u-r);return i=this,s=arguments,0>=c||c>e?(clearTimeout(a),a=null,r=u,o=t.apply(i,s),a||(i=s=null)):a||n.trailing===!1||(a=setTimeout(l,c)),o}},p.debounce=function(t,e,n){var i,s,o,a,r,l=function(){var u=p.now()-a;e>u&&u>0?i=setTimeout(l,e-u):(i=null,n||(r=t.apply(o,s),i||(o=s=null)))};return function(){o=this,s=arguments,a=p.now();var u=n&&!i;return i||(i=setTimeout(l,e)),u&&(r=t.apply(o,s),o=s=null),r}},p.wrap=function(t,e){return p.partial(e,t)},p.negate=function(t){return function(){return!t.apply(this,arguments)}},p.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}},p.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},p.before=function(t,e){var n;return function(){return--t>0?n=e.apply(this,arguments):e=null,n}},p.once=p.partial(p.before,2),p.keys=function(t){if(!p.isObject(t))return[];if(h)return h(t);var e=[];for(var n in t)p.has(t,n)&&e.push(n);return e},p.values=function(t){for(var e=p.keys(t),n=e.length,i=Array(n),s=0;n>s;s++)i[s]=t[e[s]];return i},p.pairs=function(t){for(var e=p.keys(t),n=e.length,i=Array(n),s=0;n>s;s++)i[s]=[e[s],t[e[s]]];return i},p.invert=function(t){for(var e={},n=p.keys(t),i=0,s=n.length;s>i;i++)e[t[n[i]]]=n[i];return e},p.functions=p.methods=function(t){var e=[];for(var n in t)p.isFunction(t[n])&&e.push(n);return e.sort()},p.extend=function(t){if(!p.isObject(t))return t;for(var e,n,i=1,s=arguments.length;s>i;i++){e=arguments[i];for(n in e)u.call(e,n)&&(t[n]=e[n])}return t},p.pick=function(t,e,n){var i,s={};if(null==t)return s;if(p.isFunction(e)){e=f(e,n);for(i in t){var o=t[i];e(o,i,t)&&(s[i]=o)}}else{var l=r.apply([],a.call(arguments,1));t=new Object(t);for(var u=0,c=l.length;c>u;u++)i=l[u],i in t&&(s[i]=t[i])}return s},p.omit=function(t,e,n){if(p.isFunction(e))e=p.negate(e);else{var i=p.map(r.apply([],a.call(arguments,1)),String);e=function(t,e){return!p.contains(i,e)}}return p.pick(t,e,n)},p.defaults=function(t){if(!p.isObject(t))return t;for(var e=1,n=arguments.length;n>e;e++){var i=arguments[e];for(var s in i)void 0===t[s]&&(t[s]=i[s])}return t},p.clone=function(t){return p.isObject(t)?p.isArray(t)?t.slice():p.extend({},t):t},p.tap=function(t,e){return e(t),t};var y=function(t,e,n,i){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof p&&(t=t._wrapped),e instanceof p&&(e=e._wrapped);var s=l.call(t);if(s!==l.call(e))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}if("object"!=typeof t||"object"!=typeof e)return!1;for(var o=n.length;o--;)if(n[o]===t)return i[o]===e;var a=t.constructor,r=e.constructor;if(a!==r&&"constructor"in t&&"constructor"in e&&!(p.isFunction(a)&&a instanceof a&&p.isFunction(r)&&r instanceof r))return!1;n.push(t),i.push(e);var u,c;if("[object Array]"===s){if(u=t.length,c=u===e.length)for(;u--&&(c=y(t[u],e[u],n,i)););}else{var h,d=p.keys(t);if(u=d.length,c=p.keys(e).length===u)for(;u--&&(h=d[u],c=p.has(e,h)&&y(t[h],e[h],n,i)););}return n.pop(),i.pop(),c};p.isEqual=function(t,e){return y(t,e,[],[])},p.isEmpty=function(t){if(null==t)return!0;if(p.isArray(t)||p.isString(t)||p.isArguments(t))return 0===t.length;for(var e in t)if(p.has(t,e))return!1;return!0},p.isElement=function(t){return!(!t||1!==t.nodeType)},p.isArray=c||function(t){return"[object Array]"===l.call(t)},p.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},p.each(["Arguments","Function","String","Number","Date","RegExp"],function(t){p["is"+t]=function(e){return l.call(e)==="[object "+t+"]"}}),p.isArguments(arguments)||(p.isArguments=function(t){return p.has(t,"callee")}),"function"!=typeof/./&&(p.isFunction=function(t){return"function"==typeof t||!1}),p.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},p.isNaN=function(t){return p.isNumber(t)&&t!==+t},p.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===l.call(t)},p.isNull=function(t){return null===t},p.isUndefined=function(t){return void 0===t},p.has=function(t,e){return null!=t&&u.call(t,e)},p.noConflict=function(){return t._=e,this},p.identity=function(t){return t},p.constant=function(t){return function(){return t}},p.noop=function(){},p.property=function(t){return function(e){return e[t]}},p.matches=function(t){var e=p.pairs(t),n=e.length;return function(t){if(null==t)return!n;t=new Object(t);for(var i=0;n>i;i++){var s=e[i],o=s[0];if(s[1]!==t[o]||!(o in t))return!1}return!0}},p.times=function(t,e,n){var i=Array(Math.max(0,t));e=f(e,n,1);for(var s=0;t>s;s++)i[s]=e(s);return i},p.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},p.now=Date.now||function(){return(new Date).getTime()};var _={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},w=p.invert(_),M=function(t){var e=function(e){return t[e]},n="(?:"+p.keys(t).join("|")+")",i=RegExp(n),s=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(s,e):t}};p.escape=M(_),p.unescape=M(w),p.result=function(t,e){if(null==t)return void 0;var n=t[e];return p.isFunction(n)?t[e]():n};var x=0;p.uniqueId=function(t){var e=++x+"";return t?t+e:e},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},S=/\\|'|\r|\n|\u2028|\u2029/g,E=function(t){return"\\"+I[t]};p.template=function(t,e,n){!e&&n&&(e=n),e=p.defaults({},e,p.templateSettings);var i=RegExp([(e.escape||C).source,(e.interpolate||C).source,(e.evaluate||C).source].join("|")+"|$","g"),s=0,o="__p+='";t.replace(i,function(e,n,i,a,r){return o+=t.slice(s,r).replace(S,E),s=r+e.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?o+="'+\n((__t=("+i+"))==null?'':__t)+\n'":a&&(o+="';\n"+a+"\n__p+='"),e}),o+="';\n",e.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var a=new Function(e.variable||"obj","_",o)}catch(r){throw r.source=o,r}var l=function(t){return a.call(this,t,p)},u=e.variable||"obj";return l.source="function("+u+"){\n"+o+"}",l},p.chain=function(t){var e=p(t);return e._chain=!0,e};var L=function(t){return this._chain?p(t).chain():t};p.mixin=function(t){p.each(p.functions(t),function(e){var n=p[e]=t[e];p.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),L.call(this,n.apply(p,t))}})},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];p.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],L.call(this,n)}}),p.each(["concat","join","slice"],function(t){var e=n[t];p.prototype[t]=function(){return L.call(this,e.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}.call(this),function(){var t={VERSION:"2.3.5",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(e,n){var i="string"==typeof e.initial?{state:e.initial}:e.initial,s=e.terminal||e["final"],o=n||e.target||{},a=e.events||[],r=e.callbacks||{},l={},u={},c=function(e){var n=e.from instanceof Array?e.from:e.from?[e.from]:[t.WILDCARD];l[e.name]=l[e.name]||{};for(var i=0;i<n.length;i++)u[n[i]]=u[n[i]]||[],u[n[i]].push(e.name),l[e.name][n[i]]=e.to||n[i]};i&&(i.event=i.event||"startup",c({name:i.event,from:"none",to:i.state}));for(var h=0;h<a.length;h++)c(a[h]);for(var d in l)l.hasOwnProperty(d)&&(o[d]=t.buildEvent(d,l[d]));for(var d in r)r.hasOwnProperty(d)&&(o[d]=r[d]);return o.current="none",o.is=function(t){return t instanceof Array?t.indexOf(this.current)>=0:this.current===t},o.can=function(e){return!this.transition&&(l[e].hasOwnProperty(this.current)||l[e].hasOwnProperty(t.WILDCARD))},o.cannot=function(t){return!this.can(t)},o.transitions=function(){return u[this.current]},o.isFinished=function(){return this.is(s)},o.error=e.error||function(t,e,n,i,s,o,a){throw a||o},i&&!i.defer&&o[i.event](),o},doCallback:function(e,n,i,s,o,a){if(n)try{return n.apply(e,[i,s,o].concat(a))}catch(r){return e.error(i,s,o,a,t.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",r)}},beforeAnyEvent:function(e,n,i,s,o){return t.doCallback(e,e.onbeforeevent,n,i,s,o)},afterAnyEvent:function(e,n,i,s,o){return t.doCallback(e,e.onafterevent||e.onevent,n,i,s,o)},leaveAnyState:function(e,n,i,s,o){return t.doCallback(e,e.onleavestate,n,i,s,o)},enterAnyState:function(e,n,i,s,o){return t.doCallback(e,e.onenterstate||e.onstate,n,i,s,o)},changeState:function(e,n,i,s,o){return t.doCallback(e,e.onchangestate,n,i,s,o)},beforeThisEvent:function(e,n,i,s,o){return t.doCallback(e,e["onbefore"+n],n,i,s,o)},afterThisEvent:function(e,n,i,s,o){return t.doCallback(e,e["onafter"+n]||e["on"+n],n,i,s,o)},leaveThisState:function(e,n,i,s,o){return t.doCallback(e,e["onleave"+i],n,i,s,o)},enterThisState:function(e,n,i,s,o){return t.doCallback(e,e["onenter"+s]||e["on"+s],n,i,s,o)},beforeEvent:function(e,n,i,s,o){return!1===t.beforeThisEvent(e,n,i,s,o)||!1===t.beforeAnyEvent(e,n,i,s,o)?!1:void 0},afterEvent:function(e,n,i,s,o){t.afterThisEvent(e,n,i,s,o),t.afterAnyEvent(e,n,i,s,o)},leaveState:function(e,n,i,s,o){var a=t.leaveThisState(e,n,i,s,o),r=t.leaveAnyState(e,n,i,s,o);return!1===a||!1===r?!1:t.ASYNC===a||t.ASYNC===r?t.ASYNC:void 0},enterState:function(e,n,i,s,o){t.enterThisState(e,n,i,s,o),t.enterAnyState(e,n,i,s,o)},buildEvent:function(e,n){return function(){var i=this.current,s=n[i]||n[t.WILDCARD]||i,o=Array.prototype.slice.call(arguments);if(this.transition)return this.error(e,i,s,o,t.Error.PENDING_TRANSITION,"event "+e+" inappropriate because previous transition did not complete");if(this.cannot(e))return this.error(e,i,s,o,t.Error.INVALID_TRANSITION,"event "+e+" inappropriate in current state "+this.current);if(!1===t.beforeEvent(this,e,i,s,o))return t.Result.CANCELLED;if(i===s)return t.afterEvent(this,e,i,s,o),t.Result.NOTRANSITION;var a=this;this.transition=function(){return a.transition=null,a.current=s,t.enterState(a,e,i,s,o),t.changeState(a,e,i,s,o),t.afterEvent(a,e,i,s,o),t.Result.SUCCEEDED},this.transition.cancel=function(){a.transition=null,t.afterEvent(a,e,i,s,o)};var r=t.leaveState(this,e,i,s,o);return!1===r?(this.transition=null,t.Result.CANCELLED):t.ASYNC===r?t.Result.PENDING:this.transition?this.transition():void 0}}};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.StateMachine=t):"function"==typeof define&&define.amd?define(function(e){return t}):"undefined"!=typeof window?window.StateMachine=t:"undefined"!=typeof self&&(self.StateMachine=t)}(),locuslabs.logLayout=new log4javascript.PatternLayout("%d{HH:mm:ss} %-5p - %m%n"),locuslabs.logAppender=new log4javascript.BrowserConsoleAppender,locuslabs.logAppender.setLayout(locuslabs.logLayout),locuslabs.logAppender.setThreshold(log4javascript.Level.DEBUG),locuslabs.log=log4javascript.getLogger(),locuslabs.log.addAppender(locuslabs.logAppender),locuslabs.deserialize=function(t){if($.isPlainObject(t)){if(t.__locuslabs_serialized_object__){var e=t.className.split(/\./),n=window;return $.each(e,function(t,i){return n=n[i],n?void 0:(console.log("Unknown class: "+e),!1)}),n.deserialize(t.data)}var i={};return $.each(t,function(t,e){i[t]=locuslabs.deserialize(e)}),i}return t},!function(t,e){"use strict";function n(t){return t&&t.toLowerCase?t.toLowerCase():t}function i(t,e){for(var n=0,i=t.length;i>n;n++)if(t[n]==e)return!s;return s}var s=!1,o=null,a=parseFloat,r=Math.min,l=/(-?\d+\.?\d*)$/g,u=/(\d+\.?\d*)$/g,c=[],h=[],d=function(t){return"string"==typeof t},p=function(t,e){for(var n,i=t.length,s=i;s--;)n=i-s-1,e(t[n],n)},f=Array.prototype.indexOf||function(t){var e=this.length,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=e);e>n;n++)if(n in this&&this[n]===t)return n;return-1};t.tinysort={id:"TinySort",version:"1.5.6",copyright:"Copyright (c) 2008-2013 Ron Valstar",uri:"http://tinysort.sjeiti.com/",licensed:{MIT:"http://www.opensource.org/licenses/mit-license.php",GPL:"http://www.gnu.org/licenses/gpl.html"},plugin:function(){var t=function(t,e){c.push(t),h.push(e)};return t.indexOf=f,t}(),defaults:{order:"asc",attr:o,data:o,useVal:s,place:"start",returns:s,cases:s,forceStrings:s,ignoreDashes:s,sortFunction:o}},t.fn.extend({tinysort:function(){var g,m,v,b,y=this,_=[],w=[],M=[],x=[],C=0,I=[],S=[],E=function(t){p(c,function(e){e.call(e,t)})},L=function(t,e){return"string"==typeof e&&(t.cases||(e=n(e)),e=e.replace(/^\s*(.*?)\s*$/i,"$1")),e},k=function(t,e){var n=0;for(0!==C&&(C=0);0===n&&b>C;){var i=x[C],o=i.oSettings,r=o.ignoreDashes?u:l;if(E(o),o.sortFunction)n=o.sortFunction(t,e);else if("rand"==o.order)n=Math.random()<.5?1:-1;else{var c=s,f=L(o,t.s[C]),g=L(o,e.s[C]);if(!o.forceStrings){var m=d(f)?f&&f.match(r):s,v=d(g)?g&&g.match(r):s;if(m&&v){var y=f.substr(0,f.length-m[0].length),_=g.substr(0,g.length-v[0].length);y==_&&(c=!s,f=a(m[0]),g=a(v[0]))}}n=i.iAsc*(g>f?-1:f>g?1:0)}p(h,function(t){n=t.call(t,c,f,g,n)}),0===n&&C++}return n};for(g=0,v=arguments.length;v>g;g++){var D=arguments[g];d(D)?I.push(D)-1>S.length&&(S.length=I.length-1):S.push(D)>I.length&&(I.length=S.length)}for(I.length>S.length&&(S.length=I.length),b=I.length,0===b&&(b=I.length=1,S.push({})),g=0,v=b;v>g;g++){var P=I[g],T=t.extend({},t.tinysort.defaults,S[g]),N=!(!P||""===P),A=N&&":"===P[0];x.push({sFind:P,oSettings:T,bFind:N,bAttr:!(T.attr===o||""===T.attr),bData:T.data!==o,bFilter:A,$Filter:A?y.filter(P):y,fnSort:T.sortFunction,iAsc:"asc"==T.order?1:-1})}return y.each(function(n,i){var s,o=t(i),a=o.parent().get(0),r=[];for(m=0;b>m;m++){var l=x[m],u=l.bFind?l.bFilter?l.$Filter.filter(i):o.find(l.sFind):o;r.push(l.bData?u.data(l.oSettings.data):l.bAttr?u.attr(l.oSettings.attr):l.oSettings.useVal?u.val():u.text()),s===e&&(s=u)}var c=f.call(M,a);0>c&&(c=M.push(a)-1,w[c]={s:[],n:[]}),s.length>0?w[c].s.push({s:r,e:o,n:n}):w[c].n.push({e:o,n:n})}),p(w,function(t){t.s.sort(k)}),p(w,function(t){var e=t.s,n=t.n,o=e.length,a=n.length,l=o+a,u=[],c=l,h=[0,0];switch(T.place){case"first":p(e,function(t){c=r(c,t.n)});break;case"org":p(e,function(t){u.push(t.n)});break;case"end":c=a;break;default:c=0}for(g=0;l>g;g++){var d=i(u,g)?!s:g>=c&&c+o>g,f=d?0:1,m=(d?e:n)[h[f]].e;m.parent().append(m),(d||!T.returns)&&_.push(m.get(0)),h[f]++}}),y.length=0,Array.prototype.push.apply(y,_),y}}),t.fn.TinySort=t.fn.Tinysort=t.fn.tsort=t.fn.tinysort}(jQuery),locuslabs.Base=function(){},locuslabs.Base.addNonEnumeratedProperty=function(t,e,n){("object"==typeof t||"function"==typeof t)&&Object.defineProperty(t,e,{value:n,enumerable:!1,configurable:!0,writable:!0})},locuslabs.Base.addNonEnumeratedProperty(locuslabs.Base.prototype,"category","function-prototype-base"),locuslabs.Base.addNonEnumeratedProperty(locuslabs.Base,"category","function-base"),locuslabs.Base.subclass=function(t,e){var n=this,i=e.hasOwnProperty("constructor")?e.constructor:function(){};locuslabs.Base.addNonEnumeratedProperty(i,"$name","constructor"),delete e.constructor,i.prototype=Object.create(n.prototype),locuslabs.Base.addNonEnumeratedProperty(i.prototype,"constructor",i),locuslabs.Base.addNonEnumeratedProperty(i.prototype,"category","function-prototype-"+t),locuslabs.Base.addNonEnumeratedProperty(i,"category","function-"+t),locuslabs.Base.addNonEnumeratedProperty(i,"subclass",locuslabs.Base.subclass),locuslabs.Base.addNonEnumeratedProperty(i.prototype,"parentConstructor",n),locuslabs.Base.addNonEnumeratedProperty(i.prototype,"parentPrototype",n.prototype),locuslabs.Base.addNonEnumeratedProperty(i.prototype,"className",t);for(var s in e){var o;if(e.hasOwnProperty(s))if("static"==s){var a=e[s];for(var r in a)a.hasOwnProperty(r)&&(o=a[r],i[r]=o,locuslabs.Base.addNonEnumeratedProperty(o,"$name",r))}else o=e[s],i.prototype[s]=o,locuslabs.Base.addNonEnumeratedProperty(o,"$name",s)}return locuslabs.Base.addNonEnumeratedProperty(i.prototype,"callParent",function(t){function e(t){for(var e=t,n=t.callParent.caller,i=n.$name;!e.hasOwnProperty(i)||e[i]!=n;)e=e.__proto__;return e}var n,i=this.callParent.caller.$name;if("constructor"==i)return n=this.callParent.caller.prototype,n.parentConstructor.apply(this,arguments);try{return n=e(this).__proto__,n[i].apply(this,arguments)}catch(s){var o=e(this).className+"."+i+"() called this.callParent, but no ancestor has a method named '"+i+"'";throw new Error(o)}}),i},locuslabs.maps.MVCObject=locuslabs.Base.subclass("MVCObject",{constructor:function(){this.callParent()},addListener:function(t,e){return locuslabs.maps.event.addDomListener(this,t,e)},bindTo:function(t,e,n,i){this.__mvcbindings||(this.__mvcbindings={}),this.__mvcbindings[t]&&this.unbind(t);var s=this,o=e.addListener(n+"_changed",function(){s.changed(t),i||s.notify(t)});this.__mvcbindings[t]={target:e,targetKey:n,listener:o},this.changed(t),i||this.notify(t)},changed:function(t,e){this[t+"_changed"]&&this[t+"_changed"](e)},get:function(t){if(this.__mvcbindings){var e=this.__mvcbindings[t];if(e)return e.target.get(e.targetKey)}return this.__mvcobject?this.__mvcobject[t]:null},notifyAll:function(){var t=this;$.each(this.__mvcobject,function(e,n){t.notify(e)}),$.each(this.__mvcbindings,function(e,n){t.notify(e)})},notify:function(t){locuslabs.maps.event.trigger(this,t+"_changed"),locuslabs.maps.event.trigger(this,"changed",t)},set:function(t,e){if(this.__mvcbindings){var n=this.__mvcbindings[t];if(n)return void n.target.set(n.targetKey,e)}this.__mvcobject||(this.__mvcobject={});var i=this.__mvcobject[t];this.__mvcobject[t]=e,i!=this.__mvcobject[t]&&(this.changed(t,i),this.notify(t))},setValues:function(t){var e=this;$.each(t,function(t,n){e.set(t,n)})},unbind:function(t){if(this.__mvcbindings){var e=this.__mvcbindings[t];e&&(locuslabs.maps.event.removeListener(e.listener),delete this.__mvcbindings[t])}},unbindAll:function(){if(this.__mvcbindings){var t=this;$.each(this.__mvcbindings,function(e,n){t.unbind(e)})}},getUUID:function(){return this.get("uuid")},getClassName:function(){return"locuslabs.maps.MVCObject"}}),locuslabs.Events=locuslabs.maps.MVCObject.subclass("Events",{constructor:function(t){var e={};t&&$.each(t,function(t,n){e[t]=n}),$.each(locuslabs.Events.defaults,function(t,n){t in e||(e[t]=n)}),this.options=e},addEvent:function(t){this.current||(this.current=[]),this.current.push(t)},isBatchTooBig:function(t){return t.length>=this.options.maxBatchSize},isBatchTooOld:function(t){if(0==t.length)return!1;var e=new Date;return e.getTime()-new Date(t[0].timestamp).getTime()>=this.options.maxBatchAge},checkCurrent:function(){this.current&&(this.options.sendNow||this.isBatchTooBig(this.current)||this.isBatchTooOld(this.current))&&(this.addToPending(),this.current=[])},sendRequest:function(t,e){locuslabs.maps.event.trigger(this,"sending",t.events);var n=locuslabs.config.apiBase+"/events",i=this,s=$.ajax({method:"POST",url:n,contentType:"application/json",data:t.data});return s.then(function(){t.done=!0,i.removeFromPending(e),locuslabs.maps.event.trigger(i,"success",t.events)}).fail(function(e){var n=e.statusCode();locuslabs.log.warn("Event submission returned "+n+" error!"),locuslabs.maps.event.trigger(i,"failed",t.events);var s=t.nextDelay;t.canceled||(t.timeout=setTimeout(function(){t.request=i.sendRequest(t)},s),s=2*s,s>i.options.maxBackoff&&(s=i.options.maxBackoff),t.nextDelay=s)}),s},addToPending:function(){this.pending||(this.pending={batches:{},dataSize:0,first:0,next:0});var t=JSON.stringify(this.current),e={nextDelay:this.options.initialBackoff,submitted:new Date,done:!1,events:this.current,data:t},n=this.pending.next;for(this.pending.batches[n]=e,this.pending.dataSize+=t.length,this.pending.next+=1,e.request=this.sendRequest(e,n);this.pending.dataSize>=this.options.maxPendingSize;)this.removeFromPending(this.pending.first)},cancelBatch:function(t){t.canceled=!0,t.request&&t.request.abort(),t.timeout&&clearTimeout(t.timeout)},removeFromPending:function(t){if(!(t<this.pending.first||t>=this.pending.next||!this.pending.batches[t])){var e=this.pending.batches[t];if(this.cancelBatch(e),this.pending.dataSize-=e.data.length,delete this.pending.batches[t],t==this.pending.first)for(this.pending.first+=1;!this.pending.batches[this.pending.first]&&this.pending.first<this.pending.next;)this.pending.first+=1;locuslabs.maps.event.trigger(this,"removed",e.events)}},getAccountId:function(){return this.options.accountId||locuslabs._getAccountId()},getInstallId:function(){return this.options.installId||locuslabs._getInstallId()},count:function(){var t=0;return this.current&&(t+=this.current.length),this.pending&&$.each(this.pending.batches,function(e,n){t+=n.events.length}),t},isEmpty:function(){return 0==this.count()},submit:function(t){t.timestamp=(new Date).toISOString(),t.installId=this.getInstallId(),t.accountId=this.getAccountId(),t.installId&&t.accountId&&(this.addEvent(t),this.checkCurrent())},flush:function(){for(;this.pending.first<this.pending.next;)this.removeFromPending(this.pending.first);this.current=[]},"static":{defaults:{sendNow:!1,maxBatchSize:120,maxBatchAge:6e4,initialBackoff:100,maxBackoff:36e5,maxPendingSize:1024e3}}}),locuslabs.Person=locuslabs.maps.MVCObject.subclass("Person",{constructor:function(t){var e=_.defaults(t||{});e.uuid||(e.uuid=locuslabs.uuid()),this.callParent(),this.setValues(e)},getName:function(){return this.get("name")},setName:function(t){this.set("name",t)},_update:function(){if(this.get("id")){var t=JSON.stringify({people:{name:this.getName()}}),e=this;$.ajax({url:locuslabs.config.apiBase+"/people/"+this.get("id"),data:t,method:"put"}).then(function(){locuslabs.log.debug("Person :",e.get("id")," updated")}).fail(function(){locuslabs.log.error("Failed to update person :",e.get("id")),setTimeout(function(){e._update()},3e4)})}},name_changed:function(){this._update()},getClassName:function(){return"locuslabs.Person"},"static":{_loadPersonId:function(t){return locuslabs._loadAccountId().then(function(e){var n=locuslabs.config.apiBase+"/people?account="+e+"&accountSpecificId="+encodeURIComponent(t);return locuslabs.log.debug("Loading personId:",n),$.ajax({url:n,method:"get"})}).then(function(t){return t&&t.people&&t.people.length?t.people[0]:null})},_loadPerson:function(t){var e=locuslabs.config.apiBase+"/people/"+t;return locuslabs.log.debug("Loading person:",e),$.ajax({url:e,method:"get"}).then(function(t){return locuslabs.log.debug("Loaded person:",JSON.stringify(t.people)),new locuslabs.Person(t.people)})},_createPerson:function(t){return locuslabs._loadAccountId().then(function(e){var n=JSON.stringify({people:{accountSpecificId:t,links:{account:e}}});return $.ajax({url:locuslabs.config.apiBase+"/people",method:"post",data:n,contentType:"application/vnd.api+json"})}).then(function(t){return t&&t.people?(locuslabs.log.debug("Person created:",t.people.id),t.people.id):null})},load:function(t,e,n){locuslabs.Person._loadPersonId(t).then(function(e){return e?locuslabs.Person._loadPerson(e):locuslabs.Person._createPerson(t).then(function(t){return locuslabs.Person._loadPerson(t)})}).then(function(t){e&&e(t)}).fail(function(e){locuslabs.log.error("Person creation failed:",e),n&&n(e.toString(),t)})}}}),locuslabs.Session=locuslabs.Base.subclass("Session",{active:!1,begin:function(t){t=t||{},this.active&&this.end(),locuslabs.log.debug("Begin session "+JSON.stringify(t)),this.id=locuslabs.uuid(),this.active=!0;var e={type:"sessionStart",id:this.id,sdkVersion:locuslabs.config.sdkVersion};"js"==locuslabs.config.sdk&&(e.browserUserAgent=window.navigator.userAgent,e.locale=window.navigator.language),$.each(t,function(t,n){e[t]=n}),this.event(e)},event:function(t){this.active||this.begin(),t.sessionId=this.id,locuslabs.events.submit(t)},end:function(){this.active&&(this.event({type:"sessionFinish",id:this.id}),this.active=!1,this.id=null)}}),locuslabs.maps.Beacon=locuslabs.Base.subclass("Beacon",{constructor:function(t){this.callParent(),this.beaconUUID=t.UUID,this.majorId=t.majorId,this.minorId=t.minorId,this.position=new locuslabs.maps.Position(t.position)},toString:function(){return JSON.stringify(this)},getBeaconUUID:function(){return this.beaconUUID},getMajorId:function(){return this.majorId},getMinorId:function(){return this.minorId},getPosition:function(){return this.position},getClassName:function(){return"locuslabs.maps.Beacon"},getUUID:function(){return this.uuid||(this.uuid=this.toString()),this.uuid},"static":{newInstance:function(t,e){var n=new locuslabs.maps.Beacon(e[0]);return n.uuid=t,n}}}),locuslabs.maps.Cache=locuslabs.Base.subclass("Cache",{constructor:function(){this.callParent()},"static":{dataCache:{},putData:function(t,e){locuslabs.maps.Cache.dataCache[t]=e},getData:function(t){return locuslabs.maps.Cache.dataCache[t]}}}),locuslabs.maps.Circle=function(t){t=t||{};var e={};$.each(t,function(t,n){e[t]=n}),$.each(locuslabs.maps.Circle.defaults,function(t,n){t in e||(e[t]=n)}),e.uuid||(e.uuid=locuslabs.uuid()),this._manageView=e.manageView,this._manageView&&(this._view=new locuslabs.maps.CircleView,this._view.setCircle(this)),this.setOptions(e)},locuslabs.maps.Circle.defaults={clickable:!0,visible:!0,manageView:!0,zIndex:0},locuslabs.maps.Circle.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.Circle.prototype.getBounds=function(){console.error("locuslabs.maps.Circle.prototype.getBounds not supported")},locuslabs.maps.Circle.newInstance=function(t,e){var n={};e&&e.length&&(n=e[0]),n.manageView=!1;var i=new locuslabs.maps.Circle(n);return i.set("uuid",t),i},locuslabs.maps.Circle.prototype.getCenter=function(){return this.get("center")},locuslabs.maps.Circle.prototype.getDraggable=function(){console.error("locuslabs.maps.Circle.prototype.getDraggable not supported")},locuslabs.maps.Circle.prototype.getEditable=function(){console.error("locuslabs.maps.Circle.prototype.getEditable not supported")},locuslabs.maps.Circle.prototype.getRadius=function(){return this.get("radius")},locuslabs.maps.Circle.prototype.getVisible=function(){return this.get("visible")},locuslabs.maps.Circle.prototype.setCenter=function(t){this.set("center",t)},locuslabs.maps.Circle.prototype.setDraggable=function(){console.error("locuslabs.maps.Circle.prototype.setDraggable not supported")},locuslabs.maps.Circle.prototype.setEditable=function(){console.error("locuslabs.maps.Circle.prototype.setEditable not supported")},locuslabs.maps.Circle.prototype.setFloor=function(t){this.set("floor",t)},locuslabs.maps.Circle.prototype.setOptions=function(t){this.setValues(t)},locuslabs.maps.Circle.prototype.setRadius=function(t){this.set("radius",t)},locuslabs.maps.Circle.prototype.setEditable=function(){console.error("locuslabs.maps.Circle.prototype.setEditable not supported")},locuslabs.maps.Circle.prototype.setVisible=function(t){this.set("visible",t)},locuslabs.maps.Circle.prototype.floor_changed=function(){this._manageView&&this._view.setFloorView(this.get("floor"))},locuslabs.maps.CircleView=function(t){t||(t=locuslabs.uuid()),this.set("uuid",t)},locuslabs.maps.CircleView.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.CircleView.newInstance=function(t){var e=new locuslabs.maps.CircleView;return e.set("uuid",t),e},locuslabs.maps.CircleView.prototype.circle_changed=function(){if(this._circle&&(d3.select(this._circle).remove(),this._circle=null),this.getCircle()){var t=this;this.getCircle().addListener("center_changed",function(){t._updateCenter()}),this.getCircle().addListener("clickable_changed",function(){t._updateClickable()}),this.getCircle().addListener("radius_changed",function(){t._updateRadius()}),this.getCircle().addListener("fillColor_changed",function(){t._updateFillColor()}),this.getCircle().addListener("fillOpacity_changed",function(){t._updateFillOpacity()}),this.getCircle().addListener("strokeColor_changed",function(){t._updateStrokeColor()}),this.getCircle().addListener("strokeOpacity_changed",function(){t._updateStrokeOpacity()}),this.getCircle().addListener("strokeWeight_changed",function(){t._updateStrokeWeight()}),this.getCircle().addListener("visible_changed",function(){t._updateVisible()}),this.getCircle().addListener("zIndex_changed",function(){t._updateZIndex()}),this._updateFloor(),this._updateAll()}},locuslabs.maps.CircleView.prototype.getCircle=function(){return this.get("circle")},locuslabs.maps.CircleView.prototype.getFloorView=function(){return this.get("floorView")},locuslabs.maps.CircleView.prototype.floorView_changed=function(){this._updateFloor()},locuslabs.maps.CircleView.prototype.setCircle=function(t){this.set("circle",t)},locuslabs.maps.CircleView.prototype.setFloorView=function(t){return this.set("floorView",t)},locuslabs.maps.CircleView.prototype._updateCenter=function(){if(this._circle&&this.getFloorView().getMapView()){var t=this.getCircle().get("center"),e=this.getFloorView().getMapView().fromLatLng(t);e&&($(this._circle).attr("cx",e[0]),$(this._circle).attr("cy",e[1]))}},locuslabs.maps.CircleView.prototype._updateClickable=function(){if(this._circle&&this.getFloorView().getMapView()){var t=this,e="click dblclick drag dragend dragstart mousedown mousemove mouseout mouseover mouseup";$.each(e.split(" "),function(e,n){var i=null;t.getCircle().get("clickable")&&(i=function(){var e=d3.mouse(t.getFloorView().getMapView().getSvg()),i=t.getFloorView().getMapView().toLatLng(e);locuslabs.maps.event.trigger(t.getCircle(),n,new locuslabs.maps.MouseEvent(i))}),d3.select(t._circle).on(n,i)})}},locuslabs.maps.CircleView.prototype._updateFillColor=function(){this._circle&&this.getFloorView().getMapView()&&$(this._circle).attr("fill",this.getCircle().get("fillColor"))},locuslabs.maps.CircleView.prototype._updateFillOpacity=function(){this._circle&&this.getFloorView().getMapView()&&$(this._circle).attr("fill-opacity",this.getCircle().get("fillOpacity"))},locuslabs.maps.CircleView.prototype._updateFloor=function(){try{if(this._circle&&(d3.select(this._circle).remove(),this._circle=null),!this.getCircle())return;if(!this.getFloorView())return;var t=this;if(!this.getFloorView().getMapView().isReady())return void locuslabs.maps.event.addListenerOnce(this.getFloorView().getMapView(),"ready",function(){t._updateFloor()});var e=this.getFloorView().getObjectGroup();this._circle=d3.select(e).append("svg:circle").attr("id",this.getUUID())[0][0],
this._updateAll()}catch(n){locuslabs.log.error("locuslabs.maps.CircleView.prototype._updateFloor : "+n)}},locuslabs.maps.CircleView.prototype._updateRadius=function(){if(this._circle){var t=this.getCircle().get("radius"),e=this.getFloorView().getMapView().fromMeters(t);$(this._circle).attr("r",e)}},locuslabs.maps.CircleView.prototype._updateStrokeColor=function(){this._circle&&$(this._circle).attr("stroke",this.getCircle().get("strokeColor"))},locuslabs.maps.CircleView.prototype._updateStrokeOpacity=function(){this._circle&&$(this._circle).attr("stroke-opacity",this.getCircle().get("strokeOpacity"))},locuslabs.maps.CircleView.prototype._updateStrokeWeight=function(){this._circle&&$(this._circle).attr("stroke-width",this.getCircle().get("strokeWeight"))},locuslabs.maps.CircleView.prototype._updateVisible=function(){this._circle&&(this.getCircle().get("visible")?$(this._circle).attr("visibility",""):$(this._circle).attr("visibility","hidden"))},locuslabs.maps.CircleView.prototype._updateZIndex=function(){this._circle&&this.getCircle().get("zIndex")!=$(this._circle).attr("z-index")&&($(this._circle).attr("z-index",this.getCircle().get("zIndex")),this.getFloorView().sortObjects())},locuslabs.maps.CircleView.prototype._updateAll=function(){this.getCircle()&&(this._updateClickable(),this._updateCenter(),this._updateRadius(),this._updateFillColor(),this._updateFillOpacity(),this._updateStrokeColor(),this._updateStrokeOpacity(),this._updateStrokeWeight(),this._updateVisible(),this._updateZIndex())},locuslabs.maps.DataLoader=function(){this._data={}},locuslabs.maps.DataLoader.newInstance=function(t,e){var n=new locuslabs.maps.DataLoader;return n._data.uuid=t,n},locuslabs.maps.DataLoader.prototype.getUUID=function(){return this._data.uuid||(this._data.uuid=this.toString()),this._data.uuid},locuslabs.maps.DataLoader.prototype.getClassName=function(){return"locuslabs.maps.DataLoader"},locuslabs.maps.DataLoader.prototype.equals=function(t){return!0},locuslabs.maps.DataLoader.prototype.toString=function(){return"(DataLoader)"},locuslabs.maps.DataLoader.prototype.setCache=function(t,e){try{locuslabs.log.debug("Storing in Cache : "+t),locuslabs.maps.Cache.putData(t,e)}catch(n){locuslabs.log.error(n)}},locuslabs.maps.DataLoader.prototype.setLS=function(t,e){try{locuslabs.log.debug("Storing in Local Storage : "+t),localStorage.setItem(t,e)}catch(n){locuslabs.log.error(n)}},locuslabs.maps.DataLoader.prototype.getCache=function(t){try{locuslabs.log.debug("Retrieving from Cache : "+t);var e=locuslabs.maps.Cache.getData(t);return e?(locuslabs.log.debug(t+" found in Cache."),e):(locuslabs.log.debug(t+" NOT found in Cache!"),null)}catch(n){locuslabs.log.error("getCache: "+n)}},locuslabs.maps.DataLoader.prototype.getLS=function(t){try{locuslabs.log.debug("Retrieving from Local Storage : "+t);var e=localStorage.getItem(t);return e?(locuslabs.log.debug(t+" found in Local Storage."),e):(locuslabs.log.debug(t+" NOT found in Local Storage!"),null)}catch(n){locuslabs.log.error("getLS: "+n)}},locuslabs.maps.DataLoader.prototype.clear=function(){locuslabs.log.debug("Clearing the Local Storage Repository"),localStorage.clear()},locuslabs.maps.DataLoader.prototype.clearVenue=function(t){locuslabs.log.debug("Clearing the venueId: "+t),locuslabs.maps.Venue.clearVenueById(t)},locuslabs.maps.DataLoader.prototype.setMap=function(t,e){this.setCache(t+".map",e)},locuslabs.maps.DataLoader.prototype.setPoi=function(t,e){this.setCache(t+".poi",e)},locuslabs.maps.DataLoader.prototype.setVenueData=function(t,e){this.setCache(t+"venueData.json",e)},locuslabs.maps.DataLoader.prototype.setVenueList=function(t){this.setLS("venueList.json",t)},locuslabs.maps.DataLoader.prototype.setBeacons=function(t,e){this.setCache(t+".beacons",e)},locuslabs.maps.DataLoader.prototype.setNav=function(t,e){this.setCache(t+".nav",e)},locuslabs.maps.DataLoader.prototype.getMap=function(t,e,n){try{var i=this.getCache(t+".map");null!=i?e(i):n()}catch(s){locuslabs.log.error("getMap: "+s)}},locuslabs.maps.DataLoader.prototype.getPoi=function(t,e,n){try{var i=this.getCache(t+".poi");null!=i?e(JSON.parse(i)):n()}catch(s){locuslabs.log.error("getPoi: "+s)}},locuslabs.maps.DataLoader.prototype.getVenueData=function(t,e,n){try{var i=this.getCache(t+"venueData.json");null!=i?e(JSON.parse(i)):n()}catch(s){locuslabs.log.error("getVenueData: "+s)}},locuslabs.maps.DataLoader.prototype.getVenueList=function(t,e){try{var n=this.getLS("venueList.json");null!=n?t(JSON.parse(n)):e()}catch(i){locuslabs.log.error("getVenueList: "+i)}},locuslabs.maps.DataLoader.prototype.getBeacons=function(t,e,n){try{var i=this.getCache(t+".beacons");null!=i?e(JSON.parse(i)):n()}catch(s){locuslabs.log.error("getBeacons: "+s)}},locuslabs.maps.DataLoader.prototype.getNav=function(t,e,n){try{var i=this.getCache(t+".nav");null!=i?e(JSON.parse(i)):n()}catch(s){locuslabs.log.error("getNav: "+s)}},locuslabs.maps.DataLoader.prototype.serialize=function(){return{__locuslabs_serialized_object__:!0,className:"locuslabs.maps.DataLoader",data:{}}},locuslabs.maps.DataLoader.deserialize=function(t){return new locuslabs.maps.DataLoader},locuslabs.dataloader=new locuslabs.maps.DataLoader,locuslabs.maps.FloorView=function(t){var e={};$.each(t,function(t,n){e[t]=n}),e.uuid=locuslabs.uuid(),$.each(locuslabs.maps.FloorView.defaults,function(t,n){t in e||(e[t]=n)}),this.setValues(e),d3.select(this.getGroup()).append("svg:g").attr("id","ll-"+this.get("floorName")+"-object")},locuslabs.maps.FloorView.defaults={},locuslabs.maps.FloorView.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.FloorView.prototype.getClassName=function(){return"locuslabs.maps.FloorView"},locuslabs.maps.FloorView.prototype.getGroup=function(){return this.get("group")},locuslabs.maps.FloorView.prototype.getMapView=function(){return this.get("mapView")},locuslabs.maps.FloorView.prototype.getObjectGroup=function(){return $(this.getGroup()).find("#ll-"+this.get("floorName")+"-object").get(0)},locuslabs.maps.FloorView.prototype.sortObjects=function(){$(this.getObjectGroup()).children().tsort({attr:"z-index"})},locuslabs.maps.FloorView.prototype.hideFloor=function(){$(this.getGroup()).css("visibility","hidden")},locuslabs.maps.FloorView.prototype.showFloor=function(){$(this.getGroup()).css("visibility","visible")},locuslabs.maps.FloorView.prototype.teardown=function(){this.set("group",null)},locuslabs.maps.MinPriorityQueue=locuslabs.Base.subclass("MinPriorityQueue",{constructor:function(){this.callParent(),this.heap=[null],this.heapMap={}},offerWithPriority:function(t,e){var n=this.heap.push([t,e])-1;this.heapMap[t]=n,this.bubble(n)},raisePriority:function(t,e){var n=this.heapMap[t];this.heap[n][1]=e,this.bubble(n)},poll:function(){if(1==this.heap.length)return null;if(2==this.heap.length){var t=this.heap.pop()[0];return delete this.heapMap[t],t}var t=this.heap[1][0];return delete this.heapMap[t],this.heap[1]=this.heap.pop(),this.heapMap[this.heap[1][0]]=1,this.sink(1),t},isEmpty:function(){return 1==this.heap.length},bubble:function(t){for(;t>1;){var e=t>>1;if(!this.isHigherPriority(t,e))break;this.swap(t,e),t=e}},sink:function(t){for(;2*t<this.heap.length;){var e=void 0==this.heap[2*t+1]?!1:this.isHigherPriority(2*t+1,2*t),n=e?2*t+1:2*t;if(this.isHigherPriority(t,n))break;this.swap(t,n),t=n}},swap:function(t,e){this.heapMap[this.heap[t][0]]=e,this.heapMap[this.heap[e][0]]=t;var n=this.heap[t];this.heap[t]=this.heap[e],this.heap[e]=n},isHigherPriority:function(t,e){return this.heap[t][1]<this.heap[e][1]}}),locuslabs.maps.GraphEdge=locuslabs.Base.subclass("GraphEdge",{constructor:function(t,e,n,i,s,o,a){this.callParent(),this.src=t,this.dst=e,this.type=n,this.transitTime=i,this.distance=s,this.securityCheckpoint=o?o:!1,this.path=a},getSrc:function(){return this.src},getDst:function(){return this.dst},getType:function(){return this.type},getTransitTime:function(){return this.transitTime},getDistance:function(){return this.distance},getPath:function(){return this.path},isSecurityCheckpoint:function(){return this.securityCheckpoint},toString:function(){return this.getSrc()+" -> "+this.getDst()}}),locuslabs.maps.GraphNode=locuslabs.Base.subclass("GraphNode",{constructor:function(t,e){this.callParent(),this.id=t,this.position=e,this.edges={},this.edgeList=[]},getId:function(){return this.id},getPosition:function(){return this.position},getLatLng:function(){return this.position.getLatLng()},getFloorId:function(){return this.position.getFloorId()},addEdge:function(t){var e=this.edges[t.getDst()];e||(this.edges[t.getDst()]=t,this.edgeList.push(t))},removeEdge:function(t){delete this.edges[t.getDst()];var e=this.edgeList.indexOf(t);this.edgeList.splice(e,1)},getEdges:function(){return this.edgeList},getEdge:function(t){return this.edges[t]},toString:function(){var t="";return $.each(this.edgeList,function(e,n){t+=n+", "}),this.id+" : ["+t+"]"}}),locuslabs.maps.NavigationGraph=locuslabs.Base.subclass("NavigationGraph",{constructor:function(t){this.callParent(),this.venueId=t,this.nodeList=[],this.nodes={},this.geoDb={},this.edgeBoundingBoxes=null},getVenueId:function(){return this.venueId},toString:function(){var t="[";return $.each(this.getAllNodes(),function(e,n){t+=n.getId()+", "}),t+="]","Nodes: "+t+", Count: "+this.nodeList.length},addNode:function(t){this.nodeList.push(t),this.nodes[t.getId()]=t;var e=t.getFloorId()+":"+t.getLatLng().getGeohash().substr(0,7),n=t.getFloorId()+":"+t.getLatLng().getGeohash().substr(0,8);this.geoDb[e]||(this.geoDb[e]=[]),this.geoDb[e].push(t),this.geoDb[n]||(this.geoDb[n]=[]),this.geoDb[n].push(t),this.edgeBoundingBoxes=null},getNode:function(t){return this.nodes[t]},getAllNodes:function(){return this.nodeList},distanceBetweenNodes:function(t,e){try{var n=this.getNode(t),i=this.getNode(e);return n.getLatLng().distance(i.getLatLng())}catch(s){return locuslabs.log.warn("distanceBetweenNodes: "+t+", "+e),Number.MAX_VALUE}},findShortestPath:function(t,e){try{if(t==e)return[t];var n=this._findPaths(t,e),i=e.getId();if(void 0==n[i])return null;for(var s=[i];n[i];)s.push(i=n[i]);for(var o=[],a=s.length-1;a>=0;a--)o.push(this.nodes[s[a]]);return o}catch(r){return locuslabs.log.debug("findShortestPath: "+r),null}},findClosestNode:function(t,e){for(var n=this.findNodesByGeohash(t,e.getGeohash()),i=[],s=0;s<n.length;s++)i.push([n[s],e.distance(n[s].getLatLng())]);i.sort(function(t,e){return t[1]-e[1]});for(var o=[],s=0;s<i.length;s++)o.push(i[s][0]);return o[0]},getEdgeBoundingBoxes:function(){if(!this.edgeBoundingBoxes){var t={},e=_.compact(_.flatten(_.collect(this.nodeList,function(e){return _.collect(e.edgeList,function(n){var i=Math.min(e.id,n.dst)+"|"+Math.max(e.id,n.dst);return t[i]?null:(t[i]=!0,{src:e.id,dst:n.dst})})})));this.edgeBoundingBoxes=_.each(e,function(t){var e=this.nodes[t.src].position.latLng,n=this.nodes[t.dst].position.latLng,i=e.lng(),s=n.lng(),o=e.lat(),a=n.lat(),r=o>a,l=s>i;t.top=r?o:a,t.bottom=r?a:o,t.left=l?i:s,t.right=l?s:i},this)}return this.edgeBoundingBoxes},cohenSutherlandIntersect:function(t,e,n,i,s,o,a,r){function l(t,e){var n=u;return s>t?n|=c:t>a&&(n|=h),o>e?n|=d:e>r&&(n|=p),n}const u=0,c=1,h=2,d=4,p=8;for(var f,g,m=l(t,e),v=l(n,i);;){if(!(m|v))return!0;if(m&v)return!1;var b=m?m:v;b&p?(f=t+(n-t)*(r-e)/(i-e),g=r):b&d?(f=t+(n-t)*(o-e)/(i-e),g=o):b&h?(g=e+(i-e)*(a-t)/(n-t),f=a):b&c&&(g=e+(i-e)*(s-t)/(n-t),f=s),b==m?(t=f,e=g,m=l(t,e)):(n=f,i=g,v=l(n,i))}},shortestDistanceFromPointToLineSegment:function(t,e,n){function i(t){return t*t}function s(t,e){return i(t.x-e.x)+i(t.y-e.y)}function o(t,e){return{distance:t,point:e}}function a(t,e,n){var i=s(e,n);if(0==i)return o(s(t,e),e);var a=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;if(0>a)return o(s(t,e),e);if(a>1)return o(s(t,n),n);var r={x:e.x+a*(n.x-e.x),y:e.y+a*(n.y-e.y)};return o(s(t,r),r)}var r=a(t,e,n);return o(Math.sqrt(r.distance),r.point)},_edgesNearLatLng:function(t,e){var n=t.lat()+e,i=t.lat()-e,s=t.lng()-e,o=t.lng()+e;return _.filter(this.getEdgeBoundingBoxes(),function(t){return this.cohenSutherlandIntersect(t.left,t.bottom,t.right,t.top,s,i,o,n)},this)},interpolateClosestPoint:function(t){for(var e=5e-4,n=this._edgesNearLatLng(t,e);0==n.length;)e=1.4*e,n=this._edgesNearLatLng(t,e);var i=_.collect(n,function(e){var n=this.nodes[e.src].position.latLng,i=this.nodes[e.dst].position.latLng;return this.shortestDistanceFromPointToLineSegment({x:t.lng(),y:t.lat()},{x:n.lng(),y:n.lat()},{x:i.lng(),y:i.lat()})},this),s=_.reduce(i,function(t,e){return t.distance>e.distance?e:t},{distance:Number.MAX_VALUE,point:null});return new locuslabs.maps.LatLng(s.point.y,s.point.x)},findClosestPoint:function(t,e){var n=this.findClosestNode(t,e);return n.getLatLng()},findNodesByGeohash:function(t,e){var n=this._findNodesByGeohash(t,e,8);return n.length>0?n:this._findNodesByGeohash(t,e,7)},_findNodesByGeohash:function(t,e,n){var i=e.substr(0,n),s=[];s.push(t+":"+calculateAdjacent(calculateAdjacent(i,"top"),"left")),s.push(t+":"+calculateAdjacent(i,"top")),s.push(t+":"+calculateAdjacent(calculateAdjacent(i,"top"),"right")),s.push(t+":"+calculateAdjacent(i,"left")),s.push(t+":"+i),s.push(t+":"+calculateAdjacent(i,"right")),s.push(t+":"+calculateAdjacent(calculateAdjacent(i,"bottom"),"left")),s.push(t+":"+calculateAdjacent(i,"bottom")),s.push(t+":"+calculateAdjacent(calculateAdjacent(i,"bottom"),"right"));for(var o=[],a=0;a<s.length;a++){var r=this.geoDb[s[a]];if(r)for(var l=0;l<r.length;l++)o.push(r[l])}return o},_findPaths:function(t,e){try{if(!t||!e)return null;if(t==e)return[t];var n={},i={},s={},o=new locuslabs.maps.MinPriorityQueue;for($.each(this.nodeList,function(t,e){n[e.getId()]=Number.MAX_VALUE,i[e.getId()]=void 0,o.offerWithPriority(e.getId(),Number.MAX_VALUE)}),n[t.getId()]=0,delete i[t.getId()],o.raisePriority(t.getId(),0);!o.isEmpty();){for(var a=o.poll(),r=this.getNode(a),l=r.getEdges(),u=0;u<l.length;u++){var c=l[u].getDst();if(!s[c]){var h=n[a]+l[u].getTransitTime();h<n[c]&&(n[c]=h,i[c]=a,o.raisePriority(c,h))}}s[a]=!0}return i}catch(d){return locuslabs.log.debug("_findPaths: "+d),null}},"static":{buildGraph:function(t,e){try{var n=new locuslabs.maps.NavigationGraph(t);return $.each(e.nodes,function(e,i){var s=i.id,o=new locuslabs.maps.Position({venueId:t,buildingId:"unknown",floorId:i.floorId,lat:i.lat,lng:i.lng});n.addNode(new locuslabs.maps.GraphNode(s,o))}),$.each(e.edges,function(t,e){var i=e.s,s=e.d,o=n.distanceBetweenNodes(i,s),a=""==e.t?"Ground":e.t,r=e.x?e.x:!1,l=e.l;0==l&&(l=o/84);var u=null;if(e.p){for(var c=[],h=0;h<e.p.length;h++){var d=e.p[h],p={};p.start=new locuslabs.maps.LatLng(d.s[0],d.s[1]),p.out=new locuslabs.maps.LatLng(d.o[0],d.o[1]),p["in"]=new locuslabs.maps.LatLng(d.i[0],d.i[1]),p.end=new locuslabs.maps.LatLng(d.e[0],d.e[1]),c.push(p)}u=new locuslabs.maps.GraphEdge(i,s,a,l,o,r,c)}else u=new locuslabs.maps.GraphEdge(i,s,a,l,o,r);n.getNode(i).addEdge(u)}),n}catch(i){return locuslabs.log.error("NavigationGraph.buildGraph: "+i),null}},graphValidator:function(t){var e=[],n=[],i=t.getAllNodes(),s=Math.random(),o=+Number(s*i.length).toFixed(0),a=i[o];return null==a?(locuslabs.log.debug("Bad Node - Trying again "),locuslabs.maps.NavigationGraph.graphValidator(t)):($.each(i,function(i,s){if(a.getId()!=s.getId()){var o=t.findShortestPath(a,s);o||e.push(s.getFloorId()+":"+s.getLatLng());var r=t.findShortestPath(s,a);r||n.push(s.getFloorId()+":"+s.getLatLng())}}),locuslabs.log.debug("Graph Validation for : "+t.getVenueId()),locuslabs.log.debug("	 No Path from "+a.getFloorId()+":"+a.getLatLng()+" to ["+e+"]"),locuslabs.log.debug("	 No Path from ["+n+"] to "+a.getFloorId()+":"+a.getLatLng()),e)}}}),locuslabs.maps.GraphBuilder=locuslabs.Base.subclass("GraphBuilder",{constructor:function(t,e){this.callParent(),this.poiDB=t,this.mapView=e,this.nodes={},this.nodeList=[],this.edges={},this.edgeList=[],e&&(this.venue=locuslabs.maps.Venue.getVenueById(this.mapView.getMap().get("venueId"))),this.floorOrdinals={}},addNode:function(t){return null==this.nodes[t.getId()]&&(this.nodes[t.getId()]=t,this.nodeList.push(t)),this.nodes[t.getId()]},getNode:function(t){return this.nodes[t]},removeNode:function(t){var e=this;$.each(t.getDstEdges(),function(t,n){e.removeEdge(n)}),$.each(t.getSrcEdges(),function(t,n){e.removeEdge(n)}),delete this.nodes[t.getId()];var n=this.nodeList.indexOf(t);this.nodeList.splice(n,1)},addEdge:function(t){if(t.getSrcId()!=t.getDstId()&&!this.doesEdgeExist(t)){this.edges[t.getId()]=t,this.edgeList.push(t);var e=this.getNode(t.getSrcId());e.addSrcEdge(t);var n=this.getNode(t.getDstId());return n.addDstEdge(t),!0}return!1},doesEdgeExist:function(t){return t&&null!=this.edges[t.getId()]},removeEdge:function(t){if(this.doesEdgeExist(t)){var e=this.getNode(t.getSrcId());e&&e.removeSrcEdge(t);var n=this.getNode(t.getDstId());n&&n.removeDstEdge(t),delete this.edges[t.getId()];var i=this.edgeList.indexOf(t);this.edgeList.splice(i,1)}},buildGraph:function(t){for(var e=0;e<t.levels.length;e++)for(var n=t.levels[e].name,i=t.levels[e].nav,s=0;s<i.length;s++)for(var o=i[s],a=o.points,r=0;r<a.length-1;r++){var l=a[r],u=a[r+1],c=this._getFirstPoint(l),h=this._getSecondPoint(u);if(c[0][0]==c[1][0]&&c[0][1]==c[1][1])this._buildNodesAndEdge(c[0][0],c[0][1],h[0][0],h[0][1],n,o.delay,o.secure);else for(var d=locuslabs.maps.Utilities.getCurvePoints([c[0],c[1],h[0],h[1]]),p=0;p<d.length-1;p+=1){var f=d[p][0],g=d[p][1],m=d[p+1][0],v=d[p+1][1];this._buildNodesAndEdge(f,g,m,v,n,o.delay,o.secure)}}locuslabs.log.debug("Node Count: "+this.nodeList.length),locuslabs.log.debug("Edge Count: "+this.edgeList.length),this._findEdge2EdgeIntersections(),this._findNodeEdgeIntersections(),this._findNodeEdgeIntersections(),this._addPortals(t)},_buildNodesAndEdge:function(t,e,n,i,s,o,a){var r=new locuslabs.maps.TNode(t,e,s);this.addNode(r);var l=new locuslabs.maps.TNode(n,i,s);this.addNode(l);var u=new locuslabs.maps.TEdge(r.getId(),l.getId(),"Ground",o,a);this.addEdge(u)},_getFirstPoint:function(t){if(t.p){var e=this.calcCoord(t.p.x),n=this.calcCoord(t.p.y),i=this.calcCoord(t.out.x),s=this.calcCoord(t.out.y);return[[e,n],[i,s]]}var o=this.calcCoord(t.x),a=this.calcCoord(t.y);return[[o,a],[o,a]]},_getSecondPoint:function(t){if(t.p){var e=this.calcCoord(t.p.x),n=this.calcCoord(t.p.y),i=this.calcCoord(t["in"].x),s=this.calcCoord(t["in"].y);return[[i,s],[e,n]]}var o=this.calcCoord(t.x),a=this.calcCoord(t.y);return[[o,a],[o,a]]},_findNodeEdgeIntersections:function(){locuslabs.log.debug("_findNodeEdgeIntersections nodes: "+this.nodeList.length+", edges: "+this.edgeList.length);try{var t=[],e={},n=this;$.each(n.nodeList,function(i,s){$.each(n.edgeList,function(i,o){if(n._nodeTouchesEdge(s,o)){var a=new locuslabs.maps.TEdge(o.getSrcId(),s.getId(),o.getType(),o.getDelay(),o.isSecurityCheckpoint());n.doesEdgeExist(a)||(t.push(a),e[a.getId()]=o);var r=new locuslabs.maps.TEdge(s.getId(),o.getDstId(),o.getType(),o.getDelay(),o.isSecurityCheckpoint());n.doesEdgeExist(r)||(t.push(r),e[r.getId()]=o)}})}),locuslabs.log.debug("Edges to Add: "+t.length);var i=0;$.each(t,function(t,s){if(n.addEdge(s)){var o=e[s.getId()];n.removeEdge(o),i++}}),locuslabs.log.debug("Edges Removed: "+i)}catch(s){locuslabs.log.error("findNodeEdgeIntersections: "+s)}},_findEdge2EdgeIntersections:function(){locuslabs.log.debug("_findEdge2EdgeIntersections edge count: "+this.edgeList.length);try{for(var t=[],e=[],n=0;n<this.edgeList.length;n++)for(var i=0;i<this.edgeList.length;i++){var s=this.edgeList[n],o=this.edgeList[i],a=this.findNonEdgeEndpointIntersection(s,o);if(a){var r=this.nodes[s.getSrcId()],l=this.nodes[s.getDstId()],u=this.nodes[o.getSrcId()],c=this.nodes[o.getDstId()],h=new locuslabs.maps.TNode(this.calcCoord(a[0]),this.calcCoord(a[1]),r.getZ());h=this.addNode(h);var d=new locuslabs.maps.TEdge(r.getId(),h.getId(),s.getType(),s.getDelay(),s.isSecurityCheckpoint()),p=new locuslabs.maps.TEdge(u.getId(),h.getId(),o.getType(),o.getDelay(),o.isSecurityCheckpoint()),f=new locuslabs.maps.TEdge(h.getId(),l.getId(),s.getType(),s.getDelay(),s.isSecurityCheckpoint()),g=new locuslabs.maps.TEdge(h.getId(),c.getId(),o.getType(),o.getDelay(),o.isSecurityCheckpoint());t.push(d),t.push(p),t.push(f),t.push(g),e.push(s),e.push(o)}}var m=this;$.each(t,function(t,e){m.addEdge(e)});var m=this;$.each(e,function(t,e){m.removeEdge(e)})}catch(v){locuslabs.log.debug("OH NOES!"+v),locuslabs.log.error("_findEdge2EdgeIntersections: "+v)}},_addPortals:function(t){locuslabs.log.debug("_addPortals portal count: "+t.portals.length);for(var e=0;e<t.portals.length;e++)try{if(t.portals[e].srcPoId.length>2||t.portals[e].dstPoId>2){var n="bi"==t.portals[e].direction,i=this.poiDB.getPoi(t.portals[e].srcPoId.substring(2)),s=this.poiDB.getPoi(t.portals[e].dstPoId.substring(2)),o=t.portals[e].delay;o||(o=0);var a=this.mapView.fromLatLng(i.position.latLng),r=this.mapView.fromLatLng(s.position.latLng),l=new locuslabs.maps.TNode(this.calcCoord(a[0]),this.calcCoord(a[1]),i.position.floorId),u=new locuslabs.maps.TNode(this.calcCoord(r[0]),this.calcCoord(r[1]),s.position.floorId),c=this._findClosestNode(l),h=this._findClosestNode(u),d=this.getPortalType(i);if("Train"==d||"Stairs"==d||"Elevator"==d||"Escalator"==d||"Ramp"==d||"Bus"==d){var p=null,f=null;if(""!=t.portals[e].navPathName){var g=this.extractPortalPath(t.portals[e].navPath,a);p=new locuslabs.maps.TEdge(l.getId(),u.getId(),d,o,!1,g);var m=this.extractPortalPath(t.portals[e].navPath,r);f=new locuslabs.maps.TEdge(u.getId(),l.getId(),d,o,!1,m)}else p=new locuslabs.maps.TEdge(l.getId(),u.getId(),d,o),f=new locuslabs.maps.TEdge(u.getId(),l.getId(),d,o);var v=new locuslabs.maps.TEdge(l.getId(),c.getId()),b=new locuslabs.maps.TEdge(c.getId(),l.getId()),y=new locuslabs.maps.TEdge(u.getId(),h.getId()),_=new locuslabs.maps.TEdge(h.getId(),u.getId());this.addNode(l),this.addNode(u),this.addEdge(p),this.addEdge(v),this.addEdge(b),this.addEdge(y),this.addEdge(_),n&&this.addEdge(f)}else{var p=new locuslabs.maps.TEdge(c.getId(),h.getId(),i.name,o),f=new locuslabs.maps.TEdge(h.getId(),c.getId(),i.name,o);this.addEdge(p),n&&this.addEdge(f)}}else locuslabs.log.debug("Bad POI ID: Src Portal: ["+t.portals[e].srcPoId+"] Dst Portal: ["+t.portals[e].dstPoId+"]")}catch(w){try{this.poiDB.getPoi(t.portals[e].srcPoId.substring(2))}catch(w){locuslabs.log.debug("Bad Portal Id:"+t.portals[e].srcPoId.substring(2))}try{this.poiDB.getPoi(t.portals[e].dstPoId.substring(2))}catch(w){locuslabs.log.debug("Bad Portal Id:"+t.portals[e].dstPoId.substring(2))}locuslabs.log.debug("addPortals: "+w+" Src Portal: "+t.portals[e].srcPoId+" Dst Portal: "+t.portals[e].dstPoId)}},getPortalType:function(t){var e=null,n=t.category.toLowerCase();return e="transport"==n?t.name.toLowerCase():n,-1!=e.indexOf("train")?"Train":-1!=e.indexOf("stairs")?"Stairs":-1!=e.indexOf("elevator")?"Elevator":-1!=e.indexOf("escalator")?"Escalator":-1!=e.indexOf("ramp")?"Ramp":-1!=e.indexOf("bus")?"Bus":(locuslabs.log.error("Non Recognized Portal Type! "+JSON.stringify(t)),t.name)},_mergeNodes:function(){locuslabs.log.debug("Merging Nodes");var t=0;try{for(var e=!0;e;){var n=this.__findNodesToMerge();null!=n?(t++,this.__mergeNodes(n[0],n[1]),e=!0):e=!1}locuslabs.log.debug("Nodes Merged : "+t)}catch(i){locuslabs.log.error("mergeNodes:"+i+"  ==>  "+i.stack)}},__findNodesToMerge:function(){for(var t=0;t<this.nodeList.length;t++){var e=this.nodeList[t],n=this._findClosestNode(e),i=this._nodeToNodeDistance(e,n);if(i<=locuslabs.maps.GraphBuilder.MERGE_NODE_TOLERANCE)return[n,e]}return null},__mergeNodes:function(t,e){var n=this,i=e.getDstEdges();$.each(i,function(e,i){var s=new locuslabs.maps.TEdge(t.getId(),i.getDstId(),i.getType(),i.getDelay(),i.isSecurityCheckpoint());n.removeEdge(i),n.addEdge(s)});var s=e.getSrcEdges();$.each(s,function(e,i){var s=new locuslabs.maps.TEdge(i.getSrcId(),t.getId(),i.getType(),i.getDelay(),i.isSecurityCheckpoint());n.removeEdge(i),n.addEdge(s)}),n.removeNode(e)},_findClosestNode:function(t){var e=Number.MAX_VALUE,n=null,i=this;return $.each(i.nodeList,function(s,o){if(o.getId()!=t.getId()&&i.isSameLevelOrdinal(o.getZ(),t.getZ())){var a=i._nodeToNodeDistance(o,t);e>a&&(n=o,e=a)}}),n},_nodeToNodeDistance:function(t,e){var n=e.getX()-t.getX(),i=e.getY()-t.getY();return Math.sqrt(Math.pow(n,2)+Math.pow(i,2))},_nodeTouchesEdge:function(t,e){if(t.getId()!=e.getSrcId()&&t.getId()!=e.getDstId()){var n=this.nodes[e.getSrcId()],i=this.nodes[e.getDstId()];if(this.isSameLevelOrdinal(t.getZ(),n.getZ())&&this.isSameLevelOrdinal(t.getZ(),i.getZ())){var s=this._distance(e,t);return s<locuslabs.maps.GraphBuilder.NODE_TO_EDGE_TOLERANCE}return!1}return!1},_distance:function(t,e){var n=this.nodes[t.getSrcId()],i=this.nodes[t.getDstId()];return this._distanceHelper(n.getX(),n.getY(),i.getX(),i.getY(),e.getX(),e.getY())},_distanceHelper:function(t,e,n,i,s,o){var a=n-t,r=i-e,l=a*a+r*r,u=((s-t)*a+(o-e)*r)/l;u>1?u=1:0>u&&(u=0);var c=t+u*a,h=e+u*r,d=c-s,p=h-o;return Math.sqrt(d*d+p*p)},findNonEdgeEndpointIntersection:function(t,e){var n=this.findEdgeToEdgeIntersection(t,e);return n&&!(this.isPointANode(n,t.getSrcId())||this.isPointANode(n,t.getDstId())||this.isPointANode(n,e.getSrcId())||this.isPointANode(n,e.getDstId()))?n:null},isPointANode:function(t,e){var n=this.nodes[e];return this.doPointsMatch(t[0],t[1],n.getX(),n.getY())},doPointsMatch:function(t,e,n,i){var s=Math.abs(Number(t).toFixed(0)-Number(n).toFixed(0)),o=Math.abs(Number(e).toFixed(0)-Number(i).toFixed(0));return 1>=s&&1>=o},findEdgeToEdgeIntersection:function(t,e){var n=this.nodes[t.getSrcId()],i=this.nodes[t.getDstId()],s=this.nodes[e.getSrcId()],o=this.nodes[e.getDstId()];if(this.isSameLevelOrdinal(n.getZ(),s.getZ())){var a=n.getX(),r=n.getY(),l=i.getX(),u=i.getY(),c=s.getX(),h=s.getY(),d=o.getX(),p=o.getY();return this.findEdgeToEdgeIntersectionHelper(a,r,l,u,c,h,d,p)}return null},findEdgeToEdgeIntersectionHelper:function(t,e,n,i,s,o,a,r){var l,u,c,h;l=n-t,u=i-e,c=a-s,h=r-o;var d=(-u*(t-s)+l*(e-o))/(-c*u+l*h),p=(c*(e-o)-h*(t-s))/(-c*u+l*h);if(d>=0&&1>=d&&p>=0&&1>=p){var f=t+p*l,g=e+p*u;return[f,g]}return null},calcCoord:function(t){return+Number(t).toFixed(0)},pointToPointDistance:function(t,e){var n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(Math.pow(n,2)+Math.pow(i,2))},closerToFirstPoint:function(t,e){var n=[t.points[0].p.x,t.points[0].p.y],i=[t.points[t.points.length-1].p.x,t.points[t.points.length-1].p.y],s=this.pointToPointDistance(n,e),o=this.pointToPointDistance(i,e);return o>=s},extractPortalPath:function(t,e){if(this.closerToFirstPoint(t,e)){for(var n=[],i=0;i<t.points.length-1;i++){var s={};s.start=[t.points[i].p.x,t.points[i].p.y],s.out=[t.points[i].out.x,t.points[i].out.y],s["in"]=[t.points[i+1]["in"].x,t.points[i+1]["in"].y],s.end=[t.points[i+1].p.x,t.points[i+1].p.y],n.push(s)}return n}for(var n=[],i=t.points.length-1;i>0;i--){var s={};s.start=[t.points[i].p.x,t.points[i].p.y],s.out=[t.points[i]["in"].x,t.points[i]["in"].y],s["in"]=[t.points[i-1].out.x,t.points[i-1].out.y],s.end=[t.points[i-1].p.x,t.points[i-1].p.y],n.push(s)}return n},isSameLevelOrdinal:function(t,e){if(t==e)return!0;var n=this.floorOrdinals[t],i=this.floorOrdinals[e];return n||(n=this.venue.getOrdinalForFloorId(t),this.floorOrdinals[t]=n),i||(i=this.venue.getOrdinalForFloorId(e),this.floorOrdinals[e]=i),n==i},generateNavData:function(){try{var t=new locuslabs.maps.NameTable,e={},n=[],i=[],s=this;return $.each(s.nodeList,function(e,i){var o=s.mapView.toLatLng([i.getX(),i.getY()]),a={};a.id=t.getIdForName(i.getId()),a.floorId=i.getZ(),a.lat=+Number(o.lat()).toFixed(6),a.lng=+Number(o.lng()).toFixed(6),n.push(a)}),$.each(this.edgeList,function(e,n){var o={};if(o.s=t.getIdForName(n.getSrcId()),o.d=t.getIdForName(n.getDstId()),o.l=n.getDelay(),o.t="Ground"==n.getType()?"":n.getType(),n.isSecurityCheckpoint()&&(o.x=!0),n.getPath()){o.p=[];for(var a=0;a<n.getPath().length;a++){var r=s.mapView.toLatLng(n.getPath()[a].start),l=s.mapView.toLatLng(n.getPath()[a].out),u=s.mapView.toLatLng(n.getPath()[a]["in"]),c=s.mapView.toLatLng(n.getPath()[a].end),h={};h.s=[+Number(r.lat()).toFixed(6),+Number(r.lng()).toFixed(6)],h.o=[+Number(l.lat()).toFixed(6),+Number(l.lng()).toFixed(6)],h.i=[+Number(u.lat()).toFixed(6),+Number(u.lng()).toFixed(6)],h.e=[+Number(c.lat()).toFixed(6),+Number(c.lng()).toFixed(6)],o.p.push(h)}}o.s!=o.d?i.push(o):locuslabs.log.debug("******* SHOULD NOT HAPPEN!")}),e.nodes=n,e.edges=i,locuslabs.log.debug("================================================"),locuslabs.log.debug("Nodes: "+this.nodeList.length),locuslabs.log.debug("Edges: "+this.edgeList.length),locuslabs.log.debug("================================================"),e}catch(o){return locuslabs.log.error("GraphBuilder.generateNavData: "+o),null}},"static":{NODE_TO_EDGE_TOLERANCE:2,MERGE_NODE_TOLERANCE:3}}),locuslabs.maps.TNode=locuslabs.Base.subclass("TNode",{constructor:function(t,e,n){this.callParent(),this.x=t,this.y=e,this.z=n,this.srcEdges={},this.srcEdgeList=[],this.dstEdges={},this.dstEdgeList=[]},getX:function(){return this.x},getY:function(){return this.y},getZ:function(){return this.z},getId:function(){return this.x+","+this.y+","+this.z},addSrcEdge:function(t){this.srcEdges[t.getDstId()]=t,this.srcEdgeList.push(t)},getSrcEdges:function(){return this.srcEdgeList},doesSrcEdgeExist:function(t){return null!=this.srcEdges[t.getDstId()]},removeSrcEdge:function(t){if(this.doesSrcEdgeExist(t)){delete this.srcEdges[t.getDstId()];var e=this.srcEdgeList.indexOf(t);this.srcEdgeList.splice(e,1)}},addDstEdge:function(t){this.dstEdges[t.getSrcId()]=t,this.dstEdgeList.push(t)},getDstEdges:function(){return this.dstEdgeList},doesDstEdgeExist:function(t){return null!=this.dstEdges[t.getSrcId()]},removeDstEdge:function(t){if(this.doesDstEdgeExist(t)){delete this.dstEdges[t.getSrcId()];var e=this.dstEdgeList.indexOf(t);this.dstEdgeList.splice(e,1)}},toString:function(){return"["+this.getId()+"] = ("+this.getX()+", "+this.getY()+", "+this.getZ()+")"}}),locuslabs.maps.TEdge=locuslabs.Base.subclass("TEdge",{constructor:function(t,e,n,i,s,o){this.callParent(),this.srcId=t,this.dstId=e,this.type=n?n:"Ground",this.delay=i?i:0,this.path=o,this.securityCheckpoint=s?s:!1},getId:function(){return this.srcId+":"+this.dstId},getSrcId:function(){return this.srcId},getDstId:function(){return this.dstId},getType:function(){return this.type},getDelay:function(){return this.delay},isSecurityCheckpoint:function(){return this.securityCheckpoint},getPath:function(){return this.path},toString:function(){return"["+this.getSrcId()+"]->["+this.getDstId()+"]"}}),locuslabs.maps.NameTable=locuslabs.Base.subclass("NameTable",{constructor:function(){this.callParent(),this.table={},this.count=1},getIdForName:function(t){var e=this.table[t];return null==e&&(e=this.count.toString(),this.table[t]=e,this.count+=1),e}}),locuslabs.maps.MergeTable=locuslabs.Base.subclass("MergeTable",{constructor:function(){this.callParent(),this.table={},this.list=[]},mergeNodes:function(t,e){var n=t.getId()+":"+e.getId(),i=e.getId()+":"+t.getId();this.table[n]||this.table[i]||(this.list.push([t,e]),this.table[n]=1,this.table[i]=1)},getMergeList:function(){return this.list}}),locuslabs.maps.InfoWindow=function(t){this._isOpen=!1,"anchorHeight"in t||(t.anchorHeight=locuslabs.maps.InfoWindow._ANCHOR_HEIGHT),"arrowPosition"in t||(t.arrowPosition=locuslabs.maps.InfoWindow._ARROW_POSITION),"arrowSize"in t||(t.arrowSize=locuslabs.maps.InfoWindow._ARROW_SIZE),"borderWidth"in t||(t.borderWidth=locuslabs.maps.InfoWindow._BORDER_WIDTH),"borderColor"in t||(t.borderColor=locuslabs.maps.InfoWindow._BORDER_COLOR),"borderRadius"in t||(t.borderRadius=locuslabs.maps.InfoWindow._BORDER_RADIUS),"backgroundColor"in t||(t.backgroundColor=locuslabs.maps.InfoWindow._BACKGROUND_COLOR),"minWidth"in t||(t.minWidth=locuslabs.maps.InfoWindow._MIN_WIDTH),"padding"in t||(t.padding=locuslabs.maps.InfoWindow._PADDING),"uuid"in t||(t.uuid=locuslabs.uuid()),"zIndex"in t||(t.zIndex=locuslabs.maps.InfoWindow._ZINDEX),"manageView"in t||(t.manageView=!0),this._manageView=t.manageView,this._manageView&&(this._view=new locuslabs.maps.InfoWindowView,this._view.setInfoWindow(this)),this.setOptions(t)},window.InfoWindow=locuslabs.maps.InfoWindow,
locuslabs.maps.InfoWindow.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.InfoWindow._ANCHOR_HEIGHT=34,locuslabs.maps.InfoWindow._ARROW_POSITION=50,locuslabs.maps.InfoWindow._ARROW_SIZE=15,locuslabs.maps.InfoWindow._BORDER_WIDTH=1,locuslabs.maps.InfoWindow._BORDER_COLOR="#ccc",locuslabs.maps.InfoWindow._BORDER_RADIUS=10,locuslabs.maps.InfoWindow._BACKGROUND_COLOR="#fff",locuslabs.maps.InfoWindow._MIN_WIDTH=50,locuslabs.maps.InfoWindow._PADDING=10,locuslabs.maps.InfoWindow._ZINDEX=100,locuslabs.maps.InfoWindow.prototype.setOptions=function(t){this.setValues(t)},locuslabs.maps.InfoWindow.prototype.setAnchorHeight=function(t){return this.set("anchorHeight",t)},locuslabs.maps.InfoWindow.prototype.getAnchorHeight=function(){return this.get("anchorHeight")},locuslabs.maps.InfoWindow.prototype.setArrowPosition=function(t){this.set("arrowPosition",t)},locuslabs.maps.InfoWindow.prototype.getArrowPosition=function(){return this.get("arrowPosition")},locuslabs.maps.InfoWindow.prototype.setArrowSize=function(t){this.set("arrowSize",t)},locuslabs.maps.InfoWindow.prototype.getArrowSize=function(){return this.get("arrowSize")},locuslabs.maps.InfoWindow.prototype.setBackgroundColor=function(t){return this.set("backgroundColor",t)},locuslabs.maps.InfoWindow.prototype.getBackgroundColor=function(){return this.get("backgroundColor")},locuslabs.maps.InfoWindow.prototype.setBorderColor=function(t){return this.set("borderColor",t)},locuslabs.maps.InfoWindow.prototype.getBorderColor=function(){return this.get("borderColor")},locuslabs.maps.InfoWindow.prototype.setBorderRadius=function(t){return this.set("borderRadius",t)},locuslabs.maps.InfoWindow.prototype.getBorderRadius=function(){return this.get("borderRadius")},locuslabs.maps.InfoWindow.prototype.setBorderWidth=function(t){this.set("borderWidth",t)},locuslabs.maps.InfoWindow.prototype.getBorderWidth=function(){return this.get("borderWidth")},locuslabs.maps.InfoWindow.prototype.setContent=function(t){return this.set("content",t)},locuslabs.maps.InfoWindow.prototype.getContent=function(){return this.get("content")},locuslabs.maps.InfoWindow.prototype.setMap=function(t){return this.set("map",t)},locuslabs.maps.InfoWindow.prototype.getMap=function(){return this.get("map")},locuslabs.maps.InfoWindow.prototype.setMaxWidth=function(t){return this.set("maxWidth",t)},locuslabs.maps.InfoWindow.prototype.getMaxWidth=function(){return this.get("maxWidth")},locuslabs.maps.InfoWindow.prototype.setMaxHeight=function(t){return this.set("maxHeight",t)},locuslabs.maps.InfoWindow.prototype.getMaxHeight=function(){return this.get("maxHeight")},locuslabs.maps.InfoWindow.prototype.setMinWidth=function(t){return this.set("minWidth",t)},locuslabs.maps.InfoWindow.prototype.getMinWidth=function(){return this.get("minWidth")},locuslabs.maps.InfoWindow.prototype.setMinHeight=function(t){return this.set("minHeight",t)},locuslabs.maps.InfoWindow.prototype.getMinHeight=function(){return this.get("minHeight")},locuslabs.maps.InfoWindow.prototype.setPadding=function(t){return this.set("padding",t)},locuslabs.maps.InfoWindow.prototype.getPadding=function(){return this.get("padding")},locuslabs.maps.InfoWindow.prototype.setPosition=function(t){return this.set("position",t)},locuslabs.maps.InfoWindow.prototype.getPosition=function(){return this.get("position")},locuslabs.maps.InfoWindow.prototype.setZIndex=function(t){return this.set("zIndex",t)},locuslabs.maps.InfoWindow.prototype.getZIndex=function(){return this.get("zIndex")},locuslabs.maps.InfoWindow.prototype.isOpen=function(){return this._manageView?this._view.isOpen():void 0},locuslabs.maps.InfoWindow.prototype.close=function(){this._manageView&&this._view.close()},locuslabs.maps.InfoWindow.prototype.open=function(t,e){this._manageView&&(t||e?this._view.open(t,e):this._view.open())},locuslabs.maps.InfoWindowView=function(t){this.set("uuid",t)},locuslabs.maps.InfoWindowView.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.InfoWindowView.prototype.setFloorView=function(t){return this.get("floorView")!=t?this.set("floorView",t):void 0},locuslabs.maps.InfoWindowView.prototype.getFloorView=function(){return this.get("floorView")},locuslabs.maps.InfoWindowView.prototype.getMapView=function(){return this.getFloorView().get("mapView")},locuslabs.maps.InfoWindowView.prototype.floorView_changed=function(){this._updateFloorView()},locuslabs.maps.InfoWindowView.prototype.setInfoWindow=function(t){return this.set("infoWindow",t)},locuslabs.maps.InfoWindowView.prototype.getInfoWindow=function(){return this.get("infoWindow")},locuslabs.maps.InfoWindowView.prototype.infoWindow_changed=function(){var t=this;this.getInfoWindow().addListener("anchorHeight_changed",function(){t._updateArrow()}),this.getInfoWindow().addListener("arrowPosition_changed",function(){t._updateArrow()}),this.getInfoWindow().addListener("arrowSize_changed",function(){t._updateArrow()}),this.getInfoWindow().addListener("backgroundColor_changed",function(){t._updateBox()}),this.getInfoWindow().addListener("borderColor_changed",function(){t._updateBox()}),this.getInfoWindow().addListener("borderRadius_changed",function(){t._updateBox()}),this.getInfoWindow().addListener("borderWidth_changed",function(){t._updateBox()}),this.getInfoWindow().addListener("content_changed",function(){t._updateContent()}),this.getInfoWindow().addListener("maxWidth_changed",function(){t._updateBox()}),this.getInfoWindow().addListener("maxHeight_changed",function(){t._updateBox()}),this.getInfoWindow().addListener("minWidth_changed",function(){t._updateBox()}),this.getInfoWindow().addListener("minHeight_changed",function(){t._updateBox()}),this.getInfoWindow().addListener("padding_changed",function(){t._updateBox()}),this.getInfoWindow().addListener("position_changed",function(){t._updatePosition()}),this.getInfoWindow().addListener("zIndex_changed",function(){t._updateZIndex()}),this._buildDom(),this.get("floorView")&&(this._infoWindow&&(d3.select(this._infoWindow).remove(),this._infoWindow=null),this._updateFloorView())},locuslabs.maps.InfoWindowView.prototype.isOpen=function(){return this._isOpen},locuslabs.maps.InfoWindowView.prototype.close=function(){this._infoWindow&&$(this._infoWindow).attr("visibility","hidden"),this._isOpen=!1},locuslabs.maps.InfoWindowView.prototype.open=function(t,e){t&&this.setFloorView(t),e&&(this.set("anchor",e),this.getInfoWindow().bindTo("position",e,"position")),$(this._infoWindow).attr("visibility","visible"),this._isOpen=!0,this._updateAll()},locuslabs.maps.InfoWindowView.prototype._buildDom=function(){this._box&&(d3.select(this._box).remove(),this._box=null);var t=this,e=this._box=document.createElement("div");e.style.position="absolute";var n=this._close=document.createElement("img");n.style.position="absolute",n.style.width="14px",n.style.height="14px",n.style.border=0,n.style.cursor="pointer",n.src="images/close.png",locuslabs.maps.event.addDomListener(n,"click",function(){t.close(),locuslabs.maps.event.trigger(t,"closeclick")});var i=this._contentContainer=document.createElement("div");i.style.overflowX="auto",i.style.overflowY="auto",i.style.cursor="default",i.style.clear="both",i.style.position="relative";var s=this._content=document.createElement("div");i.appendChild(s);var o=this._arrow=document.createElement("div");o.style.position="relative";var a=this._arrowOuter=document.createElement("div"),r=this._arrowInner=document.createElement("div");a.style.position=r.style.position="absolute",a.style.left=r.style.left="50%",a.style.height=r.style.height="0",a.style.width=r.style.width="0",a.style.marginLeft="0",a.style.borderWidth="0",a.style.borderBottomWidth=0,o.appendChild(a),o.appendChild(r),e.appendChild(i),e.appendChild(o),e.appendChild(n),locuslabs.maps.isWebkit&&(e.style.position="fixed"),this._infoWindow&&$(this._foreignObjectBody).append(e)},locuslabs.maps.InfoWindowView.prototype._makeInfoWindowObject=function(t){this._infoWindow=d3.select(t).append("svg:svg")[0][0],$(this._infoWindow).attr("id",this.getUUID()),$(this._infoWindow).attr("overflow","hidden"),$(this._infoWindow).attr("opacity",1),this._isOpen||$(this._infoWindow).attr("visibility","hidden"),this._isOpen=!1,this._foreignObject=d3.select(this._infoWindow).append("foreignObject")[0][0],this._foreignObjectBody=d3.select(this._foreignObject).append("xhtml:body")[0][0],$(this._foreignObjectBody).append(this._box),$(this._infoWindow).attr("x","1px"),$(this._infoWindow).attr("y","1px"),$(this._infoWindow).attr("width","1px"),$(this._infowindow).attr("height","1px"),$(this._foreignObject).attr("width","1px"),$(this._foreignObject).attr("height","1px")},locuslabs.maps.InfoWindowView.prototype._htmlToDocumentFragment=function(t){t=t.replace(/^\s*([\S\s]*)\b\s*$/,"$1");var e=document.createElement("div");if(e.innerHTML=t,1==e.childNodes.length)return e.removeChild(e.firstChild);for(var n=document.createDocumentFragment();e.firstChild;)n.appendChild(e.firstChild);return n},locuslabs.maps.InfoWindowView.prototype._removeChildren=function(t){if(t)for(var e;e=t.firstChild;)t.removeChild(e)},locuslabs.maps.InfoWindowView.prototype._imageLoaded=function(){this._updateContent()},locuslabs.maps.InfoWindowView.prototype._getElementSize=function(t,e,n){var i=document.createElement("div");i.style.display="inline",i.style.position="absolute",i.style.visibility="hidden","string"==typeof t?i.innerHTML=t:i.appendChild(t.cloneNode(!0)),document.body.appendChild(i);var s=new locuslabs.maps.Size(i.offsetWidth,i.offsetHeight);return e&&s.width>e&&(i.style.width=""+e+"px",s=new locuslabs.maps.Size(i.offsetWidth,i.offsetHeight)),n&&s.height>n&&(i.style.height=""+n+"px",s=new locuslabs.maps.Size(i.offsetWidth,i.offsetHeight)),document.body.removeChild(i),delete i,s},locuslabs.maps.InfoWindowView.prototype._figureOutSize=function(){var t=this.getInfoWindow(),e=(t.get("padding"),t.get("borderWidth"),t.get("borderRadius"),t.get("arrowSize")),n=2*e,i=window.innerWidth-n,s=window.innerHeight-n-t.get("anchorHeight"),o=t.get("minWidth")||0,a=t.get("minHeight")||0,r=t.get("maxWidth")||0,l=t.get("maxHeight")||0;r=Math.min(i,r),l=Math.min(s,l);var u=t.get("content");if("string"==typeof u&&(u=this._htmlToDocumentFragment(u)),u){var c=this._getElementSize(u,r,l);o=Math.max(o,c.width),a=Math.max(a,c.height)}r&&(o=Math.min(o,r)),l&&(a=Math.min(a,l)),o=Math.max(o,2*e),o=Math.min(o,i),a=Math.min(a,s),this._contentContainer.style.width=""+o+"px",this._contentContainer.style.height=""+a+"px"},locuslabs.maps.InfoWindowView.prototype._figureOutCloseButtonPosition=function(){var t=(this.getInfoWindow().get("borderRadius"),this.getInfoWindow().get("borderWidth")),e=2,n=2;n+=t,e+=t;var i=this._contentContainer;i&&i.clientHeight<i.scrollHeight&&(e+=15),this._close.style.right=""+e+"px",this._close.style.top=""+n+"px"},locuslabs.maps.InfoWindowView.prototype._updateArrow=function(){var t=this.getInfoWindow().get("arrowPosition"),e=this.getInfoWindow().get("borderWidth"),n=this.getInfoWindow().get("arrowSize"),i=""+n+"px",s=""+Math.max(0,n-e)+"px",o=this._arrowOuter,a=this._arrowInner;o.style.left=a.style.left=t+"%",this._arrow.style.marginTop=""+-e+"px",o.style.borderTopWidth=i,a.style.borderTopWidth=s,o.style.borderLeftWidth=i,a.style.borderLeftWidth=s,o.style.borderRightWidth=i,a.style.borderRightWidth=s,o.style.marginLeft=""+-n+"px",a.style.marginLeft=""+-(n-e)+"px",0==e?o.style.display="none":o.style.display="",this._updatingAll||this._updateBox()},locuslabs.maps.InfoWindowView.prototype._updateBox=function(){if(this._infoWindow){this._figureOutSize(),this._figureOutCloseButtonPosition();var t=this.getInfoWindow().get("backgroundColor"),e=this.getInfoWindow().get("borderColor"),n=this.getInfoWindow().get("borderRadius"),i=this.getInfoWindow().get("borderWidth"),s=this._contentContainer,o=this.getInfoWindow().get("padding"),a=this._arrowInner,r=this._arrowOuter;s.style.backgroundColor=t,s.style.borderColor=e,s.style.borderStyle=r.style.borderStyle=a.style.borderStyle="solid",s.style.borderRadius=s.style.MozBorderRadius=s.style.webkitBorderRadius=""+n+"px",s.style.borderWidth=""+i+"px",s.style.padding=""+o+"px",a.style.borderColor=t+" transparent transparent",r.style.borderColor=e+" transparent transparent",this._updatingAll||this._updatePosition()}},locuslabs.maps.InfoWindowView.prototype._updateContent=function(){if(this._infoWindow&&this._content){this._removeChildren(this._content);var t=this.getInfoWindow().get("content");if(t){"string"==typeof t&&(t=this._htmlToDocumentFragment(t)),this._content.appendChild(t);for(var e,n=this,i=this._content.getElementsByTagName("img"),s=0;e=i[s];s++)$(e).load(function(){n._imageLoaded()}).error(function(){n._imageLoaded()})}this._updatingAll||this._updateBox()}},locuslabs.maps.InfoWindowView.prototype._updateFloorView=function(){if(this.getFloorView()){this._infoWindow&&(d3.select(this._infoWindow).remove(),this._infoWindow=null);var t=this.getFloorView().getObjectGroup();this._makeInfoWindowObject(t),this._updateAll()}},locuslabs.maps.InfoWindowView.prototype._updatePosition=function(){if(this._infoWindow){var t=this.getMapView().fromLatLng(this.getInfoWindow().get("position")),e=this.getInfoWindow().get("anchorHeight"),n=this.getInfoWindow().get("arrowSize"),i=this.getInfoWindow().get("arrowPosition")/100,s=this._contentContainer.offsetWidth,o=this._box.offsetHeight+n,a=t[1]-(o+n+e),r=t[0]-s*i;$(this._infoWindow).attr("x",""+r+"px"),$(this._infoWindow).attr("y",""+a+"px"),$(this._infoWindow).attr("width",""+s+"px"),$(this._infowindow).attr("height",""+o+"px"),$(this._foreignObject).attr("width",""+s+"px"),$(this._foreignObject).attr("height",""+o+"px")}},locuslabs.maps.InfoWindowView.prototype._updateZIndex=function(){this._infoWindow&&($(this._infoWindow).attr("z-index",this.getInfoWindow().get("zIndex")),$(this._close).attr("z-index",this.getInfoWindow().get("zIndex")+1),this.getFloorView().sortObjects())},locuslabs.maps.InfoWindowView.prototype._updateAll=function(){this._updatingAll=!0,this._updateArrow(),this._updateContent(),this._updateBox(),this._updatePosition(),this._updateZIndex(),this._updatingAll=!1},locuslabs.maps.IOSScrollViewPanZoom=locuslabs.maps.MVCObject.subclass("IOSScrollViewPanZoom",{constructor:function(t){this.callParent(),this.setValues(t)},center_changed:function(){this.panZoomScrollView(!0)},radius_changed:function(){this.panZoomScrollView(!0)},mapView_changed:function(){this.unbindAll(),this.bindTo("center",this.getMapView(),"center"),this.bindTo("radius",this.getMapView(),"radius"),this.bindTo("scale",this.getMapView(),"scale"),this.bindTo("scrollViewSize",this.getMapView(),"scrollViewSize"),this.bindTo("scrollViewScale",this.getMapView(),"scrollViewScale"),this.bindTo("scrollViewOffset",this.getMapView(),"scrollViewOffset"),this.bindTo("svgScale",this.getMapView(),"svgScale"),this.bindTo("svgTranslate",this.getMapView(),"svgTranslate"),this.bindTo("scrollViewCallback",this.getMapView(),"scrollViewCallback"),this.panZoomScrollView(!1)},scrollViewSize_changed:function(t){var e=this.get("scrollViewSize");t&&t[0]==e[0]&&t[1]==e[1]||this.panZoomScrollView(!0)},scrollViewScale_changed:function(){var t=1;"undefined"!=typeof this.get("svgScale")&&(t*=this.get("svgScale")),"undefined"!=typeof this.get("scrollViewScale")&&(t*=this.get("scrollViewScale")),locuslabs.log.debug("MapView.updateScale - : svgScale : "+this.get("svgScale")+" : scrollViewScale : "+this.get("scrollViewScale")+" : scale : "+t),this.set("scale",t),this.updateCenterRadius()},scrollViewOffset_changed:function(){this.updateCenterRadius()},getCenter:function(){return this.get("center")},getMapView:function(){return this.get("mapView")},getRadius:function(){return this.get("radius")},getScrollViewSize:function(){return this.get("scrollViewSize")},getScrollViewScale:function(){return this.get("scrollViewScale")},getScrollViewOffset:function(){return this.get("scrollViewOffset")},getSvgScale:function(){return this.get("svgScale")},getSvgTranslate:function(){return this.get("svgTranslate")},setCenter:function(t){this.set("center",t)},setRadius:function(t){this.set("radius",t)},setUpdatingMapPosition:function(t){this._updatingMapPosition=t},isUpdatingMapPosition:function(){return this._updatingMapPosition},panZoomScrollView:function(t){if(!this.isUpdatingMapPosition()){var e=this.getCenter(),n=this.getRadius();if("undefined"!=typeof e&&"undefined"!=typeof n&&(locuslabs.log.info("iosScrollViewPanZoom.panZoomScrollView : center : [",e.toString(),"] : radius :",n,": animate :",t),"undefined"!=typeof this.get("scrollViewSize"))){var i=this.getMapView().fromLatLng(e),s=this.getSvgScale(),o=this.getSvgTranslate(),a=[i[0]*s+o[0],i[1]*s+o[1]],r=this.getMapView().calculateSvgTransform(e,n);locuslabs.log.debug("panZoomScrollView : transform : "+JSON.stringify(r));var l=r.scale/s;locuslabs.log.debug("panZoomScrollView : scale : "+l);var u=this.getScrollViewSize(),c=this.getMapView().getSvgViewBox(),h=u[0]/c.size.width,d=[(a[0]-c.origin.x)*h*l,(a[1]-c.origin.y)*h*l],p=[d[0]-u[0]/2,d[1]-u[1]/2],f=this.get("scrollViewTimer");f&&clearTimeout(f);var g=this;this.set("scrollViewTimer",setTimeout(function(){g.get("scrollViewCallback")&&g.get("scrollViewCallback")(l,p,t)},60))}}},transformScrollViewPoint:function(t){var e=this.getScrollViewScale(),n=this.getScrollViewOffset(),i=this.getScrollViewSize(),s=[t[0]+n[0],t[1]+n[1]],o=[i[0]*e,i[1]*e],a=[s[0]/o[0],s[1]/o[1]],r=i[1]/i[0],l=this.getMapView().getSvgViewBox(),u=l.size.height/l.size.width,c=[a[0],a[1]*r/u],h=[c[0]*l.size.width+l.origin.x,c[1]*l.size.height+l.origin.y],d=this.getSvgScale(),p=this.getSvgTranslate(),f=[(h[0]-p[0])/d,(h[1]-p[1])/d];return f},transformScrollViewPointToLatLng:function(t){var e=this.transformScrollViewPoint(t);return this.getMapView().toLatLng(e,!0)},transformScrollViewPointToUTM:function(t){var e=this.transformScrollViewPoint(t);return this.getMapView().toUTM(e)},utmDistance:function(t,e){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},updateCenterRadius:function(){var t=this.getScrollViewScale();if("undefined"!=typeof t){var e=this.getScrollViewOffset();if("undefined"!=typeof e){var n=this.getScrollViewSize();locuslabs.log.info("iosScrollViewPanZoom.iOSUpdateCenterRadius : scale :",t,": offset :",e,": size :",n);var i,s=[n[0]/2,n[1]/2];i=n[0]<n[1]?[0,s[1]]:[s[0],0];var o=this.transformScrollViewPointToLatLng(s),a=this.transformScrollViewPointToUTM(s),r=this.transformScrollViewPointToLatLng(i),l=this.transformScrollViewPointToUTM(i);locuslabs.log.debug("MapView.iOSUpdateCenterRadius : centerUTM : [",JSON.stringify(a),"] : edgeUTM : [",JSON.stringify(l),"]");var u=o.distance(r),c=this.utmDistance(a,l);locuslabs.log.debug("MapView.iOSUpdateCenterRadius : radius :",u,": radiusUTM :",c),this.setUpdatingMapPosition(!0),this.setCenter(o),this.setRadius(c),this.setUpdatingMapPosition(!1)}}},toString:function(){return"iosScrollViewPanZoom"}}),locuslabs.maps.JQueryPanZoomCss=locuslabs.maps.MVCObject.subclass("JQueryPanZoomCss",{constructor:function(t){this.callParent(),this.setValues(t)},center_changed:function(){this.panZoomSvg()},radius_changed:function(){this.panZoomSvg()},mapView_changed:function(){if(this.unbindAll(),this.getMapView()){this.bindTo("center",this.getMapView(),"center"),this.bindTo("radius",this.getMapView(),"radius"),this.bindTo("scale",this.getMapView(),"scale"),this.bindTo("svgScale",this.getMapView(),"svgScale"),this.bindTo("svgTranslate",this.getMapView(),"svgTranslate"),this.getMapView().set("mapScale",2);var t=this;this.getMapView().addListener("ready",function(){t.setup()})}},svgScale_changed:function(){var t=1;"undefined"!=typeof this.get("svgScale")&&(t*=this.get("svgScale")),this.set("scale",t)},getCenter:function(){return this.get("center")},getMapView:function(){return this.get("mapView")},getRadius:function(){return this.get("radius")},setUpdatingMapPosition:function(t){this._updatingMapPosition=t},isUpdatingMapPosition:function(){return this._updatingMapPosition},teardown:function(){this._panzoom.off(),$(this._zoomContainer).off(),$(this._zoomContainer).panzoom("destroy"),this._panzoom=null,this._zoomContainer=null},setup:function(){var t=this;this._zoomContainer=$('<div id="locuslabs-zoom-container"></div>'),this._zoomContainer.append($(this.getMapView().getMapDiv()).children().detach());var e=$('<div style="overflow:hidden;"></div>');e.append(this._zoomContainer),$(this.getMapView().getMapDiv()).append(e),this._panzoom=this._zoomContainer.panzoom({animate:!1,outIncrement:this.get("outIncrement"),inIncrement:this.get("inIncrement"),minScale:.1,maxScale:50}),t.updateZoomHeightWidth(),$(this.getMapView().getMapDiv()).resize(function(){this.updateZoomHeightWidth()}.bind(this)),this._panzoom.on("mousewheel.focal",function(e){e.preventDefault();var n=e.delta||e.originalEvent.wheelDelta,i=n?0>n:e.originalEvent.deltaY>0,s=$(t.getMapView().getSvg()).height()/t.getMapView().get("mapScale"),o=$(t.getMapView().getSvg()).width()/t.getMapView().get("mapScale"),a=$(t.getMapView().getMapDiv()).offset(),r=i?.7:1.3;matrix=[r,0,0,r,(o/2-e.clientX+a.left)*(r-1),(s/2-e.clientY+a.top)*(r-1)],t.moveTransformToSvg(matrix),t.updateMapPosition()}),$(this._zoomContainer).on("panzoomend",function(e,n,i,s){s&&(t.moveTransformToSvg(i),t.updateMapPosition())})},moveTransformToSvg:function(t){var e=this.getMapView().getSvgViewBox(),n=$(this.getMapView().getSvg()).height(),i=$(this.getMapView().getSvg()).width(),s=e.size.width/i,o=e.size.height/n,a=s>o?s:o,r=[i/2,n/2],l=[r[0]*s+e.origin.x,r[1]*o+e.origin.y],u=this.get("svgScale"),c=u*t[0],h=[(u-1)*l[0],(u-1)*l[1]],d=this.get("svgTranslate"),p=[d[0]+h[0],d[1]+h[1]],f=[t[4]*a,t[5]*a],g=[(c-1)*l[0],(c-1)*l[1]],m=[-g[0]+p[0]/u*c+f[0],-g[1]+p[1]/u*c+f[1]];this.getMapView().updateSvgTransform(m,c),$(this._zoomContainer).panzoom("reset",!1)},updateZoomHeightWidth:function(){var t=$(this.getMapView().getMapDiv()).width(),e=$(this.getMapView().getMapDiv()).height();locuslabs.log.debug("New size: "+e.toString()+"x"+t.toString()),this._zoomContainer.height(e),this._zoomContainer.width(t);var n=this.getMapView().get("mapScale"),i=50*-(n-1),s=50*-(n-1),o=100*n;$(this.getMapView().getSvg()).height(o.toString()+"%"),$(this.getMapView().getSvg()).width(o.toString()+"%"),$(this.getMapView().getSvg()).css("top",i+"%"),$(this.getMapView().getSvg()).css("left",s+"%"),$(this._zoomContainer).panzoom("reset",!1)},updateMapPosition:function(){this.setUpdatingMapPosition(!0);var t=this.getMapView().getSvgViewBox(),e=$(this.getMapView().getMapDiv()).height(),n=$(this.getMapView().getMapDiv()).width(),i=t.size.width/n,s=t.size.height/e,o=[n/2,e/2],a=[o[0]*i+t.origin.x,o[1]*s+t.origin.y],r=this.get("svgScale"),l=this.get("svgTranslate"),u=[(a[0]-l[0])/r,(a[1]-l[1])/r],c=this.getMapView().toLatLng(u);locuslabs.log.debug("updateMapPosition.center :",c),this.set("center",c);var h;h=e>n?[0,o[1]]:[o[0],0];var d=[h[0]*i+t.origin.x,h[1]*s+t.origin.y],p=[(d[0]-l[0])/r,(d[1]-l[1])/r],f=this.getMapView().toLatLng(p),g=c.distance(f);this.set("radius",g),this.setUpdatingMapPosition(!1)},panZoomSvg:function(){if(!this.isUpdatingMapPosition()){var t=this.getCenter(),e=this.getRadius();"undefined"!=typeof t&&"undefined"!=typeof e&&this.getMapView().panZoomSvg(t,e,!0)}}}),locuslabs.maps.LatLng=locuslabs.Base.subclass("LatLng",{constructor:function(t,e){this.callParent(),this._data={lat:t,lng:e},this.geohash=encodeGeoHash(this.lat(),this.lng())},toString:function(){return JSON.stringify(this)},lat:function(){return this._data.lat},lng:function(){return this._data.lng},getGeohash:function(){return this.geohash},bearing:function(t){var e=this.lat(),n=t.lat(),i=this.lng(),s=t.lng(),o=Math.sin(s-i)*Math.cos(n),a=Math.cos(e)*Math.sin(n)-Math.sin(e)*Math.cos(n)*Math.cos(s-i);return Math.atan2(o,a)},distance:function(t){var e=this.lat(),n=t.lat(),i=this.lng(),s=t.lng(),o=6371e3,a=locuslabs.maps.LatLng.toRadians(e),r=locuslabs.maps.LatLng.toRadians(n),l=locuslabs.maps.LatLng.toRadians(n-e),u=locuslabs.maps.LatLng.toRadians(s-i),c=Math.sin(l/2)*Math.sin(l/2)+Math.cos(a)*Math.cos(r)*Math.sin(u/2)*Math.sin(u/2),h=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c));return o*h},rotate:function(t){var e=Math.cos(t)*this.lat()-Math.sin(t)*this.lng(),n=Math.sin(t)*this.lat()+Math.cos(t)*this.lng();return new locuslabs.maps.LatLng(e,n)},getClassName:function(){return"locuslabs.maps.LatLng"},getUUID:function(){return this._data.uuid||(this._data.uuid=this.toString()),this._data.uuid},serialize:function(){return{__locuslabs_serialized_object__:!0,className:"locuslabs.maps.LatLng",data:{lat:this.lat(),lng:this.lng()}}},"static":{newInstance:function(t,e){var n=new locuslabs.maps.LatLng(e[0],e[1]);return n._data.uuid=t,n},toRadians:function(t){return t*Math.PI/180},deserialize:function(t){return new locuslabs.maps.LatLng(t.lat,t.lng)}}}),locuslabs.maps.LatLngBounds=locuslabs.Base.subclass("LatLngBounds",{constructor:function(t,e){this.callParent(),this._data={sw:t,ne:e};var n=(this.getSouthWest().lat()+this.getNorthEast().lat())/2,i=(this.getSouthWest().lng()+this.getNorthEast().lng())/2;this.cp=new locuslabs.maps.LatLng(n,i),this.radius=this.cp.distance(this.getSouthWest())},toString:function(){return JSON.stringify(this)},getNorthEast:function(){return this._data.ne},getSouthWest:function(){return this._data.sw},getCenterPoint:function(){return this.cp},getRadius:function(){return this.radius},getClassName:function(){return"locuslabs.maps.LatLngBounds"},getUUID:function(){return this._data.uuid||(this._data.uuid=this.toString()),this._data.uuid},serialize:function(){return{__locuslabs_serialized_object__:!0,className:"locuslabs.maps.LatLngBounds",data:{sw:this._data.sw.serialize(),ne:this._data.ne.serialize()}}},"static":{newInstance:function(t,e){var n=new locuslabs.maps.LatLngBounds(e[0],e[1]);return n._data.uuid=t,n},deserialize:function(t){var e=locuslabs.deserialize(t.sw),n=locuslabs.deserialize(t.ne);return new locuslabs.maps.LatLngBounds(e,n)}}}),locuslabs.maps.Location=locuslabs.maps.MVCObject.subclass("Location",{constructor:function(t){this.callParent(),this.setValues(t),t.bounds&&this.set("bounds",new locuslabs.maps.LatLngBounds(new locuslabs.maps.LatLng(t.bounds.sw.lat,t.bounds.sw.lng),new locuslabs.maps.LatLng(t.bounds.ne.lat,t.bounds.ne.lng)))},toString:function(){return JSON.stringify(this)},getId:function(){return this.get("id")},getName:function(){return this.get("name")},getDetails:function(){return this.get("details")},getAddress:function(){return this.get("address")},getWebsite:function(){return this.get("website")},getHours:function(){return this.get("hours")},getPhone:function(){return this.get("phone")},getCategory:function(){return this.get("category")},getBounds:function(){return this.get("bounds")},getBearing:function(){return this.get("bearing")},getKeywords:function(){return this.get("keywords")},getAccess:function(){return this.get("access")},getAttributes:function(){return this.get("attributes")},getClassName:function(){return"locuslabs.maps.Location"},getUUID:function(){return this.get("uuid")||this.set("uuid",locuslabs.uuid()),this.get("uuid")},"static":{newInstance:function(t,e){var n=new locuslabs.maps.Location(e[0]);return n.set("uuid",t),n}}}),locuslabs.maps.Logger=function(t,e){this._data={}},locuslabs.maps.Logger.newInstance=function(t,e){var n=new locuslabs.maps.Logger;return n._data.uuid=t,n},locuslabs.maps.Logger.prototype.getUUID=function(){return this._data.uuid||(this._data.uuid=this.toString()),this._data.uuid},locuslabs.maps.Logger.prototype.getClassName=function(){return"locuslabs.maps.Logger"},locuslabs.maps.Logger.prototype.equals=function(t){return!0},locuslabs.maps.Logger.prototype.toString=function(){return"(Logger)"},locuslabs.maps.Logger.prototype.setLogLevel=function(t){console.log("Setting the logging level : "+t),0==t?locuslabs.logAppender.setThreshold(log4javascript.Level.OFF):1==t?locuslabs.logAppender.setThreshold(log4javascript.Level.ERROR):2==t?locuslabs.logAppender.setThreshold(log4javascript.Level.WARN):3==t?locuslabs.logAppender.setThreshold(log4javascript.Level.INFO):4==t?locuslabs.logAppender.setThreshold(log4javascript.Level.DEBUG):5==t&&locuslabs.logAppender.setThreshold(log4javascript.Level.ALL)},locuslabs.maps.Logger.prototype.serialize=function(){return{__locuslabs_serialized_object__:!0,className:"locuslabs.maps.Logger",data:{}}},locuslabs.maps.Logger.deserialize=function(t){return new locuslabs.maps.Logger},locuslabs.maps.Map=function(t,e,n){var i={};e&&$.each(e,function(t,e){i[t]=e}),"mapId"in i||(i.mapId="ll-"+i.venueId),"navPathId"in i||(i.navPathId="nav"),n?i.uuid=n:i.uuid=locuslabs.uuid(),"manageView"in i||(i.manageView=!0),this._manageView=i.manageView,this.setOptions(i),this._manageView&&(this._view=new locuslabs.maps.MapView,this._view.setMapDiv(t),this._view.setMap(this))},locuslabs.maps.Map.newInstance=function(t,e){var n={};return $.each(e,function(t,e){n[t]=e}),n.airport&&$.each(locuslabs.maps.airports[n.airport],function(t,e){n[t]=e}),n.manageView=!1,new locuslabs.maps.Map($(e[0]).get(0),e[1],t)},locuslabs.maps.Map.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.Map.prototype.getCenter=function(){return this.get("center")},locuslabs.maps.Map.prototype.setCenter=function(t){this.set("center",t)},locuslabs.maps.Map.prototype.getRadius=function(){return this.get("radius")},locuslabs.maps.Map.prototype.setRadius=function(t){this.set("radius",t)},locuslabs.maps.Map.prototype.getFloorId=function(t){return this.get("floorId")},locuslabs.maps.Map.prototype.setFloorId=function(t){this.set("floorId",t)},locuslabs.maps.Map.prototype.getClassName=function(){return"locuslabs.maps.Map"},locuslabs.maps.Map.prototype.getDiv=function(){return this._data.mapDiv},locuslabs.maps.Map.prototype.getView=function(){return this._view},locuslabs.maps.Map.prototype.setOptions=function(t){this.setValues(t)},locuslabs.maps.Map.prototype.toString=function(){return"locuslabs.maps.Map"},locuslabs.maps.Map.prototype.teardown=function(){this._manageView&&(this._view.teardown(),this._view=null)},locuslabs.maps.MapView=function(t){this.set("mapScale",1),this.set("inIncrement",1),this.set("outIncrement",.3),this.set("uuid",t),this.set("floorViews",new Array),this.set("allFloorIds",new Array),this.set("panZoomMethod",locuslabs.config.panZoomMethod)},locuslabs.maps.MapView.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.MapView.prototype.getFloorView=function(t){var e=t;return 0!=t.indexOf("ll-")&&(e="ll-"+t),this.get("floorViews")[e]},locuslabs.maps.MapView.prototype.getFloorViews=function(){return this.get("floorViews")},locuslabs.maps.MapView.prototype.getOrdinalForFloorId=function(t){return this.getMap().get("allOrdinals")[t]},locuslabs.maps.MapView.newInstance=function(t){var e=new locuslabs.maps.MapView(t);return e.set("inIncrement",1),e.set("outIncrement",.3),e},locuslabs.maps.MapView.prototype.getCenter=function(){return this.get("center")},locuslabs.maps.MapView.prototype.getCenterPosition=function(){return this.get("centerPosition")},locuslabs.maps.MapView.prototype.mapChangedEvent=function(){try{if(!this.getCenter())return;if(!this.getRadius())return;locuslabs.session.event({type:"mapMoved",center:{lat:this.getCenter().lat(),lng:this.getCenter().lng(),venueId:this.getMap().get("venueId"),floorId:this.getMap().get("floorId")},radius:this.get("radius")})}catch(t){locuslabs.log.warn("locuslabs.maps.MapView.prototype.mapChangedEvent exception: "+t)}},locuslabs.maps.MapView.prototype.isPointInBounds=function(t,e){this.boundsPolygons||(this.boundsPolygons={});var n=$(e).attr("id");return this.boundsPolygons[n]||($(e).is("g")&&(e=$(e).find("path")[0]),this.boundsPolygons[n]=locuslabs.maps.Utilities.pathToPolygonPoints(e)),locuslabs.maps.Utilities.isPointInPolygon(t,this.boundsPolygons[n])},locuslabs.maps.MapView.prototype.updateCenterPosition=function(){try{if(!this.getSvg())return;var t,e,n,i=this.fromLatLng(this.get("center")),s=$(this.getSvg()).find(".ll_bounds"),o=this.getMap().get("venueId"),a=this.get("floorIds"),r=this;$.each(s,function(){var s=$(this).attr("id");if(s){if(s=s.substr(0,s.length-"-bounds".length),
s=s.substr(3),d3.select(this).classed("ll_building_bounds")){if(!r.isPointInBounds(i,this))return;t=s}if(d3.select(this).classed("ll_floor_bounds")){if(!a||-1==$.inArray(s,a))return;if(!r.isPointInBounds(i,this))return;e=s}if(d3.select(this).classed("ll_section_bounds")){var o=locuslabs.maps.Utilities.getFloorIdFromSectionId(s);if(!a||-1==$.inArray(o,a))return;if(!r.isPointInBounds(i,this))return;n=s}}}),this.set("centerPosition",{latLng:this.getCenter(),venueId:o,buildingId:t,floorId:e,sectionId:n,nearAirport:!0})}catch(l){locuslabs.log.warn("locuslabs.maps.MapView.prototype.updateCenter exception: "+l)}},locuslabs.maps.MapView.prototype.center_changed=function(){locuslabs.log.debug("MapView.center_changed to: "+this.getCenter()),this.mapChangedEvent(),this.updateCenterPosition()},locuslabs.maps.MapView.prototype.centerPosition_changed=function(){locuslabs.log.debug("MapView.centerPosition_changed to: "+JSON.stringify(this.getCenterPosition()))},locuslabs.maps.MapView.prototype.getRadius=function(){return this.get("radius")},locuslabs.maps.MapView.prototype.radius_changed=function(){locuslabs.log.debug("MapView.radius_changed to: "+this.getRadius()),this.mapChangedEvent()},locuslabs.maps.MapView.prototype.scale_changed=function(){this.pixelScale()<.7?this.showLabels():this.hideLabels()},locuslabs.maps.MapView.prototype.map_changed=function(){this._mapData={},this.bindTo("center",this.get("map"),"center"),this.bindTo("centerPosition",this.get("map"),"centerPosition"),this.bindTo("radius",this.get("map"),"radius"),this._setupMapDiv()},locuslabs.maps.MapView.prototype.mapDiv_changed=function(t){$(t).empty(),$(t).attr("locuslabs-ready"),this._setupMapDiv()},locuslabs.maps.MapView.prototype.getPanZoom=function(){return this.get("panZoom")},locuslabs.maps.MapView.prototype.setPanZoom=function(t){this.set("panZoom",t)},locuslabs.maps.MapView.panZoomMethods={iosScrollView:locuslabs.maps.IOSScrollViewPanZoom,jqueryPanZoomCss:locuslabs.maps.JQueryPanZoomCss},locuslabs.maps.MapView.prototype.getPanZoomMethod=function(){return this.get("panZoomMethod")},locuslabs.maps.MapView.prototype.panZoomMethod_changed=function(){this.getPanZoom()&&this.getPanZoom().set("mapView",null);var t=locuslabs.maps.MapView.panZoomMethods[this.getPanZoomMethod()];t&&this.setPanZoom(new t({mapView:this}))},locuslabs.maps.MapView.prototype.pixelScale=function(){var t=this.get("scale"),e=this.getSvgViewBox();if(e){var n=$(this.getSvg()).height(),i=$(this.getSvg()).width();if("iosScrollView"==this.get("panZoomMethod")){var s=this.get("scrollViewSize");i=s[0],n=s[1]}var o=e.size.width/i,a=e.size.height/n;return a>o?t/a:t/o}},locuslabs.maps.MapView.prototype.updateSvgTransform=function(t,e,n){if(n){var i=d3.select(this._getContainer()).transition();i.duration(1e3),i.attr("transform","translate("+t+")scale("+e+")")}else d3.select(this._getContainer()).attr("transform","translate("+t+")scale("+e+")");this.set("svgTranslate",t),this.set("svgScale",e)},locuslabs.maps.MapView.prototype.hideAllFloors=function(){$(this.getMapDiv()).find(".ll_floor").css("visibility","hidden")},locuslabs.maps.MapView.prototype.updateVisibleFloorIds=function(){try{var t=[];$(this.getMapDiv()).find(".ll_floor").each(function(){"visible"==$(this).css("visibility")&&t.push($(this).attr("id").substr(3))}),this.set("floorIds",t)}catch(e){locuslabs.log.error(e)}},locuslabs.maps.MapView.prototype.showFloor=function(t){try{var e=this.getMap().get("allOrdinals"),n=e[t],i=".ll_floor_"+n;$(this.getMapDiv()).find(i).css("visibility","visible")}catch(s){locuslabs.log.error(s)}},locuslabs.maps.MapView.prototype.showLabels=function(){try{if(!this.getMap())return;var t="#ll-"+this.getMap().get("venueId")+"-labels",e="#ll-"+this.getMap().get("venueId")+"-sections-label";$(this.getMapDiv()).find(t).find(e).fadeIn(500)}catch(n){locuslabs.log.error(n)}},locuslabs.maps.MapView.prototype.hideLabels=function(){try{if(!this.getMap())return;var t="#ll-"+this.getMap().get("venueId")+"-labels",e="#ll-"+this.getMap().get("venueId")+"-sections-label";$(this.getMapDiv()).find(t).find(e).fadeOut(500)}catch(n){locuslabs.log.error(n)}},locuslabs.maps.MapView.prototype.calculateSvgTransform=function(t,e){var n,i=this.fromMeters(e),s=2*i*this.get("mapScale"),o=this.getSvgViewBox(),a=$(this.getSvg()).height(),r=$(this.getSvg()).width(),l=o.size.width/s;locuslabs.log.debug("MapView.calculateSvgTransform : viewBox.size.width :",o.size.width,": coordDiameter :",s),n=l;var u=this.fromLatLng(t),c=o.size.width/r,h=o.size.height/a,d=[r/2*c+o.origin.x,a/2*h+o.origin.y],p=[d[0]-u[0]*n,d[1]-u[1]*n];return{scale:n,translate:p}},locuslabs.maps.MapView.prototype.panZoomSvg=function(t,e,n){var i=this.calculateSvgTransform(t,e);this.updateSvgTransform(i.translate,i.scale,n)},locuslabs.maps.MapView.prototype.fromLatLng=function(t){if(!t)return null;var e=this.getSvgViewBox(),n=this.getMap().get("utmData"),i=n.rect,s={x:t.lng(),y:t.lat()};proj4("+proj=longlat","+proj=utm +zone="+n.utmZone,s);var o=locuslabs.maps.Utilities.interpolatePointInRectangleToAnotherRectangle({r1:i,r2:e,invertYForR1:"utm",invertYForR2:"svg",p:s});return[o.x,o.y]},locuslabs.maps.MapView.prototype.fromMeters=function(t){if(!t)return null;if(!this._fromMetersRatio){var e=this.getMap().get("utmData"),n=e.rect,i=this.getSvgViewBox();locuslabs.log.debug("MapView.fromMeters : utmRect :",JSON.stringify(n),": viewBox :",i.size),this._fromMetersRatio=i.size.width/n.width}return t*this._fromMetersRatio},locuslabs.maps.MapView.prototype.isReady=function(){return $(this.getMapDiv()).attr("locuslabs-ready")?!0:!1},locuslabs.maps.MapView.prototype._getContainer=function(){return $(this.getSvg()).find("#container").get(0)},locuslabs.maps.MapView.prototype.findPOIId=function(t){for(var e=$(t);e.length;){var n=e.attr("id");if(n&&0==n.indexOf("ID"))return n.substring(2);e=e.parent()}},locuslabs.maps.MapView.prototype._loadMap=function(){if(this.getMap()&&this.getMapDiv())try{$(this.getMapDiv()).append(this.getMap().get("svg")),this.getMap().set("svg",""),this.setupMapInDiv();var t=this.getMap().get("venueOrientation");_.each(["html","body","svg","#map"],function(e){d3.select(e).classed(t,!0)})}catch(e){locuslabs.log.debug("Load Map: "+e)}},locuslabs.maps.MapView.prototype.setupMapInDiv=function(){try{var t=this,e=t.get("mapScale");d3.select(t.getSvg()).attr("preserveAspectRatio","xMidYMid meet"),1!=e&&($(t.getSvg()).css("position","absolute"),$(t.getSvg()).css("overflow","visible")),$(t.getSvg()).prepend('<style type="text/css">@font-face { font-family: OpenSans-Semibold; src: url(\''+locuslabs.config.fontsBase+"OpenSans-Semibold-webfont.woff'); } @font-face { font-family: OpenSans; src: url('"+locuslabs.config.fontsBase+"OpenSans-Regular-webfont.woff'); }</style>"),d3.select(t.getSvg()).append("svg:g").attr("id","container");var n=t.getMap().get("mapId");$(t.getSvg()).find("#"+n).detach().appendTo(t._getContainer());var i=t.getMap().get("venueId"),s=t.getMap().get("allStructures");s.push(i+"-content");var o=t.getMap().get("allFloors");$.each(o,function(e,n){t.get("allFloorIds").push(n)});for(var a=0;a<s.length;a++){var r=s[a],l=-1!=$.inArray(r,o),u=null;u=r==i+"-content"?"#ll-"+i+"-content":"#ll-"+r+"-content",l&&d3.select(t.getMapDiv()).select("#ll-"+r).each(function(){t.get("floorViews")[$(this).attr("id")]=new locuslabs.maps.FloorView({group:this,mapView:t,floorName:r})}),d3.select(t.getMapDiv()).select(u).on("click",function(){locuslabs.log.debug("Map Clicked : "+$(this).attr("id"));var e=d3.mouse(t._getContainer()),n=t.toLatLng(e,!0);locuslabs.log.debug("LatLng: "+n),locuslabs.log.debug("Coords: "+t.fromLatLng(n));var i=new locuslabs.maps.MouseEvent(n),s={type:"mapTapped",tapPosition:{lat:n.lat(),lng:n.lng(),venueId:t.getMap().get("venueId"),floorId:t.getMap().get("floorId")}},o=t.findPOIId(d3.event.target);if(o){s.tapPosition.poiId=o,locuslabs.log.debug("POI Clicked");var a={poiId:o};locuslabs.maps.event.trigger(t.getMap(),"poi_click",a),locuslabs.maps.event.trigger(t,"poi_click",a)}else locuslabs.log.debug("Non-POI Clicked"),locuslabs.maps.event.trigger(t.getMap(),"click",i),locuslabs.maps.event.trigger(t,"click",i);locuslabs.session.event(s)})}t.set("scale",1),t.set("translate",[0,0]),t.panZoomSvg(t.getMap().get("venueCenter"),t.getMap().get("venueRadius"),!1),t.getMap().set("center",t.getMap().get("venueCenter")),t.getMap().set("radius",t.getMap().get("venueRadius")),t.getMap().addListener("floorId_changed",function(){t.hideAllFloors(),t.showFloor(t.getMap().get("floorId")),t.mapChangedEvent(),t.updateVisibleFloorIds()}),t.updateVisibleFloorIds(),$(t.getMapDiv()).attr("locuslabs-ready",!0),locuslabs.maps.event.trigger(t,"ready")}catch(c){locuslabs.log.warn("MapView.setupMapInDiv : "+c)}},locuslabs.maps.MapView.prototype.getImageDiv=function(){return $(this.getMapDiv()).find("#__map_images").get(0)},locuslabs.maps.MapView.prototype.getMap=function(){return this.get("map")},locuslabs.maps.MapView.prototype.getMapDiv=function(){return this.get("mapDiv")},locuslabs.maps.MapView.prototype.getObjectGroup=function(){return $(this.getSvg()).find("#object").get(0)},locuslabs.maps.MapView.prototype.getSvg=function(){return $(this.getMapDiv()).find("svg").get(0)},locuslabs.maps.MapView.prototype.getSvgViewBox=function(){if(this._mapData){if(this._mapData.svgViewBox)return this._mapData.svgViewBox;var t=this.getSvg(),e=t.getAttribute("viewBox"),n=e.split(/ +/),i=new locuslabs.maps.Point(parseInt(n[0],10),parseInt(n[1],10)),s=new locuslabs.maps.Size(parseInt(n[2],10),parseInt(n[3],10));return this._mapData.svgViewBox=new locuslabs.maps.ViewBox(i,s),this._mapData.svgViewBox}},locuslabs.maps.MapView.prototype.hideNavPath=function(){$(this.getNavPath()).attr("visibility","hidden")},locuslabs.maps.MapView.prototype.setMap=function(t){this.set("map",t)},locuslabs.maps.MapView.prototype.setMapDiv=function(t){this.set("mapDiv",t)},locuslabs.maps.MapView.prototype.setMapDivFromId=function(t){this.setMapDiv(document.getElementById(t))},locuslabs.maps.MapView.prototype.getNavPath=function(){var t=this.getMap().get("navPathId"),e=$(this.getSvg()).find("#"+t).get(0);return e},locuslabs.maps.MapView.prototype._setupMapDiv=function(){$(this.getMapDiv()).empty(),$(this.getMapDiv()).append('<div id="__map_images" style="width: 0px; height: 0px; visibility: hidden;"></div>'),this._loadMap()},locuslabs.maps.MapView.prototype.showNavPath=function(){$(this.getNavPath()).attr("visibility","")},locuslabs.maps.MapView.prototype.toUTM=function(t){var e=this.getSvgViewBox(),n=this.getMap().get("utmData"),i=n.rect,s={x:t[0],y:t[1]};return s=locuslabs.maps.Utilities.interpolatePointInRectangleToAnotherRectangle({r1:e,r2:i,invertYForR1:"svg",invertYForR2:"utm",p:s})},locuslabs.maps.MapView.prototype.toLatLng=function(t,e){e=!0;var n,i=this.get("svgScale"),s=this.get("svgTranslate");n=e?t:[(t[0]-s[0])/i,(t[1]-s[1])/i];var o=this.toUTM(n),a=this.getMap().get("utmData");return proj4("+proj=utm +zone="+a.utmZone,"+proj=longlat",o),new locuslabs.maps.LatLng(o.y,o.x)},locuslabs.maps.MapView.prototype.poiLatLng=function(t){var e=document.getElementById("ID"+t);if(!e)return null;var n=e.getBBox(),i=[n.x+n.width/2,n.y+n.height/2];return this.toLatLng(i,!0)},locuslabs.maps.MapView.prototype.toString=function(){return"locuslabs.maps.MapView["+this.getUUID()+"]"},locuslabs.maps.MapView.prototype.teardown=function(){var t=this.getPanZoom();t&&(t.teardown&&t.teardown(),this.set("panZoom",null)),this.get("allFloorIds").forEach(function(t){var e=this.getFloorView(t);e&&e.teardown()}.bind(this)),console.log("MapView.teardown starting _objects"),window.locuslabs&&window.locuslabs.ios&&window.locuslabs.ios._objects&&(console.log("MapView.teardown nulling  window.locuslabs.ios._objects"),window.locuslabs.ios._objects=null)},locuslabs.maps.MapView.prototype.getClassName=function(){return"locuslabs.maps.MapView"},locuslabs.maps.MapView.prototype.runMemoryTests=function(t){console.log("MEMORY TESTS (mapView): FindUnexpectedGlobals"),(new locuslabs.FindUnexpectedGlobals).output(),console.log("MEMORY TESTS: MemoryFootprint: window"),(new locuslabs.MemoryFootprint).output(window),console.log("MEMORY TESTS: FindDetachedNodes"),(new locuslabs.FindDetachedNodes).output(window),console.log("MEMORY TESTS: CountDomElements"),(new locuslabs.CountDomElements).output(document),console.log("MEMORY TESTS (mapView) end")},locuslabs.maps.Marker=function(t){var e={};$.each(t,function(t,n){e[t]=n}),$.each(locuslabs.maps.Marker.defaults,function(t,n){t in e||(e[t]=n)}),this._manageView=e.manageView,this._manageView&&(this._view=new locuslabs.maps.MarkerView,this._view.setMarker(this)),e.uuid||(e.uuid=locuslabs.uuid()),this.setOptions(e)},locuslabs.maps.Marker.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.Marker.defaults={clickable:!0,crossOnDrag:!0,draggable:!1,raiseOnDrag:!0,visible:!0,opacity:1,manageView:!0,zIndex:0},locuslabs.maps.Marker.newInstance=function(t,e){var n={};e&&e.length&&(n=e[0]),n.manageView=!1;var i=new locuslabs.maps.Marker(n);return i.set("uuid",t),i},locuslabs.maps.Marker.prototype.getAnimation=function(){return this.get("animation")},locuslabs.maps.Marker.prototype.getClickable=function(){return this.get("clickable")},locuslabs.maps.Marker.prototype.getCursor=function(){return this.get("cursor")},locuslabs.maps.Marker.prototype.getDraggable=function(){return this.get("draggable")},locuslabs.maps.Marker.prototype.getIcon=function(){return this.get("icon")},locuslabs.maps.Marker.prototype.getMap=function(){return this.get("map")},locuslabs.maps.Marker.prototype.getOpacity=function(){return this.get("opacity")},locuslabs.maps.Marker.prototype.getPosition=function(){return this.get("position")},locuslabs.maps.Marker.prototype.getShadow=function(){return this.get("shadow")},locuslabs.maps.Marker.prototype.getShape=function(){return this.get("shape")},locuslabs.maps.Marker.prototype.getTitle=function(){return this.get("title")},locuslabs.maps.Marker.prototype.getVisible=function(){return this.get("visible")},locuslabs.maps.Marker.prototype.getZIndex=function(){return this.get("zIndex")},locuslabs.maps.Marker.prototype.setAnimation=function(t){return this.set("animation",t)},locuslabs.maps.Marker.prototype.setClickable=function(t){return this.set("clickable",t)},locuslabs.maps.Marker.prototype.setCursor=function(t){return this.set("cursor",t)},locuslabs.maps.Marker.prototype.setDraggable=function(t){return this.set("draggable",t)},locuslabs.maps.Marker.prototype.setFlat=function(t){return this.set("flat",t)},locuslabs.maps.Marker.prototype.setFloor=function(t){return this.set("floor",t)},locuslabs.maps.Marker.prototype.setOpacity=function(t){return this.set("opacity",opacity)},locuslabs.maps.Marker.prototype.setOptions=function(t){this.setValues(t)},locuslabs.maps.Marker.prototype.setPosition=function(t){return this.set("position",t)},locuslabs.maps.Marker.prototype.setShadow=function(t){return this.set("shadow",t)},locuslabs.maps.Marker.prototype.setShape=function(t){return this.set("shape",t)},locuslabs.maps.Marker.prototype.setTitle=function(t){return this.set("title",t)},locuslabs.maps.Marker.prototype.setVisible=function(t){return this.set("visible",t)},locuslabs.maps.Marker.prototype.setZIndex=function(t){return this.set("zIndex",t)},locuslabs.maps.Marker.prototype.getView=function(){return this._manageView?this._view:null},locuslabs.maps.Marker.prototype.floor_changed=function(){this._manageView&&this._view.setFloorView(this.get("floor"))},locuslabs.maps.MarkerView=function(t){this.set("uuid",t)},locuslabs.maps.MarkerView.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.MarkerView.newInstance=function(t){var e=new locuslabs.maps.MarkerView;return e.set("uuid",t),e},locuslabs.maps.MarkerView.prototype.marker_changed=function(){this._marker&&(d3.select(this._marker).remove(),this._marker=null);var t=this;this.getMarker().addListener("clickable_changed",function(){t._updateClickable()}),this.getMarker().addListener("draggable_changed",function(){t._updateDraggable()}),this.getMarker().addListener("icon_changed",function(){t._updateIcon()}),this.getMarker().addListener("opacity_changed",function(){t._updateOpacity()}),this.getMarker().addListener("position_changed",function(){t._updatePosition()}),this.getMarker().addListener("visible_changed",function(){t._updateVisible()}),this.getMarker().addListener("zIndex_changed",function(){t._updateZIndex()}),this._updateAll()},locuslabs.maps.MarkerView.prototype.floorView_changed=function(){locuslabs.log.debug("floorView_changed"),this._updateMapView()},locuslabs.maps.MarkerView.prototype._addMouseMovementEvents=function(){if(this._marker){var t=this,e=["mousedown","mousemove","mouseout","mouseover","mouseup"];$.each(e,function(e,n){d3.select(t._marker).on(n,function(){var e=d3.mouse(t.getFloorView().getMapView().getSvg()),i=t.getFloorView().getMapView().toLatLng(e);locuslabs.maps.event.trigger(t.getMarker(),n,new locuslabs.maps.MouseEvent(i)),locuslabs.maps.event.trigger(t,n,new locuslabs.maps.MouseEvent(i)),locuslabs.maps.event.trigger(t,n,new locuslabs.maps.MouseEvent(i))})})}},locuslabs.maps.MarkerView.prototype.getFloorView=function(){return this.get("floorView")},locuslabs.maps.MarkerView.prototype.setFloorView=function(t){this.set("floorView",t)},locuslabs.maps.MarkerView.prototype.getMarker=function(){return this.get("marker")},locuslabs.maps.MarkerView.prototype._icon=function(t){return"string"===jQuery.type(t)?{url:t}:$.isPlainObject(t)&&t.url?t:$.isPlainObject(t)&&t.path?t:null},locuslabs.maps.MarkerView.prototype._processIcon=function(t){var e=t.anchor,n=t.origin,i=t.scaledSize,s=t.size,o=t.url,a=$(this.getFloorView().getMapView().getImageDiv()).find('[src="'+o+'"]'),r=a[0].naturalWidth,l=a[0].naturalHeight;n||(n=new locuslabs.maps.Point(0,0)),s?(s.width>r-n.x&&(s.width=r-n.x),s.height>l-n.y&&(s.height=l-n.y)):s=new locuslabs.maps.Size(r-n.x,l-n.y),i||(i=s);var u=this.getFloorView().getMapView().pixelScale();i="images/pin-plane-takeoff.svg"==t.url?new locuslabs.maps.Size(.5*i.width/u,.5*i.height/u):new locuslabs.maps.Size(i.width/u,i.height/u),e=e?new locuslabs.maps.Point(e.x/u,e.y/u):new locuslabs.maps.Point(i.width/2,i.height),this._markerIcon||(this._markerIcon=d3.select(this._anchor).append("svg:image")[0][0]);var c={x:i.width/s.width,y:i.height/s.height};$(this._anchor).attr("overflow","visible").attr("x",-e.x).attr("y",-e.y).attr("width",i.width).attr("height",i.height),d3.select(this._markerIcon).attr("xlink:href",o),d3.select(this._markerIcon).attr("preserveAspectRatio","none"),$(this._markerIcon).attr("x","-"+n.x*c.x+"px").attr("y","-"+n.y*c.y+"px").attr("width",r*c.x+"px").attr("height",l*c.y+"px"),$(this._marker).attr("overflow","visible")},locuslabs.maps.MarkerView.prototype._processSymbol=function(t){var e=t.anchor,n=t.fillColor,i=t.fillOpacity,s=t.path,o=t.rotation,a=t.scale,r=t.strokeColor,l=t.strokeOpacity,u=t.strokeWeight;e||(e=new locuslabs.maps.Point(0,0)),n||(n="black"),i||(i=0),o||(o=0),a||(a=1),r||(r="black"),l||(l=1),u||(u=a),this._markerIcon||(this._markerIcon=d3.select(this._anchor).append("svg:svg")[0][0],this._markerPath=d3.select(this._markerIcon).append("svg:path")[0][0]),$(this._anchor).attr("overflow","visible").attr("x",e.x).attr("y",e.y),$(this._markerPath).attr("d",s);var c=[this._marker.getBoundingClientRect().width,this._marker.getBoundingClientRect().height],h="rotate("+o+" "+c[0]*a/2+" "+c[1]*a/2+") scale("+a+")";$(this._markerIcon).attr("fill",n).attr("fill-opacity",i).attr("overflow","visible").attr("transform",h).attr("stroke",r).attr("stroke-opacity",l).attr("stroke-width",u)},locuslabs.maps.MarkerView.prototype.setMarker=function(t){this.set("marker",t)},locuslabs.maps.MarkerView.prototype._updateClickable=function(){if(this._marker&&this.getMarker().get("clickable")){var t=this,e=["click","dblclick"];$.each(e,function(e,n){d3.select(t._marker).on(n,function(){if(!d3.event.defaultPrevented){var e=d3.mouse(t.getFloorView().getMapView().getSvg()),i=t.getFloorView().getMapView().toLatLng(e);locuslabs.maps.event.trigger(t.getMarker(),n,new locuslabs.maps.MouseEvent(i)),locuslabs.maps.event.trigger(t,n,new locuslabs.maps.MouseEvent(i))}})})}},locuslabs.maps.MarkerView.prototype._updateDraggable=function(){if(this._marker){if(!this.getMarker().get("draggable"))return void d3.behavior.drag().on("dragstart",null).on("drag",null).on("dragend",null);var t=this,e=function(e){d3.event.sourceEvent.stopPropagation();var n=d3.mouse(t.getFloorView().getMapView()._getContainer()),i=[Number($(t._marker).attr("x")),Number($(t._marker).attr("y"))];t.dragOffset=[n[0]-i[0],n[1]-i[1]];var s=t.getFloorView().getMapView().toLatLng(i,!0);locuslabs.maps.event.trigger(t.getMarker(),"dragstart",new locuslabs.maps.MouseEvent(s)),locuslabs.maps.event.trigger(t,"dragstart",new locuslabs.maps.MouseEvent(s))},n=function(e){d3.event.sourceEvent.stopPropagation();var n=[d3.event.x-t.dragOffset[0],d3.event.y-t.dragOffset[1]];t.getMarker().set("position",t.getFloorView().getMapView().toLatLng(n,!0));var i=t.getFloorView().getMapView().toLatLng(n,!0);locuslabs.maps.event.trigger(t.getMarker(),"drag",new locuslabs.maps.MouseEvent(i)),locuslabs.maps.event.trigger(t,"drag",new locuslabs.maps.MouseEvent(i))},i=function(e){d3.event.sourceEvent.stopPropagation();var n=[Number($(t._marker).attr("x")),Number($(t._marker).attr("y"))],i=t.getFloorView().getMapView().toLatLng(n);locuslabs.maps.event.trigger(t.getMarker(),"dragend",new locuslabs.maps.MouseEvent(i)),locuslabs.maps.event.trigger(t,"dragend",new locuslabs.maps.MouseEvent(i))},s=d3.behavior.drag().on("dragstart",e).on("drag",n).on("dragend",i);d3.select(this._marker).call(s)}},locuslabs.maps.MarkerView.prototype._updateIcon=function(){if(this._marker){var t=this.getMarker().get("icon");if(t){var e=this._icon(t);if(e){var n=this;if(e.url){var i=$(this.getFloorView().getMapView().getImageDiv()).find('[src="'+e.url+'"]'),s='<img src="'+e.url+'" />';0===i.length&&$(this.getFloorView().getMapView().getImageDiv()).append($(s)),$(s).load(function(){n._processIcon(e)}).error(function(){n._processIcon(e)})}else e.path?this._processSymbol(e):this._markerIcon&&d3.select(this.markerIcon).remove()}}}},locuslabs.maps.MarkerView.prototype._updateMapView=function(){locuslabs.log.debug("Marker_updateMapView");try{if(this._marker&&(d3.select(this._marker).remove(),this._marker=null),!this.getFloorView())return;var t=this;if(!this.getFloorView().getMapView().isReady())return void locuslabs.maps.event.addListenerOnce(this.getFloorView().getMapView(),"ready",function(){t._updateMapView()});var t=this;this.getFloorView().getMapView().addListener("scale_changed",function(){t._updateIcon()});var e=this.getFloorView().getObjectGroup();this._marker=d3.select(e).append("svg:svg").attr("id",this.getUUID())[0][0],this._anchor=d3.select(this._marker).append("svg:svg")[0][0],this._addMouseMovementEvents(),this._updateAll()}catch(n){locuslabs.log.error(n),n.stack&&locuslabs.log.error(n.stack)}},locuslabs.maps.MarkerView.prototype._updateOpacity=function(){this._marker&&$(this._marker).attr("opacity",this.getMarker().get("opacity"))},locuslabs.maps.MarkerView.prototype._updatePosition=function(){if(this._marker){var t=this.getMarker().get("position");if(t){var e=this.getFloorView().getMapView().fromLatLng(t);$(this._marker).attr("x",e[0]),$(this._marker).attr("y",e[1])}}},locuslabs.maps.MarkerView.prototype._updateZIndex=function(){this._marker&&($(this._marker).attr("z-index",this.getMarker().get("zIndex")),this.getFloorView().sortObjects())},locuslabs.maps.MarkerView.prototype._updateVisible=function(){this._marker&&(this.getMarker().get("visible")?$(this._marker).attr("visibility",""):$(this._marker).attr("visibility","hidden"))},locuslabs.maps.MarkerView.prototype._updateAll=function(){this._updateClickable(),this._updateDraggable(),this._updateIcon(),this._updateOpacity(),this._updatePosition(),this._updateZIndex(),this._updateVisible()},locuslabs.maps.MouseEvent=function(t){this.latLng=t},locuslabs.maps.MouseEvent.prototype.latLng=null,locuslabs.maps.MouseEvent.prototype.serialize=function(){return this.latLng.serialize()},locuslabs.maps.MVCArray=function(t){t||(t=[]),this.set("array",t)},locuslabs.maps.MVCArray.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.MVCArray.prototype.clear=function(){var t=this.getArray();t.splice(0,t.length)},locuslabs.maps.MVCArray.prototype.forEach=function(t){$.each(this.get("array"),function(e,n){t(n,e)})},locuslabs.maps.MVCArray.prototype.getArray=function(){return this.get("array")},locuslabs.maps.MVCArray.prototype.getAt=function(t){return this.getArray()[t]},locuslabs.maps.MVCArray.prototype.getLength=function(){return this.getArray().length},locuslabs.maps.MVCArray.prototype.insertAt=function(t,e){this.getArray().splice(t,0,e),locuslabs.maps.event.trigger("insert_at",t)},locuslabs.maps.MVCArray.prototype.pop=function(){return this.getArray().pop()},locuslabs.maps.MVCArray.prototype.push=function(t){return this.getArray().push(t),this.getArray().length},locuslabs.maps.MVCArray.prototype.removeAt=function(t){var e=this.getArray(),n=e[t];return e.splice(t,1),locuslabs.maps.event.trigger("remove_at",t,n),n},locuslabs.maps.MVCArray.prototype.setAt=function(t,e){var n=this.getArray(),i=n[t];n.splice(t,1,e),locuslabs.maps.event.trigger("set_at",t,i)},locuslabs.maps.MVCObjectRelay=function(t,e){var n=this;locuslabs.maps.event.addListener(t,"changed",function(e){if(!n._isSetting){var i=locuslabs.maps.MVCObjectRelay.serialize(t.get(e));n.getCallback()(e,i)}}),this.set("object",t),this.set("callback",e),this._isSetting=!1},locuslabs.maps.MVCObjectRelay.serialize=function(t){if(t.serialize)return t.serialize();if($.isPlainObject(t)){var e={};return $.each(t,function(t,n){e[t]=locuslabs.maps.MVCObjectRelay.serialize(n)}),e}return t},locuslabs.maps.MVCObjectRelay.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.MVCObjectRelay.newInstance=function(t,e){var n=new locuslabs.maps.MVCObjectRelay(e[0],e[1]);return n.set("uuid",t),n},locuslabs.maps.MVCObjectRelay.prototype.getCallback=function(){return this.get("callback")},locuslabs.maps.MVCObjectRelay.prototype.getObject=function(){return this.get("object")},locuslabs.maps.MVCObjectRelay.prototype.objectSet=function(t,e){this._isSetting=!0,this.getObject().set(t,e),this._isSetting=!1},locuslabs.maps.MVCObjectRelay.prototype.updateAll=function(){this.getObject().notifyAll()},locuslabs.maps.MVCObjectRelay.prototype.toString=function(){return"locuslabs.maps.MVCObjectRelay"},locuslabs.maps.MVCObjectShadow=function(t,e){locuslabs.maps.MVCObject.prototype.set.call(this,"uuid",t),locuslabs.maps.MVCObject.prototype.set.call(this,"callback",e)},locuslabs.maps.MVCObjectShadow.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.MVCObjectShadow.newInstance=function(t,e){var n=new locuslabs.maps.MVCObjectShadow(t,e[0]);return n},locuslabs.maps.MVCObjectShadow.prototype.set=function(t,e){e.serialize?this.get("callback")(t,e.serialize()):this.get("callback")(t,e),locuslabs.maps.MVCObject.prototype.set.call(this,t,e)},locuslabs.maps.MVCObjectShadow.prototype.relaySet=function(t,e){e=locuslabs.deserialize(e),locuslabs.maps.MVCObject.prototype.set.call(this,t,e)},locuslabs.maps.MVCObjectShadow.prototype.toString=function(){return"locuslabs.maps.MVCObjectShadow["+this.getUUID()+"]"},locuslabs.maps.NavigatorEngine=locuslabs.Base.subclass("NavigatorEngine",{constructor:function(t,e){this.callParent(),this.graph=locuslabs.maps.NavigationGraph.buildGraph(t,e)},getGraph:function(){return this.graph},findRoute:function(t,e){var n=t,i={waypoints:[],eta:0,distance:0},s=this;return $.each(e,function(t,e){var o=s.__findRoute(n,e);i.eta+=o.eta,i.distance+=o.distance,i.waypoints=i.waypoints.concat(o.waypoints),n=e}),i},calculateRoute:function(t,e){try{var n=this.graph.findClosestNode(t.getFloorId(),t.getLatLng()),i=this.graph.findClosestNode(e.getFloorId(),e.getLatLng());return this.graph.findShortestPath(n,i)}catch(s){return locuslabs.log.debug("calculateRoute: "+s),null}},__findRoute:function(t,e){var n=locuslabs.maps.Venue.getVenueById(this.getGraph().getVenueId()),i=(new Date).getTime();try{if(!t||!e)return;var s=new locuslabs.maps.Position({venueId:this.getGraph().getVenueId(),buildingId:locuslabs.maps.Utilities.getBuildingIdFromFloorId(t.floorId),floorId:t.floorId,lat:t.latLng.lat(),lng:t.latLng.lng()}),o=new locuslabs.maps.Position({venueId:this.getGraph().getVenueId(),buildingId:locuslabs.maps.Utilities.getBuildingIdFromFloorId(e.floorId),floorId:e.floorId,lat:e.latLng.lat(),lng:e.latLng.lng()});locuslabs.events.submit({type:"navigation",startPosition:{venueId:this.getGraph().getVenueId(),buildingId:locuslabs.maps.Utilities.getBuildingIdFromFloorId(t.floorId),floorId:t.floorId,lat:t.latLng.lat(),lng:t.latLng.lng()},endPosition:{venueId:this.getGraph().getVenueId(),buildingId:locuslabs.maps.Utilities.getBuildingIdFromFloorId(e.floorId),floorId:e.floorId,lat:e.latLng.lat(),lng:e.latLng.lng()}});var a={distance:0,eta:0,waypoints:[]},r=this.calculateRoute(s,o);if(null==r)return a;for(var l=null,u=0;u<r.length;u++){var c=0,h=0,d=null,p=null,f=!1;if(l){var g=l.getEdge(r[u].getId());null!=g&&(c=g.getDistance(),h=g.getTransitTime(),p=g.getPath(),f=g.isSecurityCheckpoint(),"Ground"!=g.getType()&&(d=g.getType()))}a.distance+=c,a.eta+=h;var m=0;if(l&&n)try{m=n.getLevelDifference(t.buildingId,r[u].getFloorId(),l.getFloorId())}catch(v){locuslabs.log.debug("EXCEPTION: "+v)}try{var b={venueId:this.graph.getVenueId(),buildingId:locuslabs.maps.Utilities.getBuildingIdFromFloorId(r[u].getFloorId()),floorId:r[u].getFloorId(),latLng:r[u].getLatLng(),distance:c,eta:h,nearAirport:!0,isPortal:null!=d,securityCheckpoint:f,portalType:null==d?"":d,levelDifference:m,isDestination:!1,curvePath:null==p?[]:p};a.waypoints.push(b)}catch(v){locuslabs.log.error("__findRoute exception: "+v)}l=r[u]}return a.waypoints[a.waypoints.length-1].isDestination=!0,locuslabs.log.debug("*** Time to Find a Route : "+((new Date).getTime()-i)+" ***"),a}catch(v){return locuslabs.log.error("__findRoute exception: "+v),null}},toString:function(){var t="";for(var e in this.graph.getAllNodes())t+=e+" ";return"Nodes: "+t}}),locuslabs.maps.NavPoint=function(t){t=t||{};var e={};$.each(t,function(t,n){e[t]=n}),$.each(locuslabs.maps.NavPoint.defaults,function(t,n){t in e||(e[t]=n)}),this._manageView=e.manageView,this._manageView&&(this._view=new locuslabs.maps.NavPointView,this._view.setNavPoint(this)),e.uuid||(e.uuid=locuslabs.uuid()),this.setOptions(e)},locuslabs.maps.NavPoint.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.NavPoint.defaults={maxRadius:20,minRadius:10,pulseDuration:1e3,pulseInterval:5e3,transitionTime:1400,manageView:!0,fillColor:"rgb(58,77,157)",maxFillOpacity:.35,minFillOpacity:0},locuslabs.maps.NavPoint.newInstance=function(t,e){var n={};e&&e.length&&(n=e[0]),n.manageView=!1;var i=new locuslabs.maps.NavPoint(n);return i.set("uuid",t),i},locuslabs.maps.NavPoint.prototype.getPosition=function(){return this.get("position")},locuslabs.maps.NavPoint.prototype.setFloor=function(t){this.set("floor",t)},locuslabs.maps.NavPoint.prototype.setOptions=function(t){this.setValues(t)},locuslabs.maps.NavPoint.prototype.setPosition=function(t){this.set("position",t)},locuslabs.maps.NavPoint.prototype.floor_changed=function(){this._manageView&&this._view.setFloorView(this.get("floor"))},locuslabs.maps.NavPointView=function(t){this.set("uuid",t)},locuslabs.maps.NavPointView.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.NavPointView.newInstance=function(t){var e=new locuslabs.maps.NavPointView;return e.set("uuid",t),e},locuslabs.maps.NavPointView.prototype.navPoint_changed=function(){var t=this;this.getNavPoint().addListener("position_changed",function(){t._updatePosition()}),this._updateAll()},locuslabs.maps.NavPointView.prototype.floorView_changed=function(){this._updateFloorView()},locuslabs.maps.NavPointView.prototype.getFloorView=function(){return this.get("floorView")},locuslabs.maps.NavPointView.prototype.setFloorView=function(t){return this.set("floorView",t)},locuslabs.maps.NavPointView.prototype.getNavPoint=function(){
return this.get("navPoint")},locuslabs.maps.NavPointView.prototype.setNavPoint=function(t){this.set("navPoint",t)},locuslabs.maps.NavPointView.prototype._updateBaseCircle=function(){if(!this._circle){var t=this.getNavPoint();t.get("maxRadius");this._circle=new locuslabs.maps.Circle({manageView:!1}),this._circle.bindTo("radius",this.getNavPoint(),"minRadius"),this._circle.bindTo("fillOpacity",this.getNavPoint(),"maxFillOpacity"),this._circle.bindTo("fillColor",this.getNavPoint(),"fillColor")}this._circleView||(this._circleView=new locuslabs.maps.CircleView,this._circleView.bindTo("floorView",this,"floorView"),this._circleView.setCircle(this._circle))},locuslabs.maps.NavPointView.prototype._updateFloorView=function(){return this.getFloorView()?(this._startPulsing(),void this._updateAll()):void this._stopPulsing()},locuslabs.maps.NavPointView.prototype._updatePosition=function(){if(this._circle)if(this._circle.getCenter()){if(this._transitionDiv)return;this._transitionDiv=$("<div></div>"),this._transitionDiv.css("opacity",0);var t=this._circle.getCenter(),e=this;this._transitionDiv.animate({opacity:1},{step:function(n,i){var s=e.getNavPoint().get("position"),o=t.lat()-s.lat(),a=t.lng()-s.lng(),r=o*n,l=a*n,u=t.lat()-r,c=t.lng()-l,h=new locuslabs.maps.LatLng(u,c);e._circle.setCenter(h)},duration:this.get("transitionTime"),complete:function(){e._transitionDiv=null}})}else this._circle.setCenter(this.getNavPoint().get("position"))},locuslabs.maps.NavPointView.prototype._emitPulse=function(){if(this._circle){var t=$("<div></div>"),e=new locuslabs.maps.Circle({manageView:!1});e.bindTo("fillColor",this.getNavPoint(),"fillColor"),e.bindTo("center",this._circle,"center"),e.set("radius",this.getNavPoint().get("minRadius")),e.set("fillOpacity",this.getNavPoint().get("maxFillOpacity"));var n=new locuslabs.maps.CircleView;n.set("floorView",this.get("floorView")),n.set("circle",e),t.css("opacity",0);var i=this;t.animate({opacity:1},{easing:"linear",step:function(t,n){var s=i.getNavPoint().get("minRadius")+(i.getNavPoint().get("maxRadius")-i.getNavPoint().get("minRadius"))*t,o=i.getNavPoint().get("maxFillOpacity")-(i.getNavPoint().get("maxFillOpacity")-i.getNavPoint().get("minFillOpacity"))*t;e.set("radius",s),e.set("fillOpacity",o)},duration:this.getNavPoint().get("pulseDuration"),complete:function(){n.setFloorView(null),t.remove()}})}},locuslabs.maps.NavPointView.prototype._startPulsing=function(){if(!this._pulseInterval){var t=this;this._pulseInterval=setInterval(function(){t._emitPulse()},this.getNavPoint().get("pulseInterval"))}},locuslabs.maps.NavPointView.prototype._stopPulsing=function(){this._pulseInterval&&(clearInterval(this._pulseInterval),this._pulseInterval=null)},locuslabs.maps.NavPointView.prototype._updatePulsing=function(){this._stopPulsing(),this._startPulsing()},locuslabs.maps.NavPointView.prototype._updateAll=function(){this._updateBaseCircle(),this._updatePosition(),this._updatePulsing()},locuslabs.maps.CurvedPath=locuslabs.maps.MVCObject.subclass("CurvedPath",{constructor:function(t){t||(t={}),t.uuid||(t.uuid=locuslabs.uuid()),this.setValues(t),this.set("array",new locuslabs.maps.MVCArray)},clear:function(){this.get("array").clear()},forEach:function(t){this.get("array").forEach(t)},push:function(t){this.get("array").push(t)},serialize:function(){var t=[];return this.get("array").forEach(function(e){var n={};n.start=e.start.serialize(),n.out=e.out.serialize(),n["in"]=e["in"].serialize(),n.end=e.end.serialize(),t.push(n)}),{__locuslabs_serialized_object__:!0,className:"locuslabs.maps.CurvedPath",data:t}},getClassName:function(){return"locuslabs.maps.CurvedPath"},"static":{deserialize:function(t){var e=new locuslabs.maps.CurvedPath;return $.each(t,function(t,n){var i={};i.start=locuslabs.deserialize(n.start),i.out=locuslabs.deserialize(n.out),i["in"]=locuslabs.deserialize(n["in"]),i.end=locuslabs.deserialize(n.end),e.push(i)}),e},newInstance:function(t){return new locuslabs.maps.CurvedPath({uuid:t})}}}),locuslabs.maps.Path=locuslabs.maps.CurvedPath.subclass("Path",{constructor:function(t){this.callParent(t)},push:function(t){this.get("array").push({start:t,out:t,"in":t,end:t})},serialize:function(){var t=[];return this.get("array").forEach(function(e){t.push(e.start.serialize())}),{__locuslabs_serialized_object__:!0,className:"locuslabs.maps.Path",data:t}},toString:function(){var t=[];return this.get("array").forEach(function(e){t.push(e.start.lat()+"|"+e.start.lng())}),"locuslabs.maps.Path: "+t.join(" ")},getClassName:function(){return"locuslabs.maps.Path"},"static":{deserialize:function(t){var e=new locuslabs.maps.Path;return $.each(t,function(t,n){e.push(locuslabs.deserialize(n))}),e},newInstance:function(t){return new locuslabs.maps.Path({uuid:t})}}}),locuslabs.maps.Polycurve=locuslabs.maps.MVCObject.subclass("Polycurve",{constructor:function(t){var e={};t&&$.each(t,function(t,n){e[t]=n}),$.each(locuslabs.maps.Polycurve.defaults,function(t,n){t in e||(e[t]=n)}),this._manageView=e.manageView,this.callParent(e),this._manageView&&(this.setView(new locuslabs.maps.PolycurveView),this.getView().setPolyline(this)),this.setOptions(e)},getClickable:function(){return this.get("clickable")},getDraggable:function(){return this.get("draggable")},getEditable:function(){return this.get("editable")},getCurvedPath:function(){return this.get("path")},getView:function(){return this._view},getVisible:function(){return this.get("visible")},getIcons:function(){return this.get("icons")},setDraggable:function(t){this.set("draggable",t)},setClickable:function(t){this.set("clickable",t)},setIcons:function(t){this.set("icons",t)},setEditable:function(t){this.set("editable",t)},setFloor:function(t){this.set("floor",t)},setOptions:function(t){this.setValues(t)},setCurvedPath:function(t){this.set("path",t)},setView:function(t){this._view=t},setVisible:function(t){this.set("visible",t)},floor_changed:function(){if(this._manageView){if(!this.get("floor"))return void this.getView().setFloorView(null);this.getView().setFloorView(this.get("floor"))}},"static":{defaults:{clickable:!0,draggable:!1,editable:!1,geodesic:!1,visible:!0,manageView:!0,zIndex:0},newInstance:function(t,e){var n={};e&&e.length&&(n=e[0]),n.manageView=!1;var i=new locuslabs.maps.Polycurve(n);return i.set("uuid",t),i}}}),locuslabs.maps.PolycurveView=locuslabs.maps.MVCObject.subclass("PolycurveView",{constructor:function(t){this.callParent(t)},polyline_changed:function(){this._polylineGroup&&this.remove();var t=this;this.getPolyline().addListener("clickable_changed",function(){t._updateClickable()}),this.getPolyline().addListener("icons_changed",function(){t._updateIcons()}),this.getPolyline().addListener("path_changed",function(){t._updatePath()}),this.getPolyline().addListener("strokeColor_changed",function(){t._updateStrokeColor()}),this.getPolyline().addListener("strokeWeight_changed",function(){t._updateStrokeWeight(),t._updateIcons()}),this.getPolyline().addListener("strokeOpacity_changed",function(){t._updateStrokeOpacity()}),this.getPolyline().addListener("zIndex_changed",function(){t._updateZIndex()}),this._updateAll()},floorView_changed:function(){this._updateFloor()},getFloorView:function(){return this.get("floorView")},getPolyline:function(){return this.get("polyline")},setFloorView:function(t){return this.set("floorView",t)},setPolyline:function(t){this.set("polyline",t)},_updateFloor:function(){try{if(!this.getFloorView())return void this.remove();this._polylineGroup&&this.remove();var t=this;if(!this.getFloorView().getMapView().isReady())return void locuslabs.maps.event.addListenerOnce(this.getFloorView().getMapView(),"ready",function(){t._updateFloor()});var e=this.getFloorView().getObjectGroup();this._polylineGroup=d3.select(e).append("svg:svg").attr("id",this.getUUID())[0][0],this._polyline=d3.select(this._polylineGroup).append("svg:path").attr("id",this.getUUID())[0][0],this._updateAll()}catch(n){locuslabs.log.error("PolycurveView._updateFloor : "+n)}},_updatePath:function(){if(this._polylineGroup){var t=this.getPolyline(),e=t.get("path"),n=locuslabs.maps.PolycurveView._toPathObject(e);if(n){var i="M",s=this,o=0;n.forEach(function(t){0==o&&(i+=s.getFloorView().getMapView().fromLatLng(t.start)+" "),i+="C",i+=s.getFloorView().getMapView().fromLatLng(t.out)+" ",i+=s.getFloorView().getMapView().fromLatLng(t["in"])+" ",i+=s.getFloorView().getMapView().fromLatLng(t.end)+" ",o++}),$(this._polyline).attr("d",i),$(this._polyline).attr("fill","none"),$(this._polyline).attr("stroke-linejoin","round"),this.getPolyline().get("icons")&&this._updateIcons()}}},_getLinePoints:function(){var t=this.getPolyline().get("path"),e=locuslabs.maps.PolycurveView._toPathObject(t);if(!e)return[];var n=[],i=this;return e.forEach(function(t){for(var e=locuslabs.maps.Utilities.getCurvePoints([i.getFloorView().getMapView().fromLatLng(t.start),i.getFloorView().getMapView().fromLatLng(t.out),i.getFloorView().getMapView().fromLatLng(t["in"]),i.getFloorView().getMapView().fromLatLng(t.end)]),s=0;s<e.length;s++){var o=e[s][0],a=e[s][1];n.push(new locuslabs.maps.Point(o,a))}}),n},_processIcon:function(t,e){var n=d3.select(t).append("svg:path").attr("id",locuslabs.uuid())[0][0];$(n).attr("d",e.path).attr("fill",e.fillColor).attr("fill-opacity",e.fillOpacity).attr("overflow","visible").attr("transform","scale("+e.scale+") rotate("+e.rotation+","+e.anchor.x/e.scale+","+e.anchor.y/e.scale+")").attr("stroke",e.strokeColor).attr("stroke-opacity",e.strokeOpacity).attr("stroke-width",e.strokeWeight)},_updateStrokeColor:function(){this._polyline&&$(this._polyline).attr("stroke",this.getPolyline().get("strokeColor"))},_updateStrokeOpacity:function(){this._polyline&&$(this._polyline).attr("stroke-opacity",this.getPolyline().get("strokeOpacity"))},_updateStrokeWeight:function(){this._polyline&&$(this._polyline).attr("stroke-width",this.getPolyline().get("strokeWeight"))},_updateZIndex:function(){this._polylineGroup&&($(this._polylineGroup).attr("z-index",this.getPolyline().get("zIndex")),this.getFloorView().sortObjects())},_updateClickable:function(){if(this._polyline&&this.getPolyline().get("clickable")){var t=this,e=["click","dblclick"];$.each(e,function(e,n){d3.select(t._polyline).on(n,function(){if(!d3.event.defaultPrevented){var e=d3.mouse(t.getFloorView().getMapView().getSvg()),i=t.getFloorView().getMapView().toLatLng(e);locuslabs.maps.event.trigger(t.getPolyline(),n,new locuslabs.maps.MouseEvent(i)),locuslabs.maps.event.trigger(t,n,new locuslabs.maps.MouseEvent(i))}})})}},_updateAll:function(){this._updateClickable(),this._updatePath(),this._updateStrokeColor(),this._updateStrokeOpacity(),this._updateStrokeWeight(),this._updateZIndex(),this._updateIcons()},remove:function(){d3.select(this._polylineGroup).remove(),this._polylineGroup=null,this._polyline=null},removeAllIcons:function(){this._polylineIcons&&($.each(this._polylineIcons,function(t,e){d3.select(e).remove()}),this._polylineIcons=null)},_updateIcons:function(){if(this._polyline&&this.getPolyline().get("icons")){this.removeAllIcons(),this._polylineIcons=[];var t=this,e=this.getPolyline().get("icons"),n=this._getLinePoints(),i=locuslabs.maps.Utilities.calculateLineDistance(n);$.each(e,function(e,s){var o=s.icon.scale?s.icon.scale:t.getPolyline().get("strokeWeight")?t.getPolyline().get("strokeWeight"):1;i*=o;var a=0;a=locuslabs.maps.Utilities.isAPercentage(s.offset)?locuslabs.maps.Utilities.getNumberValue(s.offset)/100*i:locuslabs.maps.Utilities.isInMeters(s.offset)?t.getFloorView().getMapView().fromMeters(locuslabs.maps.Utilities.getNumberValue(s.offset)):locuslabs.maps.Utilities.getNumberValue(s.offset);var r=0;r=locuslabs.maps.Utilities.isAPercentage(s.repeat)?locuslabs.maps.Utilities.getNumberValue(s.repeat)/100*i:locuslabs.maps.Utilities.isInMeters(s.repeat)?t.getFloorView().getMapView().fromMeters(locuslabs.maps.Utilities.getNumberValue(s.repeat)):locuslabs.maps.Utilities.getNumberValue(s.repeat),r<locuslabs.maps.PolycurveView.MIN_DIS_SYMBOLS&&(a=Math.round(locuslabs.maps.PolycurveView.MIN_DIS_SYMBOLS*(locuslabs.maps.Utilities.getNumberValue(s.offset)/locuslabs.maps.Utilities.getNumberValue(s.repeat))),r=locuslabs.maps.PolycurveView.MIN_DIS_SYMBOLS);var l=d3.select(t._polylineGroup).append("svg:svg").attr("id",locuslabs.uuid())[0][0];t._polylineIcons.push(l);var u=locuslabs.maps.Utilities.findPoints(n,a,r);$.each(u,function(e,n){var i=0;i=s.fixedRotation?s.icon.rotation:n.angle;var a={};a.anchor=s.icon.anchor?s.icon.anchor:n,a.fillColor=s.icon.fillColor?s.icon.fillColor:"black",a.fillOpacity=s.icon.fillOpacity?s.icon.fillOpacity:1,a.rotation=i,a.scale=o,a.strokeColor=s.icon.strokeColor?s.icon.strokeColor:"black",a.strokeOpacity=s.icon.strokeOpacity?s.icon.strokeOpacity:1,a.strokeWeight=s.icon.strokeWeight?s.icon.strokeWeight:1,a.path="M"+n.getX()/a.scale+" "+n.getY()/a.scale+" "+s.icon.path,t._processIcon(l,a)})})}},"static":{FORWARD_ARROW:"m-2,0 l-3,5 l10,-5 l-10,-5 l3,5z",BACKWARD_ARROW:"m2,0 l3,5 l-10,-5 l10,-5 l-3,5z",MIN_DIS_SYMBOLS:30,newInstance:function(t){return new locuslabs.maps.PolycurveView(t)},_toPathObject:function(t){if(!t)return null;if(t.clear)return t;if($.isArray(t)){var e=new locuslabs.maps.CurvedPath;return $.each(t,function(t,n){if(n.bearing)e.push({start:n,out:n,"in":n,end:n});else if(n.start)e.push(n);else if(n.lat){var i=new locuslabs.maps.LatLng(n.lat,n.lng);e.push({start:i,out:i,"in":i,end:i})}}),e}return null}}}),locuslabs.maps.Polyline=locuslabs.maps.Polycurve.subclass("Polyline",{constructor:function(t){var e={};t&&$.each(t,function(t,n){e[t]=n}),$.each(locuslabs.maps.Polycurve.defaults,function(t,n){t in e||(e[t]=n)}),this._manageView=e.manageView,this.callParent(e),this._manageView&&(this.setView(new locuslabs.maps.PolycurveView),this.getView().setPolyline(this)),this.setOptions(e)},getPath:function(){return this.get("path")},setPath:function(t){this.set("path",t)},"static":{newInstance:function(t,e){var n={};e&&e.length&&(n=e[0]),n.manageView=!1;var i=new locuslabs.maps.Polyline(n);return i.set("uuid",t),i}}}),locuslabs.maps.NavLine=locuslabs.maps.Polyline.subclass("NavLine",{constructor:function(t){var e={};t&&$.each(t,function(t,n){e[t]=n}),$.each(locuslabs.maps.NavLine.navline_defaults,function(t,n){t in e||(e[t]=n)}),this._manageView=e.manageView,this.callParent(e),this._manageView&&(this.setView(new locuslabs.maps.NavLineView),this.getView().setNavLine(this)),this.setOptions(e)},setNumberOfSymbols:function(t){this.set("symbolCount",t)},getNumberOfSymbols:function(){return this.get("symbolCount")},setIntervalTime:function(t){100>t?this.set("intervalTime",100):this.set("intervalTime",t)},getIntervalTime:function(){return this.get("intervalTime")},strokeColor_changed:function(){this.setIcons([{offset:"0%",repeat:"10%",icon:{fillColor:this.get("strokeColor"),strokeColor:this.get("strokeColor"),path:"m-1,1 l2,-1 l-2,-1 l0,2z"}}])},"static":{navline_defaults:{manageView:!0,strokeWeight:5,strokeColor:"#F00",icons:[{offset:"0%",repeat:"10%",icon:{fillColor:"blue",strokeColor:"blue",path:"m-1,1 l2,-1 l-2,-1 l0,2z"}}],zIndex:-10,intervalTime:250,symbolCount:10},newInstance:function(t,e){var n={};e&&e.length&&(n=e[0]),n.manageView=!1;var i=new locuslabs.maps.NavLine(n);return i.set("uuid",t),i}}}),locuslabs.maps.NavLineView=locuslabs.maps.PolycurveView.subclass("NavLineView",{constructor:function(t){this.callParent(t)},polyline_changed:function(){var t=this;this.getPolyline().addListener("intervalTime_changed",function(){t._startAnimation()}),this.callParent(),this._startAnimation()},getNavLine:function(){return this.getPolyline()},setNavLine:function(t){this.setPolyline(t)},floorView_changed:function(){this.getFloorView()||(clearInterval(this._animationInterval),this._animationInterval=null),this.callParent()},_startAnimation:function(){this._animationInterval&&clearInterval(this._animationInterval),this.offset=0;var t=this;this._animationInterval=setInterval(function(){try{var e=Math.floor(100/t.getNavLine().get("symbolCount")),n=t.getNavLine().get("icons");n[0].offset=t.offset+"%",n[0].repeat=e+"%",t._updateIcons(),t.offset+=1,t.offset>=e&&(t.offset=0)}catch(i){locuslabs.log.debug("NavLine.animation : "+i)}},this.getNavLine().get("intervalTime"))},"static":{newInstance:function(t){return new locuslabs.maps.NavLineView(t)}}}),locuslabs.maps.NavCurve=locuslabs.maps.Polycurve.subclass("NavCurve",{constructor:function(t){var e={};t&&$.each(t,function(t,n){e[t]=n}),$.each(locuslabs.maps.NavCurve.defaults,function(t,n){t in e||(e[t]=n)}),this._manageView=e.manageView,this.callParent(e),this._manageView&&(this.setView(new locuslabs.maps.NavCurveView),this.getView().setNavCurve(this)),this.setOptions(e)},setNumberOfSymbols:function(t){this.set("symbolCount",t)},getNumberOfSymbols:function(){return this.get("symbolCount")},setIntervalTime:function(t){100>t?this.set("intervalTime",100):this.set("intervalTime",t)},getIntervalTime:function(){return this.get("intervalTime")},"static":{defaults:{manageView:!0,strokeWeight:5,strokeColor:"green",icons:[{offset:"0%",repeat:"10%",icon:{fillColor:"green",strokeColor:"green",path:"m-1,1 l2,-1 l-2,-1 l0,2z"}}],zIndex:-10,intervalTime:250,symbolCount:10},newInstance:function(t,e){var n={};e&&e.length&&(n=e[0]),n.manageView=!1;var i=new locuslabs.maps.NavCurve(n);return i.set("uuid",t),i}}}),locuslabs.maps.NavCurveView=locuslabs.maps.PolycurveView.subclass("NavCurveView",{constructor:function(t){this.callParent(t)},polyline_changed:function(){var t=this;this.getPolyline().addListener("intervalTime_changed",function(){t._startAnimation()}),this.callParent(),this._startAnimation()},getNavCurve:function(){return this.getPolyline()},setNavCurve:function(t){this.setPolyline(t)},floorView_changed:function(){this.getFloorView()||(clearInterval(this._animationInterval),this._animationInterval=null),this.callParent()},_startAnimation:function(){this._animationInterval&&clearInterval(this._animationInterval),this.offset=0;var t=this;this._animationInterval=setInterval(function(){try{var e=Math.floor(100/t.getNavCurve().get("symbolCount")),n=t.getNavCurve().get("icons");n[0].offset=t.offset+"%",n[0].repeat=e+"%",t._updateIcons(),t.offset+=1,t.offset>=e&&(t.offset=0)}catch(i){locuslabs.log.debug("NavCurveView.animation : "+i)}},this.getNavCurve().get("intervalTime"))},"static":{newInstance:function(t){return new locuslabs.maps.NavCurveView(t)}}}),locuslabs.maps.Position=locuslabs.Base.subclass("Position",{constructor:function(t){this.callParent(),this.venueId=t.venueId,this.buildingId=t.buildingId,this.floorId=t.floorId,this.sectionId=t.sectionId,t.latLng?this.latLng=t.latLng:this.latLng=new locuslabs.maps.LatLng(t.lat,t.lng)},toString:function(){return JSON.stringify(this)},getVenueId:function(){return this.venueId},getBuildingId:function(){return this.buildingId},getFloorId:function(){return this.floorId},getSectionId:function(){return this.sectionId},getLatLng:function(){return this.latLng},getClassName:function(){return"locuslabs.maps.Position"},getUUID:function(){return this.uuid||(this.uuid=this.toString()),this.uuid},"static":{newInstance:function(t,e){var n=new locuslabs.maps.Position({venueId:e[0],buildingId:e[1],floorId:e[2],lat:e[3],lng:e[4]});return n.uuid=t,n}}}),locuslabs.maps.PositionManager=locuslabs.maps.MVCObject.subclass("PositionManager",{constructor:function(t){t=t||{};var e={};$.each(t,function(t,n){e[t]=n}),this.setValues(e),this.beaconStrengthGauges={},this.nearestBeaconStrengthGauge=null,this.positionSensorReadings={},this.BEACON_IS_OFF=locuslabs.maps.PositionManager.BEACON_IS_OFF;var n=this;this.positioningStateMachine=StateMachine.create({initial:"NoPositioning",events:[{name:"StartBeaconPositioning",from:"NoPositioning",to:"BeaconPositioning"},{name:"StopPositioning",from:"NoPositioning",to:"NoPositioning"},{name:"StopPositioning",from:"BeaconPositioning",to:"NoPositioning"},{name:"StopPositioning",from:"IAPositioning",to:"NoPositioning"},{name:"StopPositioning",from:"IAWarmingUp",to:"NoPositioning"},{name:"WarmUpIA",from:"BeaconPositioning",to:"IAWarmingUp"},{name:"MarkIAInaccurate",from:"IAPositioning",to:"IAWarmingUp"},{name:"MarkServiceInterrupted",from:"IAPositioning",to:"IAWarmingUp"},{name:"UseIA",from:"IAWarmingUp",to:"IAPositioning"},{name:"ChangeFloor",from:"BeaconPositioning",to:"BeaconPositioning"},{name:"ChangeFloor",from:"IAPositioning",to:"BeaconPositioning"},{name:"ChangeFloor",from:"IAWarmingUp",to:"BeaconPositioning"},{name:"CancelPositioningSensors",from:"NoPositioning",to:"NoPositioning"},{name:"CancelPositioningSensors",from:"BeaconPositioning",to:"BeaconPositioning"},{name:"CancelPositioningSensors",from:"IAWarmingUp",to:"BeaconPositioning"},{name:"CancelPositioningSensors",from:"IAPositioning",to:"BeaconPositioning"}],callbacks:{onchangestate:function(t,e,i){var s=t+": "+e+" => "+i;locuslabs.log.debug(s),n.set("positionState",s)}}})},getCurrentFloorId:function(){return this.get("currentFloorId")},setCurrentFloorId:function(t){return this.set("currentFloorId",t)},getBeacons:function(){return this.get("beacons")},getNavigator:function(){return this.get("navigator")},getPosition:function(){return this.get("position")},beacons_changed:function(){this._refreshAllSensorReadings()},beaconReadingLifespan_changed:function(){var t=this.get("beaconReadingLifespan");_.each(this.beaconStrengthGauges,function(e,n){e.setBeaconReadingLifespan(t)})},bonusForBeingNearest_changed:function(){var t=this.get("bonusForBeingNearest");_.each(this.beaconStrengthGauges,function(e,n){e.setBonusForBeingNearest(t)})},minimumReadingCount_changed:function(){var t=this.get("minimumReadingCount");_.each(this.beaconStrengthGauges,function(e,n){e.setMinimumReadingCount(t)})},navigator_changed:function(){this._refreshAllSensorReadings()},simulationMode_changed:function(){this._refreshAllSensorReadings()},shouldUsePositioningSensors_changed:function(){this.get("shouldUsePositioningSensors")||this.positioningStateMachine.CancelPositioningSensors()},position_changed:function(){var t=locuslabs._getInstallId();if(t){var e=this.getPosition();if(e){locuslabs.events.submit({type:"positionChanged",position:{lat:e.latLng.lat(),lng:e.latLng.lng(),venueId:e.venueId,floorId:e.floorId}});var n=JSON.stringify({installs:{position:{floor:e.venueId+":"+e.buildingId+":"+e.floorId,lat:e.latLng.lat(),lng:e.latLng.lng()}}});$.ajax({method:"put",url:locuslabs.config.apiBase+"/installs/"+t,data:n,contentType:"application/vnd.api+json"}).then(function(){})}}},_findStrongestBeaconStrengthGauge:function(t){var e=null,n=this.get("logger"),i=this.BEACON_IS_OFF;return _.each(this.beaconStrengthGauges,function(s,o){var a=s.effectiveStrength(t);a>i&&(i=a,e=s),n&&n.log(t,s.beaconInfo,a)}),n&&e&&n.logNearest(t,e.beaconInfo,i),e},processReadings:function(t){t=t||new Date;var e=this.nearestBeaconStrengthGauge,n=this._findStrongestBeaconStrengthGauge(t);switch(this.nearestBeaconStrengthGauge=n,e&&e.markNearest(!1),n&&n.markNearest(!0),this.set("closestBeacon",n?n.beaconInfo:null),this.set("currentFloorId",n?n.floorId:""),n?this.positioningStateMachine.is("NoPositioning")?this.positioningStateMachine.StartBeaconPositioning():e.floorId!=n.floorId&&this.positioningStateMachine.ChangeFloor():this.positioningStateMachine.StopPositioning(),this.positioningStateMachine.current){case"NoPositioning":this.setPositionIfChanged(null);break;case"BeaconPositioning":case"IAWarmingUp":var i=n.beaconInfo,s=this.getNavigator()?this.getNavigator().getGraph().interpolateClosestPoint(i.position):i.position;this.setPositionIfChanged({nearAirport:!0,venueId:i.venueId,buildingId:i.buildingId,floorId:i.floorId,latLng:s});break;case"IAPositioning":var o=this.getCurrentFloorId();this.setPositionIfChanged({nearAirport:!0,venueId:locuslabs.maps.Utilities.getVenueIdFromFloorId(o),buildingId:locuslabs.maps.Utilities.getBuildingIdFromFloorId(o),floorId:o,latLng:_.last(this.positionSensorReadings[o]).latLng})}},setPositionIfChanged:function(t){var e=this.get("position");if(e!=t)return locuslabs.maps.Utilities.isNullOrUndefined(e)!=locuslabs.maps.Utilities.isNullOrUndefined(t)?void this.set("position",t):e.latLng.distance(t.latLng)>.1?void this.set("position",t):void(_.isEqual(_.omit(e,"latLng"),_.omit(t,"latLng"))||this.set("position",t))},beaconReadings:function(t){t.forEach(function(t){var e=locuslabs.maps.PositionManager.idForBeaconInfo(t),n=this.beaconStrengthGauges[e];n&&n.addBeaconReading(t)},this)},recordPositionSensorServiceInterruption:function(t){this.positioningStateMachine.is("IAPositioning")&&this.positioningStateMachine.MarkServiceInterrupted(t)},recordPositionSensorReadings:function(t,e){_.each(t,function(t){this.recordPositionSensorReading(t.latLng,t.errorRadius,t.floorId,e)},this)},recordPositionSensorReading:function(t,e,n,i){i=i||new Date;var s=new PositionSensorReading(t,e,n,i);switch(this.positionSensorReadings[n]||(this.positionSensorReadings[n]=[]),this.positionSensorReadings[n].push(s),this.positioningStateMachine.current){case"BeaconPositioning":this.get("shouldUsePositioningSensors")&&this.positioningStateMachine.WarmUpIA();break;case"IAWarmingUp":s.errorRadius<=7&&this.positioningStateMachine.UseIA();break;case"IAPositioning":s.errorRadius>7&&this.positioningStateMachine.MarkIAInaccurate()}},_refreshAllSensorReadings:function(){this.positionSensorReadings={},clearInterval(this._updateTimer);var t=this.beaconStrengthGauges;this.beaconStrengthGauges={};var e=this.getBeacons()||[];e.forEach(function(e){var n=locuslabs.maps.PositionManager.idForBeaconInfo(e);this.beaconStrengthGauges[n]=t[n]?t[n]:new BeaconStrengthGauge(e,{beaconReadingLifespan:this.get("beaconReadingLifespan"),bonusForBeingNearest:this.get("bonusForBeingNearest"),minimumReadingCount:this.get("minimumReadingCount")})},this),this.get("simulationMode")||(this._updateTimer=setInterval(this.processReadings.bind(this),1e3))},"static":{BEACON_IS_OFF:-400,idForBeaconInfo:function(t){return(t.uuid+"|"+t.majorId+"|"+t.minorId).toUpperCase()}}}),locuslabs.maps.PositionManagerLogger=locuslabs.Base.subclass("PositionManagerLogger",{constructor:function(){this.array=new locuslabs.Array2D,this.array.set(0,0,"time"),this.array.set(0,"nearest","nearest"),this.array.set(0,"nearest strength","nearest strength"),this.previousTime=0,this.currentRow=0},log:function(t,e,n){var i=n!=locuslabs.maps.PositionManager.BEACON_IS_OFF;if(i){var s=e.majorId+"|"+e.minorId;this.previousTime!=t&&(this.previousTime=t,this.currentRow=this.array.addRow(),this.array.set(this.currentRow,0,this.timeAsString(t))),this.array.set(0,s,s),this.array.set(this.currentRow,s,n.toFixed(1))}},logNearest:function(t,e,n){var i=e.majorId+"|"+e.minorId;this.array.set(this.currentRow,"nearest",i),this.array.set(this.currentRow,"nearest strength",n.toFixed(1)),locuslabs.log.debug("beacon data\n"+this.output())},timeAsString:function(t){return this.pad(t.getHours(),2)+":"+this.pad(t.getMinutes(),2)+":"+this.pad(t.getSeconds(),2)+"."+this.pad(t.getMilliseconds(),3)},pad:function(t,e){var n=e,i="000";return e||(n=i.length),(i+t).slice(-n)},output:function(){return this.array.toString("\n","	")}}),locuslabs.maps.POIDatabase=locuslabs.maps.MVCObject.subclass("POIDatabase",{constructor:function(t){this.callParent(),this.set("uuid",locuslabs.uuid()),this.setValues(t)},getPoi:function(t){var e=locuslabs.maps.Venue.getVenueById(this.get("venueId")).getPOIData().pois[t];return e.position.latLng||(e.position.latLng=new locuslabs.maps.LatLng(e.position.latitude,e.position.longitude)),e.operatingHours=new locuslabs.maps.OperatingHours(e.rawHours||"").toStringPairs(),e},getClassName:function(){return"locuslabs.maps.POIDatabase"},loadPOI:function(t,e){var n=this.getPoi(t);e(n)},getAllPoiKeys:function(){var t=[];for(var e in locuslabs.maps.Venue.getVenueById(this.get("venueId")).getPOIData().pois)t.push(e);return t}}),locuslabs.maps.PoiDatabaseBuilder=locuslabs.Base.subclass("PoiDatabaseBuilder",{constructor:function(t){this.callParent(),this.mapView=t},buildDatabase:function(t,e){var n=this.extendData(t);return this.extendedSearchData(n),this.addPortals(n,e),n},extendData:function(t){try{for(var e in t.pois)try{if(!t.pois[e].position.latLng){var n=this.mapView.poiLatLng(e);if(null!=n){t.pois[e].position.latitude=parseFloat(n.lat().toFixed(6)),t.pois[e].position.longitude=parseFloat(n.lng().toFixed(6)),t.pois[e].position.geohash=encodeGeoHash(n.lat(),n.lng()),t.pois[e].position.floorId=this.extractFloorId(e),t.pois[e].position.buildingId=this.extractBuildingId(t.pois[e].position.floorId);var i=t.pois[e].position.floorId;t.pois[e].position.sectionId=this.findSectionId(i,n)}else locuslabs.log.warn("No Lat/Lng for : "+e)}}catch(s){locuslabs.log.error("extendData error for : "+e+" : "+s)}}catch(s){locuslabs.log.error("extendData: "+s)}return t},findSectionId:function(t,e){try{var n,i=$(this.mapView.getMapDiv()).find("#ll-"+t).find(".ll_section_bounds"),s=this,o=this.mapView.fromLatLng(e);return $.each(i,function(){s.mapView.isPointInBounds(o,this)&&(n=$(this).attr("id").substr(3),n=n.substr(0,n.length-"-bounds".length))}),n}catch(a){locuslabs.log.error("findSectionId: "+a)}},extractFloorId:function(t){try{for(var e=this.mapView.get("allFloorIds"),n=$(this.mapView.getMapDiv()).find("#ID"+t).parents(),i=0;i<n.length;i++){var s=n[i].id.substring(3);if(-1!=e.indexOf(s))return s}return null}catch(o){locuslabs.log.error("extractFloorId: "+o)}},extractBuildingId:function(t){try{var e=t.indexOf("-");if(-1==e)return"";var n=t.indexOf("-",e+1);return-1==n?"":t.substring(0,n)}catch(i){return locuslabs.log.error("extractBuildingId: "+i),""}},extendedSearchData:function(t){locuslabs.log.debug("extendSearchData");try{var e={};for(var n in t.pois)try{var i=t.pois[n].position.geohash;if(i){var s=t.pois[n].position.floorId+":"+i.substr(0,7),o=t.pois[n].position.floorId+":"+i.substr(0,8);e[s]||(e[s]=[]),e[s].push(n),e[o]||(e[o]=[]),e[o].push(n)}}catch(a){locuslabs.log.error("extendSearchData error for : "+n+" : "+a)}t.geoDb=e}catch(a){locuslabs.log.error("extendSearchData: "+a)}},addPortals:function(t,e){for(var n=0;n<e.portals.length;n++)try{if(e.portals[n].srcPoId.length>2||e.portals[n].dstPoId>2){var i="bi"==e.portals[n].direction,s=e.portals[n].srcPoId.substring(2),o=e.portals[n].dstPoId.substring(2),a=t.pois[s],r=a.connectsTo;if(r||(a.connectsTo=[]),a.connectsTo.push(o),i){var l=t.pois[o],r=l.connectsTo;r||(l.connectsTo=[]),l.connectsTo.push(s)}}}catch(u){locuslabs.log.warn("addPortals: "+u+" Src Portal: "+e.portals[n].srcPoId+" Dst Portal: "+e.portals[n].dstPoId)}}}),locuslabs.maps.BeaconDatabaseBuilder=locuslabs.Base.subclass("BeaconDatabaseBuilder",{constructor:function(t,e){this.callParent(),this.mapView=e,this.venueId=t,this.venue=locuslabs.maps.Venue.getVenueById(t)},buildDatabase:function(t){locuslabs.log.debug("Building Beacon Database");for(var e=this.venue.getStructures(),n=[],i=0;i<e.length;i++){var s=this.getPolygonForBuilding(e[i]+"-bounds");s&&(n[e[i]]=s)}for(var o=[],a=[],i=0;i<t.length;i++){var r=!1,l=!1,u=t[i];if(u.latitude&&u.longitude)for(var c in n){var h=this.mapView.fromLatLng(new locuslabs.maps.LatLng(u.latitude,u.longitude));if(locuslabs.maps.Utilities.isPointInPolygon(h,n[c])){u.buildingId=c,r=!0;var d=u.floorId;if(!isNaN(d))for(var p=this.venue.getStructure(c),f=p.getLevels(),g=0;g<f.length;g++){var m=p.loadFloor(f[g]);m.getOrdinal()==d&&(u.floorId=m.getFloorId(),l=!0)}}}r&&l?o.push(u):a.push(u)}return{good:o,bad:a}},getPolygonForBuilding:function(t){locuslabs.log.debug("getPolygonForBuilding: "+t);var e=document.getElementById("ll-"+t);return e?($(e).is("g")&&(e=$(e).find("path")[0]),locuslabs.maps.Utilities.pathToPolygonPoints(e)):(locuslabs.log.debug("No element found for: ["+t+"]"),null)}}),locuslabs.maps.Point=function(t,e){this.x=t,this.y=e,this._data={}},locuslabs.maps.Point.newInstance=function(t,e){var n=new locuslabs.maps.Point(e[0],e[1]);return n._data.uuid=t,n},locuslabs.maps.Point.prototype.getUUID=function(){return this._data.uuid||(this._data.uuid=this.toString()),this._data.uuid},locuslabs.maps.Point.prototype.getClassName=function(){return"locuslabs.maps.Point"},locuslabs.maps.Point.prototype.equals=function(t){
return t.x==this.x&&t.y==this.y},locuslabs.maps.Point.prototype.toString=function(){return"("+this.x+","+this.y+")"},locuslabs.maps.Point.prototype.getX=function(){return this.x},locuslabs.maps.Point.prototype.getY=function(){return this.y},locuslabs.maps.Point.prototype.setX=function(t){this.x=t},locuslabs.maps.Point.prototype.setY=function(t){this.y=t},locuslabs.maps.Point.prototype.serialize=function(){return{__locuslabs_serialized_object__:!0,className:"locuslabs.maps.Point",data:{x:this.x,y:this.y}}},locuslabs.maps.Point.deserialize=function(t){return new locuslabs.maps.Point(t.x,t.y)},locuslabs.maps.Search=locuslabs.maps.MVCObject.subclass("Search",{constructor:function(t){this.callParent(),this.set("uuid",locuslabs.uuid()),this.setValues(t)},getClassName:function(){return"locuslabs.maps.Search"},autocomplete:function(t,e){t&&locuslabs.events.submit({type:"autocomplete",venueId:this.get("venueId"),query:t}),t=t.toLowerCase();var n=locuslabs.maps.Venue.getVenueById(this.get("venueId")).getPOIData().autocomplete[t];return n||(n=[]),e&&e(t,n),n},search:function(t,e){t&&locuslabs.events.submit({type:"search",venueId:this.get("venueId"),query:t});var n=new locuslabs.maps.SearchResults;n.setQuery(t),n.setSearch(this),t=t.toLowerCase();var i=[],s=locuslabs.maps.Venue.getVenueById(this.get("venueId")).getPOIData().search[t];if(!s)return e&&e(n),n;var o=this;return $.each(s,function(t,e){var n=locuslabs.maps.Venue.getVenueById(o.get("venueId")).getPOIData().pois[e];n.position.latLng||(n.position.latLng=new locuslabs.maps.LatLng(n.position.latitude,n.position.longitude));var s=n.position.latLng;if(s){var a={poiId:e,name:n.name,position:n.position,gate:n.gate,terminal:n.terminal};i.push(a)}}),n.setMore(!1),n.setResults(i),e&&e(n),n},multiTermSearch:function(t,e){locuslabs.log.debug("multiTermSearch: "+t);try{t&&locuslabs.events.submit({type:"multiTermSearch",venueId:this.get("venueId"),queryTerms:t});var n=new locuslabs.maps.MultiTermSearchResults;n.setQueryTerms(t),n.setSearch(this);for(var i=[],s=0;s<t.length;s++){var o=t[s].toLowerCase(),a=[],r=locuslabs.maps.Venue.getVenueById(this.get("venueId")).getPOIData().search[o];r&&i.push(r)}for(var l=i[0],s=1;s<i.length;s++){var u=this.findIntersectionAndRemainder(l,i[s]);l=u[0]}var c=this;return $.each(l,function(t,e){var n=locuslabs.maps.Venue.getVenueById(c.get("venueId")).getPOIData().pois[e];n.position.latLng||(n.position.latLng=new locuslabs.maps.LatLng(n.position.latitude,n.position.longitude));var i=n.position.latLng;if(i){var s={poiId:e,name:n.name,position:n.position,gate:n.gate,terminal:n.terminal};a.push(s)}}),n.setMore(!1),n.setResults(a),e&&e(n),n}catch(h){locuslabs.log.debug("multiTermSearch Exception: "+h)}},proximitySearch:function(t,e,n,i){locuslabs.log.debug("_proximitySearch: "+t+": ("+e+","+n+")");try{var s=new locuslabs.maps.LatLng(e,n),o=encodeGeoHash(e,n),a=o.substr(0,8),r=[];r.push(t+":"+calculateAdjacent(calculateAdjacent(a,"top"),"left")),r.push(t+":"+calculateAdjacent(a,"top")),r.push(t+":"+calculateAdjacent(calculateAdjacent(a,"top"),"right")),r.push(t+":"+calculateAdjacent(a,"left")),r.push(t+":"+a),r.push(t+":"+calculateAdjacent(a,"right")),r.push(t+":"+calculateAdjacent(calculateAdjacent(a,"bottom"),"left")),r.push(t+":"+calculateAdjacent(a,"bottom")),r.push(t+":"+calculateAdjacent(calculateAdjacent(a,"bottom"),"right"));for(var l=[],u=0;u<r.length;u++){var c=locuslabs.maps.Venue.getVenueById(this.get("venueId")).getPOIData().geoDb[r[u]];if(c)for(var h=0;h<c.length;h++){var d=locuslabs.maps.Venue.getVenueById(this.get("venueId")).getPOIData().pois[c[h]];d.position.latitude&&d.position.longitude&&(d.position.latLng||(d.position.latLng=new locuslabs.maps.LatLng(d.position.latitude,d.position.longitude)),l.push([c[h],s.distance(d.position.latLng)]))}}l.sort(function(t,e){return t[1]-e[1]});for(var p=[],u=0;u<l.length;u++)p.push(l[u][0]);var f=new locuslabs.maps.SearchResults;f.setSearch(this);var g=this,m=[];return $.each(p,function(t,e){var n=locuslabs.maps.Venue.getVenueById(g.get("venueId")).getPOIData().pois[e];n.position.latLng||(n.position.latLng=new locuslabs.maps.LatLng(n.position.latitude,n.position.longitude));var i={poiId:e,name:n.name,position:n.position,gate:n.gate,terminal:n.terminal};m.push(i)}),f.setMore(!1),f.setResults(m),i&&i(f),f}catch(v){return locuslabs.log.error("_proximitySearch: "+v),null}},proximitySearchWithTerms:function(t,e,n,i,s){locuslabs.log.debug("_proximitySearchWithTerms: "+t+"->"+e+": ("+n+","+i+")");try{var o=new locuslabs.maps.LatLng(n,i),a=this.rawSearchForTerms(t,o),r=this.rawProximitySearch(e,n,i),l=this.findIntersectionAndRemainder(a,r),u=new locuslabs.maps.SearchResults;u.setSearch(this),u.setMore(!1);var c=this,h=[];$.each(l[0],function(t,n){var i=locuslabs.maps.Venue.getVenueById(c.get("venueId")).getPOIData().pois[n];if(i.position.floorId==e){var s={poiId:n,name:i.name,position:i.position,gate:i.gate,terminal:i.terminal};h.push(s)}}),u.setResults(h);var d=[];return $.each(l[1],function(t,e){var n=locuslabs.maps.Venue.getVenueById(c.get("venueId")).getPOIData().pois[e],i={poiId:e,name:n.name,position:n.position,gate:n.gate,terminal:n.terminal};d.push(i)}),u.setOtherResults(d),s&&s(u),u}catch(p){locuslabs.log.error("_proximitySearchWithTerms: "+p)}},searchWithTerms:function(t,e){locuslabs.log.debug("_searchWithTerms: "+t);try{var n=this.rawSearchForTerms(t,null),i=new locuslabs.maps.SearchResults;i.setSearch(this),i.setMore(!1);var s=this,o=[];$.each(n,function(t,e){var n=locuslabs.maps.Venue.getVenueById(s.get("venueId")).getPOIData().pois[e];n.position.latLng||(n.position.latLng=new locuslabs.maps.LatLng(n.position.latitude,n.position.longitude));var i={poiId:e,name:n.name,position:n.position,gate:n.gate,terminal:n.terminal};o.push(i)}),i.setResults(o),e(i)}catch(a){locuslabs.log.error("_searchWithTerms: "+a)}},rawSearch:function(t){return t=t.toLowerCase(),locuslabs.maps.Venue.getVenueById(this.get("venueId")).getPOIData().search[t]},rawSearchForTerms:function(t,e){try{for(var n={},i=0;i<t.length;i++)for(var s=this.rawSearch(t[i]),o=0;o<s.length;o++)n[s[o]]=s[o];var a=[];for(var r in n)a.push(r);return e?this.sortPoisByDistanceFromOrigin(e,a):n}catch(l){return locuslabs.log.error("rawSearchForTerms: "+l),null}},rawProximitySearch:function(t,e,n){try{var i=new locuslabs.maps.LatLng(e,n),s=encodeGeoHash(e,n),o=s.substr(0,7),a=[];a.push(t+":"+calculateAdjacent(calculateAdjacent(o,"top"),"left")),a.push(t+":"+calculateAdjacent(o,"top")),a.push(t+":"+calculateAdjacent(calculateAdjacent(o,"top"),"right")),a.push(t+":"+calculateAdjacent(o,"left")),a.push(t+":"+o),a.push(t+":"+calculateAdjacent(o,"right")),a.push(t+":"+calculateAdjacent(calculateAdjacent(o,"bottom"),"left")),a.push(t+":"+calculateAdjacent(o,"bottom")),a.push(t+":"+calculateAdjacent(calculateAdjacent(o,"bottom"),"right"));for(var r=[],l=0;l<a.length;l++){var u=locuslabs.maps.Venue.getVenueById(this.get("venueId")).getPOIData().geoDb[a[l]];if(u)for(var c=0;c<u.length;c++)r.push(u[c])}return this.sortPoisByDistanceFromOrigin(i,r)}catch(h){return locuslabs.log.error("rawProximitySearch: "+h),null}},findIntersectionAndRemainder:function(t,e){for(var n=[],i=[],s={},o=0;o<e.length;o++)s[e[o]]=e[o];for(var a=0;a<t.length;a++)s[t[a]]?n.push(t[a]):i.push(t[a]);return[n,i]},sortPoisByDistanceFromOrigin:function(t,e){try{for(var n=[],i=0;i<e.length;i++)locuslabs.maps.Venue.getVenueById(this.get("venueId")).getPOIData().pois[e[i]].position.latLng&&n.push([e[i],t.distance(locuslabs.maps.Venue.getVenueById(this.get("venueId")).getPOIData().pois[e[i]].position.latLng)]);n.sort(function(t,e){return t[1]-e[1]});for(var s=[],i=0;i<n.length;i++)s.push(n[i][0]);return s}catch(o){return locuslabs.log.error("sortPoisByDistanceFromOrigin: "+o),null}},concatTerm:function(t){for(var e="",n=0;n<t.length;n++)e+=t[n]+", ";return e}}),locuslabs.maps.SearchResults=function(){this.set("uuid",locuslabs.uuid())},locuslabs.maps.SearchResults.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.SearchResults.prototype.getClassName=function(){return"locuslabs.maps.SearchResults"},locuslabs.maps.SearchResults.prototype.getSearch=function(){return this.get("search")},locuslabs.maps.SearchResults.prototype.getQuery=function(){return this.get("query")},locuslabs.maps.SearchResults.prototype.getQueryTerms=function(){return this.get("queryTerms")},locuslabs.maps.SearchResults.prototype.getResults=function(){return this.get("results")},locuslabs.maps.SearchResults.prototype.getOtherResults=function(){return this.get("otherResults")},locuslabs.maps.SearchResults.prototype.hasMore=function(){return this.get("more")},locuslabs.maps.SearchResults.prototype.setSearch=function(t){this.set("search",t)},locuslabs.maps.SearchResults.prototype.setMore=function(t){this.set("more",t)},locuslabs.maps.SearchResults.prototype.setQuery=function(t){this.set("query",t)},locuslabs.maps.SearchResults.prototype.setQueryTerms=function(t){this.set("queryTerms",t)},locuslabs.maps.SearchResults.prototype.setResults=function(t){this.set("results",t)},locuslabs.maps.SearchResults.prototype.setOtherResults=function(t){this.set("otherResults",t)},locuslabs.maps.MultiTermSearchResults=function(){this.set("uuid",locuslabs.uuid())},locuslabs.maps.MultiTermSearchResults.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.MultiTermSearchResults.prototype.getClassName=function(){return"locuslabs.maps.MultiTermSearchResults"},locuslabs.maps.MultiTermSearchResults.prototype.getSearch=function(){return this.get("search")},locuslabs.maps.MultiTermSearchResults.prototype.getQueryTerms=function(){return this.get("queryTerms")},locuslabs.maps.MultiTermSearchResults.prototype.getResults=function(){return this.get("results")},locuslabs.maps.MultiTermSearchResults.prototype.getOtherResults=function(){return this.get("otherResults")},locuslabs.maps.MultiTermSearchResults.prototype.hasMore=function(){return this.get("more")},locuslabs.maps.MultiTermSearchResults.prototype.setSearch=function(t){this.set("search",t)},locuslabs.maps.MultiTermSearchResults.prototype.setMore=function(t){this.set("more",t)},locuslabs.maps.MultiTermSearchResults.prototype.setQueryTerms=function(t){this.set("queryTerms",t)},locuslabs.maps.MultiTermSearchResults.prototype.setResults=function(t){this.set("results",t)},locuslabs.maps.MultiTermSearchResults.prototype.setOtherResults=function(t){this.set("otherResults",t)},locuslabs.maps.Size=function(t,e){this.width=t,this.height=e},locuslabs.maps.Size.prototype.toString=function(){return this.width+","+this.height},locuslabs.maps.Venue=locuslabs.maps.Location.subclass("Venue",{constructor:function(t){this.callParent(t),this.buildings={},this.rawData=t},getVenueOrientation:function(){return this.get("venueOrientation")},getVenueCenter:function(){return this.get("venueCenter")},getVenueRadius:function(){return this.get("venueRadius")},getNavData:function(){return this.navData},getSearchData:function(){return this.poiData},getPOIData:function(){return this.poiData},getMapData:function(){return this._svgTextString},getDefaultStructureId:function(){return this.get("defaultStructureId")},getStructures:function(){var t=[],e=this.get("structures");for(var n in e)t.push(n);return t},getStructure:function(t){if(t){if(!this.buildings[t]){var e=this.get("structures")[t];if(!e)return this.getStructure(this.getStructures()[0]);this.buildings[t]=new locuslabs.maps.Building(this.get("structures")[t])}return this.buildings[t]}return this.getStructure(this.getStructures()[0])},getLevelDifference:function(t,e,n){var i=this.findStructureForFloorId(e),s=this.findStructureForFloorId(n),o=i.loadFloor(e),a=s.loadFloor(n);return o.getOrdinal()-a.getOrdinal()},isSameOrdinalForFloors:function(t,e){try{var n=this.findStructureForFloorId(t),i=this.findStructureForFloorId(e),s=n.loadFloor(t),o=i.loadFloor(e);return s.getOrdinal()==o.getOrdinal()}catch(a){return!1}},getOrdinalForFloorId:function(t){try{var e=this.findStructureForFloorId(t),n=e.loadFloor(t);return n.getOrdinal()}catch(i){return!1}},findStructureForFloorId:function(t){for(var e=this.getStructures(),n=0;n<e.length;n++)for(var i=this.getStructure(e[n]),s=i.getLevels(),o=0;o<s.length;o++)if(s[o]==t)return i;return null},getBeaconRegions:function(){return this.get("beaconRegions")},getBeacons:function(){return this.get("beacons")},getClassName:function(){return"locuslabs.maps.Venue"},getRaw:function(){return this.rawData},releaseSVGText:function(){this._svgTextString=null},"static":{venueDb:{},venueList:{},newInstance:function(t,e){var n=new locuslabs.maps.Venue(e[0]);return n.set("uuid",t),n},getVenues:function(){var t=[];for(var e in locuslabs.maps.Venue.venueList)t.push(locuslabs.maps.Venue.venueList[e]);return t},getVenueIds:function(){return $.map(locuslabs.maps.Venue.venueList,function(t){return t.id})},getVenueInfoById:function(t){return locuslabs.maps.Venue.venueList[t]},loadVenueList:function(t){var e=null;e=locuslabs.config.isPreparingAssets?locuslabs.config.assetsFormatVersion+".json":locuslabs.config.accountId+"/"+locuslabs.config.assetsFormatVersion+".json",locuslabs.log.debug("Venue List Loaded From: ["+locuslabs.config.assetsBase+e+"]");var n=function(t){locuslabs.maps.Venue.venueList={};for(var e in t)locuslabs.maps.Venue.venueList[e]=t[e]};locuslabs.dataloader.getVenueList(function(i){n(i);$.ajax(locuslabs.config.assetsBase+e,{cache:!1}).success(function(e){locuslabs.dataloader.setVenueList(JSON.stringify(e)),t()}).error(function(n,i,s){locuslabs.log.debug("FAILED TO LOAD: "+locuslabs.config.assetsBase+e+" => "+s),t()})},function(){$.ajax(locuslabs.config.assetsBase+e,{cache:!1}).success(function(e){n(e),locuslabs.dataloader.setVenueList(JSON.stringify(e)),t()}).error(function(n,i,s){locuslabs.log.debug("FAILED TO LOAD: "+locuslabs.config.assetsBase+e+" => "+s),t()})})},loadVenueData:function(t,e){var n=locuslabs.maps.Venue.getVenueInfoById(t);if(!n)throw'No venue information found for "'+t+'." This user is authorized for these venues: '+this.getVenueIds().join("|");var i=null;i=locuslabs.config.isPreparingAssets?t+"VenueData.json":"v1"==locuslabs.config.assetsFormatVersion?locuslabs.config.accountId+"/"+t+"/"+n.assetVersion+"/"+t+"VenueData.json":locuslabs.config.accountId+"/"+t+"/"+n.assetVersion+"/"+locuslabs.config.assetsFormatVersion+"/"+t+"VenueData.json",locuslabs.log.debug("Venue Data Loaded From: ["+locuslabs.config.assetsBase+i+"]");var s=function(t){for(var e in t){var n=t[e];locuslabs.maps.Venue.venueDb[e]=new locuslabs.maps.Venue(n)}};try{locuslabs.dataloader.getVenueData(t,function(t){s(t),e()},function(){$.ajax(locuslabs.config.assetsBase+i,{cache:locuslabs.config.cache}).success(function(t){s(t),e()}).fail(function(t){locuslabs.log.debug("Unable to load Venue Data: "+locuslabs.config.assetsBase+i)})})}catch(o){locuslabs.log.error("loadVenueData: "+o)}},getVenueById:function(t){return locuslabs.maps.Venue.venueDb[t]},clearVenueById:function(t){locuslabs.maps.Venue.venueDb[t.toLowerCase()]=null},getVenueByIdAsynchronously:function(t,e){locuslabs.log.debug("getVenueByIdAsynchronously: "+t);try{var n=locuslabs.maps.Venue.getVenueById(t);if(n){var i=locuslabs.maps.Venue.getVenueInfoById(t),s=function(t){locuslabs.dataloader.getMap(t,function(t){n._svgTextString=t,e(n)},function(){locuslabs.log.debug("Loading Map data from remote source : "+n.get("map"));var s=null;s=locuslabs.config.isPreparingAssets?n.get("map"):"v1"==locuslabs.config.assetsFormatVersion?locuslabs.config.accountId+"/"+t+"/"+i.assetVersion+"/"+n.get("map"):locuslabs.config.accountId+"/"+t+"/"+i.assetVersion+"/"+locuslabs.config.assetsFormatVersion+"/"+n.get("map"),locuslabs.log.debug("Loading map from: "+s),$.ajax(locuslabs.config.assetsBase+s,{cache:locuslabs.config.cache,dataType:"text"}).success(function(t){n._svgTextString=t,e(n)})})},o=function(t){locuslabs.dataloader.getNav(t,function(e){n.navData=e,s(t)},function(){locuslabs.log.debug("Loading Nav Data Remotely: "+n.get("mapNav"));var e=null;e=locuslabs.config.isPreparingAssets?n.get("mapNav"):"v1"==locuslabs.config.assetsFormatVersion?locuslabs.config.accountId+"/"+t+"/"+i.assetVersion+"/"+n.get("mapNav"):locuslabs.config.accountId+"/"+t+"/"+i.assetVersion+"/"+locuslabs.config.assetsFormatVersion+"/"+n.get("mapNav"),locuslabs.log.debug("Loading nav from: "+e),$.ajax(locuslabs.config.assetsBase+e,{cache:locuslabs.config.cache}).success(function(e){n.navData=e,s(t)})})},a=function(t){locuslabs.dataloader.getBeacons(t,function(e){var i=[];$.each(e,function(t,e){var n={uuid:e.uuid,floorId:e.floorId,buildingId:e.buildingId,venueId:e.venueId,majorId:e.majorId,minorId:e.minorId,position:new locuslabs.maps.LatLng(e.latitude,e.longitude)};i.push(n)}),n.set("beacons",i),o(t)},function(){locuslabs.log.debug("Loading Beacon Data Remotely: "+n.get("beaconsUrl"));var e=null;e=locuslabs.config.isPreparingAssets?n.get("beaconsUrl"):"v1"==locuslabs.config.assetsFormatVersion?locuslabs.config.accountId+"/"+t+"/"+i.assetVersion+"/"+n.get("beaconsUrl"):locuslabs.config.accountId+"/"+t+"/"+i.assetVersion+"/"+locuslabs.config.assetsFormatVersion+"/"+n.get("beaconsUrl"),locuslabs.log.debug("Loading beacons from: "+e),$.ajax(locuslabs.config.assetsBase+e,{cache:locuslabs.config.cache}).success(function(e){var i=[];$.each(e,function(t,e){var n={uuid:e.uuid,floorId:e.floorId,buildingId:e.buildingId,venueId:e.venueId,majorId:e.majorId,minorId:e.minorId,position:new locuslabs.maps.LatLng(e.latitude,e.longitude)};i.push(n)}),n.set("beacons",i),o(t)})})};locuslabs.dataloader.getPoi(t,function(e){n.poiData=e,a(t)},function(){locuslabs.log.debug("Loading POI Database from remote source : "+n.get("poiDb"));var e=null;e=locuslabs.config.isPreparingAssets?n.get("poiDb"):"v1"==locuslabs.config.assetsFormatVersion?locuslabs.config.accountId+"/"+t+"/"+i.assetVersion+"/"+n.get("poiDb"):locuslabs.config.accountId+"/"+t+"/"+i.assetVersion+"/"+locuslabs.config.assetsFormatVersion+"/"+n.get("poiDb"),locuslabs.log.debug("Loading poi from: "+e),$.ajax(locuslabs.config.assetsBase+e,{cache:locuslabs.config.cache}).success(function(e){n.poiData=e,a(t)})})}else locuslabs.maps.Venue.loadVenueData(t,function(){locuslabs.maps.Venue.getVenueByIdAsynchronously(t,e)})}catch(r){locuslabs.log.error("getVenueByIdAsynchronously: "+r)}}}}),locuslabs.maps.ViewBox=function(t,e){this.origin=t,this.size=e},locuslabs.maps.POI=locuslabs.maps.Location.subclass("POI",{constructor:function(t){this.callParent(t),t.position&&this.set("position",new locuslabs.maps.Position(t.position))},getPosition:function(){return this.get("position")},getDisplayTags:function(){return this.get("displayTags")},getClassName:function(){return"locuslabs.maps.POI"},"static":{newInstance:function(t,e){var n=new locuslabs.maps.POI(e[0]);return n.set("uuid",t),n}}}),locuslabs.maps.Building=locuslabs.maps.Location.subclass("Building",{constructor:function(t){this.callParent(t),this.levelDb={},this.set("uuid",locuslabs.uuid())},getLevels:function(){var t=[],e=this.get("levels");for(var n in e)t.push(n);return t},getDefaultFloorId:function(){return this.get("defaultLevelId")},listFloors:function(t){var e=[];if(!this.getLevels()||0==this.getLevels().length){if(!t)return null;t(null)}for(var n=0;n<this.getLevels().length;n++){var i=this.getFloorData(this.getLevels()[n]),s={floorId:i.id,name:i.name,floor:i.ordinal,details:i.details};e.push(s)}return t?void t(e):e},loadFloor:function(t,e){return this.levelDb[t]||(this.levelDb[t]=new locuslabs.maps.Floor(this.getFloorData(t))),this.set("activeFloor",this.levelDb[t]),e&&e(this.levelDb[t]),this.levelDb[t]},getFloorData:function(t){return this.get("levels")[t]},getClassName:function(){return"locuslabs.maps.Building"}}),locuslabs.maps.Section=locuslabs.maps.Location.subclass("Section",{constructor:function(t){this.callParent(t),this.set("uuid",locuslabs.uuid()),this.set("floorId",locuslabs.maps.Utilities.getFloorIdFromSectionId(this.getSectionId())),this.set("venueId",locuslabs.maps.Utilities.getVenueIdFromFloorId(this.getFloorId())),this.set("buildingId",locuslabs.maps.Utilities.getBuildingIdFromFloorId(this.getFloorId()))},getVenueId:function(){return this.get("venueId")},getBuildingId:function(){return this.get("buildingId")},getFloorId:function(){return this.get("floorId")},getSectionId:function(){return this.getId()},getClassName:function(){return"locuslabs.maps.Section"}}),locuslabs.maps.Airport=locuslabs.maps.Venue.subclass("Airport",{constructor:function(t){this.callParent(t),this.set("airportCode",t.airportCode),this.set("uuid",locuslabs.uuid()),this.set("shouldUsePositioningSensors",!0),this.set("positionManager",new locuslabs.maps.PositionManager({})),this.set("beaconReadingLifespan",5),this.set("bonusForBeingNearest",3),this.set("minimumReadingCount",1);var e=locuslabs.maps.Venue.getVenueById(this.getId());e&&(this.bindTo("beacons",e,"beacons"),this.getPositionManager().bindTo("beacons",e,"beacons")),this.getPositionManager().bindTo("navigator",this,"navigator"),this.getPositionManager().bindTo("shouldUsePositioningSensors",this,"shouldUsePositioningSensors"),this.getPositionManager().bindTo("beaconReadingLifespan",this,"beaconReadingLifespan"),this.getPositionManager().bindTo("bonusForBeingNearest",this,"bonusForBeingNearest"),this.getPositionManager().bindTo("minimumReadingCount",this,"minimumReadingCount"),this.bindTo("positionState",this.getPositionManager(),"positionState"),this.bindTo("position",this.getPositionManager(),"position"),this.bindTo("closestBeacon",this.getPositionManager(),"closestBeacon")},teardown:function(){this.unbind("beacons"),this.unbind("positionState"),this.unbind("position"),this.unbind("closestBeacon"),this.getPositionManager().unbind("beaconReadingLifespan"),this.getPositionManager().unbind("bonusForBeingNearest"),this.getPositionManager().unbind("minimumReadingCount"),this.getPositionManager().unbind("navigator"),this.getPositionManager().unbind("beacons"),this.getPositionManager().unbind("shouldUsePositioningSensors")},getVenueId:function(){return this.getId()},toString:function(){return this.getVenueId()},getDefaultBuildingId:function(){return this.getDefaultStructureId()},listBuildings:function(t){try{var e=locuslabs.maps.Venue.getVenueById(this.getId()),n=[],i=e.getStructures();if(!i)return t&&t(null),null;for(var s=0;s<i.length;s++){var o={buildingId:e.getStructure(i[s]).getId(),name:e.getStructure(i[s]).getName()};n.push(o)}return t&&t(n),n}catch(a){return locuslabs.log.error("listBuildings: "+a),t?(t(null),null):null}},loadBuilding:function(t,e){try{var n=locuslabs.maps.Venue.getVenueById(this.getId());if(!n)return locuslabs.log.warn("unknown venue: "+this.getId()),e&&e(null),null;var i=n.getStructure(t);return i?(e&&e(i),i):(locuslabs.log.warn("unknown buildingId: "+t),e&&e(null),null)}catch(s){return locuslabs.log.error("loadBuilding: "+s),e&&e(null),null}},loadNavigationGraph:function(){try{this.getNavigator()}catch(t){locuslabs.log.error("airport.loadNavigationGraph exception: "+t)}},navigate:function(t,e,n){locuslabs.log.debug("airport.navigate");try{n(this.getNavigator().findRoute(t,e),t,e)}catch(i){locuslabs.log.error("airport.navigate exception: "+i)}},timeEstimate:function(t,e,n){locuslabs.log.debug("airport.timeEstimate");try{var i=[e],s=this.getNavigator().findRoute(t,i);if(!s)return void n(-1,t,i[0]);n(s.eta,t,i[0])}catch(o){locuslabs.log.error("airport.timeEstimate exception: "+o)}},navigateUpdate:function(t,e,n){locuslabs.log.debug("airport.navigateUpdate");try{var i=[e];n(this.getNavigator().findRoute(t,i),t,i[0])}catch(s){locuslabs.log.error("airport.navigateUpdate exception: "+s)}},buildNavigator:function(){var t;locuslabs.log.debug("airport.buildNavigator");try{var e=(new Date).getTime();t=new locuslabs.maps.NavigatorEngine(this.getVenueId(),locuslabs.maps.Venue.getVenueById(this.getId()).getNavData()),locuslabs.log.debug("Total Time For Navigation2 : "+((new Date).getTime()-e))}catch(n){locuslabs.log.error("airport.buildNavigator exception: "+n)}return t},getNavigator:function(){if(!this.get("navigator")){var t=this.buildNavigator();this.set("navigator",t)}return this.get("navigator")},buildNavGraphFromString:function(t,e){return locuslabs.log.debug("airport.buildNavGraphFromString"),this.buildNavGraphFromObject(JSON.parse(t),e)},buildNavGraphFromObject:function(t,e){try{var n=new locuslabs.maps.GraphBuilder(this.poiDatabase(),e.getView());return n.buildGraph(t),n.generateNavData()}catch(i){return locuslabs.log.error("airport.buildNavGraph exception: "+i),null}},beaconReadings:function(t){this.getNavigator(),this.getPositionManager().beaconReadings(t)},recordPositionSensorReading:function(t,e,n){this.getNavigator(),this.getPositionManager().recordPositionSensorReading(t,e,n)},recordPositionSensorServiceInterruption:function(t){this.getPositionManager().recordPositionSensorServiceInterruption(t)},search:function(){return new locuslabs.maps.Search({venueId:this.getId()})},poiDatabase:function(){return new locuslabs.maps.POIDatabase({venueId:this.getId()})},buildPoiDatabase:function(t,e,n){locuslabs.log.debug("airport.buildPoiDatabase");var i=new locuslabs.maps.PoiDatabaseBuilder(n.getView());return i.buildDatabase(t,e)},buildBeaconDatabase:function(t,e){locuslabs.log.debug("airport.buildBeaconDatabase");var n=new locuslabs.maps.BeaconDatabaseBuilder(this.getVenueId(),e.getView());return n.buildDatabase(t)},getPosition:function(){return this.get("position")},getClosestBeacon:function(){return this.get("closestBeacon")},getClassName:function(){return"locuslabs.maps.Airport"},getPositionManager:function(){return this.get("positionManager")},interpolateClosestPointOnNavigationPath:function(t){return this.getNavigator().getGraph().interpolateClosestPoint(t)},_getGraphPoints:function(t,e){locuslabs.log.debug("airport._getGraphPoints");try{var n=this.getNavigator(),i=n.getGraph().getAllNodes(),s=[],o=[];$.each(i,function(e,n){n.getFloorId()===t&&o.push(n.getLatLng())});var a={},r=[];$.each(i,function(e,i){if(i.getFloorId()===t){var s=i.getLatLng();$.each(i.getEdges(),function(e,o){var l=n.getGraph().getNode(o.getDst());if(l.getFloorId()===t){var u=i.getId()+":"+l.getId();if(!a[u]){var c=l.getLatLng();r.push([s,c]),a[u]=1,a[l.getId()+":"+i.getId()]=1}}})}}),s.push(o),s.push(r),e(s)}catch(l){locuslabs.log.error("airport._getGraphPoints exception: "+l)}},_getPathPoints:function(t,e,n){locuslabs.log.debug("airport._getPathPoints");try{var i=this.getNavigator(),s=i.getGraph().findClosestNode(t.floorId,t.latLng),o=i.getGraph().findClosestNode(e[0].floorId,e[0].latLng),a=i.getGraph()._findPaths(s,o),r=[];for(var l in a){var u=l,c=a[l];if(c){var h=i.getGraph().getNode(u).getLatLng(),d=i.getGraph().getNode(c).getLatLng(),p=[];p.push(h),p.push(d),r.push(p)}}n(r)}catch(f){locuslabs.log.error("airport._getPathPoints exception: "+f)}}}),locuslabs.maps.Utilities=locuslabs.Base.subclass("Utilities",{constructor:function(){this.callParent()},"static":{getCurvePoints:function(t){try{var e=[];locuslabs.maps.Utilities._getCurvePoints(t,e);for(var n=[],i=0;i<e.length;i++){var s=e[i];n.push([+Number(s[0][0]).toFixed(0),+Number(s[0][1]).toFixed(0)]),n.push([+Number(s[1][0]).toFixed(0),+Number(s[1][1]).toFixed(0)]),n.push([+Number(s[2][0]).toFixed(0),+Number(s[2][1]).toFixed(0)]),n.push([+Number(s[3][0]).toFixed(0),+Number(s[3][1]).toFixed(0)])}return n}catch(o){locuslabs.log.debug("getCurvePoints Exception: "+o)}},_getCurvePoints:function(t,e){if(locuslabs.maps.Utilities.isFlat(t))e.push(t);else{var n=this.subdivide(t);locuslabs.maps.Utilities._getCurvePoints(n[0],e),locuslabs.maps.Utilities._getCurvePoints(n[1],e)}},midpoints:function(t){for(var e=function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]},n=new Array(t.length-1),i=0;i<n.length;i++)n[i]=e(t[i],t[i+1]);return n},subdivide:function(t){var e=locuslabs.maps.Utilities.midpoints(t),n=locuslabs.maps.Utilities.midpoints(e),i=locuslabs.maps.Utilities.midpoints(n);return[[t[0],e[0],n[0],i[0]],[i[0],n[1],e[2],t[3]]]},isFlat:function(t){var e=10,n=3*t[1][0]-2*t[0][0]-t[3][0];n*=n;var i=3*t[1][1]-2*t[0][1]-t[3][1];i*=i;var s=3*t[2][0]-t[0][0]-2*t[3][0];s*=s;var o=3*t[2][1]-t[0][1]-2*t[3][1];return o*=o,Math.max(n,s)+Math.max(i,o)<=e},angleBetweenPoints:function(t,e){var n=e.getX()-t.getX(),i=e.getY()-t.getY();return Math.atan2(i,n)/Math.PI*180},radiansBetweenPoints:function(t,e){var n=e.getX()-t.getX(),i=e.getY()-t.getY();return Math.atan2(i,n)},distance:function(t,e){var n=e.getX()-t.getX(),i=e.getY()-t.getY();return Math.sqrt(n*n+i*i)},calculateLineDistance:function(t){for(var e=0,n=0;n<t.length-1;n++)e+=locuslabs.maps.Utilities.distance(t[n],t[n+1]);return e},findPoints:function(t,e,n){for(var i=e,s=[],o=0;o<t.length-1;o++){var a=t[o],r=t[o+1],l=locuslabs.maps.Utilities.distance(a,r);if(l>i){for(var u=l,c=a;u>i;){var h=locuslabs.maps.Utilities.radiansBetweenPoints(a,r),d=Math.cos(h)*i,p=Math.sin(h)*i;if(c=new locuslabs.maps.Point(c.getX()+d,c.getY()+p),c.angle=locuslabs.maps.Utilities.angleBetweenPoints(a,r),s.push(c),u-=i,i=n,0==n)return s}i-=u}else i-=l}return s},getNumberValue:function(t){return t.replace("%","").replace("px","")},isAPercentage:function(t){return-1!=t.indexOf("%")},isInMeters:function(t){return-1==t.indexOf("%")&&-1==t.indexOf("px")},interpolatePointInRectangleToAnotherRectangle:function(t){function e(t){var e=t.invertY||!1;"utm"==e&&(e=!1),"svg"==e&&(e=!0);var n=t.r,i=n.width||n.size.width,s=n.height||n.size.height,o=n.x||n.origin.x,a=n.y||n.origin.y;return{width:i,height:s,x:o,y:a,invertY:e}}function n(t){return t instanceof locuslabs.maps.LatLng?{x:t.lng(),y:t.lat()}:{x:t.x,y:t.y}}var i=e({r:t.r1,invertY:t.invertYForR1}),s=e({r:t.r2,invertY:t.invertYForR2}),o=n(t.p),a=(o.x-i.x)/i.width,r=i.invertY?(i.y+i.height-o.y)/i.height:(o.y-i.y)/i.height,l=s.width*a+s.x,u=s.invertY?s.y+s.height-s.height*r:s.y+s.height*r;return{x:l,y:u}},pathToPolygonPoints:function(t){var e=locuslabs.maps.Utilities.pathToPolygonString(t,100);return locuslabs.maps.Utilities.stringOfPointsToArrayOfPoints(e)},pathToPolygonString:function(t,e){e||(e=0);var n=n=t.pathSegList;if(!n||!n.numberOfItems)return null;for(var i=[],n=t.pathSegList,s=n.numberOfItems-1;s>=0;--s)i[s]=n.getItem(s);for(var o,a,r,l,u=i.concat(),c=[],h=function(t){if(t.pathSegType==SVGPathSeg.PATHSEG_CLOSEPATH);else{t.pathSegType%2==1&&t.pathSegType>1?(r+=t.x,l+=t.y):(r=t.x,l=t.y);var e=c[c.length-1];e&&r==e[0]&&l==e[1]||c.push([r,l])}},d=0,p=t.getTotalLength(),f=p/e;p>=d;d+=f){var o=u[t.getPathSegAtLength(d)],g=t.getPointAtLength(d);if(o!=a)for(a=o;i.length&&i[0]!=o;)h(i.shift());var m=c[c.length-1];m&&g.x==m[0]&&g.y==m[1]||c.push([g.x,g.y])}for(var s=0,p=i.length;p>s;++s)h(i[s]);for(var s=0,p=c.length;p>s;++s)c[s]=c[s].join(",");return c.join(" ")},stringOfPointsToArrayOfPoints:function(t){if(t){for(var e=[],n=t.split(" "),i=0;i<n.length;i++){var s=n[i].split(",");isNaN(s[0])||isNaN(s[1])||e.push([Number(s[0]),Number(s[1])])}return e}return null},isPointInPolygon:function(t,e){for(var n,i,s,o,a=t[0],r=t[1],l=!1,s=0,u=e.length-1;s<e.length;u=s++)n=e[s][0],yi=e[s][1],i=e[u][0],yj=e[u][1],o=yi>r!=yj>r&&a<(i-n)*(r-yi)/(yj-yi)+n,o&&(l=!l);return l},getBuildingIdFromFloorId:function(t){var e=t.indexOf("-"),n=t.indexOf("-",e+1);return t.substring(0,n)},getVenueIdFromFloorId:function(t){var e=t.indexOf("-");return t.substring(0,e)},getFloorIdFromSectionId:function(t){var e=t.lastIndexOf("-");return t.substring(0,e)},isNullOrUndefined:function(t){return"undefined"==typeof t||null==t}}}),locuslabs.maps.OperatingHoursClause=locuslabs.maps.MVCObject.subclass("OperatingHoursClause",{constructor:function(t,e,n,i,s){this.callParent(),this.days=t,this.startMinute=parseInt(n),this.startHour=parseInt(e),this.endMinute=parseInt(s),this.endHour=parseInt(i),this.startIsAm=12>e,this.startHour=e%12,24==i?(this.endHour=12,this.endIsAm=!0):(this.endIsAm=12>i,this.endHour=i%12)},dayAsString:function(t){var e={MO:"Mon",TU:"Tue",WE:"Wed",TH:"Thu",FR:"Fri",SA:"Sat",SU:"Sun"};return e[t.toUpperCase()]},hourToString:function(t,e,n){return 0==t&&(t=12),""+t+":"+(e?e:"00")+(n?"a":"p")},isAllDay:function(){return 0==this.startHour&&0==this.startMinute&&this.startIsAm&&12==this.endHour&&0==this.endMinute&&this.endIsAm;
},toStringPair:function(){var t=_.collect(this.days,function(t){return this.dayAsString(t)},this),e=this.isAllDay()?"24 hours":this.hourToString(this.startHour,this.startMinute,this.startIsAm)+" - "+this.hourToString(this.endHour,this.endMinute,this.endIsAm);return{days:t.join(" thru "),hours:e}},toString:function(){var t=this.toStringPair();return t.days+" "+t.hours}}),locuslabs.maps.OperatingHours=locuslabs.maps.MVCObject.subclass("OperatingHours",{constructor:function(t){this.callParent(),this.operatingHoursText=t,this.clauses=[],this.parse(t)},parse:function(t){var e=t.split(";");this.clauses=_.compact(_.collect(e,function(t){var e;return(e=this.matchSingleDay(t))?e:(e=this.matchDashSeparatedDays(t))?e:null},this))},matchDashSeparatedDays:function(t){var e=t.match(/^ *(mo|tu|we|th|fr|sa|su)-(mo|tu|we|th|fr|sa|su) ([0-2][0-9]):(00|15|30|45)-([0-2][0-9]):(00|15|30|45)$/i);return e?new locuslabs.maps.OperatingHoursClause([e[1],e[2]],e[3],e[4],e[5],e[6]):null},matchSingleDay:function(t){var e=t.match(/^ *(mo|tu|we|th|fr|sa|su) ([0-2][0-9]):(00|15|30|45)-([0-2][0-9]):(00|15|30|45)$/i);return e?new locuslabs.maps.OperatingHoursClause([e[1]],e[2],e[3],e[4],e[5]):null},toStringPairs:function(){return _.collect(this.clauses,function(t){return t.toStringPair()})},getClassName:function(){return"locuslabs.maps.OperatingHours"},toString:function(){return JSON.stringify(this)}}),locuslabs.maps.Floor=locuslabs.maps.Location.subclass("Floor",{constructor:function(t){this.callParent(t),this.set("uuid",locuslabs.uuid()),this.set("venueId",locuslabs.maps.Utilities.getVenueIdFromFloorId(this.getFloorId())),this.set("buildingId",locuslabs.maps.Utilities.getBuildingIdFromFloorId(this.getFloorId()));var e=[];if(this.get("sections"))for(var n in this.get("sections"))e.push(n);this.set("sectionIds",e),this.sectionDb={}},getVenueId:function(){return this.get("venueId")},getBuildingId:function(){return this.get("buildingId")},getFloorId:function(){return this.getId()},getOrdinal:function(){return this.get("ordinal")},getSectionIds:function(){return this.get("sectionIds")},getSection:function(t){return this.get("sections")&&this.get("sections")[t]?(this.sectionDb[t]||(this.sectionDb[t]=new locuslabs.maps.Section(this.get("sections")[t])),this.sectionDb[t]):void 0},mapInfo:function(t){try{var e=locuslabs.maps.Venue.getVenueById(this.get("venueId")),n=e.getStructure(this.get("buildingId")),i=n.getFloorData(t),s={};$.each(i,function(t,e){s[t]=e,"boundsViewBoxPoints"==t&&(s.boundsViewBox=new locuslabs.maps.ViewBox(new locuslabs.maps.Point(e[0][0],e[0][1]),new locuslabs.maps.Size(e[1][0],e[1][1])))}),s.floorId=this.getId(),e.getVenueCenter()?s.venueCenter=new locuslabs.maps.LatLng(e.getVenueCenter()[0],e.getVenueCenter()[1]):s.venueCenter=e.getBounds().getCenterPoint(),e.getVenueRadius()?s.venueRadius=e.getVenueRadius():s.venueRadius=e.getBounds().getRadius(),e.getVenueOrientation()?s.venueOrientation=e.getVenueOrientation():s.venueOrientation="wide",s.bounds=e.getBounds(),s.venueId=this.get("venueId"),s.buildingId=this.get("buildingId");var o=e.get("utmBounds");return s.utmData={bounds:o,utmZone:o.utmZone,rect:{width:o.upperRight.easting-o.lowerLeft.easting,height:o.upperRight.northing-o.lowerLeft.northing,x:o.lowerLeft.easting,y:o.lowerLeft.northing},invertY:"utm"},s}catch(a){locuslabs.log.debug("locuslabs.maps.Floor.prototype.mapInfo : "+a)}},loadMap:function(t,e){try{if(e){var n=this.mapInfo(this.getFloorId());n||e(null);var i=this,s=locuslabs.maps.Venue.getVenueById(this.get("venueId")),o=i._getMapDetails(s);n.svg=o.map,n.allFloors=o.allFloors,n.allStructures=o.allStructures,n.allOrdinals=o.allOrdinals;var a=new locuslabs.maps.Map(t,n);e(a)}}catch(r){locuslabs.log.debug("locuslabs.maps.Floor.prototype.loadMap : "+r)}},createMap:function(t){try{if(t){var e=this.mapInfo(this.getFloorId());e||t(null);var n={};$.each(e,function(t,e){n[t]=e}),n.manageView=!1;var i=this;locuslabs.maps.Venue.getVenueByIdAsynchronously(this.get("venueId"),function(e){var s=i._getMapDetails(e);n.svg=s.map,n.allFloors=s.allFloors,n.allStructures=s.allStructures,n.allOrdinals=s.allOrdinals;var o=new locuslabs.maps.Map(null,n);t(o),e.mapData=""})}}catch(s){locuslabs.log.debug("locuslabs.maps.Floor.prototype.createMap : "+s)}},listBeacons:function(t){var e=locuslabs.maps.Venue.getVenueById(this.getVenueId());t(e.getBeacons())},_getMapDetails:function(t){try{for(var e=t.getStructures(),n=[],i=[],s={},o=0;o<e.length;o++)for(var a=t.getStructure(e[o]),r=a.getLevels(),l=0;l<r.length;l++){n.push(r[l]),i.push(r[l]);var u=a.loadFloor(r[l]);s[r[l]]=u.getOrdinal()}return{map:t.getMapData(),allFloors:n,allStructures:i,allOrdinals:s}}catch(c){locuslabs.log.debug("_getMapDetails: "+c)}},getClassName:function(){return"locuslabs.maps.Floor"},runMemoryTests:function(){console.log("MEMORY TESTS (floor): FindUnexpectedGlobals"),(new locuslabs.FindUnexpectedGlobals).output(),console.log("MEMORY TESTS: MemoryFootprint: window"),(new locuslabs.MemoryFootprint).output(window),console.log("MEMORY TESTS: FindDetachedNodes"),(new locuslabs.FindDetachedNodes).output(window),console.log("MEMORY TESTS: CountDomElements"),(new locuslabs.CountDomElements).output(document),console.log("MEMORY TESTS (floor) end")}}),locuslabs.maps.AirportDatabase=function(t){t||(t={}),t.uuid||(t.uuid=locuslabs.uuid()),this.setValues(t)},locuslabs.maps.AirportDatabase.prototype=new locuslabs.maps.MVCObject,locuslabs.maps.AirportDatabase.newInstance=function(t){var e=new locuslabs.maps.AirportDatabase({uuid:t});return e},locuslabs.maps.AirportDatabase.prototype.getClassName=function(){return"locuslabs.maps.AirportDatabase"},locuslabs.maps.AirportDatabase.prototype.listAirports=function(t){locuslabs.log.debug("listAirports");try{locuslabs.maps.Venue.loadVenueList(function(){var e=locuslabs.maps.Venue.getVenues();if(t){for(var n=[],i=0;i<e.length;i++)try{var s={venueId:e[i].id,name:e[i].name,airportCode:e[i].airportCode};n.push(s)}catch(o){locuslabs.log.warn("Bad VenueData: "+o+" for: "+e[i])}t(n)}})}catch(e){locuslabs.log.error("listAirports : "+e)}},locuslabs.maps.AirportDatabase.prototype.loadAirport=function(t,e){try{var n=this;locuslabs.maps.Venue.loadVenueList(function(){locuslabs.maps.Venue.getVenueByIdAsynchronously(t,function(){n.releaseActiveAirport();var i=locuslabs.maps.Venue.getVenueById(t),s=new locuslabs.maps.Airport(i.getRaw());s&&(n._activeAirport=s,n.bindTo("position",n._activeAirport,"position"),n.bindTo("closestBeacon",n._activeAirport,"closestBeacon"),e&&setTimeout(function(){e(s),i.releaseSVGText()},10))})})}catch(i){locuslabs.log.error("loadAirport : "+i)}},locuslabs.maps.AirportDatabase.prototype.releaseActiveAirport=function(){this._activeAirport&&(this.unbind("position"),this.unbind("closestBeacon"),this._activeAirport.teardown())},locuslabs.maps.AirportDatabase.prototype.teardown=function(){this.releaseActiveAirport()},locuslabs.Native=function(t){this._objects={},this._functions={},this._native=t},locuslabs.Native.prototype.setup=function(){this._native.ready()},locuslabs.Native.prototype._processNativeArg=function(t){var e,n=this;if($.isPlainObject(t)){if(t.__locuslabs_serialized_object__)return locuslabs.deserialize(t);if(t.__locuslabs_native_object__){var i=this._objects[t.uuid];return i||locuslabs.log.warn("Native._processNativeArg : Unknown object: "+t.uuid),i}if(t.__locuslabs_native_function__){var s=this._functions[t.uuid];return s||locuslabs.log.warn("Native._processNativeArg : Unknown function: "+t.uuid),s}return e={},$.each(t,function(t,i){e[t]=n._processNativeArg(i)}),e}return $.isArray(t)?(e=[],$.each(t,function(t,i){e.push(n._processNativeArg(i))}),e):t},locuslabs.Native.prototype.newInstance=function(t,e,n){var i=this._processNativeArg(n);if(t.newInstance){var s=t.newInstance(e,i);this._objects[e]=s}else console.error("Class missing newInstance")},locuslabs.Native.prototype.call=function(t,e,n){try{var i;if(null===t){var s=e.split(/\./),o=window;if($.each(s,function(t,e){o=o[e]}),"function"==typeof o){i=this._processNativeArg(n);var a=o.apply(null,i),r=JSON.stringify(this._processJavaScriptArg(a));return r}return console.log("Invalid global method: "+e),null}var l=this._objects[t];if("undefined"==typeof l)return console.error("Unknown instance: "+t),null;i=this._processNativeArg(n);var u=l[e];if(!u){var c="";return l.getClassName&&(c=l.getClassName()),console.log("Unknown method: "+c+":"+e+" ("+t+")"),null}var a=u.apply(l,i),r=JSON.stringify(this._processJavaScriptArg(a));return r}catch(h){h.stack}},locuslabs.Native.prototype.releaseInstance=function(t){this._objects[t]&&delete this._objects[t]},locuslabs.Native.prototype._processJavaScriptArg=function(t){var e,n=this;if("undefined"!=typeof t){if(t.getUUID){var i=t.getUUID();return this._objects[i]||(this._objects[i]=t),{__locuslabs_native_object__:!0,uuid:i,className:t.getClassName()}}return $.isPlainObject(t)?(e={},$.each(t,function(t,i){e[t]=n._processJavaScriptArg(i)}),e):$.isArray(t)?(e=[],$.each(t,function(t,i){e.push(n._processJavaScriptArg(i))}),e):t.serialize?t.serialize():t}},locuslabs.Native.prototype.registerFunction=function(t){var e=this;this._functions[t]=function(){var n=Array.prototype.slice.call(arguments),i=JSON.stringify(e._processJavaScriptArg(n));e._native.callFunction(t,i)}},locuslabs.Native.prototype.releaseFunction=function(t){this._functions[t]&&delete this._functions[t]},locuslabs.Native.prototype.getObject=function(t){return this._objects[t]},locuslabs.meld=function(){function t(t,e,a){var r,l;return arguments.length<3?n(t,e):(C(e)?l=s(t,e,a):(r=typeof e,"string"===r?"function"==typeof t[e]&&(l=i(t,e,a)):l="function"===r?s(t,e(t),a):o(t,e,a)),l)}function e(t,e){var n,i,s;this.target=t,this.func=e,this.aspects={},n=this.orig=t[e],i=this,s=this.advised=function(){function t(t){var e=u(t);return i._callSimpleAdvice("on",a,t),e}function o(t,e){i._callSimpleAdvice(t,a,e)}var a,r,l,u,h;this instanceof s?(a=S(n.prototype),u=function(t){return c(n,a,t)}):(a=this,u=function(t){return n.apply(a,t)}),l=x.call(arguments),h="afterReturning",r=f({target:a,method:e,args:l});try{i._callSimpleAdvice("before",a,l);try{r.result=i._callAroundAdvice(a,e,l,t)}catch(d){r.result=r.exception=d,h="afterThrowing"}if(l=[r.result],o(h,l),o("after",l),r.exception)throw r.exception;return r.result}finally{g()}},I(s,"_advisor",{value:i,configurable:!0})}function n(t,e){var n,s;return n=t.name||"_",s={},s[n]=t,i(s,n,e),s[n]}function i(t,n,i){var s=e.get(t,n);return s&&s.add(i)}function s(t,e,n){var s,o,r,l;for(s=[],l=0;r=e[l++];)o=i(t,r,n),o&&s.push(o);return a(s)}function o(t,e,n){var s=[];for(var o in t)"function"==typeof t[o]&&e.test(o)&&s.push(i(t,o,n));return a(s)}function a(t){return{remove:function(){for(var e=t.length-1;e>=0;--e)t[e].remove()}}}function r(e){return function(n,i,s){var o={};return 2===arguments.length?(o[e]=i,t(n,o)):(o[e]=s,t(n,i,o))}}function l(t,e){var n,i,s;for(n in M)i=e[n],i&&(s=t[n],s||(t[n]=s=[]),s.push({aspect:e,advice:i}))}function u(t,e){var n,i,s;s=0;for(n in M)if(i=t[n]){s+=i.length;for(var o=i.length-1;o>=0;--o)if(i[o].aspect===e){i.splice(o,1),--s;break}}return s}function c(t,e,n){try{I(e,"constructor",{value:t,enumerable:!1})}catch(i){}return t.apply(e,n),e}function h(t,e){for(var n=0,i=t.length;i>n;n++)e(t[n])}function d(t,e){for(var n=t.length-1;n>=0;--n)e(t[n])}function p(){return v}function f(t){return b.push(v),v=t}function g(){return v=b.pop()}function m(){try{return"x"in Object.defineProperty({},"x",{})}catch(t){}}t.before=r("before"),t.around=r("around"),t.on=r("on"),t.afterReturning=r("afterReturning"),t.afterThrowing=r("afterThrowing"),t.after=r("after"),t.joinpoint=p,t.add=function(){return t.apply(null,arguments)},e.prototype={_callSimpleAdvice:function(t,e,n){var i,s;s=this.aspects[t],s&&(i=M[t])(this.aspects[t],function(t){var i=t.advice;i&&i.apply(e,n)})},_callAroundAdvice:function(t,e,n,i){function s(t,e){return 0>t?i(e):o(r[t].advice,t,e)}function o(n,i,o){function a(){return c}function r(){return u(arguments.length>0?x.call(arguments):o)}function l(t){return u(t||o)}function u(t){return c++,s(i-1,t)}var c,h;c=0,h=f({target:t,method:e,args:o,proceed:r,proceedApply:l,proceedCount:a});try{return n.call(t,h)}finally{g()}}var a,r;return r=this.aspects.around,a=r?r.length:0,s(a-1,n)},add:function(t){var e,n;return e=this,n=e.aspects,l(n,t),{remove:function(){var i=u(n,t);i||e.remove()}}},remove:function(){delete this.advised._advisor,this.target[this.func]=this.orig}},e.get=function(t,n){if(n in t){var i,s;if(s=t[n],"function"!=typeof s)throw new Error("Advice can only be applied to functions: "+n);return i=s._advisor,i||(i=new e(t,n),t[n]=i.advised),i}};var v,b,y,_,w,M,x,C,I,S;return b=[],y=Array.prototype,_=y.unshift,w=y.push,x=y.slice,C=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)},I=m()?Object.defineProperty:function(t,e,n){t[e]=n.value},S=Object.create||function(){function t(){}return function(e){t.prototype=e;var n=new t;return t.prototype=null,n}}(),M={before:d,around:!1},M.on=M.afterReturning=M.afterThrowing=M.after=h,t}(),locuslabs.meld.tracer=function(){function t(t){return t>i.length/2&&(i+=i),i.slice(0,2*t-2)}var e,n,i,s;return e=locuslabs.meld.joinpoint,n=0,i="| | | | | ",s={onCall:function(e){console.log(t(++n)+e.method+" CALL ",e.args)},onReturn:function(e){console.log(t(n--)+e.method+" RETURN ",e.result)},onThrow:function(e){console.log(t(n--)+e.method+" THROW "+e.exception)}},function(t){return t||(t=s),{before:function(){var n=e();t.onCall&&t.onCall({method:n.method,target:n.target,args:n.args.slice()})},afterReturning:function(n){var i=e();t.onReturn&&t.onReturn({method:i.method,target:i.target,result:n})},afterThrowing:function(n){var i=e();t.onThrow&&t.onThrow({method:i.method,target:i.target,exception:n})}}}}(),locuslabs.meld.profiler=function(){function t(){this.children={},this.startTime=0,this.name="root",this.count=0,this.totalTime=0,this.parent=null,this.depth=0}t.prototype={push:function(e){var n=this.children[e];return n||(n=this.children[e]=new t),n.name=e,n.startTime=new Date,n.parent=this,n.depth=this.depth+1,n},pop:function(t){return this.count=this.count+1,this.totalTime=this.totalTime+(new Date-this.startTime),this.parent},selfTime:function(){var t=this.totalTime,e=this.children;return Object.keys(e).forEach(function(n){e.hasOwnProperty(n)&&(t-=e[n].totalTime)}),t},report:function(t,e){t=t||"";var n=("      "+this.depth).slice(-6),s=("      "+this.totalTime).slice(-6),o=("      "+this.selfTime()).slice(-6),a=("      "+this.count).slice(-6),r=[n+s+" "+o+" "+a+" "+t+this.name],l=this.children;return Object.keys(l).forEach(function(e){if(l.hasOwnProperty(e)){var n=l[e];n.totalTime>i&&r.push(l[e].report(t+"|   "))}}),r.join("\n")}};var e=new t,n=e,i=1;return function(t){return{before:function(){var t=locuslabs.meld.joinpoint(),e=t.target.className?t.target.className+".":"";n=n.push(e+t.method)},afterReturning:function(t){var e=locuslabs.meld.joinpoint(),i=e.target.className?e.target.className+".":"";n=n.pop(i+e.method)},afterThrowing:function(t){var e=locuslabs.meld.joinpoint(),i=e.target.className?e.target.className+".":"";n=n.pop(i+e.method)},report:function(){return"\n depth total   self  count name\n"+e.report("")},setMinimumTotalTime:function(t){i=t}}}}(),locuslabs.Array2D=locuslabs.Base.subclass("Array2D",{constructor:function(){this._rows=[],this._columnNames=[]},rowCount:function(){return this._rows.length},columnCount:function(){return this._columnNames.length},columnNames:function(){return this._columnNames},set:function(t,e,n){var i=this._rowIndex(t),s=this._columnIndex(e);this._rows[i][s]=n},get:function(t,e){var n=this._rowIndex(t),i=this._columnIndex(e);return this._rows[n][i]},toString:function(t,e){for(var n=[],i=0;i<this.rowCount();i++)n.push(this._rows[i].join(e));return n.join(t)},addRow:function(){for(var t=[],e=0;e<this.columnCount();e++)t.push("");return this._rows.push(t),this.rowCount()-1},_addColumn:function(t){for(var e=0;e<this.rowCount();e++)this._rows[e].push("");var n="string"==typeof t?t:this._columnNames.length;this._columnNames.push(n)},_rowIndex:function(t){for(var e=t;this._rows.length<=e;)this.addRow();return e},_columnIndex:function(t){var e;for("string"==typeof t?(e=this._columnNames.indexOf(t),-1==e&&(e=this._columnNames.length)):e=t;this.columnCount()<=e;)this._addColumn(t);return e}}),locuslabs.DepthFirstProcessor=locuslabs.Base.subclass("DepthFirstProcessor",{identifyObject:function(t){var e=[];return t.getClassName&&e.push("["+t.getClassName()+"]"),t.nodeName&&e.push(t.nodeName),t.id&&e.push(t.id),e.join(" ")},visitCircularReference:function(t,e){return this.visitNode(t,"circular "+this.identifyObject(e))},visitDomElement:function(t,e){return this.visitNode(t,"DOM element: "+this.identifyObject(e))},visitNonDomElement:function(t,e){return this.recurse(t,e)},eligibleKeys:function(t){return _.keys(t)},valueForKey:function(t,e){const n={fonts:"fonts",ownerDocument:"ownerDocument",styleSheets:"styleSheets",innerHTML:"innerHTML",outerHTML:"outerHTML",innerText:"innerText",textContent:"textContent",nodeValue:"nodeValue",ownerElement:"ownerElement",outerText:"outerText",wholeText:"wholeText",nextSibling:"nextSibling",previousSibling:"previousSibling",nextElementSibling:"nextElementSibling",previousElementSibling:"previousElementSibling",parentElement:"parentElement",$:"jQuery",jQuery:"jQuery",_:"underscore",d3:"d3",proj4:"proj4",log4javascript:"log4javascript",mocha:"mocha",should:"should"};return"textContent"==e&&t.childNodes&&0==t.childNodes.length?t[e]:n[e]?n[e]:t[e]},isCircularReference:function(t){return this.alreadyVisited.get(t)?!0:(this.alreadyVisited.set(t,!0),!1)},visitObject:function(t,e){if(this.isCircularReference(e))return this.visitCircularReference(t,e);this.topDown&&this.visitNode(t,e);var n=_.map(this.eligibleKeys(e).sort(),function(n){t.push(n);var i=this.valueForKey(e,n),s=i instanceof Element?this.visitDomElement(t,i):this.visitNonDomElement(t,i);return t.pop(),s}.bind(this));return this.bottomUp?this.visitNode(t,e,n):void 0},visitArray:function(t,e){this.topDown&&this.visitNode(t,e);var n=_.map(e,function(e,n){t.push("["+n+"]");var i=this.recurse(t,e);return t.pop(),i}.bind(this));return this.bottomUp?this.visitNode(t,e,n):void 0},visitNode:function(t,e){throw"Subclass has to override the 'visitNodd' method"},visitFunction:function(t,e){return this.visitNode(t,"function")},visitNull:function(t,e){return this.visitNode(t,"null")},visitString:function(t,e){return this.visitNode(t,e)},visitNumber:function(t,e){return this.visitNode(t,e)},visitBoolean:function(t,e){return this.visitNode(t,e)},visitUndefined:function(t,e){return this.visitNode(t,e)},visitOther:function(t,e){return this.visitNode(t,e)},recurse:function(t,e){return _.isFunction(e)?this.visitFunction(t,e):_.isNull(e)?this.visitNull(t,e):_.isArray(e)?this.visitArray(t,e):_.isObject(e)?this.visitObject(t,e):_.isString(e)?this.visitString(t,e):_.isNumber(e)?this.visitNumber(t,e):_.isBoolean(e)?this.visitBoolean(t,e):_.isUndefined(e)?this.visitUndefined(t,e):this.visitOther(t,e)},visitJavascriptDepthFirst:function(t,e,n){return this.topDown=n.topDown,this.bottomUp=n.bottomUp,this.alreadyVisited=new WeakMap,this.recurse(t,e)}}),locuslabs.ObjectPrinter=locuslabs.DepthFirstProcessor.subclass("ObjectPrinter",{MAX_LENGTH:100,visitString:function(t,e){this.visitNode(t,e.length>this.MAX_LENGTH?e.substring(0,this.MAX_LENGTH)+"...":e)},visitNode:function(t,e){function n(t){return new Array(t.length).join("|   ")+_.last(t)}"object"==typeof e?this.result.push(n(t)+": "+this.identifyObject(e)):"function"==typeof e?this.result.push(n(t)+": function"):this.result.push(n(t)+": "+e)},process:function(t,e){return e=e||"root",this.result=[],this.visitJavascriptDepthFirst([e],t,{topDown:!0}),this.result},output:function(t,e){var n=this.process(t,e);console.log("Nested values"),_.each(n,function(t){console.log("    "+t)})}}),locuslabs.DomPrinter=locuslabs.ObjectPrinter.subclass("DomPrinter",{visitNode:function(t,e){function n(t){return new Array(t.length).join("|   ")+_.last(t)}"object"==typeof e?this.result.push(n(t)+": "+this.identifyObject(e)):"function"==typeof e?this.result.push(n(t)+": function"):this.result.push(n(t)+": "+e)},printDom:function(t){return this.result=[],this.visitJavascriptDepthFirst(["root"],t,{topDown:!0}),this.result}}),locuslabs.MemoryFootprint=locuslabs.DepthFirstProcessor.subclass("MemoryFootprint",{MAX_LENGTH:100,visitCircularReference:function(t,e){return this.wrapResult(t,0,0,e)},pad:function(t,e){var n=e;return e||(n=8),("        "+t).slice(-n)},visitString:function(t,e){if(this.stringCache[e])return this.wrapResult(t,0,0,"'"+e+"'");this.stringCache[e]=!0;var n=this.sizeOf(e);return this.wrapResult(t,n,0,"'"+e+"'")},wrapResult:function(t,e,n,i){i=i?i.toString():"",i=i.length>this.MAX_LENGTH?i.substring(0,this.MAX_LENGTH)+"...":i;var s=t.join("|"),o={path:t.slice(),pathKey:s,selfSize:e,totalSize:e+n,value:i};return this.paths.push(o),o},sizeOf:function(t){return _.isBoolean(t)?4:_.isNumber(t)?8:_.isString(t)?2*t.length:_.isArray(t)?0:_.isObject(t)?_.reduce(_.keys(t),function(t,e){return t+2*e.length},0):_.isUndefined(t)?0:t instanceof HTMLAllCollection?0:void 0},visitNode:function(t,e,n){var i=this.sizeOf(e),s=0;(_.isArray(e)||_.isObject(e))&&(s=_.reduce(n,function(t,e){return t+e.totalSize},0));var o=e&&e.getClassName?"["+e.getClassName()+"]":"";return this.wrapResult(t,i,s,o)},process:function(t,e){function n(t){return("                                                                  "+t).slice(-8)}_.extend(this,_.defaults(e,{maxDepth:12,minTotalSize:1e4,minSelfSize:1e4,showValues:!0})),this.paths=[],this.stringCache={},this.visitJavascriptDepthFirst(["root"],t,{bottomUp:!0}),this.paths.sort(function(t,e){return t.pathKey.localeCompare(e.pathKey)});var i=[];return _.each(this.paths,function(t){if(t.length<this.maxDepth||t.totalSize>=this.minTotalSize||t.selfSize>=this.minSelfSize){var e=t.pathKey.replace(/[^|]+\|/g,"|  "),s=this.showValues&&t.value?" "+t.value:"";i.push("self: "+n(t.selfSize)+" total: "+n(t.totalSize)+" "+e+s)}}.bind(this)),i},output:function(t,e){console.log("Memory footprint");var n=this.process(t,e);_.each(n,function(t){console.log("    "+t)})}}),locuslabs.FindDetachedNodes=locuslabs.ObjectPrinter.subclass("FindUnexpectedNodes",{visitNode:function(t,e){},visitDomElement:function(t,e){var n=this.domHash.get(e)?this.attachedNodes:this.detachedNodes;n.push({path:t.slice(),value:e})},process:function(){return this.domHash=new WeakMap,this.attachedNodes=[],this.detachedNodes=[],_.each(document.getElementsByTagName("*"),function(t){this.domHash.set(t,!0)}.bind(this)),this.visitJavascriptDepthFirst(["window"],window,{topDown:!0}),{detachedNodes:this.detachedNodes,attachedNodes:this.attachedNodes}},output:function(t){function e(t,e){return("                                                                                                                                                   "+t).slice(-e)}var n=this.process(t);console.log("Detached nodes"),_.each(n.detachedNodes,function(t){console.log(e(t.value.nodeName,10)+" "+t.path.join("|"))}),console.log("Attached nodes"),_.each(n.attachedNodes,function(t){console.log(e(t.value.nodeName,10)+" "+t.path.join("|"))})}}),locuslabs.CountDomElements=locuslabs.Base.subclass("CountDomElements",{process:function(t){var e=t.getElementsByTagName("*");return _.reduce(e,function(t,e){return t[e.nodeName]||(t[e.nodeName]=0),t[e.nodeName]++,t},{})},output:function(t){function e(t){return("        "+t).slice(8)}var n=this.process(t),i=_.keys(n).sort();console.log("DOM elements:");var s=0;_.each(i,function(t){s+=n[t],console.log("    "+e(t)+": "+e(n[t]))}),console.log("DOM elements total count: "+s)}}),locuslabs.FindUnexpectedGlobals=locuslabs.Base.subclass("FindUnexpectedGlobals",{process:function(){const t={fonts:"fonts",styleSheets:"styleSheets",ownerDocument:"ownerDocument",d3:"d3",BASE32:"geohash",BITS:"geohash",BORDERS:"geohash",NEIGHBORS:"geohash",calculateAdjacent:"geohash",decodeGeoHash:"geohash",encodeGeoHash:"geohash",geohash:"geohash",refine_interval:"geohash",$:"jQuery",addResizeListener:"jQuery",jQuery:"jQuery",removeResizeListener:"jQuery",mocha:"mocha",Mocha:"mocha",after:"after",afterEach:"afterEach",before:"before",beforeEach:"beforeEach",context:"context",describe:"describe",it:"it",specify:"specify",xcontext:"xcontext",xdescribe:"xdescribe",xit:"xit",xspecify:"xspecify",should:"should",Should:"should",log4javascript:"log4javascript",proj4:"proj4",_:"underscore",top:"top",window:"window",location:"location",external:"external",chrome:"chrome",document:"document",locuslabs:"locuslabs",WebConsole:"WebConsole"};var e=document.getElementById("map"),n={accessKey:!0,align:!0,attributes:!0,baseURI:!0,childNodes:!0,children:!0,classList:!0,className:!0,contentEditable:!0,dataset:!0,dir:!0,firstChild:!0,firstElementChild:!0,id:!0,innerHTML:!0,innerText:!0,lang:!0,lastChild:!0,lastElementChild:!0,localName:!0,namespaceURI:!0,nextElementSibling:!0,nextSibling:!0,nodeName:!0,nodeValue:!0,offsetParent:!0,outerHTML:!0,outerText:!0,ownerDocument:!0,ownerElement:!0,parentElement:!0,parentNode:!0,previousSibling:!0,style:!0,tagName:!0,textContent:!0,title:!0,webkitdropzone:!0,wholeText:!0},i=[];_.each(_.keys(window),function(e){var n=window[e];t[e]?_.noop():"function"==typeof n?i.push("function: "+e):"object"==typeof n?i.push("object: "+e):"number"==typeof n?i.push("number: "+e+" = "+n):"string"==typeof n?i.push("string: "+e+" = "+n+" length: "+n.length):"boolean"==typeof n?i.push("boolean: "+e+" = "+n):"undefined"==typeof n?i.push("undefined: "+e):i.push("Don't understand: "+e+" typeof: "+typeof window[e])});var s=new locuslabs.ObjectPrinter;return _.each(_.keys(e),function(t){var o="",a=_.isString(e[t])||_.isObject(e[t])||_.isArray(e[t]);if(a&&!n[t])if(e[t]instanceof Element){var r=e[t].id?"#"+e[t].id:"",l=e[t].className?"."+e[t].className:"";i.push("DOM object: map."+t+": "+e[t].nodeName+l+r)}else o=_.isFunction(e[t])?"function":_.isObject(e[t])?"object":_.isNumber(e[t])?"number":_.isUndefined(e[t])?"undefined":"Don't understand: ",i.push(s.process(e[t],o+": map."+t))}),i.sort(),i=_.flatten(i)},output:function(){console.log("Unexpected global values");var t=this.process();_.each(t,function(t){console.log("    "+t)})}});